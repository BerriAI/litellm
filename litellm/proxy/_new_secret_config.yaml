model_list:
  - model_name: gpt-3.5-turbo
    litellm_params:
      model: openai/gpt-3.5-turbo
      api_key: os.environ/OPENAI_API_KEY
  - model_name: gpt-4o
    litellm_params:
      model: openai/gpt-4o
      api_key: os.environ/OPENAI_API_KEY
  - model_name: claude-sonnet-4-5-20250929
    litellm_params:
      model: anthropic/claude-sonnet-4-5-20250929
  - model_name: gpt-4.1-mini
    litellm_params:
      model: openai/gpt-4.1-mini

# ==============================================================================
# GUARDRAILS - PII Detection for Fortescue (Australian Mining Company)
# ==============================================================================

guardrails:
  # --------------------------------------------------------------------------
  # 1. AUSTRALIAN-SPECIFIC PII PATTERNS
  # --------------------------------------------------------------------------
  - guardrail_name: au-pii-tax-identifiers
    litellm_params:
      guardrail: litellm_content_filter
      mode: pre_call
      patterns:
        # Australian Tax File Number (8-9 digits)
        - pattern_type: prebuilt
          pattern_name: au_tfn
          action: MASK
        # Australian Business Number (11 digits)
        - pattern_type: prebuilt
          pattern_name: au_abn
          action: MASK
        # Australian Medicare Number
        - pattern_type: prebuilt
          pattern_name: au_medicare
          action: MASK
      pattern_redaction_format: "[{pattern_name}_REDACTED]"

  - guardrail_name: au-pii-passports
    litellm_params:
      guardrail: litellm_content_filter
      mode: pre_call
      patterns:
        # Australian passport (critical for mining contractors/fly-in-fly-out workers)
        - pattern_type: prebuilt
          pattern_name: passport_australia
          action: MASK
      pattern_redaction_format: "[PASSPORT_REDACTED]"

  # --------------------------------------------------------------------------
  # 2. INTERNATIONAL PII (for global workforce)
  # --------------------------------------------------------------------------
  - guardrail_name: international-pii-identifiers
    litellm_params:
      guardrail: litellm_content_filter
      mode: pre_call
      patterns:
        # US employees/contractors
        - pattern_type: prebuilt
          pattern_name: us_ssn
          action: MASK
        - pattern_type: prebuilt
          pattern_name: us_ssn_no_dash
          action: MASK
        - pattern_type: prebuilt
          pattern_name: passport_us
          action: MASK
        # UK operations
        - pattern_type: prebuilt
          pattern_name: passport_uk
          action: MASK
        # European operations
        - pattern_type: prebuilt
          pattern_name: passport_germany
          action: MASK
        - pattern_type: prebuilt
          pattern_name: passport_france
          action: MASK
        - pattern_type: prebuilt
          pattern_name: passport_netherlands
          action: MASK
        # Dutch BSN (contextual)
        - pattern_type: prebuilt
          pattern_name: nl_bsn_contextual
          action: MASK
        # Asian Pacific operations
        - pattern_type: prebuilt
          pattern_name: passport_china
          action: MASK
        - pattern_type: prebuilt
          pattern_name: passport_india
          action: MASK
        - pattern_type: prebuilt
          pattern_name: passport_japan
          action: MASK
        # Canadian operations
        - pattern_type: prebuilt
          pattern_name: passport_canada
          action: MASK
        # South American operations (mining companies often have Brazilian presence)
        - pattern_type: prebuilt
          pattern_name: br_cpf
          action: MASK
        - pattern_type: prebuilt
          pattern_name: br_cpf_unformatted
          action: MASK
        - pattern_type: prebuilt
          pattern_name: br_rg
          action: MASK
        - pattern_type: prebuilt
          pattern_name: br_cnpj
          action: MASK
      pattern_redaction_format: "[{pattern_name}_REDACTED]"

  # --------------------------------------------------------------------------
  # 3. CONTACT INFORMATION
  # --------------------------------------------------------------------------
  - guardrail_name: contact-information-pii
    litellm_params:
      guardrail: litellm_content_filter
      mode: pre_call
      patterns:
        # Email addresses (employees, contractors, suppliers)
        - pattern_type: prebuilt
          pattern_name: email
          action: MASK
        # Phone numbers (US format, commonly used internationally)
        - pattern_type: prebuilt
          pattern_name: us_phone
          action: MASK
        # Brazilian phones (if applicable)
        - pattern_type: prebuilt
          pattern_name: br_phone_landline
          action: MASK
        - pattern_type: prebuilt
          pattern_name: br_phone_mobile
          action: MASK
        # Street addresses (mining sites, offices, residential)
        - pattern_type: prebuilt
          pattern_name: street_address
          action: MASK
        # Postal codes
        - pattern_type: prebuilt
          pattern_name: br_cep
          action: MASK
      pattern_redaction_format: "[{pattern_name}_REDACTED]"

  # --------------------------------------------------------------------------
  # 4. FINANCIAL & PAYMENT INFORMATION
  # --------------------------------------------------------------------------
  - guardrail_name: financial-pii
    litellm_params:
      guardrail: litellm_content_filter
      mode: pre_call
      patterns:
        # Credit cards (corporate cards, employee expenses)
        - pattern_type: prebuilt
          pattern_name: visa
          action: MASK
        - pattern_type: prebuilt
          pattern_name: mastercard
          action: MASK
        - pattern_type: prebuilt
          pattern_name: amex
          action: MASK
        - pattern_type: prebuilt
          pattern_name: discover
          action: MASK
        - pattern_type: prebuilt
          pattern_name: credit_card
          action: MASK
        # International banking (IBAN for international payments)
        - pattern_type: prebuilt
          pattern_name: iban
          action: MASK
      pattern_redaction_format: "[{pattern_name}_REDACTED]"

  # --------------------------------------------------------------------------
  # 5. CREDENTIALS & API KEYS (BLOCK - High Risk)
  # --------------------------------------------------------------------------
  - guardrail_name: credentials-api-keys
    litellm_params:
      guardrail: litellm_content_filter
      mode: pre_call
      patterns:
        # AWS credentials (critical infrastructure access)
        - pattern_type: prebuilt
          pattern_name: aws_access_key
          action: BLOCK
        - pattern_type: prebuilt
          pattern_name: aws_secret_key
          action: BLOCK
        # GitHub tokens (code repository access)
        - pattern_type: prebuilt
          pattern_name: github_token
          action: BLOCK
        # Slack tokens (internal communications)
        - pattern_type: prebuilt
          pattern_name: slack_token
          action: BLOCK
        # Generic API keys
        - pattern_type: prebuilt
          pattern_name: generic_api_key
          action: BLOCK
      pattern_redaction_format: "[{pattern_name}_REDACTED]"

  # --------------------------------------------------------------------------
  # 6. NETWORK INFORMATION (Mining operations, remote sites)
  # --------------------------------------------------------------------------
  - guardrail_name: network-infrastructure-pii
    litellm_params:
      guardrail: litellm_content_filter
      mode: pre_call
      patterns:
        # IP addresses (internal network, mining site infrastructure)
        - pattern_type: prebuilt
          pattern_name: ipv4
          action: MASK
        - pattern_type: prebuilt
          pattern_name: ipv6
          action: MASK
      pattern_redaction_format: "[INTERNAL_IP_REDACTED]"

  # --------------------------------------------------------------------------
  # 7. PROTECTED CLASS INFORMATION (Fair Lending, HR Compliance)
  # Critical for mining industry with diverse workforce
  # --------------------------------------------------------------------------
  - guardrail_name: protected-class-information
    litellm_params:
      guardrail: litellm_content_filter
      mode: pre_call
      patterns:
        # Gender and sexual orientation (workplace discrimination prevention)
        - pattern_type: prebuilt
          pattern_name: gender_sexual_orientation
          action: MASK
        # Race, ethnicity, national origin (diversity/inclusion compliance)
        - pattern_type: prebuilt
          pattern_name: race_ethnicity_national_origin
          action: MASK
        # Religion and creed
        - pattern_type: prebuilt
          pattern_name: religion
          action: MASK
        # Age discrimination (important for mining workforce management)
        - pattern_type: prebuilt
          pattern_name: age_discrimination
          action: MASK
        # Disability status (safety accommodations, worker's compensation)
        - pattern_type: prebuilt
          pattern_name: disability
          action: MASK
        # Marital and family status (relocation, benefits)
        - pattern_type: prebuilt
          pattern_name: marital_family_status
          action: MASK
        # Military status
        - pattern_type: prebuilt
          pattern_name: military_status
          action: MASK
        # Public assistance status
        - pattern_type: prebuilt
          pattern_name: public_assistance
          action: MASK
      pattern_redaction_format: "[PROTECTED_CLASS_INFO_REDACTED]"

  # --------------------------------------------------------------------------
  # 8. CUSTOM CODE GUARDRAIL - Mining Industry Specific PII
  # --------------------------------------------------------------------------
  - guardrail_name: mining-industry-custom-pii
    litellm_params:
      guardrail: custom_code
      mode: pre_call
      custom_code: |
        def apply_guardrail(inputs, request_data, input_type):
            """
            Custom PII detection for mining industry:
            - Australian Company Numbers (ACN)
            - Mining License Numbers
            - Site-specific employee IDs
            - Geological coordinates (sensitive mine locations)
            """
            import re
            
            for text in inputs["texts"]:
                # Australian Company Number (ACN) - 9 digits, space-separated
                # Format: XXX XXX XXX
                acn_pattern = r'\b\d{3}\s\d{3}\s\d{3}\b'
                if re.search(acn_pattern, text):
                    # Mask ACNs
                    text = re.sub(acn_pattern, '[ACN_REDACTED]', text)
                
                # Mining tenement/license numbers (Australian format)
                # Format: M/E/P + numbers (e.g., M12345, EL6789)
                mining_license_pattern = r'\b[MEP][A-Z]?\s?\d{4,6}\b'
                if re.search(mining_license_pattern, text, re.IGNORECASE):
                    text = re.sub(mining_license_pattern, '[MINING_LICENSE_REDACTED]', text, flags=re.IGNORECASE)
                
                # Precise GPS coordinates (sensitive mine locations)
                # Format: latitude, longitude with high precision
                gps_pattern = r'-?\d{1,3}\.\d{4,}\s*,\s*-?\d{1,3}\.\d{4,}'
                if re.search(gps_pattern, text):
                    text = re.sub(gps_pattern, '[GPS_COORDINATES_REDACTED]', text)
                
                # FIFO/DIDO roster numbers or employee mining IDs
                # Format: Common mining employee ID patterns
                employee_id_pattern = r'\b(?:EMP|FIF|DID|MIN)[_-]?\d{5,8}\b'
                if re.search(employee_id_pattern, text, re.IGNORECASE):
                    text = re.sub(employee_id_pattern, '[EMPLOYEE_ID_REDACTED]', text, flags=re.IGNORECASE)
                
                # Update the text in inputs if any modifications were made
                if text != inputs["texts"][inputs["texts"].index(inputs["texts"][next(i for i, t in enumerate(inputs["texts"]) if t == text)])]:
                    inputs["texts"][inputs["texts"].index(inputs["texts"][next(i for i, t in enumerate(inputs["texts"]) if t == text)])] = text
            
            return allow()

# ==============================================================================
# POLICIES - Combining PII Guardrails
# ==============================================================================

policies:
  # Comprehensive PII policy for Fortescue mining operations
  fortescue-pii-protection:
    description: >
      Comprehensive PII detection and masking policy for Fortescue.
      Protects Australian-specific identifiers, international employee data,
      financial information, credentials, protected class information,
      and mining industry-specific sensitive data.
    guardrails:
      add:
        # Australian-specific
        - au-pii-tax-identifiers
        - au-pii-passports
        # International workforce
        - international-pii-identifiers
        # Contact information
        - contact-information-pii
        # Financial data
        - financial-pii
        # Credentials (blocks instead of masks)
        - credentials-api-keys
        # Network infrastructure
        - network-infrastructure-pii
        # Protected class compliance
        - protected-class-information
        # Mining industry custom
        - mining-industry-custom-pii

  # Baseline policy for non-sensitive internal use
  fortescue-pii-baseline:
    description: >
      Baseline PII protection for internal tools and testing.
      Focuses on credentials and high-risk identifiers only.
    guardrails:
      add:
        - au-pii-tax-identifiers
        - credentials-api-keys
        - financial-pii

  # HR and recruiting policy (extra strict on protected class)
  fortescue-pii-hr-recruiting:
    description: >
      Strict PII protection for HR, recruiting, and workforce management.
      Emphasizes protected class information to ensure compliance with
      anti-discrimination laws and workplace regulations.
    inherit: fortescue-pii-protection
    guardrails:
      add:
        # Already includes protected-class-information from parent
        # This policy ensures all PII filters are active for HR use cases

# ==============================================================================
# POLICY ATTACHMENTS - Apply Policies to Teams/Keys/Models
# ==============================================================================

policy_attachments:
  # Apply comprehensive PII protection globally
  - policy: fortescue-pii-protection
    scope: "*"  # Applies to all requests by default
  
  # Override for HR team with stricter policy
  # Uncomment and modify team alias after creating teams
  # - policy: fortescue-pii-hr-recruiting
  #   teams:
  #     - hr-team
  #     - recruiting-team
  #     - workforce-management
  
  # Override for internal development/testing with baseline policy
  # - policy: fortescue-pii-baseline
  #   teams:
  #     - internal-dev
  #     - testing-team
  #   keys:
  #     - dev-*
  #     - test-*