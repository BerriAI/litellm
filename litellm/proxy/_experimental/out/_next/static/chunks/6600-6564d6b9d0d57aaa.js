"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6600],{66600:function(e,s,t){t.d(s,{Z:function(){return X}});var l=t(57437),a=t(2265),r=t(40278),n=t(12514),i=t(49804),c=t(67101),o=t(47323),d=t(92414),m=t(46030),u=t(97765),h=t(12485),x=t(18135),p=t(35242),f=t(29706),g=t(77991),v=t(84264),_=t(39789),y=t(9114),j=t(23628),N=t(19250),b=t(20831),k=t(51853),C=t(44643),w=t(71157);let S=e=>{let{responseTimeMs:s}=e;return null==s?null:(0,l.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-500 font-mono",children:[(0,l.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M12 6V12L16 14M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,l.jsxs)("span",{children:[s.toFixed(0),"ms"]})]})},Z=e=>{let s=e;if("string"==typeof s)try{s=JSON.parse(s)}catch(e){}return s},A=e=>{let{label:s,value:t}=e,[r,n]=a.useState(!1),[i,c]=a.useState(!1),o=(null==t?void 0:t.toString())||"N/A",d=o.length>50?o.substring(0,50)+"...":o;return(0,l.jsx)("tr",{className:"hover:bg-gray-50",children:(0,l.jsx)("td",{className:"px-4 py-2 align-top",colSpan:2,children:(0,l.jsxs)("div",{className:"flex items-center justify-between group",children:[(0,l.jsxs)("div",{className:"flex items-center flex-1",children:[(0,l.jsx)("button",{onClick:()=>n(!r),className:"text-gray-400 hover:text-gray-600 mr-2",children:r?"▼":"▶"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm text-gray-600",children:s}),(0,l.jsx)("pre",{className:"mt-1 text-sm font-mono text-gray-800 whitespace-pre-wrap",children:r?o:d})]})]}),(0,l.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(o),c(!0),setTimeout(()=>c(!1),2e3)},className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-gray-600",children:(0,l.jsx)(k.Z,{className:"h-4 w-4"})})]})})})},T=e=>{var s,t,a,r,n,i,c,o,d,m,u,_,y,j;let{response:N}=e,b=null,k={},S={};try{if(null==N?void 0:N.error)try{let e="string"==typeof N.error.message?JSON.parse(N.error.message):N.error.message;b={message:(null==e?void 0:e.message)||"Unknown error",traceback:(null==e?void 0:e.traceback)||"No traceback available",litellm_params:(null==e?void 0:e.litellm_cache_params)||{},health_check_cache_params:(null==e?void 0:e.health_check_cache_params)||{}},k=Z(b.litellm_params)||{},S=Z(b.health_check_cache_params)||{}}catch(e){console.warn("Error parsing error details:",e),b={message:String(N.error.message||"Unknown error"),traceback:"Error parsing details",litellm_params:{},health_check_cache_params:{}}}else k=Z(null==N?void 0:N.litellm_cache_params)||{},S=Z(null==N?void 0:N.health_check_cache_params)||{}}catch(e){console.warn("Error in response parsing:",e),k={},S={}}let T={redis_host:(null==S?void 0:null===(a=S.redis_client)||void 0===a?void 0:null===(t=a.connection_pool)||void 0===t?void 0:null===(s=t.connection_kwargs)||void 0===s?void 0:s.host)||(null==S?void 0:null===(i=S.redis_async_client)||void 0===i?void 0:null===(n=i.connection_pool)||void 0===n?void 0:null===(r=n.connection_kwargs)||void 0===r?void 0:r.host)||(null==S?void 0:null===(c=S.connection_kwargs)||void 0===c?void 0:c.host)||(null==S?void 0:S.host)||"N/A",redis_port:(null==S?void 0:null===(m=S.redis_client)||void 0===m?void 0:null===(d=m.connection_pool)||void 0===d?void 0:null===(o=d.connection_kwargs)||void 0===o?void 0:o.port)||(null==S?void 0:null===(y=S.redis_async_client)||void 0===y?void 0:null===(_=y.connection_pool)||void 0===_?void 0:null===(u=_.connection_kwargs)||void 0===u?void 0:u.port)||(null==S?void 0:null===(j=S.connection_kwargs)||void 0===j?void 0:j.port)||(null==S?void 0:S.port)||"N/A",redis_version:(null==S?void 0:S.redis_version)||"N/A",startup_nodes:(()=>{try{var e,s,t,l,a,r,n,i,c,o,d,m,u;if(null==S?void 0:null===(e=S.redis_kwargs)||void 0===e?void 0:e.startup_nodes)return JSON.stringify(S.redis_kwargs.startup_nodes);let h=(null==S?void 0:null===(l=S.redis_client)||void 0===l?void 0:null===(t=l.connection_pool)||void 0===t?void 0:null===(s=t.connection_kwargs)||void 0===s?void 0:s.host)||(null==S?void 0:null===(n=S.redis_async_client)||void 0===n?void 0:null===(r=n.connection_pool)||void 0===r?void 0:null===(a=r.connection_kwargs)||void 0===a?void 0:a.host),x=(null==S?void 0:null===(o=S.redis_client)||void 0===o?void 0:null===(c=o.connection_pool)||void 0===c?void 0:null===(i=c.connection_kwargs)||void 0===i?void 0:i.port)||(null==S?void 0:null===(u=S.redis_async_client)||void 0===u?void 0:null===(m=u.connection_pool)||void 0===m?void 0:null===(d=m.connection_kwargs)||void 0===d?void 0:d.port);return h&&x?JSON.stringify([{host:h,port:x}]):"N/A"}catch(e){return"N/A"}})(),namespace:(null==S?void 0:S.namespace)||"N/A"};return(0,l.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,l.jsxs)(x.Z,{children:[(0,l.jsxs)(p.Z,{className:"border-b border-gray-200 px-4",children:[(0,l.jsx)(h.Z,{className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Summary"}),(0,l.jsx)(h.Z,{className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Raw Response"})]}),(0,l.jsxs)(g.Z,{children:[(0,l.jsx)(f.Z,{className:"p-4",children:(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center mb-6",children:[(null==N?void 0:N.status)==="healthy"?(0,l.jsx)(C.Z,{className:"h-5 w-5 text-green-500 mr-2"}):(0,l.jsx)(w.Z,{className:"h-5 w-5 text-red-500 mr-2"}),(0,l.jsxs)(v.Z,{className:"text-sm font-medium ".concat((null==N?void 0:N.status)==="healthy"?"text-green-500":"text-red-500"),children:["Cache Status: ",(null==N?void 0:N.status)||"unhealthy"]})]}),(0,l.jsx)("table",{className:"w-full border-collapse",children:(0,l.jsxs)("tbody",{children:[b&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:2,className:"pt-4 pb-2 font-semibold text-red-600",children:"Error Details"})}),(0,l.jsx)(A,{label:"Error Message",value:b.message}),(0,l.jsx)(A,{label:"Traceback",value:b.traceback})]}),(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:2,className:"pt-4 pb-2 font-semibold",children:"Cache Details"})}),(0,l.jsx)(A,{label:"Cache Configuration",value:String(null==k?void 0:k.type)}),(0,l.jsx)(A,{label:"Ping Response",value:String(N.ping_response)}),(0,l.jsx)(A,{label:"Set Cache Response",value:N.set_cache_response||"N/A"}),(0,l.jsx)(A,{label:"litellm_settings.cache_params",value:JSON.stringify(k,null,2)}),(null==k?void 0:k.type)==="redis"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:2,className:"pt-4 pb-2 font-semibold",children:"Redis Details"})}),(0,l.jsx)(A,{label:"Redis Host",value:T.redis_host||"N/A"}),(0,l.jsx)(A,{label:"Redis Port",value:T.redis_port||"N/A"}),(0,l.jsx)(A,{label:"Redis Version",value:T.redis_version||"N/A"}),(0,l.jsx)(A,{label:"Startup Nodes",value:T.startup_nodes||"N/A"}),(0,l.jsx)(A,{label:"Namespace",value:T.namespace||"N/A"})]})]})})]})}),(0,l.jsx)(f.Z,{className:"p-4",children:(0,l.jsx)("div",{className:"bg-gray-50 rounded-md p-4 font-mono text-sm",children:(0,l.jsx)("pre",{className:"whitespace-pre-wrap break-words overflow-auto max-h-[500px]",children:(()=>{try{let e={...N,litellm_cache_params:k,health_check_cache_params:S},s=JSON.parse(JSON.stringify(e,(e,s)=>{if("string"==typeof s)try{return JSON.parse(s)}catch(e){}return s}));return JSON.stringify(s,null,2)}catch(e){return"Error formatting JSON: "+e.message}})()})})})]})]})})},R=e=>{let{accessToken:s,healthCheckResponse:t,runCachingHealthCheck:r,responseTimeMs:n}=e,[i,c]=a.useState(null),[o,d]=a.useState(!1),m=async()=>{d(!0);let e=performance.now();await r(),c(performance.now()-e),d(!1)};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(b.Z,{onClick:m,disabled:o,className:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm px-4 py-2 rounded-md",children:o?"Running Health Check...":"Run Health Check"}),(0,l.jsx)(S,{responseTimeMs:i})]}),t&&(0,l.jsx)(T,{response:t})]})};var E=t(87452),L=t(88829),F=t(72208),I=t(25512),O=e=>{let{redisType:s,redisTypeDescriptions:t,onTypeChange:a}=e;return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Redis Type"}),(0,l.jsxs)(I.P,{value:s,onValueChange:a,children:[(0,l.jsx)(I.Q,{value:"node",children:"Node (Single Instance)"}),(0,l.jsx)(I.Q,{value:"cluster",children:"Cluster"}),(0,l.jsx)(I.Q,{value:"sentinel",children:"Sentinel"}),(0,l.jsx)(I.Q,{value:"semantic",children:"Semantic"})]}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:t[s]||"Select the type of Redis deployment you're using"})]})},D=t(80443),H=t(30150),V=t(49566),J=t(52787),P=t(10703),B=t(24199),M=e=>{let{field:s,currentValue:t}=e,[r,n]=(0,a.useState)([]),[i,c]=(0,a.useState)(t||""),{accessToken:o}=(0,D.Z)();if((0,a.useEffect)(()=>{o&&(async()=>{try{let e=await (0,P.p)(o);console.log("Fetched models for selector:",e),e.length>0&&n(e)}catch(e){console.error("Error fetching model info:",e)}})()},[o]),"Boolean"===s.field_type)return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:s.ui_field_name}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",name:s.field_name,defaultChecked:!0===t||"true"===t,className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,l.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:s.field_description})]})]});if("Integer"===s.field_type||"Float"===s.field_type)return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:s.ui_field_name}),(0,l.jsx)(B.Z,{name:s.field_name,type:"number",defaultValue:t,placeholder:s.field_description}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:s.field_description})]});if("List"===s.field_type)return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:s.ui_field_name}),(0,l.jsx)("textarea",{name:s.field_name,defaultValue:"object"==typeof t?JSON.stringify(t,null,2):t,placeholder:s.field_description,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",rows:4}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:s.field_description})]});if("Models_Select"===s.field_type){let e=r.filter(e=>"embedding"===e.mode).map(e=>({value:e.model_group,label:e.model_group}));return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:s.ui_field_name}),(0,l.jsx)(J.default,{value:i,onChange:c,showSearch:!0,placeholder:"Search and select a model...",options:e,style:{width:"100%"},className:"rounded-md",filterOption:(e,s)=>{var t;return(null!==(t=null==s?void 0:s.label)&&void 0!==t?t:"").toLowerCase().includes(e.toLowerCase())}}),(0,l.jsx)("input",{type:"hidden",name:s.field_name,value:i}),s.field_description&&(0,l.jsx)("p",{className:"text-xs text-gray-500",children:s.field_description})]})}if("Integer"===s.field_type||"Float"===s.field_type)return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:s.ui_field_name}),(0,l.jsx)(H.Z,{name:s.field_name,defaultValue:t,placeholder:s.field_description,step:"Float"===s.field_type?.01:1}),s.field_description&&(0,l.jsx)("p",{className:"text-xs text-gray-500",children:s.field_description})]});let d="password"===s.field_name||s.field_name.includes("password")?"password":"text";return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:s.ui_field_name}),(0,l.jsx)(V.Z,{name:s.field_name,type:d,defaultValue:t,placeholder:s.field_description}),s.field_description&&(0,l.jsx)("p",{className:"text-xs text-gray-500",children:s.field_description})]})};let q=(e,s)=>null===e.redis_type||void 0===e.redis_type||e.redis_type===s,G=(e,s)=>e.find(e=>e.field_name===s),U=(e,s)=>{let t=["host","port","password","username"].map(s=>G(e,s)).filter(Boolean),l=["ssl","ssl_cert_reqs","ssl_check_hostname"].map(s=>G(e,s)).filter(Boolean),a=["namespace","ttl","max_connections"].map(s=>G(e,s)).filter(Boolean),r=["gcp_service_account","gcp_ssl_ca_certs"].map(s=>G(e,s)).filter(Boolean);return{basicFields:t,sslFields:l,cacheManagementFields:a,gcpFields:r,clusterFields:e.filter(e=>"cluster"===e.redis_type),sentinelFields:e.filter(e=>"sentinel"===e.redis_type),semanticFields:e.filter(e=>"semantic"===e.redis_type)}},Q=(e,s)=>{let t={type:"redis"};return e.forEach(e=>{if("redis_type"===e.field_name||!q(e,s))return;let l=e.field_name,a=null;if("Boolean"===e.field_type){let e=document.querySelector('input[name="'.concat(l,'"]'));(null==e?void 0:e.checked)!==void 0&&(a=e.checked)}else if("List"===e.field_type){let e=document.querySelector('textarea[name="'.concat(l,'"]'));if(null==e?void 0:e.value)try{a=JSON.parse(e.value)}catch(e){console.error("Invalid JSON for ".concat(l,":"),e)}}else{let s=document.querySelector('input[name="'.concat(l,'"]'));if(null==s?void 0:s.value){let t=s.value.trim();if(""!==t){if("Integer"===e.field_type){let e=Number(t);isNaN(e)||(a=e)}else if("Float"===e.field_type){let e=Number(t);isNaN(e)||(a=e)}else a=t}}}null!=a&&(t[l]=a)}),t};var z=e=>{let{accessToken:s,userRole:t,userID:r}=e,[n,i]=(0,a.useState)({}),[c,o]=(0,a.useState)([]),[d,m]=(0,a.useState)({}),[u,h]=(0,a.useState)("node"),[x,p]=(0,a.useState)(!1),[f,g]=(0,a.useState)(!1),v=(0,a.useCallback)(async()=>{try{let e=await (0,N.getCacheSettingsCall)(s);console.log("cache settings from API",e),e.fields&&o(e.fields),e.current_values&&(i(e.current_values),e.current_values.redis_type&&h(e.current_values.redis_type)),e.redis_type_descriptions&&m(e.redis_type_descriptions)}catch(e){console.error("Failed to load cache settings:",e),y.Z.fromBackend("Failed to load cache settings")}},[s]);(0,a.useEffect)(()=>{s&&v()},[s,v]);let _=async()=>{if(s){p(!0);try{let e=Q(c,u),t=await (0,N.testCacheConnectionCall)(s,e);"success"===t.status?y.Z.success("Cache connection test successful!"):y.Z.fromBackend("Connection test failed: ".concat(t.message||t.error))}catch(e){console.error("Test connection error:",e),y.Z.fromBackend("Connection test failed: ".concat(e.message||"Unknown error"))}finally{p(!1)}}},j=async()=>{if(s){g(!0);try{let e=Q(c,u);"semantic"===u&&(e.type="redis-semantic"),await (0,N.updateCacheSettingsCall)(s,e),y.Z.success("Cache settings updated successfully"),await v()}catch(e){console.error("Failed to save cache settings:",e),y.Z.fromBackend("Failed to update cache settings")}finally{g(!1)}}};if(!s)return null;let{basicFields:k,sslFields:C,cacheManagementFields:w,gcpFields:S,clusterFields:Z,sentinelFields:A,semanticFields:T}=U(c,u);return(0,l.jsxs)("div",{className:"w-full space-y-8 py-2",children:[(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"max-w-3xl",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Cache Settings"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Configure Redis cache for LiteLLM"})]}),(0,l.jsx)(O,{redisType:u,redisTypeDescriptions:d,onTypeChange:h}),(0,l.jsxs)("div",{className:"space-y-6 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Connection Settings"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:k.map(e=>{var s,t;if(!e)return null;let a=null!==(t=null!==(s=n[e.field_name])&&void 0!==s?s:e.field_default)&&void 0!==t?t:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),"cluster"===u&&Z.length>0&&(0,l.jsxs)("div",{className:"space-y-6 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Cluster Configuration"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6",children:Z.map(e=>{var s,t;let a=null!==(t=null!==(s=n[e.field_name])&&void 0!==s?s:e.field_default)&&void 0!==t?t:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),"sentinel"===u&&A.length>0&&(0,l.jsxs)("div",{className:"space-y-6 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Sentinel Configuration"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:A.map(e=>{var s,t;let a=null!==(t=null!==(s=n[e.field_name])&&void 0!==s?s:e.field_default)&&void 0!==t?t:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),"semantic"===u&&T.length>0&&(0,l.jsxs)("div",{className:"space-y-6 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Semantic Configuration"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:T.map(e=>{var s,t;let a=null!==(t=null!==(s=n[e.field_name])&&void 0!==s?s:e.field_default)&&void 0!==t?t:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),(0,l.jsxs)(E.Z,{className:"mt-4",children:[(0,l.jsx)(F.Z,{children:(0,l.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Advanced Settings"})}),(0,l.jsx)(L.Z,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[C.length>0&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-gray-700",children:"SSL Settings"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:C.map(e=>{var s,t;if(!e)return null;let a=null!==(t=null!==(s=n[e.field_name])&&void 0!==s?s:e.field_default)&&void 0!==t?t:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),w.length>0&&(0,l.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-gray-700",children:"Cache Management"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:w.map(e=>{var s,t;if(!e)return null;let a=null!==(t=null!==(s=n[e.field_name])&&void 0!==s?s:e.field_default)&&void 0!==t?t:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),S.length>0&&(0,l.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-gray-700",children:"GCP Authentication"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:S.map(e=>{var s,t;if(!e)return null;let a=null!==(t=null!==(s=n[e.field_name])&&void 0!==s?s:e.field_default)&&void 0!==t?t:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]})]})})]})]}),(0,l.jsxs)("div",{className:"border-t border-gray-200 pt-6 flex justify-end gap-3",children:[(0,l.jsx)(b.Z,{variant:"secondary",size:"sm",onClick:_,disabled:x,className:"text-sm",children:x?"Testing...":"Test Connection"}),(0,l.jsx)(b.Z,{size:"sm",onClick:j,disabled:f,className:"text-sm font-medium",children:f?"Saving...":"Save Changes"})]})]})};let W=e=>{if(e)return e.toISOString().split("T")[0]};function K(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0,notation:"compact",compactDisplay:"short"}).format(e)}var X=e=>{let{accessToken:s,token:t,userRole:b,userID:k,premiumUser:C}=e,[w,S]=(0,a.useState)([]),[Z,A]=(0,a.useState)([]),[T,E]=(0,a.useState)([]),[L,F]=(0,a.useState)([]),[I,O]=(0,a.useState)("0"),[D,H]=(0,a.useState)("0"),[V,J]=(0,a.useState)("0"),[P,B]=(0,a.useState)({from:new Date(Date.now()-6048e5),to:new Date}),[M,q]=(0,a.useState)(""),[G,U]=(0,a.useState)("");(0,a.useEffect)(()=>{s&&P&&((async()=>{F(await (0,N.adminGlobalCacheActivity)(s,W(P.from),W(P.to)))})(),q(new Date().toLocaleString()))},[s]);let Q=Array.from(new Set(L.map(e=>{var s;return null!==(s=null==e?void 0:e.api_key)&&void 0!==s?s:""}))),X=Array.from(new Set(L.map(e=>{var s;return null!==(s=null==e?void 0:e.model)&&void 0!==s?s:""})));Array.from(new Set(L.map(e=>{var s;return null!==(s=null==e?void 0:e.call_type)&&void 0!==s?s:""})));let Y=async(e,t)=>{e&&t&&s&&F(await (0,N.adminGlobalCacheActivity)(s,W(e),W(t)))};(0,a.useEffect)(()=>{console.log("DATA IN CACHE DASHBOARD",L);let e=L;Z.length>0&&(e=e.filter(e=>Z.includes(e.api_key))),T.length>0&&(e=e.filter(e=>T.includes(e.model))),console.log("before processed data in cache dashboard",e);let s=0,t=0,l=0,a=e.reduce((e,a)=>{console.log("Processing item:",a),a.call_type||(console.log("Item has no call_type:",a),a.call_type="Unknown"),s+=(a.total_rows||0)-(a.cache_hit_true_rows||0),t+=a.cache_hit_true_rows||0,l+=a.cached_completion_tokens||0;let r=e.find(e=>e.name===a.call_type);return r?(r["LLM API requests"]+=(a.total_rows||0)-(a.cache_hit_true_rows||0),r["Cache hit"]+=a.cache_hit_true_rows||0,r["Cached Completion Tokens"]+=a.cached_completion_tokens||0,r["Generated Completion Tokens"]+=a.generated_completion_tokens||0):e.push({name:a.call_type,"LLM API requests":(a.total_rows||0)-(a.cache_hit_true_rows||0),"Cache hit":a.cache_hit_true_rows||0,"Cached Completion Tokens":a.cached_completion_tokens||0,"Generated Completion Tokens":a.generated_completion_tokens||0}),e},[]);O(K(t)),H(K(l));let r=t+s;r>0?J((t/r*100).toFixed(2)):J("0"),S(a),console.log("PROCESSED DATA IN CACHE DASHBOARD",a)},[Z,T,P,L]);let $=async()=>{try{y.Z.info("Running cache health check..."),U("");let e=await (0,N.cachingHealthCheckCall)(null!==s?s:"");console.log("CACHING HEALTH CHECK RESPONSE",e),U(e)}catch(s){let e;if(console.error("Error running health check:",s),s&&s.message)try{let t=JSON.parse(s.message);t.error&&(t=t.error),e=t}catch(t){e={message:s.message}}else e={message:"Unknown error occurred"};U({error:e})}};return(0,l.jsxs)(x.Z,{className:"gap-2 p-8 h-full w-full mt-2 mb-8",children:[(0,l.jsxs)(p.Z,{className:"flex justify-between mt-2 w-full items-center",children:[(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)(h.Z,{children:"Cache Analytics"}),(0,l.jsx)(h.Z,{children:(0,l.jsx)("pre",{children:"Cache Health"})}),(0,l.jsx)(h.Z,{children:"Cache Settings"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[M&&(0,l.jsxs)(v.Z,{children:["Last Refreshed: ",M]}),(0,l.jsx)(o.Z,{icon:j.Z,variant:"shadow",size:"xs",className:"self-center",onClick:()=>{q(new Date().toLocaleString())}})]})]}),(0,l.jsxs)(g.Z,{children:[(0,l.jsx)(f.Z,{children:(0,l.jsxs)(n.Z,{children:[(0,l.jsxs)(c.Z,{numItems:3,className:"gap-4 mt-4",children:[(0,l.jsx)(i.Z,{children:(0,l.jsx)(d.Z,{placeholder:"Select API Keys",value:Z,onValueChange:A,children:Q.map(e=>(0,l.jsx)(m.Z,{value:e,children:e},e))})}),(0,l.jsx)(i.Z,{children:(0,l.jsx)(d.Z,{placeholder:"Select Models",value:T,onValueChange:E,children:X.map(e=>(0,l.jsx)(m.Z,{value:e,children:e},e))})}),(0,l.jsx)(i.Z,{children:(0,l.jsx)(_.Z,{value:P,onValueChange:e=>{B(e),Y(e.from,e.to)}})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 mt-4",children:[(0,l.jsxs)(n.Z,{children:[(0,l.jsx)("p",{className:"text-tremor-default font-medium text-tremor-content dark:text-dark-tremor-content",children:"Cache Hit Ratio"}),(0,l.jsx)("div",{className:"mt-2 flex items-baseline space-x-2.5",children:(0,l.jsxs)("p",{className:"text-tremor-metric font-semibold text-tremor-content-strong dark:text-dark-tremor-content-strong",children:[V,"%"]})})]}),(0,l.jsxs)(n.Z,{children:[(0,l.jsx)("p",{className:"text-tremor-default font-medium text-tremor-content dark:text-dark-tremor-content",children:"Cache Hits"}),(0,l.jsx)("div",{className:"mt-2 flex items-baseline space-x-2.5",children:(0,l.jsx)("p",{className:"text-tremor-metric font-semibold text-tremor-content-strong dark:text-dark-tremor-content-strong",children:I})})]}),(0,l.jsxs)(n.Z,{children:[(0,l.jsx)("p",{className:"text-tremor-default font-medium text-tremor-content dark:text-dark-tremor-content",children:"Cached Tokens"}),(0,l.jsx)("div",{className:"mt-2 flex items-baseline space-x-2.5",children:(0,l.jsx)("p",{className:"text-tremor-metric font-semibold text-tremor-content-strong dark:text-dark-tremor-content-strong",children:D})})]})]}),(0,l.jsx)(u.Z,{className:"mt-4",children:"Cache Hits vs API Requests"}),(0,l.jsx)(r.Z,{title:"Cache Hits vs API Requests",data:w,stack:!0,index:"name",valueFormatter:K,categories:["LLM API requests","Cache hit"],colors:["sky","teal"],yAxisWidth:48}),(0,l.jsx)(u.Z,{className:"mt-4",children:"Cached Completion Tokens vs Generated Completion Tokens"}),(0,l.jsx)(r.Z,{className:"mt-6",data:w,stack:!0,index:"name",valueFormatter:K,categories:["Generated Completion Tokens","Cached Completion Tokens"],colors:["sky","teal"],yAxisWidth:48})]})}),(0,l.jsx)(f.Z,{children:(0,l.jsx)(R,{accessToken:s,healthCheckResponse:G,runCachingHealthCheck:$})}),(0,l.jsx)(f.Z,{children:(0,l.jsx)(z,{accessToken:s,userRole:b,userID:k})})]})]})}}}]);