(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,760221,e=>{"use strict";var l=e.i(843476),s=e.i(271645),t=e.i(994388),a=e.i(653824),i=e.i(881073),r=e.i(197647),o=e.i(723731),n=e.i(404206),c=e.i(212931),d=e.i(998573),m=e.i(560445),h=e.i(270377),x=e.i(827252),p=e.i(708347),u=e.i(269200),g=e.i(942232),f=e.i(977572),y=e.i(427612),j=e.i(64848),b=e.i(496020),v=e.i(752978),w=e.i(389083),k=e.i(68155),_=e.i(797672),S=e.i(94629),N=e.i(360820),C=e.i(871943),T=e.i(592968),I=e.i(262218),A=e.i(152990),B=e.i(682830);let L=({policies:e,isLoading:a,onDeleteClick:i,onEditClick:r,onViewClick:o,isAdmin:n=!1})=>{let[c,d]=(0,s.useState)([{id:"created_at",desc:!0}]),m=[{header:"Policy ID",accessorKey:"policy_id",cell:e=>(0,l.jsx)(T.Tooltip,{title:String(e.getValue()||""),children:(0,l.jsx)(t.Button,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>e.getValue()&&o(e.getValue()),children:e.getValue()?`${String(e.getValue()).slice(0,7)}...`:""})})},{header:"Name",accessorKey:"policy_name",cell:({row:e})=>{let s=e.original;return(0,l.jsx)(T.Tooltip,{title:s.policy_name,children:(0,l.jsx)("span",{className:"text-xs font-medium",children:s.policy_name||"-"})})}},{header:"Description",accessorKey:"description",cell:({row:e})=>{let s=e.original;return(0,l.jsx)(T.Tooltip,{title:s.description,children:(0,l.jsx)("span",{className:"text-xs truncate max-w-[200px] block",children:s.description||"-"})})}},{header:"Inherits From",accessorKey:"inherit",cell:({row:e})=>{let s=e.original;return s.inherit?(0,l.jsx)(w.Badge,{color:"blue",size:"xs",children:s.inherit}):(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Guardrails (Add)",accessorKey:"guardrails_add",cell:({row:e})=>{let s=e.original.guardrails_add||[];return 0===s.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[s.slice(0,2).map((e,s)=>(0,l.jsx)(I.Tag,{color:"green",className:"text-xs",children:e},s)),s.length>2&&(0,l.jsx)(T.Tooltip,{title:s.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",s.length-2]})})]})}},{header:"Guardrails (Remove)",accessorKey:"guardrails_remove",cell:({row:e})=>{let s=e.original.guardrails_remove||[];return 0===s.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[s.slice(0,2).map((e,s)=>(0,l.jsx)(I.Tag,{color:"red",className:"text-xs",children:e},s)),s.length>2&&(0,l.jsx)(T.Tooltip,{title:s.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",s.length-2]})})]})}},{header:"Model Condition",accessorKey:"condition",cell:({row:e})=>{let s=e.original,t=s.condition?.model;return t?(0,l.jsx)(T.Tooltip,{title:"string"==typeof t?t:JSON.stringify(t),children:(0,l.jsx)("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"string"==typeof t?t.length>20?t.slice(0,20)+"...":t:"Multiple"})}):(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Created At",accessorKey:"created_at",cell:({row:e})=>{var s;let t=e.original;return(0,l.jsx)(T.Tooltip,{title:t.created_at,children:(0,l.jsx)("span",{className:"text-xs",children:(s=t.created_at)?new Date(s).toLocaleString():"-"})})}},{id:"actions",header:"Actions",cell:({row:e})=>{let s=e.original;return(0,l.jsx)("div",{className:"flex space-x-2",children:n&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T.Tooltip,{title:"Edit policy",children:(0,l.jsx)(v.Icon,{icon:_.PencilIcon,size:"sm",onClick:()=>r(s),className:"cursor-pointer hover:text-blue-500"})}),(0,l.jsx)(T.Tooltip,{title:"Delete policy",children:(0,l.jsx)(v.Icon,{icon:k.TrashIcon,size:"sm",onClick:()=>s.policy_id&&i(s.policy_id,s.policy_name||"Unnamed Policy"),className:"cursor-pointer hover:text-red-500"})})]})})}}],h=(0,A.useReactTable)({data:e,columns:m,state:{sorting:c},onSortingChange:d,getCoreRowModel:(0,B.getCoreRowModel)(),getSortedRowModel:(0,B.getSortedRowModel)(),enableSorting:!0});return(0,l.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(u.Table,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,l.jsx)(y.TableHead,{children:h.getHeaderGroups().map(e=>(0,l.jsx)(b.TableRow,{children:e.headers.map(e=>(0,l.jsx)(j.TableHeaderCell,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,A.flexRender)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,l.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,l.jsx)(N.ChevronUpIcon,{className:"h-4 w-4 text-blue-500"}),desc:(0,l.jsx)(C.ChevronDownIcon,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,l.jsx)(S.SwitchVerticalIcon,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,l.jsx)(g.TableBody,{children:a?(0,l.jsx)(b.TableRow,{children:(0,l.jsx)(f.TableCell,{colSpan:m.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"Loading..."})})})}):e.length>0?h.getRowModel().rows.map(e=>(0,l.jsx)(b.TableRow,{className:"h-8",children:e.getVisibleCells().map(e=>(0,l.jsx)(f.TableCell,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,children:(0,A.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,l.jsx)(b.TableRow,{children:(0,l.jsx)(f.TableCell,{colSpan:m.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"No policies found"})})})})})]})})})};var P=e.i(304967),R=e.i(530212),F=e.i(869216),z=e.i(482725),E=e.i(312361),M=e.i(898586),D=e.i(199133),W=e.i(779241),G=e.i(988297);let O=s.forwardRef(function(e,l){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:l},e),s.createElement("path",{d:"M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"}))});var V=e.i(764205),$=e.i(727749);let{Text:K}=M.Typography,U=[{label:"Next Step",value:"next"},{label:"Allow",value:"allow"},{label:"Block",value:"block"},{label:"Custom Response",value:"modify_response"}],q={allow:"Allow",block:"Block",next:"Next Step",modify_response:"Custom Response"};function H(){return{guardrail:"",on_pass:"next",on_fail:"block",pass_data:!1,modify_response_message:null}}let Y=()=>(0,l.jsx)("div",{style:{width:28,height:28,borderRadius:"50%",backgroundColor:"#eef2ff",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,l.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"#6366f1",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,l.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,l.jsx)("path",{d:"M12 8v4"})]})}),J=()=>(0,l.jsx)("div",{style:{width:28,height:28,borderRadius:"50%",backgroundColor:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,l.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"#6b7280",stroke:"none",children:(0,l.jsx)("polygon",{points:"6,3 20,12 6,21"})})}),Z=()=>(0,l.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"#22c55e",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",style:{flexShrink:0},children:[(0,l.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,l.jsx)("path",{d:"M9 12l2 2 4-4"})]}),Q=()=>(0,l.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"#f87171",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",style:{flexShrink:0},children:(0,l.jsx)("circle",{cx:"12",cy:"12",r:"10"})}),X=({onInsert:e})=>(0,l.jsxs)("div",{className:"flex flex-col items-center",style:{height:56},children:[(0,l.jsx)("div",{style:{width:1,flex:1,backgroundColor:"#d1d5db"}}),(0,l.jsx)("button",{onClick:e,className:"flex items-center justify-center",style:{width:24,height:24,borderRadius:"50%",border:"1px solid #d1d5db",backgroundColor:"#fff",cursor:"pointer",zIndex:1,transition:"all 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.borderColor="#6366f1",e.currentTarget.style.backgroundColor="#eef2ff"},onMouseLeave:e=>{e.currentTarget.style.borderColor="#d1d5db",e.currentTarget.style.backgroundColor="#fff"},title:"Insert step",children:(0,l.jsx)(G.PlusIcon,{style:{width:12,height:12,color:"#9ca3af"}})}),(0,l.jsx)("div",{style:{width:1,flex:1,backgroundColor:"#d1d5db"}})]}),ee=({step:e,stepIndex:s,totalSteps:t,onChange:a,onDelete:i,availableGuardrails:r})=>{let o=r.map(e=>({label:e.guardrail_name||e.guardrail_id,value:e.guardrail_name||e.guardrail_id}));return(0,l.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,backgroundColor:"#fff",maxWidth:720,width:"100%",overflow:"hidden"},children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",style:{padding:"14px 20px 0 20px"},children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(Y,{}),(0,l.jsx)("span",{style:{fontSize:11,fontWeight:700,textTransform:"uppercase",color:"#6366f1",letterSpacing:"0.06em"},children:"GUARDRAIL"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("span",{style:{fontSize:13,color:"#9ca3af"},children:["Step ",s+1]}),(0,l.jsx)("button",{onClick:i,disabled:t<=1,style:{background:"none",border:"none",cursor:t<=1?"not-allowed":"pointer",opacity:t<=1?.3:1,padding:2,display:"flex",alignItems:"center"},title:"Delete step",children:(0,l.jsx)(O,{style:{width:16,height:16,color:"#9ca3af"}})})]})]}),(0,l.jsxs)("div",{style:{padding:"12px 20px 16px 20px"},children:[(0,l.jsx)("label",{style:{fontSize:12,fontWeight:500,color:"#6b7280",display:"block",marginBottom:6},children:"Guardrail"}),(0,l.jsx)(D.Select,{showSearch:!0,style:{width:"100%"},placeholder:"Select a guardrail",value:e.guardrail||void 0,onChange:e=>a({guardrail:e}),options:o,filterOption:(e,l)=>(l?.label??"").toString().toLowerCase().includes(e.toLowerCase())})]}),(0,l.jsxs)("div",{style:{borderTop:"1px solid #f0f0f0",padding:"14px 20px"},children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",style:{marginBottom:8},children:[(0,l.jsx)(Z,{}),(0,l.jsx)("span",{style:{fontSize:13,fontWeight:600,color:"#374151"},children:"ON PASS"})]}),(0,l.jsx)("label",{style:{fontSize:12,fontWeight:500,color:"#6b7280",display:"block",marginBottom:6},children:"Action"}),(0,l.jsx)(D.Select,{style:{width:"100%"},value:e.on_pass,onChange:e=>a({on_pass:e}),options:U}),"modify_response"===e.on_pass&&(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("label",{style:{fontSize:12,fontWeight:500,color:"#6b7280",display:"block",marginBottom:6},children:"Custom Response Message"}),(0,l.jsx)(W.TextInput,{placeholder:"Enter custom response...",value:e.modify_response_message||"",onChange:e=>a({modify_response_message:e.target.value||null})})]})]}),(0,l.jsxs)("div",{style:{borderTop:"1px solid #f0f0f0",padding:"14px 20px"},children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",style:{marginBottom:8},children:[(0,l.jsx)(Q,{}),(0,l.jsx)("span",{style:{fontSize:13,fontWeight:600,color:"#374151"},children:"ON FAIL"})]}),(0,l.jsx)("label",{style:{fontSize:12,fontWeight:500,color:"#6b7280",display:"block",marginBottom:6},children:"Action"}),(0,l.jsx)(D.Select,{style:{width:"100%"},value:e.on_fail,onChange:e=>a({on_fail:e}),options:U}),"modify_response"===e.on_fail&&(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("label",{style:{fontSize:12,fontWeight:500,color:"#6b7280",display:"block",marginBottom:6},children:"Custom Response Message"}),(0,l.jsx)(W.TextInput,{placeholder:"Enter custom response...",value:e.modify_response_message||"",onChange:e=>a({modify_response_message:e.target.value||null})})]})]})]})},el=({pipeline:e,onChange:t,availableGuardrails:a})=>{let i=l=>{var s;let a;t({...e,steps:(s=e.steps,(a=[...s]).splice(l,0,H()),a)})};return(0,l.jsxs)("div",{className:"flex flex-col items-center",style:{padding:"16px 0"},children:[(0,l.jsx)("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:"16px 20px",backgroundColor:"#fff",maxWidth:720,width:"100%"},children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(J,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{style:{fontSize:11,fontWeight:700,textTransform:"uppercase",color:"#6b7280",letterSpacing:"0.06em",display:"block",marginBottom:2},children:"TRIGGER"}),(0,l.jsx)("span",{style:{fontSize:14,fontWeight:600,color:"#111827",display:"block"},children:"Incoming LLM Request"}),(0,l.jsx)("span",{style:{fontSize:13,color:"#9ca3af"},children:"This flow runs when a request matches this policy"})]})]})}),e.steps.map((r,o)=>(0,l.jsxs)(s.default.Fragment,{children:[(0,l.jsx)(X,{onInsert:()=>i(o)}),(0,l.jsx)(ee,{step:r,stepIndex:o,totalSteps:e.steps.length,onChange:l=>{var s;t({...e,steps:(s=e.steps,s.map((e,s)=>s===o?{...e,...l}:e))})},onDelete:()=>{t({...e,steps:function(e,l){if(e.length<=1)return e;let s=[...e];return s.splice(l,1),s}(e.steps,o)})},availableGuardrails:a})]},o)),(0,l.jsx)(X,{onInsert:()=>i(e.steps.length)}),(0,l.jsx)("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:"14px 20px",backgroundColor:"#fff",maxWidth:720,width:"100%"},children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{style:{width:28,height:28,borderRadius:"50%",backgroundColor:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:(0,l.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"#6b7280",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,l.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),(0,l.jsx)("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{style:{fontSize:11,fontWeight:700,textTransform:"uppercase",color:"#6b7280",letterSpacing:"0.06em",display:"block",marginBottom:2},children:"END"}),(0,l.jsx)("span",{style:{fontSize:14,fontWeight:600,color:"#111827",display:"block"},children:"Continue to LLM"}),(0,l.jsx)("span",{style:{fontSize:13,color:"#9ca3af"},children:"Request proceeds to the model"})]})]})})]})},es=({pipeline:e})=>(0,l.jsxs)("div",{className:"flex flex-col items-center",style:{padding:"16px 0"},children:[(0,l.jsx)("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:"14px 20px",backgroundColor:"#fff",maxWidth:720,width:"100%"},children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(J,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{style:{fontSize:11,fontWeight:700,textTransform:"uppercase",color:"#6b7280",letterSpacing:"0.06em",display:"block",marginBottom:2},children:"TRIGGER"}),(0,l.jsx)("span",{style:{fontSize:14,fontWeight:600,color:"#111827"},children:"Incoming LLM Request"})]})]})}),e.steps.map((e,t)=>(0,l.jsxs)(s.default.Fragment,{children:[(0,l.jsx)("div",{style:{width:1,height:32,backgroundColor:"#d1d5db"}}),(0,l.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:"14px 20px",backgroundColor:"#fff",maxWidth:720,width:"100%"},children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",style:{marginBottom:8},children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(Y,{}),(0,l.jsx)("span",{style:{fontSize:11,fontWeight:700,textTransform:"uppercase",color:"#6366f1",letterSpacing:"0.06em"},children:"GUARDRAIL"})]}),(0,l.jsxs)("span",{style:{fontSize:13,color:"#9ca3af"},children:["Step ",t+1]})]}),(0,l.jsx)("div",{style:{fontSize:15,fontWeight:600,color:"#111827",marginBottom:8},children:e.guardrail}),(0,l.jsx)("div",{style:{borderTop:"1px solid #f3f4f6",marginBottom:10}}),(0,l.jsxs)("div",{className:"flex items-center gap-6",style:{fontSize:13,color:"#374151"},children:[(0,l.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,l.jsx)(Z,{})," Pass → ",q[e.on_pass]||e.on_pass]}),(0,l.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,l.jsx)(Q,{})," Fail → ",q[e.on_fail]||e.on_fail]})]})]})]},t))]}),et={pass:{bg:"#f0fdf4",color:"#16a34a",label:"PASS"},fail:{bg:"#fef2f2",color:"#dc2626",label:"FAIL"},error:{bg:"#fffbeb",color:"#d97706",label:"ERROR"}},ea={allow:{bg:"#f0fdf4",color:"#16a34a"},block:{bg:"#fef2f2",color:"#dc2626"},modify_response:{bg:"#eff6ff",color:"#2563eb"}},ei=({pipeline:e,accessToken:a,onClose:i})=>{let r,[o,n]=(0,s.useState)("Hello, can you help me?"),[c,d]=(0,s.useState)(!1),[m,h]=(0,s.useState)(null),[x,p]=(0,s.useState)(null),u=async()=>{if(a){if(e.steps.filter(e=>!e.guardrail).length>0)return void p("All steps must have a guardrail selected");d(!0),h(null),p(null);try{let l=await (0,V.testPipelineCall)(a,e,[{role:"user",content:o}]);h(l)}catch(e){p(e instanceof Error?e.message:String(e))}finally{d(!1)}}};return(0,l.jsxs)("div",{style:{width:400,borderLeft:"1px solid #e5e7eb",backgroundColor:"#fff",display:"flex",flexDirection:"column",flexShrink:0,overflow:"hidden"},children:[(0,l.jsxs)("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)("span",{style:{fontSize:14,fontWeight:600,color:"#111827"},children:"Test Pipeline"}),(0,l.jsx)("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer",fontSize:18,color:"#9ca3af",padding:"0 4px"},children:"x"})]}),(0,l.jsxs)("div",{style:{padding:16,borderBottom:"1px solid #e5e7eb"},children:[(0,l.jsx)("label",{style:{fontSize:12,fontWeight:500,color:"#6b7280",display:"block",marginBottom:6},children:"Test Message"}),(0,l.jsx)("textarea",{value:o,onChange:e=>n(e.target.value),placeholder:"Enter a test message...",rows:3,style:{width:"100%",border:"1px solid #d1d5db",borderRadius:6,padding:"8px 10px",fontSize:13,resize:"vertical",fontFamily:"inherit"}}),(0,l.jsx)(t.Button,{onClick:u,loading:c,style:{marginTop:8,width:"100%"},children:"Run Test"})]}),(0,l.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:16},children:[x&&(0,l.jsx)("div",{style:{padding:"10px 12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:6,fontSize:13,color:"#dc2626",marginBottom:12},children:x}),m&&(0,l.jsxs)("div",{children:[m.step_results.map((e,s)=>{let t=et[e.outcome]||et.error;return(0,l.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:8,padding:"10px 12px",marginBottom:8},children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",style:{marginBottom:4},children:[(0,l.jsxs)("span",{style:{fontSize:13,fontWeight:600,color:"#111827"},children:["Step ",s+1,": ",e.guardrail_name]}),(0,l.jsx)("span",{style:{fontSize:11,fontWeight:700,backgroundColor:t.bg,color:t.color,padding:"2px 8px",borderRadius:4},children:t.label})]}),(0,l.jsxs)("div",{style:{fontSize:12,color:"#6b7280"},children:["Action: ",q[e.action_taken]||e.action_taken,null!=e.duration_seconds&&(0,l.jsxs)("span",{style:{marginLeft:8},children:["(",(1e3*e.duration_seconds).toFixed(0),"ms)"]})]}),e.error_detail&&(0,l.jsx)("div",{style:{fontSize:12,color:"#dc2626",marginTop:4},children:e.error_detail})]},s)}),(0,l.jsxs)("div",{style:{borderTop:"1px solid #e5e7eb",paddingTop:12,marginTop:4},children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{style:{fontSize:13,fontWeight:600,color:"#111827"},children:"Result"}),(r=ea[m.terminal_action]||ea.block,(0,l.jsx)("span",{style:{fontSize:12,fontWeight:700,backgroundColor:r.bg,color:r.color,padding:"3px 10px",borderRadius:4,textTransform:"uppercase"},children:"modify_response"===m.terminal_action?"Custom Response":m.terminal_action}))]}),m.error_message&&(0,l.jsx)("div",{style:{fontSize:12,color:"#dc2626",marginTop:6},children:m.error_message}),m.modify_response_message&&(0,l.jsxs)("div",{style:{fontSize:12,color:"#2563eb",marginTop:6},children:["Response: ",m.modify_response_message]})]})]}),!m&&!x&&(0,l.jsx)("div",{style:{textAlign:"center",color:"#9ca3af",fontSize:13,marginTop:24},children:'Enter a test message and click "Run Test" to execute the pipeline'})]})]})},er=({onBack:e,onSuccess:a,accessToken:i,editingPolicy:r,availableGuardrails:o,createPolicy:n,updatePolicy:c})=>{let m=!!r?.policy_id,[h,x]=(0,s.useState)(r?.policy_name||""),[p,u]=(0,s.useState)(r?.description||""),[g,f]=(0,s.useState)(!1),[y,j]=(0,s.useState)(!1),[b,v]=(0,s.useState)(r?.pipeline||{mode:"pre_call",steps:[H()]}),w=async()=>{if(!h.trim())return void d.message.error("Please enter a policy name");if(!i)return void d.message.error("No access token available");if(b.steps.filter(e=>!e.guardrail).length>0)return void d.message.error("Please select a guardrail for all steps");f(!0);try{let l=b.steps.map(e=>e.guardrail).filter(Boolean),s={policy_name:h,description:p||void 0,guardrails_add:l,guardrails_remove:[],pipeline:b};m&&r?(await c(i,r.policy_id,s),$.default.success("Policy updated successfully")):(await n(i,s),$.default.success("Policy created successfully")),a(),e()}catch(e){console.error("Failed to save policy:",e),$.default.fromBackend("Failed to save policy: "+(e instanceof Error?e.message:String(e)))}finally{f(!1)}};return(0,l.jsxs)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"#f9fafb",zIndex:1e3,display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,l.jsxs)("div",{style:{borderBottom:"1px solid #e5e7eb",backgroundColor:"#fff",padding:"10px 24px",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("button",{onClick:e,style:{background:"none",border:"none",cursor:"pointer",padding:4,display:"flex",alignItems:"center"},children:(0,l.jsx)(R.ArrowLeftIcon,{style:{width:18,height:18,color:"#6b7280"}})}),(0,l.jsx)("span",{style:{fontSize:14,color:"#6b7280"},children:"Policies"}),(0,l.jsx)("span",{style:{fontSize:14,color:"#d1d5db"},children:"/"}),(0,l.jsx)(W.TextInput,{placeholder:"Policy name...",value:h,onChange:e=>x(e.target.value),disabled:m,style:{width:240}}),(0,l.jsx)("span",{style:{fontSize:11,fontWeight:600,backgroundColor:"#eef2ff",color:"#6366f1",padding:"3px 8px",borderRadius:4,letterSpacing:"0.02em"},children:"Flow"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(t.Button,{variant:"secondary",onClick:e,children:"Cancel"}),(0,l.jsx)(t.Button,{variant:"secondary",onClick:()=>j(!y),children:y?"Hide Test":"Test Pipeline"}),(0,l.jsx)(t.Button,{onClick:w,loading:g,children:m?"Update Policy":"Save Policy"})]})]}),(0,l.jsx)("div",{style:{padding:"8px 24px",backgroundColor:"#fff",borderBottom:"1px solid #e5e7eb",flexShrink:0},children:(0,l.jsx)(W.TextInput,{placeholder:"Add a description (optional)...",value:p,onChange:e=>u(e.target.value),style:{maxWidth:500}})}),(0,l.jsxs)("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[(0,l.jsx)("div",{style:{flex:1,overflowY:"auto",display:"flex",justifyContent:"center",padding:"32px 24px"},children:(0,l.jsx)("div",{style:{maxWidth:760,width:"100%"},children:(0,l.jsx)(el,{pipeline:b,onChange:v,availableGuardrails:o})})}),y&&(0,l.jsx)(ei,{pipeline:b,accessToken:i,onClose:()=>j(!1)})]})]})},{Title:eo,Text:en}=M.Typography,ec=({policyId:e,onClose:a,onEdit:i,accessToken:r,isAdmin:o,getPolicy:n})=>{let[c,d]=(0,s.useState)(null),[h,x]=(0,s.useState)(!0),[p,u]=(0,s.useState)([]),[g,f]=(0,s.useState)(!1),y=(0,s.useCallback)(async()=>{if(r&&e){x(!0);try{let l=await n(r,e);d(l),f(!0);try{let l=await (0,V.getResolvedGuardrails)(r,e);u(l.resolved_guardrails||[])}catch(e){console.error("Error fetching resolved guardrails:",e)}finally{f(!1)}}catch(e){console.error("Error fetching policy:",e)}finally{x(!1)}}},[e,r,n]);return((0,s.useEffect)(()=>{y()},[y]),h)?(0,l.jsx)("div",{className:"flex justify-center items-center p-12",children:(0,l.jsx)(z.Spin,{size:"large"})}):c?(0,l.jsx)(P.Card,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)(t.Button,{variant:"secondary",icon:R.ArrowLeftIcon,onClick:a,children:"Back to Policies"}),o&&(0,l.jsx)(t.Button,{icon:_.PencilIcon,onClick:()=>i(c),children:"Edit Policy"})]}),(0,l.jsx)(eo,{level:4,children:c.policy_name}),(0,l.jsxs)(F.Descriptions,{bordered:!0,column:1,children:[(0,l.jsx)(F.Descriptions.Item,{label:"Policy ID",children:(0,l.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:c.policy_id})}),(0,l.jsx)(F.Descriptions.Item,{label:"Description",children:c.description||(0,l.jsx)(en,{type:"secondary",children:"No description"})}),(0,l.jsx)(F.Descriptions.Item,{label:"Inherits From",children:c.inherit?(0,l.jsx)(w.Badge,{color:"blue",size:"sm",children:c.inherit}):(0,l.jsx)(en,{type:"secondary",children:"None"})}),(0,l.jsx)(F.Descriptions.Item,{label:"Created At",children:c.created_at?new Date(c.created_at).toLocaleString():"-"}),(0,l.jsx)(F.Descriptions.Item,{label:"Updated At",children:c.updated_at?new Date(c.updated_at).toLocaleString():"-"})]}),c.pipeline&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(en,{strong:!0,children:"Pipeline Flow"})}),(0,l.jsx)(m.Alert,{message:`Pipeline (${c.pipeline.mode} mode, ${c.pipeline.steps.length} step${1!==c.pipeline.steps.length?"s":""})`,type:"info",showIcon:!0,style:{marginBottom:16}}),(0,l.jsx)(es,{pipeline:c.pipeline})]}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(en,{strong:!0,children:"Guardrails Configuration"})}),p.length>0&&(0,l.jsx)(m.Alert,{message:"Resolved Guardrails",description:(0,l.jsxs)("div",{children:[(0,l.jsx)(en,{type:"secondary",style:{display:"block",marginBottom:8},children:"Final guardrails that will be applied (including inheritance):"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:p.map(e=>(0,l.jsx)(I.Tag,{color:"blue",children:e},e))})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,l.jsxs)(F.Descriptions,{bordered:!0,column:1,children:[(0,l.jsx)(F.Descriptions.Item,{label:"Guardrails to Add",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:c.guardrails_add&&c.guardrails_add.length>0?c.guardrails_add.map(e=>(0,l.jsx)(I.Tag,{color:"green",children:e},e)):(0,l.jsx)(en,{type:"secondary",children:"None"})})}),(0,l.jsx)(F.Descriptions.Item,{label:"Guardrails to Remove",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:c.guardrails_remove&&c.guardrails_remove.length>0?c.guardrails_remove.map(e=>(0,l.jsx)(I.Tag,{color:"red",children:e},e)):(0,l.jsx)(en,{type:"secondary",children:"None"})})})]}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(en,{strong:!0,children:"Conditions"})}),(0,l.jsx)(F.Descriptions,{bordered:!0,column:1,children:(0,l.jsx)(F.Descriptions.Item,{label:"Model Condition",children:c.condition?.model?(0,l.jsx)(I.Tag,{color:"purple",children:"string"==typeof c.condition.model?c.condition.model:JSON.stringify(c.condition.model)}):(0,l.jsx)(en,{type:"secondary",children:"No model condition (applies to all models)"})})})]})}):(0,l.jsxs)(P.Card,{children:[(0,l.jsx)(en,{type:"danger",children:"Policy not found"}),(0,l.jsx)("br",{}),(0,l.jsx)(t.Button,{onClick:a,className:"mt-4",children:"Go Back"})]})};var ed=e.i(808613),em=e.i(91739),eh=e.i(78085),ex=e.i(135214);let{Text:ep}=M.Typography,{Option:eu}=D.Select,eg=({selected:e,onSelect:s})=>(0,l.jsxs)("div",{className:"flex gap-4",style:{padding:"8px 0"},children:[(0,l.jsxs)("div",{onClick:()=>s("simple"),style:{flex:1,padding:"24px 20px",border:`2px solid ${"simple"===e?"#4f46e5":"#e5e7eb"}`,borderRadius:12,cursor:"pointer",backgroundColor:"simple"===e?"#eef2ff":"#fff",transition:"all 0.15s ease"},children:[(0,l.jsx)("div",{style:{width:40,height:40,borderRadius:10,backgroundColor:"simple"===e?"#e0e7ff":"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16},children:(0,l.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"simple"===e?"#4f46e5":"#6b7280",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,l.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),(0,l.jsx)("path",{d:"M8 7h8M8 12h8M8 17h5"})]})}),(0,l.jsx)(ep,{strong:!0,style:{fontSize:15,display:"block",marginBottom:4},children:"Simple Mode"}),(0,l.jsx)(ep,{type:"secondary",style:{fontSize:13},children:"Pick guardrails from a list. All run in parallel."})]}),(0,l.jsxs)("div",{onClick:()=>s("flow_builder"),style:{flex:1,padding:"24px 20px",border:`2px solid ${"flow_builder"===e?"#4f46e5":"#e5e7eb"}`,borderRadius:12,cursor:"pointer",backgroundColor:"flow_builder"===e?"#eef2ff":"#fff",transition:"all 0.15s ease",position:"relative"},children:[(0,l.jsx)(I.Tag,{color:"purple",style:{position:"absolute",top:12,right:12,fontSize:10,fontWeight:600,margin:0},children:"NEW"}),(0,l.jsx)("div",{style:{width:40,height:40,borderRadius:10,backgroundColor:"flow_builder"===e?"#e0e7ff":"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16},children:(0,l.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"flow_builder"===e?"#4f46e5":"#6b7280",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,l.jsx)("path",{d:"M13 2L3 14h9l-1 8 10-12h-9l1-8z"})})}),(0,l.jsx)(ep,{strong:!0,style:{fontSize:15,display:"block",marginBottom:4},children:"Flow Builder"}),(0,l.jsx)(ep,{type:"secondary",style:{fontSize:13},children:"Define steps, conditions, and error responses."})]})]}),ef=({visible:e,onClose:a,onSuccess:i,onOpenFlowBuilder:r,accessToken:o,editingPolicy:n,existingPolicies:d,availableGuardrails:h,createPolicy:x,updatePolicy:p})=>{let[u]=ed.Form.useForm(),[g,f]=(0,s.useState)(!1),[y,j]=(0,s.useState)([]),[b,v]=(0,s.useState)(!1),[w,k]=(0,s.useState)("model"),[_,S]=(0,s.useState)([]),[N,C]=(0,s.useState)("pick_mode"),[T,A]=(0,s.useState)("simple"),{userId:B,userRole:L}=(0,ex.default)(),P=!!n?.policy_id;(0,s.useEffect)(()=>{if(e&&n){let e=n.condition?.model;if(k(e&&/[.*+?^${}()|[\]\\]/.test(e)?"regex":"model"),u.setFieldsValue({policy_name:n.policy_name,description:n.description,inherit:n.inherit,guardrails_add:n.guardrails_add||[],guardrails_remove:n.guardrails_remove||[],model_condition:e}),n.policy_id&&o&&F(n.policy_id),n.pipeline){a(),r();return}C("simple_form")}else e&&(u.resetFields(),j([]),k("model"),A("simple"),C("pick_mode"))},[e,n,u]),(0,s.useEffect)(()=>{e&&o&&R()},[e,o]);let R=async()=>{if(o)try{let e=await (0,V.modelAvailableCall)(o,B,L);if(e?.data){let l=e.data.map(e=>e.id||e.model_name).filter(Boolean);S(l)}}catch(e){console.error("Failed to load available models:",e)}},F=async e=>{if(o){v(!0);try{let l=await (0,V.getResolvedGuardrails)(o,e);j(l.resolved_guardrails||[])}catch(e){console.error("Failed to load resolved guardrails:",e)}finally{v(!1)}}},z=e=>{let l=new Set;if(e.inherit){let s=d.find(l=>l.policy_name===e.inherit);s&&z(s).forEach(e=>l.add(e))}return e.guardrails_add&&e.guardrails_add.forEach(e=>l.add(e)),e.guardrails_remove&&e.guardrails_remove.forEach(e=>l.delete(e)),Array.from(l)},M=()=>{u.resetFields()},G=()=>{M(),C("pick_mode"),A("simple"),a()},O=async()=>{try{f(!0),await u.validateFields();let e=u.getFieldsValue(!0);if(!o)throw Error("No access token available");let l={policy_name:e.policy_name,description:e.description||void 0,inherit:e.inherit||void 0,guardrails_add:e.guardrails_add||[],guardrails_remove:e.guardrails_remove||[],condition:e.model_condition?{model:e.model_condition}:void 0};P&&n?(await p(o,n.policy_id,l),$.default.success("Policy updated successfully")):(await x(o,l),$.default.success("Policy created successfully")),M(),i(),a()}catch(e){console.error("Failed to save policy:",e),$.default.fromBackend("Failed to save policy: "+(e instanceof Error?e.message:String(e)))}finally{f(!1)}},K=h.map(e=>({label:e.guardrail_name||e.guardrail_id,value:e.guardrail_name||e.guardrail_id})),U=d.filter(e=>!n||e.policy_id!==n.policy_id).map(e=>({label:e.policy_name,value:e.policy_name}));return"pick_mode"===N?(0,l.jsxs)(c.Modal,{title:"Create New Policy",open:e,onCancel:G,footer:null,width:620,children:[(0,l.jsx)(eg,{selected:T,onSelect:A}),"flow_builder"===T&&(0,l.jsx)(m.Alert,{message:"You'll be redirected to the full-screen Flow Builder to design your policy logic visually.",type:"info",style:{marginTop:16,backgroundColor:"#eef2ff",border:"1px solid #c7d2fe"}}),(0,l.jsxs)("div",{className:"flex justify-end gap-2",style:{marginTop:24},children:[(0,l.jsx)(t.Button,{variant:"secondary",onClick:G,children:"Cancel"}),(0,l.jsx)(t.Button,{onClick:()=>{"flow_builder"===T?(a(),r()):C("simple_form")},style:{backgroundColor:"#4f46e5",color:"#fff",border:"none"},children:"flow_builder"===T?"Continue to Builder":"Create Policy"})]})]}):(0,l.jsx)(c.Modal,{title:P?"Edit Policy":"Create New Policy",open:e,onCancel:G,footer:null,width:700,children:(0,l.jsxs)(ed.Form,{form:u,layout:"vertical",initialValues:{guardrails_add:[],guardrails_remove:[]},onValuesChange:()=>{j((()=>{let e=u.getFieldsValue(!0),l=e.inherit,s=e.guardrails_add||[],t=e.guardrails_remove||[],a=new Set;if(l){let e=d.find(e=>e.policy_name===l);e&&z(e).forEach(e=>a.add(e))}return s.forEach(e=>a.add(e)),t.forEach(e=>a.delete(e)),Array.from(a).sort()})())},children:[(0,l.jsx)(ed.Form.Item,{name:"policy_name",label:"Policy Name",rules:[{required:!0,message:"Please enter a policy name"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"Policy name can only contain letters, numbers, hyphens, and underscores"}],children:(0,l.jsx)(W.TextInput,{placeholder:"e.g., global-baseline, healthcare-compliance",disabled:P})}),(0,l.jsx)(ed.Form.Item,{name:"description",label:"Description",children:(0,l.jsx)(eh.Textarea,{rows:2,placeholder:"Describe what this policy does..."})}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(ep,{strong:!0,children:"Inheritance"})}),(0,l.jsx)(ed.Form.Item,{name:"inherit",label:"Inherit From",tooltip:"Inherit guardrails from another policy. The child policy will include all guardrails from the parent.",children:(0,l.jsx)(D.Select,{allowClear:!0,placeholder:"Select a parent policy (optional)",options:U,style:{width:"100%"}})}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(ep,{strong:!0,children:"Guardrails"})}),(0,l.jsx)(ed.Form.Item,{name:"guardrails_add",label:"Guardrails to Add",tooltip:"These guardrails will be added to requests matching this policy",children:(0,l.jsx)(D.Select,{mode:"multiple",allowClear:!0,placeholder:"Select guardrails to add",options:K,style:{width:"100%"}})}),(0,l.jsx)(ed.Form.Item,{name:"guardrails_remove",label:"Guardrails to Remove",tooltip:"These guardrails will be removed from inherited guardrails",children:(0,l.jsx)(D.Select,{mode:"multiple",allowClear:!0,placeholder:"Select guardrails to remove (from inherited)",options:K,style:{width:"100%"}})}),y.length>0&&(0,l.jsx)(m.Alert,{message:"Resolved Guardrails",description:(0,l.jsxs)("div",{children:[(0,l.jsx)(ep,{type:"secondary",style:{display:"block",marginBottom:8},children:"These are the final guardrails that will be applied (including inheritance):"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:y.map(e=>(0,l.jsx)(I.Tag,{color:"blue",children:e},e))})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(ep,{strong:!0,children:"Conditions (Optional)"})}),(0,l.jsx)(m.Alert,{message:"Model Scope",description:"By default, this policy will run on all models. You can optionally restrict it to specific models below.",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,l.jsx)(ed.Form.Item,{label:"Model Condition Type",children:(0,l.jsxs)(em.Radio.Group,{value:w,onChange:e=>{k(e.target.value),u.setFieldValue("model_condition",void 0)},children:[(0,l.jsx)(em.Radio,{value:"model",children:"Select Model"}),(0,l.jsx)(em.Radio,{value:"regex",children:"Custom Regex Pattern"})]})}),(0,l.jsx)(ed.Form.Item,{name:"model_condition",label:"model"===w?"Model (Optional)":"Regex Pattern (Optional)",tooltip:"model"===w?"Select a specific model to apply this policy to. Leave empty to apply to all models.":"Enter a regex pattern to match models (e.g., gpt-4.* or bedrock/.*). Leave empty to apply to all models.",children:"model"===w?(0,l.jsx)(D.Select,{showSearch:!0,allowClear:!0,placeholder:"Leave empty to apply to all models",options:_.map(e=>({label:e,value:e})),filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}}):(0,l.jsx)(W.TextInput,{placeholder:"Leave empty to apply to all models (e.g., gpt-4.* or bedrock/claude-.*)"})}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,l.jsx)(t.Button,{variant:"secondary",onClick:G,children:"Cancel"}),(0,l.jsx)(t.Button,{onClick:O,loading:g,children:P?"Update Policy":"Create Policy"})]})]})})};var ey=e.i(848725),ej=e.i(282786);let eb=({attachment:e,accessToken:t})=>{let[a,i]=(0,s.useState)(null),[r,o]=(0,s.useState)(!1),[n,c]=(0,s.useState)(!1),d=async()=>{if(!n&&!r&&t){o(!0);try{let l=await (0,V.estimateAttachmentImpactCall)(t,{policy_name:e.policy_name,scope:e.scope,teams:e.teams,keys:e.keys,models:e.models,tags:e.tags});i(l),c(!0)}catch(e){console.error("Failed to load impact:",e)}finally{o(!1)}}},m=r?(0,l.jsxs)("div",{className:"p-2 text-center",children:[(0,l.jsx)(z.Spin,{size:"small"})," Loading..."]}):a?(0,l.jsx)("div",{className:"text-xs",style:{maxWidth:280},children:-1===a.affected_keys_count?(0,l.jsx)("p",{className:"font-medium text-amber-600",children:"Global scope — affects all keys and teams"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("p",{className:"mb-1",children:[(0,l.jsx)("strong",{children:a.affected_keys_count})," key",1!==a.affected_keys_count?"s":"",","," ",(0,l.jsx)("strong",{children:a.affected_teams_count})," team",1!==a.affected_teams_count?"s":""," affected"]}),a.sample_keys.length>0&&(0,l.jsxs)("div",{className:"mb-1",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Keys: "}),a.sample_keys.map(e=>(0,l.jsx)(I.Tag,{style:{fontSize:10,margin:1},children:e},e))]}),a.sample_teams.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Teams: "}),a.sample_teams.map(e=>(0,l.jsx)(I.Tag,{style:{fontSize:10,margin:1},children:e},e))]}),0===a.affected_keys_count&&0===a.affected_teams_count&&(0,l.jsx)("p",{className:"text-gray-400",children:"No keys or teams currently affected"})]})}):(0,l.jsx)("p",{className:"text-xs text-gray-400",children:"Click to load"});return(0,l.jsx)(ej.Popover,{content:m,title:"Blast Radius",trigger:"click",onOpenChange:e=>{e&&d()},children:(0,l.jsx)(T.Tooltip,{title:"View blast radius",children:(0,l.jsx)(v.Icon,{icon:ey.EyeIcon,size:"sm",className:"cursor-pointer hover:text-blue-500"})})})},ev=({attachments:e,isLoading:t,onDeleteClick:a,isAdmin:i,accessToken:r})=>{let[o,n]=(0,s.useState)([{id:"created_at",desc:!0}]),c=[{header:"Attachment ID",accessorKey:"attachment_id",cell:e=>(0,l.jsx)(T.Tooltip,{title:String(e.getValue()||""),children:(0,l.jsx)("span",{className:"font-mono text-xs text-gray-600",children:e.getValue()?`${String(e.getValue()).slice(0,7)}...`:""})})},{header:"Policy",accessorKey:"policy_name",cell:({row:e})=>{let s=e.original;return(0,l.jsx)(w.Badge,{color:"blue",size:"xs",children:s.policy_name})}},{header:"Scope",accessorKey:"scope",cell:({row:e})=>{let s=e.original;return"*"===s.scope?(0,l.jsx)(w.Badge,{color:"amber",size:"xs",children:"Global (*)"}):s.scope?(0,l.jsx)("span",{className:"text-xs",children:s.scope}):(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Teams",accessorKey:"teams",cell:({row:e})=>{let s=e.original.teams||[];return 0===s.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[s.slice(0,2).map((e,s)=>(0,l.jsx)(I.Tag,{color:"cyan",className:"text-xs",children:e},s)),s.length>2&&(0,l.jsx)(T.Tooltip,{title:s.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",s.length-2]})})]})}},{header:"Keys",accessorKey:"keys",cell:({row:e})=>{let s=e.original.keys||[];return 0===s.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[s.slice(0,2).map((e,s)=>(0,l.jsx)(I.Tag,{color:"purple",className:"text-xs",children:e},s)),s.length>2&&(0,l.jsx)(T.Tooltip,{title:s.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",s.length-2]})})]})}},{header:"Models",accessorKey:"models",cell:({row:e})=>{let s=e.original.models||[];return 0===s.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[s.slice(0,2).map((e,s)=>(0,l.jsx)(I.Tag,{color:"green",className:"text-xs",children:e},s)),s.length>2&&(0,l.jsx)(T.Tooltip,{title:s.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",s.length-2]})})]})}},{header:"Tags",accessorKey:"tags",cell:({row:e})=>{let s=e.original.tags||[];return 0===s.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[s.slice(0,2).map((e,s)=>(0,l.jsx)(I.Tag,{color:"orange",className:"text-xs",children:e},s)),s.length>2&&(0,l.jsx)(T.Tooltip,{title:s.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",s.length-2]})})]})}},{header:"Created At",accessorKey:"created_at",cell:({row:e})=>{var s;let t=e.original;return(0,l.jsx)(T.Tooltip,{title:t.created_at,children:(0,l.jsx)("span",{className:"text-xs",children:(s=t.created_at)?new Date(s).toLocaleString():"-"})})}},{id:"actions",header:"Actions",cell:({row:e})=>{let s=e.original;return(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(eb,{attachment:s,accessToken:r}),i&&(0,l.jsx)(T.Tooltip,{title:"Delete attachment",children:(0,l.jsx)(v.Icon,{icon:k.TrashIcon,size:"sm",onClick:()=>a(s.attachment_id),className:"cursor-pointer hover:text-red-500"})})]})}}],d=(0,A.useReactTable)({data:e,columns:c,state:{sorting:o},onSortingChange:n,getCoreRowModel:(0,B.getCoreRowModel)(),getSortedRowModel:(0,B.getSortedRowModel)(),enableSorting:!0});return(0,l.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(u.Table,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,l.jsx)(y.TableHead,{children:d.getHeaderGroups().map(e=>(0,l.jsx)(b.TableRow,{children:e.headers.map(e=>(0,l.jsx)(j.TableHeaderCell,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,A.flexRender)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,l.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,l.jsx)(N.ChevronUpIcon,{className:"h-4 w-4 text-blue-500"}),desc:(0,l.jsx)(C.ChevronDownIcon,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,l.jsx)(S.SwitchVerticalIcon,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,l.jsx)(g.TableBody,{children:t?(0,l.jsx)(b.TableRow,{children:(0,l.jsx)(f.TableCell,{colSpan:c.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"Loading..."})})})}):e.length>0?d.getRowModel().rows.map(e=>(0,l.jsx)(b.TableRow,{className:"h-8",children:e.getVisibleCells().map(e=>(0,l.jsx)(f.TableCell,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,children:(0,A.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,l.jsx)(b.TableRow,{children:(0,l.jsx)(f.TableCell,{colSpan:c.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"No attachments found"})})})})})]})})})},{Text:ew}=M.Typography,ek=({impactResult:e})=>(0,l.jsx)(m.Alert,{type:-1===e.affected_keys_count?"warning":"info",showIcon:!0,className:"mb-4",message:"Impact Preview",description:-1===e.affected_keys_count?(0,l.jsxs)(ew,{children:["Global scope — this will affect ",(0,l.jsx)("strong",{children:"all keys and teams"}),"."]}):(0,l.jsxs)("div",{children:[(0,l.jsxs)(ew,{children:["This attachment would affect ",(0,l.jsxs)("strong",{children:[e.affected_keys_count," key",1!==e.affected_keys_count?"s":""]})," and ",(0,l.jsxs)("strong",{children:[e.affected_teams_count," team",1!==e.affected_teams_count?"s":""]}),"."]}),e.sample_keys.length>0&&(0,l.jsxs)("div",{className:"mt-1",children:[(0,l.jsx)(ew,{type:"secondary",style:{fontSize:12},children:"Keys: "}),e.sample_keys.slice(0,5).map(e=>(0,l.jsx)(I.Tag,{style:{fontSize:11},children:e},e)),e.affected_keys_count>5&&(0,l.jsxs)(ew,{type:"secondary",style:{fontSize:11},children:["and ",e.affected_keys_count-5," more..."]})]}),e.sample_teams.length>0&&(0,l.jsxs)("div",{className:"mt-1",children:[(0,l.jsx)(ew,{type:"secondary",style:{fontSize:12},children:"Teams: "}),e.sample_teams.slice(0,5).map(e=>(0,l.jsx)(I.Tag,{style:{fontSize:11},children:e},e)),e.affected_teams_count>5&&(0,l.jsxs)(ew,{type:"secondary",style:{fontSize:11},children:["and ",e.affected_teams_count-5," more..."]})]})]})}),{Text:e_}=M.Typography,eS=({visible:e,onClose:a,onSuccess:i,accessToken:r,policies:o,createAttachment:n})=>{let[d]=ed.Form.useForm(),[m,h]=(0,s.useState)(!1),[x,p]=(0,s.useState)("global"),[u,g]=(0,s.useState)([]),[f,y]=(0,s.useState)([]),[j,b]=(0,s.useState)([]),[v,w]=(0,s.useState)(!1),[k,_]=(0,s.useState)(!1),[S,N]=(0,s.useState)(!1),[C,T]=(0,s.useState)(!1),[I,A]=(0,s.useState)(null),{userId:B,userRole:L}=(0,ex.default)();(0,s.useEffect)(()=>{e&&r&&P()},[e,r]);let P=async()=>{if(r){w(!0);try{let e=await (0,V.teamListCall)(r,null,B),l=(Array.isArray(e)?e:e?.data||[]).map(e=>e.team_alias).filter(Boolean);g(l)}catch(e){console.error("Failed to load teams:",e)}finally{w(!1)}_(!0);try{let e=await (0,V.keyListCall)(r,null,null,null,null,null,1,100),l=(e?.keys||e?.data||[]).map(e=>e.key_alias).filter(Boolean);y(l)}catch(e){console.error("Failed to load keys:",e)}finally{_(!1)}N(!0);try{let e=await (0,V.modelAvailableCall)(r,B||"",L||""),l=(e?.data||(Array.isArray(e)?e:[])).map(e=>e.id||e.model_name).filter(Boolean);b(l)}catch(e){console.error("Failed to load models:",e)}finally{N(!1)}}},R=()=>{d.resetFields(),p("global"),A(null)},F=()=>{var e;let l;return e=d.getFieldsValue(!0),l={policy_name:e.policy_name},"global"===x?l.scope="*":(e.teams&&e.teams.length>0&&(l.teams=e.teams),e.keys&&e.keys.length>0&&(l.keys=e.keys),e.models&&e.models.length>0&&(l.models=e.models),e.tags&&e.tags.length>0&&(l.tags=e.tags)),l},z=async()=>{if(r){try{await d.validateFields(["policy_name"])}catch{return}T(!0);try{let e=F(),l=await (0,V.estimateAttachmentImpactCall)(r,e);A(l)}catch(e){console.error("Failed to estimate impact:",e)}finally{T(!1)}}},M=()=>{R(),a()},W=async()=>{try{if(h(!0),await d.validateFields(),!r)throw Error("No access token available");let e=F();await n(r,e),$.default.success("Attachment created successfully"),R(),i(),a()}catch(e){console.error("Failed to create attachment:",e),$.default.fromBackend("Failed to create attachment: "+(e instanceof Error?e.message:String(e)))}finally{h(!1)}},G=o.map(e=>({label:e.policy_name,value:e.policy_name}));return(0,l.jsx)(c.Modal,{title:"Create Policy Attachment",open:e,onCancel:M,footer:null,width:600,children:(0,l.jsxs)(ed.Form,{form:d,layout:"vertical",initialValues:{scope_type:"global"},children:[(0,l.jsx)(ed.Form.Item,{name:"policy_name",label:"Policy",rules:[{required:!0,message:"Please select a policy"}],children:(0,l.jsx)(D.Select,{placeholder:"Select a policy to attach",options:G,showSearch:!0,filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}})}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(e_,{strong:!0,children:"Scope"})}),(0,l.jsx)(ed.Form.Item,{label:"Scope Type",children:(0,l.jsxs)(em.Radio.Group,{value:x,onChange:e=>p(e.target.value),children:[(0,l.jsx)(em.Radio,{value:"specific",children:"Specific (teams, keys, models, or tags)"}),(0,l.jsx)(em.Radio,{value:"global",children:"Global (applies to all requests)"})]})}),"specific"===x&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ed.Form.Item,{name:"teams",label:"Teams",tooltip:"Select team aliases or enter custom patterns. Supports wildcards (e.g., healthcare-*)",children:(0,l.jsx)(D.Select,{mode:"tags",placeholder:v?"Loading teams...":"Select or enter team aliases",loading:v,options:u.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}})}),(0,l.jsx)(ed.Form.Item,{name:"keys",label:"Keys",tooltip:"Select key aliases or enter custom patterns. Supports wildcards (e.g., dev-*)",children:(0,l.jsx)(D.Select,{mode:"tags",placeholder:k?"Loading keys...":"Select or enter key aliases",loading:k,options:f.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}})}),(0,l.jsx)(ed.Form.Item,{name:"models",label:"Models",tooltip:"Model names this attachment applies to. Supports wildcards (e.g., gpt-4*). Leave empty to apply to all models.",children:(0,l.jsx)(D.Select,{mode:"tags",placeholder:S?"Loading models...":"Select or enter model names (e.g., gpt-4, bedrock/*)",loading:S,options:j.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}})}),(0,l.jsx)(ed.Form.Item,{name:"tags",label:"Tags",tooltip:"Match against tags set in key or team metadata. Use exact values (e.g., healthcare) or wildcard patterns (e.g., health-*) where * matches any suffix.",extra:(0,l.jsxs)(e_,{type:"secondary",style:{fontSize:12},children:["Matches tags from key/team ",(0,l.jsx)("code",{children:"metadata.tags"})," or tags passed dynamically in the request body. Use ",(0,l.jsx)("code",{children:"*"})," as a suffix wildcard (e.g., ",(0,l.jsx)("code",{children:"prod-*"})," matches ",(0,l.jsx)("code",{children:"prod-us"}),", ",(0,l.jsx)("code",{children:"prod-eu"}),")."]}),children:(0,l.jsx)(D.Select,{mode:"tags",placeholder:"Type a tag and press Enter (e.g. healthcare, prod-*)",tokenSeparators:[","," "],notFoundContent:null,suffixIcon:null,open:!1,style:{width:"100%"}})})]}),I&&(0,l.jsx)(ek,{impactResult:I}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,l.jsx)(t.Button,{variant:"secondary",onClick:M,children:"Cancel"}),"specific"===x&&(0,l.jsx)(t.Button,{variant:"secondary",onClick:z,loading:C,children:"Estimate Impact"}),(0,l.jsx)(t.Button,{onClick:W,loading:m,children:"Create Attachment"})]})]})})};var eN=e.i(21548);let{Text:eC}=M.Typography,eT=({accessToken:e})=>{let[a]=ed.Form.useForm(),[i,r]=(0,s.useState)(!1),[o,n]=(0,s.useState)(null),[c,d]=(0,s.useState)(!1),[h,x]=(0,s.useState)([]),[p,u]=(0,s.useState)([]),[g,f]=(0,s.useState)([]),{userId:y,userRole:j}=(0,ex.default)();(0,s.useEffect)(()=>{e&&b()},[e]);let b=async()=>{if(e){try{let l=await (0,V.teamListCall)(e,null,y),s=Array.isArray(l)?l:l?.data||[];x(s.map(e=>e.team_alias).filter(Boolean))}catch(e){console.error("Failed to load teams:",e)}try{let l=await (0,V.keyListCall)(e,null,null,null,null,null,1,100),s=l?.keys||l?.data||[];u(s.map(e=>e.key_alias).filter(Boolean))}catch(e){console.error("Failed to load keys:",e)}try{let l=await (0,V.modelAvailableCall)(e,y||"",j||""),s=l?.data||(Array.isArray(l)?l:[]);f(s.map(e=>e.id||e.model_name).filter(Boolean))}catch(e){console.error("Failed to load models:",e)}}},v=async()=>{if(e){r(!0),d(!0);try{let l=a.getFieldsValue(!0),s={};l.team_alias&&(s.team_alias=l.team_alias),l.key_alias&&(s.key_alias=l.key_alias),l.model&&(s.model=l.model),l.tags&&l.tags.length>0&&(s.tags=l.tags);let t=await (0,V.resolvePoliciesCall)(e,s);n(t)}catch(e){console.error("Error resolving policies:",e),n(null)}finally{r(!1)}}};return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"bg-white border rounded-lg p-6 mb-6",children:[(0,l.jsxs)("div",{className:"mb-5",children:[(0,l.jsx)("h3",{className:"text-base font-semibold mb-1",children:"Policy Simulator"}),(0,l.jsx)(eC,{type:"secondary",children:'Simulate a request to see which policies and guardrails would apply. Select a team, key, model, or tags below and click "Simulate" to see the results.'})]}),(0,l.jsxs)(ed.Form,{form:a,layout:"vertical",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)(ed.Form.Item,{name:"team_alias",label:"Team Alias",className:"mb-3",children:(0,l.jsx)(D.Select,{showSearch:!0,allowClear:!0,placeholder:"Select or type a team alias",options:h.map(e=>({label:e,value:e})),filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase())})}),(0,l.jsx)(ed.Form.Item,{name:"key_alias",label:"Key Alias",className:"mb-3",children:(0,l.jsx)(D.Select,{showSearch:!0,allowClear:!0,placeholder:"Select or type a key alias",options:p.map(e=>({label:e,value:e})),filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase())})}),(0,l.jsx)(ed.Form.Item,{name:"model",label:"Model",className:"mb-3",children:(0,l.jsx)(D.Select,{showSearch:!0,allowClear:!0,placeholder:"Select or type a model",options:g.map(e=>({label:e,value:e})),filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase())})}),(0,l.jsx)(ed.Form.Item,{name:"tags",label:"Tags",className:"mb-3",children:(0,l.jsx)(D.Select,{mode:"tags",placeholder:"Type a tag and press Enter",tokenSeparators:[","," "],notFoundContent:null,suffixIcon:null,open:!1})})]}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(t.Button,{onClick:v,loading:i,disabled:!e,children:"Simulate"}),(0,l.jsx)(t.Button,{variant:"secondary",onClick:()=>{a.resetFields(),n(null),d(!1)},children:"Reset"})]})]})]}),!c&&(0,l.jsxs)("div",{className:"bg-white border rounded-lg p-8 text-center",children:[(0,l.jsx)("div",{className:"text-gray-400 mb-2",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),(0,l.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"No simulation run yet"}),(0,l.jsx)("p",{className:"text-xs text-gray-400",children:'Fill in one or more fields above and click "Simulate" to see which policies and guardrails would apply to that request.'})]}),c&&o&&(0,l.jsx)("div",{className:"bg-white border rounded-lg p-6",children:0===o.matched_policies.length?(0,l.jsx)(eN.Empty,{description:"No policies matched this context"}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("p",{className:"text-sm font-semibold mb-2",children:"Effective Guardrails"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:o.effective_guardrails.length>0?o.effective_guardrails.map(e=>(0,l.jsx)(I.Tag,{color:"green",children:e},e)):(0,l.jsx)("span",{className:"text-gray-400 text-sm",children:"None"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-semibold mb-2",children:"Matched Policies"}),(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("th",{className:"text-left py-2 pr-4",children:"Policy"}),(0,l.jsx)("th",{className:"text-left py-2 pr-4",children:"Matched Via"}),(0,l.jsx)("th",{className:"text-left py-2",children:"Guardrails Added"})]})}),(0,l.jsx)("tbody",{children:o.matched_policies.map(e=>(0,l.jsxs)("tr",{className:"border-b last:border-0",children:[(0,l.jsx)("td",{className:"py-2 pr-4 font-medium",children:e.policy_name}),(0,l.jsx)("td",{className:"py-2 pr-4",children:(0,l.jsx)(I.Tag,{color:"blue",children:e.matched_via})}),(0,l.jsx)("td",{className:"py-2",children:e.guardrails_added.length>0?(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:e.guardrails_added.map(e=>(0,l.jsx)(I.Tag,{color:"green",children:e},e))}):(0,l.jsx)("span",{className:"text-gray-400",children:"None"})})]},e.policy_name))})]})]})]})}),c&&!o&&!i&&(0,l.jsx)(m.Alert,{message:"Error",description:"Failed to resolve policies. Check the proxy logs.",type:"error",showIcon:!0})]})};var eI=e.i(175712),eA=e.i(464571);let eB=s.forwardRef(function(e,l){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:l},e),s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"}))}),eL=s.forwardRef(function(e,l){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:l},e),s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.618 5.984A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016zM12 9v2m0 4h.01"}))}),eP=s.forwardRef(function(e,l){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:l},e),s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"}))}),eR=s.forwardRef(function(e,l){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:l},e),s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}))});var eF=e.i(220508);let ez=({title:e,description:s,icon:t,iconColor:a,iconBg:i,guardrails:r,inherits:o,complexity:n,onUseTemplate:c})=>(0,l.jsxs)(eI.Card,{className:"h-full hover:shadow-md transition-shadow",bodyStyle:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,l.jsx)("div",{className:`p-2 rounded-lg ${i}`,children:(0,l.jsx)(t,{className:`h-6 w-6 ${a}`})}),(0,l.jsxs)("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium border ${(()=>{switch(n){case"Low":return"bg-gray-50 text-gray-600 border-gray-200";case"Medium":return"bg-blue-50 text-blue-600 border-blue-100";case"High":return"bg-purple-50 text-purple-600 border-purple-100"}})()}`,children:[n," Complexity"]})]}),(0,l.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-2",children:e}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mb-6 flex-grow",children:s}),o&&(0,l.jsxs)("div",{className:"mb-4 text-xs",children:[(0,l.jsx)("span",{className:"text-gray-500",children:"Inherits from: "}),(0,l.jsx)("span",{className:"font-medium text-gray-700 bg-gray-100 px-2 py-0.5 rounded",children:o})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider block mb-2",children:"Included Guardrails"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(e=>(0,l.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200",children:e},e))})]}),(0,l.jsx)(eA.Button,{type:"primary",block:!0,className:"mt-auto",onClick:c,children:"Use Template"})]}),eE={ShieldCheckIcon:eB,ShieldExclamationIcon:eL,BeakerIcon:eP,CurrencyDollarIcon:eR,CheckCircleIcon:eF.CheckCircleIcon},eM=({onUseTemplate:e,accessToken:t})=>{let[a,i]=(0,s.useState)([]),[r,o]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{(async()=>{if(t){o(!0);try{let e=await (0,V.getPolicyTemplates)(t);i(e)}catch(e){console.error("Error fetching policy templates:",e),d.message.error("Failed to fetch policy templates")}finally{o(!1)}}})()},[t]),r)?(0,l.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,l.jsx)(z.Spin,{size:"large",tip:"Loading policy templates..."})}):(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("div",{className:"flex justify-between items-end",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Policy Templates"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Start with a pre-configured policy template to quickly set up guardrails for your organization."})]})}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:a.map((s,t)=>(0,l.jsx)(ez,{title:s.title,description:s.description,icon:eE[s.icon]||eB,iconColor:s.iconColor,iconBg:s.iconBg,guardrails:s.guardrails,inherits:s.inherits,complexity:s.complexity,onUseTemplate:()=>e(s)},s.id||t))})]})};var eD=e.i(536916),eW=e.i(245704);let eG=({visible:e,template:t,existingGuardrails:a,onConfirm:i,onCancel:r,isLoading:o=!1})=>{let[n,d]=(0,s.useState)(new Set),m=(t?.guardrailDefinitions||[]).map(e=>({guardrail_name:e.guardrail_name,description:e.guardrail_info?.description||"No description available",alreadyExists:a.has(e.guardrail_name),definition:e}));(0,s.useEffect)(()=>{e&&t&&d(new Set(m.filter(e=>!e.alreadyExists).map(e=>e.guardrail_name)))},[e,t]);let h=m.filter(e=>!e.alreadyExists).length,p=m.filter(e=>e.alreadyExists).length,u=n.size;return(0,l.jsx)(c.Modal,{title:(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-1",children:t?.title}),(0,l.jsx)("p",{className:"text-sm text-gray-500 font-normal",children:"Review and select guardrails to create for this template"})]}),open:e,onCancel:r,width:700,footer:[(0,l.jsx)(eA.Button,{onClick:r,disabled:o,children:"Cancel"},"cancel"),(0,l.jsx)(eA.Button,{type:"primary",onClick:()=>{i(m.filter(e=>n.has(e.guardrail_name)).map(e=>e.definition))},loading:o,disabled:0===u&&0===p,children:u>0?`Create ${u} Guardrail${u>1?"s":""} & Use Template`:"Use Template"},"confirm")],children:(0,l.jsxs)("div",{className:"py-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-4 p-3 bg-blue-50 rounded-lg border border-blue-100",children:[(0,l.jsx)(x.InfoCircleOutlined,{className:"text-blue-600 text-lg"}),(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsxs)("span",{className:"font-medium text-gray-900",children:[m.length," total guardrails"]}),(0,l.jsx)("span",{className:"text-gray-600 mx-2",children:"•"}),(0,l.jsxs)("span",{className:"text-green-600 font-medium",children:[h," new"]}),p>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-gray-600 mx-2",children:"•"}),(0,l.jsxs)("span",{className:"text-gray-600",children:[p," already exist"]})]})]})}),h>0&&(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(eA.Button,{size:"small",onClick:()=>{d(new Set(m.filter(e=>!e.alreadyExists).map(e=>e.guardrail_name)))},children:"Select All New"}),(0,l.jsx)(eA.Button,{size:"small",onClick:()=>{d(new Set)},children:"Deselect All"})]})]}),(0,l.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:m.map(e=>(0,l.jsx)("div",{className:`border rounded-lg p-4 ${e.alreadyExists?"bg-gray-50 border-gray-200":"bg-white border-gray-300 hover:border-blue-400"} transition-colors`,children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)("div",{className:"flex-shrink-0 pt-0.5",children:e.alreadyExists?(0,l.jsx)(eW.CheckCircleOutlined,{className:"text-green-600 text-lg"}):(0,l.jsx)(eD.Checkbox,{checked:n.has(e.guardrail_name),onChange:()=>{var l;return l=e.guardrail_name,void d(e=>{let s=new Set(e);return s.has(l)?s.delete(l):s.add(l),s})}})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,l.jsx)("span",{className:"font-mono text-sm font-medium text-gray-900",children:e.guardrail_name}),e.alreadyExists&&(0,l.jsx)(I.Tag,{color:"green",className:"text-xs",children:"Already exists"})]}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,l.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,l.jsx)(I.Tag,{className:"text-xs",children:e.definition?.litellm_params?.guardrail||"unknown"}),(0,l.jsx)(I.Tag,{className:"text-xs",color:"blue",children:e.definition?.litellm_params?.mode||"unknown"}),e.definition?.litellm_params?.patterns&&(0,l.jsxs)(I.Tag,{className:"text-xs",color:"purple",children:[e.definition.litellm_params.patterns.length," pattern(s)"]})]})]})]})},e.guardrail_name))}),0===m.length&&(0,l.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,l.jsx)("p",{children:"No guardrails defined for this template."}),(0,l.jsx)("p",{className:"text-sm mt-2",children:"This template will use existing guardrails in your system."})]}),(0,l.jsx)(E.Divider,{}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:u>0?(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"font-medium text-gray-900",children:u})," ","guardrail",u>1?"s":""," will be created"]}):p>0?(0,l.jsx)("p",{className:"text-green-600",children:"All guardrails already exist. You can proceed to use this template."}):(0,l.jsx)("p",{className:"text-orange-600",children:'Select at least one guardrail to create, or click "Use Template" to proceed without creating new guardrails.'})})]})})};var eO=e.i(127952);e.s(["default",0,({accessToken:e,userRole:u})=>{let[g,f]=(0,s.useState)([]),[y,j]=(0,s.useState)([]),[b,v]=(0,s.useState)([]),[w,k]=(0,s.useState)(!1),[_,S]=(0,s.useState)(!1),[N,C]=(0,s.useState)(!1),[T,I]=(0,s.useState)(!1),[A,B]=(0,s.useState)(null),[P,R]=(0,s.useState)(null),[F,z]=(0,s.useState)(0),[E,M]=(0,s.useState)(!1),[D,W]=(0,s.useState)(null),[G,O]=(0,s.useState)(!1),[$,K]=(0,s.useState)(!1),[U,q]=(0,s.useState)(null),[H,Y]=(0,s.useState)(new Set),[J,Z]=(0,s.useState)(!1),[Q,X]=(0,s.useState)(!1),ee=!!u&&(0,p.isAdminRole)(u),el=(0,s.useCallback)(async()=>{if(e){k(!0);try{let l=await (0,V.getPoliciesList)(e);f(l.policies||[])}catch(e){console.error("Error fetching policies:",e),d.message.error("Failed to fetch policies")}finally{k(!1)}}},[e]),es=(0,s.useCallback)(async()=>{if(e){S(!0);try{let l=await (0,V.getPolicyAttachmentsList)(e);j(l.attachments||[])}catch(e){console.error("Error fetching attachments:",e),d.message.error("Failed to fetch attachments")}finally{S(!1)}}},[e]),et=(0,s.useCallback)(async()=>{if(e)try{let l=await (0,V.getGuardrailsList)(e);v(l.guardrails||[])}catch(e){console.error("Error fetching guardrails:",e)}},[e]);(0,s.useEffect)(()=>{el(),es(),et()},[el,es,et]);let ea=async()=>{if(D&&e){M(!0);try{await (0,V.deletePolicyCall)(e,D.policy_id),d.message.success(`Policy "${D.policy_name}" deleted successfully`),await el()}catch(e){console.error("Error deleting policy:",e),d.message.error("Failed to delete policy")}finally{M(!1),O(!1),W(null)}}},ei=async l=>{if(!e)return void d.message.error("Authentication required");try{let s=await (0,V.getGuardrailsList)(e),t=new Set(s.guardrails?.map(e=>e.guardrail_name)||[]);Y(t),q(l),K(!0)}catch(e){console.error("Error fetching guardrails:",e),d.message.error("Failed to load guardrails. Please try again.")}},eo=async l=>{if(e&&U){Z(!0);try{let s=[],t=[];for(let a of l){let l=a.guardrail_name;try{await (0,V.createGuardrailCall)(e,a),s.push(l),console.log(`Successfully created guardrail: ${l}`)}catch(e){console.error(`Failed to create guardrail "${l}":`,e),t.push(l)}}await et(),K(!1),Z(!1),B(U.templateData),C(!0),z(1),s.length>0?d.message.success(`Created ${s.length} guardrail${s.length>1?"s":""}! Complete the policy form to save.`):d.message.success("Template ready! Complete the policy form to save."),t.length>0&&d.message.warning(`Failed to create ${t.length} guardrail(s): ${t.join(", ")}. You may need to create them manually.`)}catch(e){Z(!1),console.error("Error creating guardrails:",e),d.message.error("Failed to create guardrails. Please try again.")}}};return(0,l.jsxs)("div",{className:"w-full mx-auto flex-auto overflow-y-auto m-8 p-2",children:[(0,l.jsxs)(a.TabGroup,{index:F,onIndexChange:z,children:[(0,l.jsxs)(i.TabList,{className:"mb-4",children:[(0,l.jsx)(r.Tab,{children:"Templates"}),(0,l.jsx)(r.Tab,{children:"Policies"}),(0,l.jsx)(r.Tab,{children:"Attachments"}),(0,l.jsx)(r.Tab,{children:"Policy Simulator"})]}),(0,l.jsxs)(o.TabPanels,{children:[(0,l.jsxs)(n.TabPanel,{children:[(0,l.jsx)(m.Alert,{message:"About Policies",description:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"mb-3",children:"Use policies to group guardrails and control which ones run for specific teams, keys, or models."}),(0,l.jsx)("p",{className:"mb-2 font-semibold",children:"Why use policies?"}),(0,l.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,l.jsx)("li",{children:"Enable/disable specific guardrails for teams, keys, or models"}),(0,l.jsx)("li",{children:"Group guardrails into a single policy"}),(0,l.jsx)("li",{children:"Inherit from existing policies and override what you need"})]}),(0,l.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more in the documentation →"})]}),type:"info",icon:(0,l.jsx)(x.InfoCircleOutlined,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,l.jsx)(eM,{onUseTemplate:ei,accessToken:e})]}),(0,l.jsxs)(n.TabPanel,{children:[(0,l.jsx)(m.Alert,{message:"About Policies",description:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"mb-3",children:"Use policies to group guardrails and control which ones run for specific teams, keys, or models."}),(0,l.jsx)("p",{className:"mb-2 font-semibold",children:"Why use policies?"}),(0,l.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,l.jsx)("li",{children:"Enable/disable specific guardrails for teams, keys, or models"}),(0,l.jsx)("li",{children:"Group guardrails into a single policy"}),(0,l.jsx)("li",{children:"Inherit from existing policies and override what you need"})]}),(0,l.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more in the documentation →"})]}),type:"info",icon:(0,l.jsx)(x.InfoCircleOutlined,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,l.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,l.jsx)(t.Button,{onClick:()=>{P&&R(null),B(null),C(!0)},disabled:!e,children:"+ Add New Policy"})}),P?(0,l.jsx)(ec,{policyId:P,onClose:()=>R(null),onEdit:e=>{B(e),R(null),e.pipeline?X(!0):C(!0)},accessToken:e,isAdmin:ee,getPolicy:V.getPolicyInfo}):(0,l.jsx)(L,{policies:g,isLoading:w,onDeleteClick:(e,l)=>{W(g.find(l=>l.policy_id===e)||null),O(!0)},onEditClick:e=>{B(e),e.pipeline?X(!0):C(!0)},onViewClick:e=>R(e),isAdmin:ee}),(0,l.jsx)(ef,{visible:N,onClose:()=>{C(!1),B(null)},onSuccess:()=>{el(),B(null)},onOpenFlowBuilder:()=>{C(!1),X(!0)},accessToken:e,editingPolicy:A,existingPolicies:g,availableGuardrails:b,createPolicy:V.createPolicyCall,updatePolicy:V.updatePolicyCall}),(0,l.jsx)(eO.default,{isOpen:G,title:"Delete Policy",message:`Are you sure you want to delete policy: ${D?.policy_name}? This action cannot be undone.`,resourceInformationTitle:"Policy Information",resourceInformation:[{label:"Name",value:D?.policy_name},{label:"ID",value:D?.policy_id,code:!0},{label:"Description",value:D?.description||"-"},{label:"Inherits From",value:D?.inherit||"-"}],onCancel:()=>{O(!1),W(null)},onOk:ea,confirmLoading:E}),(0,l.jsx)(eG,{visible:$,template:U,existingGuardrails:H,onConfirm:eo,onCancel:()=>{K(!1),q(null)},isLoading:J})]}),(0,l.jsxs)(n.TabPanel,{children:[(0,l.jsx)(m.Alert,{message:"About Policy Attachments",description:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"mb-3",children:"Policy attachments control where your policies apply. Policies don't do anything until you attach them to specific teams, keys, models, tags, or globally."}),(0,l.jsx)("p",{className:"mb-2 font-semibold",children:"Attachment Scopes:"}),(0,l.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Global (*)"})," - Applies to all requests"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Teams"})," - Applies only to specific teams"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Keys"})," - Applies only to specific API keys (supports wildcards like dev-*)"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Models"})," - Applies only when specific models are used"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Tags"})," - Matches tags from key/team ",(0,l.jsx)("code",{children:"metadata.tags"})," or tags passed dynamically in the request body (",(0,l.jsx)("code",{children:"metadata.tags"}),'). Use this to enforce policies across groups, e.g. "all keys tagged ',(0,l.jsx)("code",{children:"healthcare"}),' get HIPAA guardrails." Supports wildcards (',(0,l.jsx)("code",{children:"prod-*"}),")."]})]}),(0,l.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies#attachments",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more about attachments →"})]}),type:"info",icon:(0,l.jsx)(x.InfoCircleOutlined,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,l.jsx)(m.Alert,{message:"Enterprise Feature Notice",description:"Parts of policy attachments will be on LiteLLM Enterprise in subsequent releases.",type:"warning",showIcon:!0,closable:!0,className:"mb-6"}),(0,l.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,l.jsx)(t.Button,{onClick:()=>I(!0),disabled:!e||0===g.length,children:"+ Add New Attachment"})}),(0,l.jsx)(ev,{attachments:y,isLoading:_,onDeleteClick:s=>{c.Modal.confirm({title:"Delete Attachment",icon:(0,l.jsx)(h.ExclamationCircleOutlined,{}),content:"Are you sure you want to delete this attachment? This action cannot be undone.",okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:async()=>{if(e)try{await (0,V.deletePolicyAttachmentCall)(e,s),d.message.success("Attachment deleted successfully"),es()}catch(e){console.error("Error deleting attachment:",e),d.message.error("Failed to delete attachment")}}})},isAdmin:ee,accessToken:e}),(0,l.jsx)(eS,{visible:T,onClose:()=>I(!1),onSuccess:()=>{es()},accessToken:e,policies:g,createAttachment:V.createPolicyAttachmentCall})]}),(0,l.jsx)(n.TabPanel,{children:(0,l.jsx)(eT,{accessToken:e})})]})]}),Q&&(0,l.jsx)(er,{onBack:()=>{X(!1),B(null)},onSuccess:()=>{el(),B(null)},accessToken:e,editingPolicy:A,availableGuardrails:b,createPolicy:V.createPolicyCall,updatePolicy:V.updatePolicyCall})]})}],760221)}]);