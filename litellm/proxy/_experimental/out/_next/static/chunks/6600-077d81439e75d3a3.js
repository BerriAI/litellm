"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6600],{66600:function(e,t,s){s.d(t,{Z:function(){return Y}});var l=s(57437),a=s(40278),r=s(12514),n=s(49804),i=s(67101),c=s(47323),o=s(92414),d=s(46030),m=s(97765),u=s(12485),h=s(18135),x=s(35242),p=s(29706),f=s(77991),g=s(84264),v=s(2265),_=s(9114),y=s(39789),j=s(23628),N=s(19250),b=s(78489),S=s(51853),w=s(44643),k=s(71157);let C=e=>{let{responseTimeMs:t}=e;return null==t?null:(0,l.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-500 font-mono",children:[(0,l.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M12 6V12L16 14M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,l.jsxs)("span",{children:[t.toFixed(0),"ms"]})]})},Z=e=>{let t=e;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){}return t},A=e=>{let{label:t,value:s}=e,[a,r]=v.useState(!1),[n,i]=v.useState(!1),c=(null==s?void 0:s.toString())||"N/A",o=c.length>50?c.substring(0,50)+"...":c;return(0,l.jsx)("tr",{className:"hover:bg-gray-50",children:(0,l.jsx)("td",{className:"px-4 py-2 align-top",colSpan:2,children:(0,l.jsxs)("div",{className:"flex items-center justify-between group",children:[(0,l.jsxs)("div",{className:"flex items-center flex-1",children:[(0,l.jsx)("button",{onClick:()=>r(!a),className:"text-gray-400 hover:text-gray-600 mr-2",children:a?"▼":"▶"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm text-gray-600",children:t}),(0,l.jsx)("pre",{className:"mt-1 text-sm font-mono text-gray-800 whitespace-pre-wrap",children:a?c:o})]})]}),(0,l.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(c),i(!0),setTimeout(()=>i(!1),2e3)},className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-gray-600",children:(0,l.jsx)(S.Z,{className:"h-4 w-4"})})]})})})},T=e=>{var t,s,a,r,n,i,c,o,d,m,v,_,y,j;let{response:N}=e,b=null,S={},C={};try{if(null==N?void 0:N.error)try{let e="string"==typeof N.error.message?JSON.parse(N.error.message):N.error.message;b={message:(null==e?void 0:e.message)||"Unknown error",traceback:(null==e?void 0:e.traceback)||"No traceback available",litellm_params:(null==e?void 0:e.litellm_cache_params)||{},health_check_cache_params:(null==e?void 0:e.health_check_cache_params)||{}},S=Z(b.litellm_params)||{},C=Z(b.health_check_cache_params)||{}}catch(e){console.warn("Error parsing error details:",e),b={message:String(N.error.message||"Unknown error"),traceback:"Error parsing details",litellm_params:{},health_check_cache_params:{}}}else S=Z(null==N?void 0:N.litellm_cache_params)||{},C=Z(null==N?void 0:N.health_check_cache_params)||{}}catch(e){console.warn("Error in response parsing:",e),S={},C={}}let T={redis_host:(null==C?void 0:null===(a=C.redis_client)||void 0===a?void 0:null===(s=a.connection_pool)||void 0===s?void 0:null===(t=s.connection_kwargs)||void 0===t?void 0:t.host)||(null==C?void 0:null===(i=C.redis_async_client)||void 0===i?void 0:null===(n=i.connection_pool)||void 0===n?void 0:null===(r=n.connection_kwargs)||void 0===r?void 0:r.host)||(null==C?void 0:null===(c=C.connection_kwargs)||void 0===c?void 0:c.host)||(null==C?void 0:C.host)||"N/A",redis_port:(null==C?void 0:null===(m=C.redis_client)||void 0===m?void 0:null===(d=m.connection_pool)||void 0===d?void 0:null===(o=d.connection_kwargs)||void 0===o?void 0:o.port)||(null==C?void 0:null===(y=C.redis_async_client)||void 0===y?void 0:null===(_=y.connection_pool)||void 0===_?void 0:null===(v=_.connection_kwargs)||void 0===v?void 0:v.port)||(null==C?void 0:null===(j=C.connection_kwargs)||void 0===j?void 0:j.port)||(null==C?void 0:C.port)||"N/A",redis_version:(null==C?void 0:C.redis_version)||"N/A",startup_nodes:(()=>{try{var e,t,s,l,a,r,n,i,c,o,d,m,u;if(null==C?void 0:null===(e=C.redis_kwargs)||void 0===e?void 0:e.startup_nodes)return JSON.stringify(C.redis_kwargs.startup_nodes);let h=(null==C?void 0:null===(l=C.redis_client)||void 0===l?void 0:null===(s=l.connection_pool)||void 0===s?void 0:null===(t=s.connection_kwargs)||void 0===t?void 0:t.host)||(null==C?void 0:null===(n=C.redis_async_client)||void 0===n?void 0:null===(r=n.connection_pool)||void 0===r?void 0:null===(a=r.connection_kwargs)||void 0===a?void 0:a.host),x=(null==C?void 0:null===(o=C.redis_client)||void 0===o?void 0:null===(c=o.connection_pool)||void 0===c?void 0:null===(i=c.connection_kwargs)||void 0===i?void 0:i.port)||(null==C?void 0:null===(u=C.redis_async_client)||void 0===u?void 0:null===(m=u.connection_pool)||void 0===m?void 0:null===(d=m.connection_kwargs)||void 0===d?void 0:d.port);return h&&x?JSON.stringify([{host:h,port:x}]):"N/A"}catch(e){return"N/A"}})(),namespace:(null==C?void 0:C.namespace)||"N/A"};return(0,l.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,l.jsxs)(h.Z,{children:[(0,l.jsxs)(x.Z,{className:"border-b border-gray-200 px-4",children:[(0,l.jsx)(u.Z,{className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Summary"}),(0,l.jsx)(u.Z,{className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Raw Response"})]}),(0,l.jsxs)(f.Z,{children:[(0,l.jsx)(p.Z,{className:"p-4",children:(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center mb-6",children:[(null==N?void 0:N.status)==="healthy"?(0,l.jsx)(w.Z,{className:"h-5 w-5 text-green-500 mr-2"}):(0,l.jsx)(k.Z,{className:"h-5 w-5 text-red-500 mr-2"}),(0,l.jsxs)(g.Z,{className:"text-sm font-medium ".concat((null==N?void 0:N.status)==="healthy"?"text-green-500":"text-red-500"),children:["Cache Status: ",(null==N?void 0:N.status)||"unhealthy"]})]}),(0,l.jsx)("table",{className:"w-full border-collapse",children:(0,l.jsxs)("tbody",{children:[b&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:2,className:"pt-4 pb-2 font-semibold text-red-600",children:"Error Details"})}),(0,l.jsx)(A,{label:"Error Message",value:b.message}),(0,l.jsx)(A,{label:"Traceback",value:b.traceback})]}),(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:2,className:"pt-4 pb-2 font-semibold",children:"Cache Details"})}),(0,l.jsx)(A,{label:"Cache Configuration",value:String(null==S?void 0:S.type)}),(0,l.jsx)(A,{label:"Ping Response",value:String(N.ping_response)}),(0,l.jsx)(A,{label:"Set Cache Response",value:N.set_cache_response||"N/A"}),(0,l.jsx)(A,{label:"litellm_settings.cache_params",value:JSON.stringify(S,null,2)}),(null==S?void 0:S.type)==="redis"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:2,className:"pt-4 pb-2 font-semibold",children:"Redis Details"})}),(0,l.jsx)(A,{label:"Redis Host",value:T.redis_host||"N/A"}),(0,l.jsx)(A,{label:"Redis Port",value:T.redis_port||"N/A"}),(0,l.jsx)(A,{label:"Redis Version",value:T.redis_version||"N/A"}),(0,l.jsx)(A,{label:"Startup Nodes",value:T.startup_nodes||"N/A"}),(0,l.jsx)(A,{label:"Namespace",value:T.namespace||"N/A"})]})]})})]})}),(0,l.jsx)(p.Z,{className:"p-4",children:(0,l.jsx)("div",{className:"bg-gray-50 rounded-md p-4 font-mono text-sm",children:(0,l.jsx)("pre",{className:"whitespace-pre-wrap break-words overflow-auto max-h-[500px]",children:(()=>{try{let e={...N,litellm_cache_params:S,health_check_cache_params:C},t=JSON.parse(JSON.stringify(e,(e,t)=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){}return t}));return JSON.stringify(t,null,2)}catch(e){return"Error formatting JSON: "+e.message}})()})})})]})]})})},D=e=>{let{accessToken:t,healthCheckResponse:s,runCachingHealthCheck:a,responseTimeMs:r}=e,[n,i]=v.useState(null),[c,o]=v.useState(!1),d=async()=>{o(!0);let e=performance.now();await a(),i(performance.now()-e),o(!1)};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(b.Z,{onClick:d,disabled:c,className:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm px-4 py-2 rounded-md",children:c?"Running Health Check...":"Run Health Check"}),(0,l.jsx)(C,{responseTimeMs:n})]}),s&&(0,l.jsx)(T,{response:s})]})};var R=s(87452),L=s(88829),E=s(72208),I=s(25512),F=e=>{let{redisType:t,redisTypeDescriptions:s,onTypeChange:a}=e;return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Redis Type"}),(0,l.jsxs)(I.P,{value:t,onValueChange:a,children:[(0,l.jsx)(I.Q,{value:"node",children:"Node (Single Instance)"}),(0,l.jsx)(I.Q,{value:"cluster",children:"Cluster"}),(0,l.jsx)(I.Q,{value:"sentinel",children:"Sentinel"}),(0,l.jsx)(I.Q,{value:"semantic",children:"Semantic"})]}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:s[t]||"Select the type of Redis deployment you're using"})]})},H=s(39760),O=s(30150),V=s(49566),J=s(37592),B=s(10703),P=s(24199),M=e=>{let{field:t,currentValue:s}=e,[a,r]=(0,v.useState)([]),[n,i]=(0,v.useState)(s||""),{accessToken:c}=(0,H.Z)();if((0,v.useEffect)(()=>{c&&(async()=>{try{let e=await (0,B.p)(c);console.log("Fetched models for selector:",e),e.length>0&&r(e)}catch(e){console.error("Error fetching model info:",e)}})()},[c]),"Boolean"===t.field_type)return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t.ui_field_name}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",name:t.field_name,defaultChecked:!0===s||"true"===s,className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,l.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:t.field_description})]})]});if("Integer"===t.field_type||"Float"===t.field_type)return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t.ui_field_name}),(0,l.jsx)(P.Z,{name:t.field_name,type:"number",defaultValue:s,placeholder:t.field_description}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:t.field_description})]});if("List"===t.field_type)return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t.ui_field_name}),(0,l.jsx)("textarea",{name:t.field_name,defaultValue:"object"==typeof s?JSON.stringify(s,null,2):s,placeholder:t.field_description,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",rows:4}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:t.field_description})]});if("Models_Select"===t.field_type){let e=a.filter(e=>"embedding"===e.mode).map(e=>({value:e.model_group,label:e.model_group}));return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t.ui_field_name}),(0,l.jsx)(J.default,{value:n,onChange:i,showSearch:!0,placeholder:"Search and select a model...",options:e,style:{width:"100%"},className:"rounded-md",filterOption:(e,t)=>{var s;return(null!==(s=null==t?void 0:t.label)&&void 0!==s?s:"").toLowerCase().includes(e.toLowerCase())}}),(0,l.jsx)("input",{type:"hidden",name:t.field_name,value:n}),t.field_description&&(0,l.jsx)("p",{className:"text-xs text-gray-500",children:t.field_description})]})}if("Integer"===t.field_type||"Float"===t.field_type)return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t.ui_field_name}),(0,l.jsx)(O.Z,{name:t.field_name,defaultValue:s,placeholder:t.field_description,step:"Float"===t.field_type?.01:1}),t.field_description&&(0,l.jsx)("p",{className:"text-xs text-gray-500",children:t.field_description})]});let o="password"===t.field_name||t.field_name.includes("password")?"password":"text";return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:t.ui_field_name}),(0,l.jsx)(V.Z,{name:t.field_name,type:o,defaultValue:s,placeholder:t.field_description}),t.field_description&&(0,l.jsx)("p",{className:"text-xs text-gray-500",children:t.field_description})]})};let q=(e,t)=>null===e.redis_type||void 0===e.redis_type||e.redis_type===t,U=(e,t)=>e.find(e=>e.field_name===t),G=(e,t)=>{let s=["host","port","password","username"].map(t=>U(e,t)).filter(Boolean),l=["ssl","ssl_cert_reqs","ssl_check_hostname"].map(t=>U(e,t)).filter(Boolean),a=["namespace","ttl","max_connections"].map(t=>U(e,t)).filter(Boolean),r=["gcp_service_account","gcp_ssl_ca_certs"].map(t=>U(e,t)).filter(Boolean);return{basicFields:s,sslFields:l,cacheManagementFields:a,gcpFields:r,clusterFields:e.filter(e=>"cluster"===e.redis_type),sentinelFields:e.filter(e=>"sentinel"===e.redis_type),semanticFields:e.filter(e=>"semantic"===e.redis_type)}},z=(e,t)=>{let s={type:"redis"};return e.forEach(e=>{if("redis_type"===e.field_name||!q(e,t))return;let l=e.field_name,a=null;if("Boolean"===e.field_type){let e=document.querySelector('input[name="'.concat(l,'"]'));(null==e?void 0:e.checked)!==void 0&&(a=e.checked)}else if("List"===e.field_type){let e=document.querySelector('textarea[name="'.concat(l,'"]'));if(null==e?void 0:e.value)try{a=JSON.parse(e.value)}catch(e){console.error("Invalid JSON for ".concat(l,":"),e)}}else{let t=document.querySelector('input[name="'.concat(l,'"]'));if(null==t?void 0:t.value){let s=t.value.trim();if(""!==s){if("Integer"===e.field_type){let e=Number(s);isNaN(e)||(a=e)}else if("Float"===e.field_type){let e=Number(s);isNaN(e)||(a=e)}else a=s}}}null!=a&&(s[l]=a)}),s};var Q=e=>{let{accessToken:t,userRole:s,userID:a}=e,[r,n]=(0,v.useState)({}),[i,c]=(0,v.useState)([]),[o,d]=(0,v.useState)({}),[m,u]=(0,v.useState)("node"),[h,x]=(0,v.useState)(!1),[p,f]=(0,v.useState)(!1),g=(0,v.useCallback)(async()=>{try{let e=await (0,N.getCacheSettingsCall)(t);console.log("cache settings from API",e),e.fields&&c(e.fields),e.current_values&&(n(e.current_values),e.current_values.redis_type&&u(e.current_values.redis_type)),e.redis_type_descriptions&&d(e.redis_type_descriptions)}catch(e){console.error("Failed to load cache settings:",e),_.Z.fromBackend("Failed to load cache settings")}},[t]);(0,v.useEffect)(()=>{t&&g()},[t,g]);let y=async()=>{if(t){x(!0);try{let e=z(i,m),s=await (0,N.testCacheConnectionCall)(t,e);"success"===s.status?_.Z.success("Cache connection test successful!"):_.Z.fromBackend("Connection test failed: ".concat(s.message||s.error))}catch(e){console.error("Test connection error:",e),_.Z.fromBackend("Connection test failed: ".concat(e.message||"Unknown error"))}finally{x(!1)}}},j=async()=>{if(t){f(!0);try{let e=z(i,m);"semantic"===m&&(e.type="redis-semantic"),await (0,N.updateCacheSettingsCall)(t,e),_.Z.success("Cache settings updated successfully"),await g()}catch(e){console.error("Failed to save cache settings:",e),_.Z.fromBackend("Failed to update cache settings")}finally{f(!1)}}};if(!t)return null;let{basicFields:S,sslFields:w,cacheManagementFields:k,gcpFields:C,clusterFields:Z,sentinelFields:A,semanticFields:T}=G(i,m);return(0,l.jsxs)("div",{className:"w-full space-y-8 py-2",children:[(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"max-w-3xl",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Cache Settings"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Configure Redis cache for LiteLLM"})]}),(0,l.jsx)(F,{redisType:m,redisTypeDescriptions:o,onTypeChange:u}),(0,l.jsxs)("div",{className:"space-y-6 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Connection Settings"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:S.map(e=>{var t,s;if(!e)return null;let a=null!==(s=null!==(t=r[e.field_name])&&void 0!==t?t:e.field_default)&&void 0!==s?s:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),"cluster"===m&&Z.length>0&&(0,l.jsxs)("div",{className:"space-y-6 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Cluster Configuration"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6",children:Z.map(e=>{var t,s;let a=null!==(s=null!==(t=r[e.field_name])&&void 0!==t?t:e.field_default)&&void 0!==s?s:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),"sentinel"===m&&A.length>0&&(0,l.jsxs)("div",{className:"space-y-6 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Sentinel Configuration"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:A.map(e=>{var t,s;let a=null!==(s=null!==(t=r[e.field_name])&&void 0!==t?t:e.field_default)&&void 0!==s?s:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),"semantic"===m&&T.length>0&&(0,l.jsxs)("div",{className:"space-y-6 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-900",children:"Semantic Configuration"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:T.map(e=>{var t,s;let a=null!==(s=null!==(t=r[e.field_name])&&void 0!==t?t:e.field_default)&&void 0!==s?s:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),(0,l.jsxs)(R.Z,{className:"mt-4",children:[(0,l.jsx)(E.Z,{children:(0,l.jsx)("span",{className:"text-sm font-medium text-gray-900",children:"Advanced Settings"})}),(0,l.jsx)(L.Z,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[w.length>0&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-gray-700",children:"SSL Settings"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:w.map(e=>{var t,s;if(!e)return null;let a=null!==(s=null!==(t=r[e.field_name])&&void 0!==t?t:e.field_default)&&void 0!==s?s:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),k.length>0&&(0,l.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-gray-700",children:"Cache Management"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:k.map(e=>{var t,s;if(!e)return null;let a=null!==(s=null!==(t=r[e.field_name])&&void 0!==t?t:e.field_default)&&void 0!==s?s:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]}),C.length>0&&(0,l.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-200",children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-gray-700",children:"GCP Authentication"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:C.map(e=>{var t,s;if(!e)return null;let a=null!==(s=null!==(t=r[e.field_name])&&void 0!==t?t:e.field_default)&&void 0!==s?s:"";return(0,l.jsx)(M,{field:e,currentValue:a},e.field_name)})})]})]})})]})]}),(0,l.jsxs)("div",{className:"border-t border-gray-200 pt-6 flex justify-end gap-3",children:[(0,l.jsx)(b.Z,{variant:"secondary",size:"sm",onClick:y,disabled:h,className:"text-sm",children:h?"Testing...":"Test Connection"}),(0,l.jsx)(b.Z,{size:"sm",onClick:j,disabled:p,className:"text-sm font-medium",children:p?"Saving...":"Save Changes"})]})]})};let W=e=>{if(e)return e.toISOString().split("T")[0]};function K(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0,notation:"compact",compactDisplay:"short"}).format(e)}var Y=e=>{let{accessToken:t,token:s,userRole:b,userID:S,premiumUser:w}=e,[k,C]=(0,v.useState)([]),[Z,A]=(0,v.useState)([]),[T,R]=(0,v.useState)([]),[L,E]=(0,v.useState)([]),[I,F]=(0,v.useState)("0"),[H,O]=(0,v.useState)("0"),[V,J]=(0,v.useState)("0"),[B,P]=(0,v.useState)({from:new Date(Date.now()-6048e5),to:new Date}),[M,q]=(0,v.useState)(""),[U,G]=(0,v.useState)("");(0,v.useEffect)(()=>{t&&B&&((async()=>{E(await (0,N.adminGlobalCacheActivity)(t,W(B.from),W(B.to)))})(),q(new Date().toLocaleString()))},[t]);let z=Array.from(new Set(L.map(e=>{var t;return null!==(t=null==e?void 0:e.api_key)&&void 0!==t?t:""}))),Y=Array.from(new Set(L.map(e=>{var t;return null!==(t=null==e?void 0:e.model)&&void 0!==t?t:""})));Array.from(new Set(L.map(e=>{var t;return null!==(t=null==e?void 0:e.call_type)&&void 0!==t?t:""})));let X=async(e,s)=>{e&&s&&t&&E(await (0,N.adminGlobalCacheActivity)(t,W(e),W(s)))};(0,v.useEffect)(()=>{console.log("DATA IN CACHE DASHBOARD",L);let e=L;Z.length>0&&(e=e.filter(e=>Z.includes(e.api_key))),T.length>0&&(e=e.filter(e=>T.includes(e.model))),console.log("before processed data in cache dashboard",e);let t=0,s=0,l=0,a=e.reduce((e,a)=>{console.log("Processing item:",a),a.call_type||(console.log("Item has no call_type:",a),a.call_type="Unknown"),t+=(a.total_rows||0)-(a.cache_hit_true_rows||0),s+=a.cache_hit_true_rows||0,l+=a.cached_completion_tokens||0;let r=e.find(e=>e.name===a.call_type);return r?(r["LLM API requests"]+=(a.total_rows||0)-(a.cache_hit_true_rows||0),r["Cache hit"]+=a.cache_hit_true_rows||0,r["Cached Completion Tokens"]+=a.cached_completion_tokens||0,r["Generated Completion Tokens"]+=a.generated_completion_tokens||0):e.push({name:a.call_type,"LLM API requests":(a.total_rows||0)-(a.cache_hit_true_rows||0),"Cache hit":a.cache_hit_true_rows||0,"Cached Completion Tokens":a.cached_completion_tokens||0,"Generated Completion Tokens":a.generated_completion_tokens||0}),e},[]);F(K(s)),O(K(l));let r=s+t;r>0?J((s/r*100).toFixed(2)):J("0"),C(a),console.log("PROCESSED DATA IN CACHE DASHBOARD",a)},[Z,T,B,L]);let $=async()=>{try{_.Z.info("Running cache health check..."),G("");let e=await (0,N.cachingHealthCheckCall)(null!==t?t:"");console.log("CACHING HEALTH CHECK RESPONSE",e),G(e)}catch(t){let e;if(console.error("Error running health check:",t),t&&t.message)try{let s=JSON.parse(t.message);s.error&&(s=s.error),e=s}catch(s){e={message:t.message}}else e={message:"Unknown error occurred"};G({error:e})}};return(0,l.jsxs)(h.Z,{className:"gap-2 p-8 h-full w-full mt-2 mb-8",children:[(0,l.jsxs)(x.Z,{className:"flex justify-between mt-2 w-full items-center",children:[(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)(u.Z,{children:"Cache Analytics"}),(0,l.jsx)(u.Z,{children:"Cache Health"}),(0,l.jsx)(u.Z,{children:"Cache Settings"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[M&&(0,l.jsxs)(g.Z,{children:["Last Refreshed: ",M]}),(0,l.jsx)(c.Z,{icon:j.Z,variant:"shadow",size:"xs",className:"self-center",onClick:()=>{q(new Date().toLocaleString())}})]})]}),(0,l.jsxs)(f.Z,{children:[(0,l.jsx)(p.Z,{children:(0,l.jsxs)(r.Z,{children:[(0,l.jsxs)(i.Z,{numItems:3,className:"gap-4 mt-4",children:[(0,l.jsx)(n.Z,{children:(0,l.jsx)(o.Z,{placeholder:"Select Virtual Keys",value:Z,onValueChange:A,children:z.map(e=>(0,l.jsx)(d.Z,{value:e,children:e},e))})}),(0,l.jsx)(n.Z,{children:(0,l.jsx)(o.Z,{placeholder:"Select Models",value:T,onValueChange:R,children:Y.map(e=>(0,l.jsx)(d.Z,{value:e,children:e},e))})}),(0,l.jsx)(n.Z,{children:(0,l.jsx)(y.Z,{value:B,onValueChange:e=>{P(e),X(e.from,e.to)}})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 mt-4",children:[(0,l.jsxs)(r.Z,{children:[(0,l.jsx)("p",{className:"text-tremor-default font-medium text-tremor-content dark:text-dark-tremor-content",children:"Cache Hit Ratio"}),(0,l.jsx)("div",{className:"mt-2 flex items-baseline space-x-2.5",children:(0,l.jsxs)("p",{className:"text-tremor-metric font-semibold text-tremor-content-strong dark:text-dark-tremor-content-strong",children:[V,"%"]})})]}),(0,l.jsxs)(r.Z,{children:[(0,l.jsx)("p",{className:"text-tremor-default font-medium text-tremor-content dark:text-dark-tremor-content",children:"Cache Hits"}),(0,l.jsx)("div",{className:"mt-2 flex items-baseline space-x-2.5",children:(0,l.jsx)("p",{className:"text-tremor-metric font-semibold text-tremor-content-strong dark:text-dark-tremor-content-strong",children:I})})]}),(0,l.jsxs)(r.Z,{children:[(0,l.jsx)("p",{className:"text-tremor-default font-medium text-tremor-content dark:text-dark-tremor-content",children:"Cached Tokens"}),(0,l.jsx)("div",{className:"mt-2 flex items-baseline space-x-2.5",children:(0,l.jsx)("p",{className:"text-tremor-metric font-semibold text-tremor-content-strong dark:text-dark-tremor-content-strong",children:H})})]})]}),(0,l.jsx)(m.Z,{className:"mt-4",children:"Cache Hits vs API Requests"}),(0,l.jsx)(a.Z,{title:"Cache Hits vs API Requests",data:k,stack:!0,index:"name",valueFormatter:K,categories:["LLM API requests","Cache hit"],colors:["sky","teal"],yAxisWidth:48}),(0,l.jsx)(m.Z,{className:"mt-4",children:"Cached Completion Tokens vs Generated Completion Tokens"}),(0,l.jsx)(a.Z,{className:"mt-6",data:k,stack:!0,index:"name",valueFormatter:K,categories:["Generated Completion Tokens","Cached Completion Tokens"],colors:["sky","teal"],yAxisWidth:48})]})}),(0,l.jsx)(p.Z,{children:(0,l.jsx)(D,{accessToken:t,healthCheckResponse:U,runCachingHealthCheck:$})}),(0,l.jsx)(p.Z,{children:(0,l.jsx)(Q,{accessToken:t,userRole:b,userID:S})})]})]})}},39789:function(e,t,s){s.d(t,{Z:function(){return i}});var l=s(57437),a=s(2265),r=s(88237),n=s(84264),i=e=>{let{value:t,onValueChange:s,label:i="Select Time Range",className:c="",showTimeRange:o=!0}=e,[d,m]=(0,a.useState)(!1),u=(0,a.useRef)(null),h=(0,a.useCallback)(e=>{m(!0),setTimeout(()=>m(!1),1500),s(e),requestIdleCallback(()=>{if(e.from){let t;let l={...e},a=new Date(e.from);t=new Date(e.to?e.to:e.from),a.toDateString(),t.toDateString(),a.setHours(0,0,0,0),t.setHours(23,59,59,999),l.from=a,l.to=t,s(l)}},{timeout:100})},[s]),x=(0,a.useCallback)((e,t)=>{if(!e||!t)return"";let s=e=>e.toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0,timeZoneName:"short"});if(e.toDateString()!==t.toDateString())return"".concat(s(e)," - ").concat(s(t));{let s=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),l=e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),a=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZoneName:"short"});return"".concat(s,": ").concat(l," - ").concat(a)}},[]);return(0,l.jsxs)("div",{className:c,children:[i&&(0,l.jsx)(n.Z,{className:"mb-2",children:i}),(0,l.jsxs)("div",{className:"relative w-fit",children:[(0,l.jsx)("div",{ref:u,children:(0,l.jsx)(r.Z,{enableSelect:!0,value:t,onValueChange:h,placeholder:"Select date range",enableClear:!1,style:{zIndex:100}})}),d&&(0,l.jsx)("div",{className:"absolute top-1/2 animate-pulse",style:{left:"calc(100% + 8px)",transform:"translateY(-50%)",zIndex:110},children:(0,l.jsxs)("div",{className:"flex items-center gap-1 text-green-600 text-sm font-medium bg-white px-2 py-1 rounded-full border border-green-200 shadow-sm whitespace-nowrap",children:[(0,l.jsx)("div",{className:"w-3 h-3 bg-green-500 text-white rounded-full flex items-center justify-center text-xs",children:"✓"}),(0,l.jsx)("span",{className:"text-xs",children:"Selected"})]})})]}),o&&t.from&&t.to&&(0,l.jsx)(n.Z,{className:"mt-2 text-xs text-gray-500",children:x(t.from,t.to)})]})}}}]);