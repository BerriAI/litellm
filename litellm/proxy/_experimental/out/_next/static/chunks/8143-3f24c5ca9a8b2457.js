"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8143],{18143:function(e,a,s){s.d(a,{Z:function(){return P}});var t=s(57437),l=s(40278),n=s(96889),r=s(12514),o=s(97765),i=s(21626),c=s(97214),d=s(28241),h=s(58834),u=s(69552),x=s(71876),m=s(96761),g=s(2265),p=s(47375),j=s(39789),Z=s(75105),y=s(78489),S=s(49804),_=s(14042),w=s(67101),f=s(92414),v=s(46030),k=s(27281),D=s(57365),E=s(12485),N=s(18135),C=s(35242),I=s(29706),F=s(77991),b=s(84264),T=s(19250),M=s(32176),A=s(59872);console.log("process.env.NODE_ENV","production");let L=e=>null!==e&&("Admin"===e||"Admin Viewer"===e);var P=e=>{let{accessToken:a,token:s,userRole:P,userID:V,keys:U,premiumUser:Y}=e,B=new Date,[O,q]=(0,g.useState)([]),[W,R]=(0,g.useState)([]),[G,K]=(0,g.useState)([]),[z,Q]=(0,g.useState)([]),[X,$]=(0,g.useState)([]),[H,J]=(0,g.useState)([]),[ee,ea]=(0,g.useState)([]),[es,et]=(0,g.useState)([]),[el,en]=(0,g.useState)([]),[er,eo]=(0,g.useState)([]),[ei,ec]=(0,g.useState)({}),[ed,eh]=(0,g.useState)([]),[eu,ex]=(0,g.useState)(""),[em,eg]=(0,g.useState)(["all-tags"]),[ep,ej]=(0,g.useState)({from:new Date(Date.now()-6048e5),to:new Date}),[eZ,ey]=(0,g.useState)(null),[eS,e_]=(0,g.useState)(0),ew=new Date(B.getFullYear(),B.getMonth(),1),ef=new Date(B.getFullYear(),B.getMonth()+1,0),ev=eI(ew),ek=eI(ef);function eD(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0,notation:"compact",compactDisplay:"short"}).format(e)}console.log("keys in usage",U),console.log("premium user in usage",Y);let eE=async()=>{if(a)try{let e=await (0,T.getProxyUISettings)(a);return console.log("usage tab: proxy_settings",e),e}catch(e){console.error("Error fetching proxy settings:",e)}};(0,g.useEffect)(()=>{eC(ep.from,ep.to)},[ep,em]);let eN=async(e,s,t)=>{if(!e||!s||!a)return;console.log("uiSelectedKey",t);let l=await (0,T.adminTopEndUsersCall)(a,t,e.toISOString(),s.toISOString());console.log("End user data updated successfully",l),Q(l)},eC=async(e,s)=>{if(!e||!s||!a)return;let t=await eE();null!=t&&t.DISABLE_EXPENSIVE_DB_QUERIES||(J((await (0,T.tagsSpendLogsCall)(a,e.toISOString(),s.toISOString(),0===em.length?void 0:em)).spend_per_tag),console.log("Tag spend data updated successfully"))};function eI(e){let a=e.getFullYear(),s=e.getMonth()+1,t=e.getDate();return"".concat(a,"-").concat(s<10?"0"+s:s,"-").concat(t<10?"0"+t:t)}console.log("Start date is ".concat(ev)),console.log("End date is ".concat(ek));let eF=async(e,a,s)=>{try{let s=await e();a(s)}catch(e){console.error(s,e)}},eb=(e,a,s,t)=>{let l=[],n=new Date(a),r=e=>{if(e.includes("-"))return e;{let[a,s]=e.split(" ");return new Date(new Date().getFullYear(),new Date("".concat(a," 01 2024")).getMonth(),parseInt(s)).toISOString().split("T")[0]}},o=new Map(e.map(e=>{let a=r(e.date);return[a,{...e,date:a}]}));for(;n<=s;){let e=n.toISOString().split("T")[0];if(o.has(e))l.push(o.get(e));else{let a={date:e,api_requests:0,total_tokens:0};t.forEach(e=>{a[e]||(a[e]=0)}),l.push(a)}n.setDate(n.getDate()+1)}return l},eT=async()=>{if(a)try{let e=await (0,T.adminSpendLogsCall)(a),s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1),l=new Date(s.getFullYear(),s.getMonth()+1,0),n=eb(e,t,l,[]),r=Number(n.reduce((e,a)=>e+(a.spend||0),0).toFixed(2));e_(r),q(n)}catch(e){console.error("Error fetching overall spend:",e)}},eM=()=>eF(()=>a&&s?(0,T.adminspendByProvider)(a,s,ev,ek):Promise.reject("No access token or token"),eo,"Error fetching provider spend"),eA=async()=>{a&&await eF(async()=>(await (0,T.adminTopKeysCall)(a)).map(e=>({key:e.api_key.substring(0,10),api_key:e.api_key,key_alias:e.key_alias,spend:Number(e.total_spend.toFixed(2))})),R,"Error fetching top keys")},eL=async()=>{a&&await eF(async()=>(await (0,T.adminTopModelsCall)(a)).map(e=>({key:e.model,spend:(0,A.pw)(e.total_spend,2)})),K,"Error fetching top models")},eP=async()=>{a&&await eF(async()=>{let e=await (0,T.teamSpendLogsCall)(a),s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1),l=new Date(s.getFullYear(),s.getMonth()+1,0);return $(eb(e.daily_spend,t,l,e.teams)),et(e.teams),e.total_spend_per_team.map(e=>({name:e.team_id||"",value:(0,A.pw)(e.total_spend||0,2)}))},en,"Error fetching team spend")},eV=()=>{a&&eF(async()=>(await (0,T.allTagNamesCall)(a)).tag_names,ea,"Error fetching tag names")},eU=()=>{a&&eF(()=>{var e,s;return(0,T.tagsSpendLogsCall)(a,null===(e=ep.from)||void 0===e?void 0:e.toISOString(),null===(s=ep.to)||void 0===s?void 0:s.toISOString(),void 0)},e=>J(e.spend_per_tag),"Error fetching top tags")},eY=()=>{a&&eF(()=>(0,T.adminTopEndUsersCall)(a,null,void 0,void 0),Q,"Error fetching top end users")},eB=async()=>{if(a)try{let e=await (0,T.adminGlobalActivity)(a,ev,ek),s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1),l=new Date(s.getFullYear(),s.getMonth()+1,0),n=eb(e.daily_data||[],t,l,["api_requests","total_tokens"]);ec({...e,daily_data:n})}catch(e){console.error("Error fetching global activity:",e)}},eO=async()=>{if(a)try{let e=await (0,T.adminGlobalActivityPerModel)(a,ev,ek),s=new Date,t=new Date(s.getFullYear(),s.getMonth(),1),l=new Date(s.getFullYear(),s.getMonth()+1,0),n=e.map(e=>({...e,daily_data:eb(e.daily_data||[],t,l,["api_requests","total_tokens"])}));eh(n)}catch(e){console.error("Error fetching global activity per model:",e)}};return((0,g.useEffect)(()=>{(async()=>{if(a&&s&&P&&V){let e=await eE();e&&(ey(e),null!=e&&e.DISABLE_EXPENSIVE_DB_QUERIES)||(console.log("fetching data - valiue of proxySettings",eZ),eT(),eM(),eA(),eL(),eB(),eO(),L(P)&&(eP(),eV(),eU(),eY()))}})()},[a,s,P,V,ev,ek]),null==eZ?void 0:eZ.DISABLE_EXPENSIVE_DB_QUERIES)?(0,t.jsx)("div",{style:{width:"100%"},className:"p-8",children:(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"Database Query Limit Reached"}),(0,t.jsxs)(b.Z,{className:"mt-4",children:["SpendLogs in DB has ",eZ.NUM_SPEND_LOGS_ROWS," rows.",(0,t.jsx)("br",{}),"Please follow our guide to view usage when SpendLogs has more than 1M rows."]}),(0,t.jsx)(y.Z,{className:"mt-4",children:(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/spending_monitoring",target:"_blank",children:"View Usage Guide"})})]})}):(0,t.jsx)("div",{style:{width:"100%"},className:"p-8",children:(0,t.jsxs)(N.Z,{children:[(0,t.jsxs)(C.Z,{className:"mt-2",children:[(0,t.jsx)(E.Z,{children:"All Up"}),L(P)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.Z,{children:"Team Based Usage"}),(0,t.jsx)(E.Z,{children:"Customer Usage"}),(0,t.jsx)(E.Z,{children:"Tag Based Usage"})]}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{})})]}),(0,t.jsxs)(F.Z,{children:[(0,t.jsx)(I.Z,{children:(0,t.jsxs)(N.Z,{children:[(0,t.jsxs)(C.Z,{variant:"solid",className:"mt-1",children:[(0,t.jsx)(E.Z,{children:"Cost"}),(0,t.jsx)(E.Z,{children:"Activity"})]}),(0,t.jsxs)(F.Z,{children:[(0,t.jsx)(I.Z,{children:(0,t.jsxs)(w.Z,{numItems:2,className:"gap-2 h-[100vh] w-full",children:[(0,t.jsxs)(S.Z,{numColSpan:2,children:[(0,t.jsxs)(b.Z,{className:"text-tremor-default text-tremor-content dark:text-dark-tremor-content mb-2 mt-2 text-lg",children:["Project Spend ",new Date().toLocaleString("default",{month:"long"})," 1 -"," ",new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate()]}),(0,t.jsx)(p.Z,{userSpend:eS,selectedTeam:null,userMaxBudget:null})]}),(0,t.jsx)(S.Z,{numColSpan:2,children:(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"Monthly Spend"}),(0,t.jsx)(l.Z,{data:O,index:"date",categories:["spend"],colors:["cyan"],valueFormatter:e=>"$ ".concat((0,A.pw)(e,2)),yAxisWidth:100,tickGap:5})]})}),(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsxs)(r.Z,{className:"h-full",children:[(0,t.jsx)(m.Z,{children:"Top Virtual Keys"}),(0,t.jsx)(M.Z,{topKeys:W,teams:null})]})}),(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsxs)(r.Z,{className:"h-full",children:[(0,t.jsx)(m.Z,{children:"Top Models"}),(0,t.jsx)(l.Z,{className:"mt-4 h-40",data:G,index:"key",categories:["spend"],colors:["cyan"],yAxisWidth:200,layout:"vertical",showXAxis:!1,showLegend:!1,valueFormatter:e=>"$".concat((0,A.pw)(e,2))})]})}),(0,t.jsx)(S.Z,{numColSpan:1}),(0,t.jsx)(S.Z,{numColSpan:2,children:(0,t.jsxs)(r.Z,{className:"mb-2",children:[(0,t.jsx)(m.Z,{children:"Spend by Provider"}),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsx)(_.Z,{className:"mt-4 h-40",variant:"pie",data:er,index:"provider",category:"spend",colors:["cyan"],valueFormatter:e=>"$".concat((0,A.pw)(e,2))})}),(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsxs)(i.Z,{children:[(0,t.jsx)(h.Z,{children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(u.Z,{children:"Provider"}),(0,t.jsx)(u.Z,{children:"Spend"})]})}),(0,t.jsx)(c.Z,{children:er.map(e=>(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(d.Z,{children:e.provider}),(0,t.jsx)(d.Z,{children:1e-5>parseFloat(e.spend.toFixed(2))?"less than 0.00":(0,A.pw)(e.spend,2)})]},e.provider))})]})})]})})]})})]})}),(0,t.jsx)(I.Z,{children:(0,t.jsxs)(w.Z,{numItems:1,className:"gap-2 h-[75vh] w-full",children:[(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"All Up"}),(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsxs)(S.Z,{children:[(0,t.jsxs)(o.Z,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["API Requests ",eD(ei.sum_api_requests)]}),(0,t.jsx)(Z.Z,{className:"h-40",data:ei.daily_data,valueFormatter:eD,index:"date",colors:["cyan"],categories:["api_requests"],onValueChange:e=>console.log(e)})]}),(0,t.jsxs)(S.Z,{children:[(0,t.jsxs)(o.Z,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["Tokens ",eD(ei.sum_total_tokens)]}),(0,t.jsx)(l.Z,{className:"h-40",data:ei.daily_data,valueFormatter:eD,index:"date",colors:["cyan"],categories:["total_tokens"],onValueChange:e=>console.log(e)})]})]})]}),(0,t.jsx)(t.Fragment,{children:ed.map((e,a)=>(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:e.model}),(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsxs)(S.Z,{children:[(0,t.jsxs)(o.Z,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["API Requests ",eD(e.sum_api_requests)]}),(0,t.jsx)(Z.Z,{className:"h-40",data:e.daily_data,index:"date",colors:["cyan"],categories:["api_requests"],valueFormatter:eD,onValueChange:e=>console.log(e)})]}),(0,t.jsxs)(S.Z,{children:[(0,t.jsxs)(o.Z,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["Tokens ",eD(e.sum_total_tokens)]}),(0,t.jsx)(l.Z,{className:"h-40",data:e.daily_data,index:"date",colors:["cyan"],categories:["total_tokens"],valueFormatter:eD,onValueChange:e=>console.log(e)})]})]})]},a))})]})})]})]})}),(0,t.jsx)(I.Z,{children:(0,t.jsxs)(w.Z,{numItems:2,className:"gap-2 h-[75vh] w-full",children:[(0,t.jsxs)(S.Z,{numColSpan:2,children:[(0,t.jsxs)(r.Z,{className:"mb-2",children:[(0,t.jsx)(m.Z,{children:"Total Spend Per Team"}),(0,t.jsx)(n.Z,{data:el})]}),(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"Daily Spend Per Team"}),(0,t.jsx)(l.Z,{className:"h-72",data:X,showLegend:!0,index:"date",categories:es,yAxisWidth:80,stack:!0})]})]}),(0,t.jsx)(S.Z,{numColSpan:2})]})}),(0,t.jsxs)(I.Z,{children:[(0,t.jsxs)("p",{className:"mb-2 text-gray-500 italic text-[12px]",children:["Customers of your LLM API calls. Tracked when a `user` param is passed in your LLM calls"," ",(0,t.jsx)("a",{className:"text-blue-500",href:"https://docs.litellm.ai/docs/proxy/users",target:"_blank",children:"docs here"})]}),(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsx)(S.Z,{children:(0,t.jsx)(j.Z,{value:ep,onValueChange:e=>{ej(e),eN(e.from,e.to,null)}})}),(0,t.jsxs)(S.Z,{children:[(0,t.jsx)(b.Z,{children:"Select Key"}),(0,t.jsxs)(k.Z,{defaultValue:"all-keys",children:[(0,t.jsx)(D.Z,{value:"all-keys",onClick:()=>{eN(ep.from,ep.to,null)},children:"All Keys"},"all-keys"),null==U?void 0:U.map((e,a)=>e&&null!==e.key_alias&&e.key_alias.length>0?(0,t.jsx)(D.Z,{value:String(a),onClick:()=>{eN(ep.from,ep.to,e.token)},children:e.key_alias},a):null)]})]})]}),(0,t.jsx)(r.Z,{className:"mt-4",children:(0,t.jsxs)(i.Z,{className:"max-h-[70vh] min-h-[500px]",children:[(0,t.jsx)(h.Z,{children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(u.Z,{children:"Customer"}),(0,t.jsx)(u.Z,{children:"Spend"}),(0,t.jsx)(u.Z,{children:"Total Events"})]})}),(0,t.jsx)(c.Z,{children:null==z?void 0:z.map((e,a)=>(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(d.Z,{children:e.end_user}),(0,t.jsx)(d.Z,{children:(0,A.pw)(e.total_spend,2)}),(0,t.jsx)(d.Z,{children:e.total_count})]},a))})]})})]}),(0,t.jsxs)(I.Z,{children:[(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsx)(j.Z,{className:"mb-4",value:ep,onValueChange:e=>{ej(e),eC(e.from,e.to)}})}),(0,t.jsx)(S.Z,{children:Y?(0,t.jsx)("div",{children:(0,t.jsxs)(f.Z,{value:em,onValueChange:e=>eg(e),children:[(0,t.jsx)(v.Z,{value:"all-tags",onClick:()=>eg(["all-tags"]),children:"All Tags"},"all-tags"),ee&&ee.filter(e=>"all-tags"!==e).map((e,a)=>(0,t.jsx)(v.Z,{value:String(e),children:e},e))]})}):(0,t.jsx)("div",{children:(0,t.jsxs)(f.Z,{value:em,onValueChange:e=>eg(e),children:[(0,t.jsx)(v.Z,{value:"all-tags",onClick:()=>eg(["all-tags"]),children:"All Tags"},"all-tags"),ee&&ee.filter(e=>"all-tags"!==e).map((e,a)=>(0,t.jsxs)(D.Z,{value:String(e),disabled:!0,children:["âœ¨ ",e," (Enterprise only Feature)"]},e))]})})})]}),(0,t.jsxs)(w.Z,{numItems:2,className:"gap-2 h-[75vh] w-full mb-4",children:[(0,t.jsx)(S.Z,{numColSpan:2,children:(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"Spend Per Tag"}),(0,t.jsxs)(b.Z,{children:["Get Started by Tracking cost per tag"," ",(0,t.jsx)("a",{className:"text-blue-500",href:"https://docs.litellm.ai/docs/proxy/cost_tracking",target:"_blank",children:"here"})]}),(0,t.jsx)(l.Z,{className:"h-72",data:H,index:"name",categories:["spend"],colors:["cyan"]})]})}),(0,t.jsx)(S.Z,{numColSpan:2})]})]})]})]})})}}}]);