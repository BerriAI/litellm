"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6868],{1309:function(e,l,a){a.d(l,{C:function(){return t.Z}});var t=a(41649)},71618:function(e,l,a){a.d(l,{OK:function(){return i.Z},nP:function(){return o.Z},td:function(){return s.Z},v0:function(){return r.Z},x4:function(){return n.Z},zx:function(){return t.Z}});var t=a(78489),i=a(12485),r=a(18135),s=a(35242),n=a(29706),o=a(77991)},51147:function(e,l,a){a.d(l,{gx:function(){return r.Z},oi:function(){return i.Z},zx:function(){return t.Z}});var t=a(78489),i=a(49566),r=a(16853)},16868:function(e,l,a){a.d(l,{Z:function(){return lT}});var t,i,r,s,n=a(57437),o=a(2265),d=a(71618),c=a(19250),u=a(57840),m=a(37592),x=a(15690),p=a(10032),h=a(3810),g=a(22116),f=a(64504);(t=r||(r={})).PresidioPII="Presidio PII",t.Bedrock="Bedrock Guardrail",t.Lakera="Lakera";let j={},v=e=>{let l={};return l.PresidioPII="Presidio PII",l.Bedrock="Bedrock Guardrail",l.Lakera="Lakera",Object.entries(e).forEach(e=>{let[a,t]=e;t&&"object"==typeof t&&"ui_friendly_name"in t&&(l[a.split("_").map((e,l)=>e.charAt(0).toUpperCase()+e.slice(1)).join("")]=t.ui_friendly_name)}),j=l,l},y=()=>Object.keys(j).length>0?j:r,_={PresidioPII:"presidio",Bedrock:"bedrock",Lakera:"lakera_v2",LitellmContentFilter:"litellm_content_filter",ToolPermission:"tool_permission"},b=e=>{Object.entries(e).forEach(e=>{let[l,a]=e;a&&"object"==typeof a&&"ui_friendly_name"in a&&(_[l.split("_").map((e,l)=>e.charAt(0).toUpperCase()+e.slice(1)).join("")]=l)})},N=e=>!!e&&"Presidio PII"===y()[e],w=e=>!!e&&"LiteLLM Content Filter"===y()[e],k="../ui/assets/logos/",C={"Presidio PII":"".concat(k,"presidio.png"),"Bedrock Guardrail":"".concat(k,"bedrock.svg"),Lakera:"".concat(k,"lakeraai.jpeg"),"Azure Content Safety Prompt Shield":"".concat(k,"presidio.png"),"Azure Content Safety Text Moderation":"".concat(k,"presidio.png"),"Aporia AI":"".concat(k,"aporia.png"),"PANW Prisma AIRS":"".concat(k,"palo_alto_networks.jpeg"),"Noma Security":"".concat(k,"noma_security.png"),"Javelin Guardrails":"".concat(k,"javelin.png"),"Pillar Guardrail":"".concat(k,"pillar.jpeg"),"Google Cloud Model Armor":"".concat(k,"google.svg"),"Guardrails AI":"".concat(k,"guardrails_ai.jpeg"),"Lasso Guardrail":"".concat(k,"lasso.png"),"Pangea Guardrail":"".concat(k,"pangea.png"),"AIM Guardrail":"".concat(k,"aim_security.jpeg"),"OpenAI Moderation":"".concat(k,"openai_small.svg"),EnkryptAI:"".concat(k,"enkrypt_ai.avif"),"Prompt Security":"".concat(k,"prompt_security.png"),"LiteLLM Content Filter":"".concat(k,"litellm_logo.jpg")},S=e=>{if(!e)return{logo:"",displayName:"-"};let l=Object.keys(_).find(l=>_[l].toLowerCase()===e.toLowerCase());if(!l)return{logo:"",displayName:e};let a=y()[l];return{logo:C[a]||"",displayName:a||e}};var Z=a(99981),P=a(5545),A=a(4156),O=a(97416),I=a(8881),L=a(10798),z=a(49638);let{Text:T}=u.default,{Option:E}=m.default,B=e=>e.replace(/_/g," "),M=e=>{switch(e){case"MASK":return(0,n.jsx)(O.Z,{style:{marginRight:4}});case"BLOCK":return(0,n.jsx)(I.Z,{style:{marginRight:4}});default:return null}},K=e=>{let{categories:l,selectedCategories:a,onChange:t}=e;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)(L.Z,{className:"text-gray-500 mr-1"}),(0,n.jsx)(T,{className:"text-gray-500 font-medium",children:"Filter by category"})]}),(0,n.jsx)(m.default,{mode:"multiple",placeholder:"Select categories to filter by",style:{width:"100%"},onChange:t,value:a,allowClear:!0,showSearch:!0,optionFilterProp:"children",className:"mb-4",tagRender:e=>(0,n.jsx)(h.Z,{color:"blue",closable:e.closable,onClose:e.onClose,className:"mr-2 mb-2",children:e.label}),children:l.map(e=>(0,n.jsx)(E,{value:e.category,children:e.category},e.category))})]})},F=e=>{let{onSelectAll:l,onUnselectAll:a,hasSelectedEntities:t}=e;return(0,n.jsxs)("div",{className:"bg-gray-50 p-5 rounded-lg mb-6 border border-gray-200 shadow-sm",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(T,{strong:!0,className:"text-gray-700 text-base",children:"Quick Actions"}),(0,n.jsx)(Z.Z,{title:"Apply action to all PII types at once",children:(0,n.jsx)("div",{className:"ml-2 text-gray-400 cursor-help text-xs",children:"â“˜"})})]}),(0,n.jsx)(P.ZP,{color:"danger",variant:"outlined",onClick:a,disabled:!t,icon:(0,n.jsx)(z.Z,{}),children:"Unselect All"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsx)(P.ZP,{color:"primary",variant:"outlined",onClick:()=>l("MASK"),className:"h-10",block:!0,icon:(0,n.jsx)(O.Z,{}),children:"Select All & Mask"}),(0,n.jsx)(P.ZP,{color:"danger",variant:"outlined",onClick:()=>l("BLOCK"),className:"h-10 hover:bg-red-100",block:!0,icon:(0,n.jsx)(I.Z,{}),children:"Select All & Block"})]})]})},G=e=>{let{entities:l,selectedEntities:a,selectedActions:t,actions:i,onEntitySelect:r,onActionSelect:s,entityToCategoryMap:o}=e;return(0,n.jsxs)("div",{className:"border rounded-lg overflow-hidden shadow-sm",children:[(0,n.jsxs)("div",{className:"bg-gray-50 px-5 py-3 border-b flex",children:[(0,n.jsx)(T,{strong:!0,className:"flex-1 text-gray-700",children:"PII Type"}),(0,n.jsx)(T,{strong:!0,className:"w-32 text-right text-gray-700",children:"Action"})]}),(0,n.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:0===l.length?(0,n.jsx)("div",{className:"py-10 text-center text-gray-500",children:"No PII types match your filter criteria"}):l.map(e=>(0,n.jsxs)("div",{className:"px-5 py-3 flex items-center justify-between hover:bg-gray-50 border-b ".concat(a.includes(e)?"bg-blue-50":""),children:[(0,n.jsxs)("div",{className:"flex items-center flex-1",children:[(0,n.jsx)(A.Z,{checked:a.includes(e),onChange:()=>r(e),className:"mr-3"}),(0,n.jsx)(T,{className:a.includes(e)?"font-medium text-gray-900":"text-gray-700",children:B(e)}),o.get(e)&&(0,n.jsx)(h.Z,{className:"ml-2 text-xs",color:"blue",children:o.get(e)})]}),(0,n.jsx)("div",{className:"w-32",children:(0,n.jsx)(m.default,{value:a.includes(e)&&t[e]||"MASK",onChange:l=>s(e,l),style:{width:120},disabled:!a.includes(e),className:"".concat(a.includes(e)?"":"opacity-50"),dropdownMatchSelectWidth:!1,children:i.map(e=>(0,n.jsx)(E,{value:e,children:(0,n.jsxs)("div",{className:"flex items-center",children:[M(e),e]})},e))})})]},e))})]})},{Title:D,Text:R}=u.default;var J=e=>{let{entities:l,actions:a,selectedEntities:t,selectedActions:i,onEntitySelect:r,onActionSelect:s,entityCategories:d=[]}=e,[c,u]=(0,o.useState)([]),m=new Map;d.forEach(e=>{e.entities.forEach(l=>{m.set(l,e.category)})});let x=l.filter(e=>0===c.length||c.includes(m.get(e)||""));return(0,n.jsxs)("div",{className:"pii-configuration",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-5",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(D,{level:4,className:"!m-0 font-semibold text-gray-800",children:"Configure PII Protection"})}),(0,n.jsxs)(R,{className:"text-gray-500",children:[t.length," items selected"]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)(K,{categories:d,selectedCategories:c,onChange:u}),(0,n.jsx)(F,{onSelectAll:e=>{l.forEach(l=>{t.includes(l)||r(l),s(l,e)})},onUnselectAll:()=>{t.forEach(e=>{r(e)})},hasSelectedEntities:t.length>0})]}),(0,n.jsx)(G,{entities:x,selectedEntities:t,selectedActions:i,actions:a,onEntitySelect:r,onActionSelect:s,entityToCategoryMap:m})]})},V=a(10353),U=a(31283),W=a(24199),Y=e=>{var l;let{selectedProvider:a,accessToken:t,providerParams:i=null,value:r=null}=e,[s,d]=(0,o.useState)(!1),[u,x]=(0,o.useState)(i),[h,g]=(0,o.useState)(null);if((0,o.useEffect)(()=>{if(i){x(i);return}let e=async()=>{if(t){d(!0),g(null);try{let e=await (0,c.getGuardrailProviderSpecificParams)(t);console.log("Provider params API response:",e),x(e),v(e),b(e)}catch(e){console.error("Error fetching provider params:",e),g("Failed to load provider parameters")}finally{d(!1)}}};i||e()},[t,i]),!a)return null;if(s)return(0,n.jsx)(V.Z,{tip:"Loading provider parameters..."});if(h)return(0,n.jsx)("div",{className:"text-red-500",children:h});let f=null===(l=_[a])||void 0===l?void 0:l.toLowerCase(),j=u&&u[f];if(console.log("Provider key:",f),console.log("Provider fields:",j),!j||0===Object.keys(j).length)return(0,n.jsx)("div",{children:"No configuration fields available for this provider."});console.log("Value:",r);let y=new Set(["patterns","blocked_words","blocked_words_file","categories","severity_threshold","pattern_redaction_format","keyword_redaction_tag"]),N=w(a),k=function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0;return Object.entries(e).map(e=>{let[t,i]=e,s=l?"".concat(l,".").concat(t):t,o=a?a[t]:null==r?void 0:r[t];return(console.log("Field value:",o),"ui_friendly_name"===t||"optional_params"===t&&"nested"===i.type&&i.fields||N&&y.has(t))?null:"nested"===i.type&&i.fields?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-2 font-medium",children:t}),(0,n.jsx)("div",{className:"ml-4 border-l-2 border-gray-200 pl-4",children:k(i.fields,s,o)})]},s):(0,n.jsx)(p.Z.Item,{name:s,label:t,tooltip:i.description,rules:i.required?[{required:!0,message:"".concat(t," is required")}]:void 0,children:"select"===i.type&&i.options?(0,n.jsx)(m.default,{placeholder:i.description,defaultValue:o||i.default_value,children:i.options.map(e=>(0,n.jsx)(m.default.Option,{value:e,children:e},e))}):"multiselect"===i.type&&i.options?(0,n.jsx)(m.default,{mode:"multiple",placeholder:i.description,defaultValue:o||i.default_value,children:i.options.map(e=>(0,n.jsx)(m.default.Option,{value:e,children:e},e))}):"bool"===i.type||"boolean"===i.type?(0,n.jsxs)(m.default,{placeholder:i.description,defaultValue:void 0!==o?String(o):i.default_value,children:[(0,n.jsx)(m.default.Option,{value:"true",children:"True"}),(0,n.jsx)(m.default.Option,{value:"false",children:"False"})]}):"number"===i.type?(0,n.jsx)(W.Z,{step:1,width:400,placeholder:i.description,defaultValue:void 0!==o?Number(o):void 0}):t.includes("password")||t.includes("secret")||t.includes("key")?(0,n.jsx)(U.o,{placeholder:i.description,type:"password",defaultValue:o||""}):(0,n.jsx)(U.o,{placeholder:i.description,type:"text",defaultValue:o||""})},s)})};return(0,n.jsx)(n.Fragment,{children:k(j)})};let{Title:q}=u.default,H=e=>{let{field:l,fieldKey:a,fullFieldKey:t,value:i}=e,[r,s]=o.useState([]),[d,c]=o.useState(l.dict_key_options||[]);o.useEffect(()=>{if(i&&"object"==typeof i){let e=Object.keys(i);s(e.map(e=>({key:e,id:"".concat(e,"_").concat(Date.now(),"_").concat(Math.random())}))),c((l.dict_key_options||[]).filter(l=>!e.includes(l)))}},[i,l.dict_key_options]);let u=e=>{e&&(s([...r,{key:e,id:"".concat(e,"_").concat(Date.now())}]),c(d.filter(l=>l!==e)))},x=(e,l)=>{s(r.filter(l=>l.id!==e)),c([...d,l].sort())};return(0,n.jsxs)("div",{className:"space-y-3",children:[r.map(e=>(0,n.jsxs)("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[(0,n.jsx)("div",{className:"w-24 font-medium text-sm",children:e.key}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(p.Z.Item,{name:Array.isArray(t)?[...t,e.key]:[t,e.key],style:{marginBottom:0},initialValue:i&&"object"==typeof i?i[e.key]:void 0,normalize:"number"===l.dict_value_type?e=>{if(null==e||""===e)return;let l=Number(e);return isNaN(l)?e:l}:void 0,children:"number"===l.dict_value_type?(0,n.jsx)(W.Z,{step:1,width:200,placeholder:"Enter ".concat(e.key," value")}):"boolean"===l.dict_value_type?(0,n.jsxs)(m.default,{placeholder:"Select ".concat(e.key," value"),children:[(0,n.jsx)(m.default.Option,{value:!0,children:"True"}),(0,n.jsx)(m.default.Option,{value:!1,children:"False"})]}):(0,n.jsx)(U.o,{placeholder:"Enter ".concat(e.key," value"),type:"text"})})}),(0,n.jsx)("button",{type:"button",className:"text-red-500 hover:text-red-700 text-sm",onClick:()=>x(e.id,e.key),children:"Remove"})]},e.id)),d.length>0&&(0,n.jsxs)("div",{className:"flex items-center space-x-3 mt-2",children:[(0,n.jsx)(m.default,{placeholder:"Select category to configure",style:{width:200},onSelect:e=>e&&u(e),value:void 0,children:d.map(e=>(0,n.jsx)(m.default.Option,{value:e,children:e},e))}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"Select a category to add threshold configuration"})]})]})};var $=e=>{let{optionalParams:l,parentFieldKey:a,values:t}=e,i=(e,l)=>{let i="".concat(a,".").concat(e),r=null==t?void 0:t[e];return(console.log("value",r),"dict"===l.type&&l.dict_key_options)?(0,n.jsxs)("div",{className:"mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200",children:[(0,n.jsx)("div",{className:"mb-4 font-medium text-gray-900 text-base",children:e}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:l.description}),(0,n.jsx)(H,{field:l,fieldKey:e,fullFieldKey:[a,e],value:r})]},i):(0,n.jsx)("div",{className:"mb-8 p-6 bg-white rounded-lg border border-gray-200 shadow-sm",children:(0,n.jsx)(p.Z.Item,{name:[a,e],label:(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("div",{className:"font-medium text-gray-900 text-base",children:e}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:l.description})]}),rules:l.required?[{required:!0,message:"".concat(e," is required")}]:void 0,className:"mb-0",initialValue:void 0!==r?r:l.default_value,normalize:"number"===l.type?e=>{if(null==e||""===e)return;let l=Number(e);return isNaN(l)?e:l}:void 0,children:"select"===l.type&&l.options?(0,n.jsx)(m.default,{placeholder:l.description,children:l.options.map(e=>(0,n.jsx)(m.default.Option,{value:e,children:e},e))}):"multiselect"===l.type&&l.options?(0,n.jsx)(m.default,{mode:"multiple",placeholder:l.description,children:l.options.map(e=>(0,n.jsx)(m.default.Option,{value:e,children:e},e))}):"bool"===l.type||"boolean"===l.type?(0,n.jsxs)(m.default,{placeholder:l.description,children:[(0,n.jsx)(m.default.Option,{value:"true",children:"True"}),(0,n.jsx)(m.default.Option,{value:"false",children:"False"})]}):"number"===l.type?(0,n.jsx)(W.Z,{step:1,width:400,placeholder:l.description}):e.includes("password")||e.includes("secret")||e.includes("key")?(0,n.jsx)(U.o,{placeholder:l.description,type:"password"}):(0,n.jsx)(U.o,{placeholder:l.description,type:"text"})})},i)};return l.fields&&0!==Object.keys(l.fields).length?(0,n.jsxs)("div",{className:"guardrail-optional-params",children:[(0,n.jsxs)("div",{className:"mb-8 pb-4 border-b border-gray-100",children:[(0,n.jsx)(q,{level:3,className:"mb-2 font-semibold text-gray-900",children:"Optional Parameters"}),(0,n.jsx)("p",{className:"text-gray-600 text-sm",children:l.description||"Configure additional settings for this guardrail provider"})]}),(0,n.jsx)("div",{className:"space-y-8",children:Object.entries(l.fields).map(e=>{let[l,a]=e;return i(l,a)})})]}):null},Q=a(9114),X=a(5945),ee=a(58760),el=a(65319),ea=a(96473),et=a(3632),ei=a(16312);let{Text:er}=u.default,{Option:es}=m.default;var en=e=>{let{visible:l,prebuiltPatterns:a,categories:t,selectedPatternName:i,patternAction:r,onPatternNameChange:s,onActionChange:o,onAdd:d,onCancel:c}=e;return(0,n.jsxs)(g.Z,{title:"Add prebuilt pattern",open:l,onCancel:c,footer:null,width:800,children:[(0,n.jsxs)(ee.Z,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(er,{strong:!0,children:"Pattern type"}),(0,n.jsx)(m.default,{placeholder:"Choose pattern type",value:i,onChange:s,style:{width:"100%",marginTop:8},showSearch:!0,filterOption:(e,l)=>{let t=a.find(e=>e.name===(null==l?void 0:l.value));return!!t&&(t.display_name.toLowerCase().includes(e.toLowerCase())||t.name.toLowerCase().includes(e.toLowerCase()))},children:t.map(e=>{let l=a.filter(l=>l.category===e);return 0===l.length?null:(0,n.jsx)(m.default.OptGroup,{label:e,children:l.map(e=>(0,n.jsx)(es,{value:e.name,children:e.display_name},e.name))},e)})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(er,{strong:!0,children:"Action"}),(0,n.jsx)(er,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this pattern is detected"}),(0,n.jsxs)(m.default,{value:r,onChange:o,style:{width:"100%"},children:[(0,n.jsx)(es,{value:"BLOCK",children:"Block"}),(0,n.jsx)(es,{value:"MASK",children:"Mask"})]})]})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,n.jsx)(ei.z,{variant:"secondary",onClick:c,children:"Cancel"}),(0,n.jsx)(ei.z,{onClick:d,children:"Add"})]})]})};let{Text:eo}=u.default,{Option:ed}=m.default;var ec=e=>{let{visible:l,patternName:a,patternRegex:t,patternAction:i,onNameChange:r,onRegexChange:s,onActionChange:o,onAdd:d,onCancel:c}=e;return(0,n.jsxs)(g.Z,{title:"Add custom regex pattern",open:l,onCancel:c,footer:null,width:800,children:[(0,n.jsxs)(ee.Z,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(eo,{strong:!0,children:"Pattern name"}),(0,n.jsx)(f.o,{placeholder:"e.g., internal_id, employee_code",value:a,onValueChange:r,style:{marginTop:8}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(eo,{strong:!0,children:"Regex pattern"}),(0,n.jsx)(f.o,{placeholder:"e.g., ID-[0-9]{6}",value:t,onValueChange:s,style:{marginTop:8}}),(0,n.jsx)(eo,{type:"secondary",style:{fontSize:12},children:"Enter a valid regular expression to match sensitive data"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(eo,{strong:!0,children:"Action"}),(0,n.jsx)(eo,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this pattern is detected"}),(0,n.jsxs)(m.default,{value:i,onChange:o,style:{width:"100%"},children:[(0,n.jsx)(ed,{value:"BLOCK",children:"Block"}),(0,n.jsx)(ed,{value:"MASK",children:"Mask"})]})]})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,n.jsx)(f.z,{variant:"secondary",onClick:c,children:"Cancel"}),(0,n.jsx)(f.z,{onClick:d,children:"Add"})]})]})},eu=a(51147);let{Text:em}=u.default,{Option:ex}=m.default;var ep=e=>{let{visible:l,keyword:a,action:t,description:i,onKeywordChange:r,onActionChange:s,onDescriptionChange:o,onAdd:d,onCancel:c}=e;return(0,n.jsxs)(g.Z,{title:"Add blocked keyword",open:l,onCancel:c,footer:null,width:800,children:[(0,n.jsxs)(ee.Z,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(em,{strong:!0,children:"Keyword"}),(0,n.jsx)(eu.oi,{placeholder:"Enter sensitive keyword or phrase",value:a,onValueChange:r,style:{marginTop:8}})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(em,{strong:!0,children:"Action"}),(0,n.jsx)(em,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this keyword is detected"}),(0,n.jsxs)(m.default,{value:t,onChange:s,style:{width:"100%"},children:[(0,n.jsx)(ex,{value:"BLOCK",children:"Block"}),(0,n.jsx)(ex,{value:"MASK",children:"Mask"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(em,{strong:!0,children:"Description (optional)"}),(0,n.jsx)(eu.gx,{placeholder:"Explain why this keyword is sensitive",value:i,onValueChange:o,rows:3,style:{marginTop:8}})]})]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,n.jsx)(eu.zx,{variant:"secondary",onClick:c,children:"Cancel"}),(0,n.jsx)(eu.zx,{onClick:d,children:"Add"})]})]})},eh=a(56609),eg=a(26349);let{Text:ef}=u.default,{Option:ej}=m.default;var ev=e=>{let{patterns:l,onActionChange:a,onRemove:t}=e,i=[{title:"Type",dataIndex:"type",key:"type",width:100,render:e=>(0,n.jsx)(h.Z,{color:"prebuilt"===e?"blue":"green",children:"prebuilt"===e?"Prebuilt":"Custom"})},{title:"Pattern name",dataIndex:"name",key:"name",render:(e,l)=>l.display_name||l.name},{title:"Regex pattern",dataIndex:"pattern",key:"pattern",render:e=>e?(0,n.jsxs)(ef,{code:!0,style:{fontSize:12},children:[e.substring(0,40),"..."]}):"-"},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,l)=>(0,n.jsxs)(m.default,{value:e,onChange:e=>a(l.id,e),style:{width:120},size:"small",children:[(0,n.jsx)(ej,{value:"BLOCK",children:"Block"}),(0,n.jsx)(ej,{value:"MASK",children:"Mask"})]})},{title:"",key:"actions",width:100,render:(e,l)=>(0,n.jsx)(ei.z,{type:"button",variant:"light",color:"red",size:"xs",icon:eg.Z,onClick:()=>t(l.id),children:"Delete"})}];return 0===l.length?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"No patterns added."}):(0,n.jsx)(eh.Z,{dataSource:l,columns:i,rowKey:"id",pagination:!1,size:"small"})};let{Text:ey}=u.default,{Option:e_}=m.default;var eb=e=>{let{keywords:l,onActionChange:a,onRemove:t}=e,i=[{title:"Keyword",dataIndex:"keyword",key:"keyword"},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,l)=>(0,n.jsxs)(m.default,{value:e,onChange:e=>a(l.id,"action",e),style:{width:120},size:"small",children:[(0,n.jsx)(e_,{value:"BLOCK",children:"Block"}),(0,n.jsx)(e_,{value:"MASK",children:"Mask"})]})},{title:"Description",dataIndex:"description",key:"description",render:e=>e||"-"},{title:"",key:"actions",width:100,render:(e,l)=>(0,n.jsx)(ei.z,{type:"button",variant:"light",color:"red",size:"xs",icon:eg.Z,onClick:()=>t(l.id),children:"Delete"})}];return 0===l.length?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"No keywords added."}):(0,n.jsx)(eh.Z,{dataSource:l,columns:i,rowKey:"id",pagination:!1,size:"small"})},eN=a(44851),ew=a(38434);let{Title:ek,Text:eC}=u.default,{Option:eS}=m.default,{Panel:eZ}=eN.default;var eP=e=>{var l;let{availableCategories:a,selectedCategories:t,onCategoryAdd:i,onCategoryRemove:r,onCategoryUpdate:s,accessToken:d}=e,[u,x]=o.useState(""),[p,g]=o.useState({}),[f,j]=o.useState({}),[v,y]=o.useState([]),[_,b]=o.useState(""),[N,w]=o.useState(!1),k=async e=>{if(d&&!p[e]){j(l=>({...l,[e]:!0}));try{let l=await (0,c.getCategoryYaml)(d,e);g(a=>({...a,[e]:l.yaml_content}))}catch(l){console.error("Failed to fetch YAML for category ".concat(e,":"),l)}finally{j(l=>({...l,[e]:!1}))}}};o.useEffect(()=>{if(u&&d){let e=p[u];if(e){b(e);return}w(!0),console.log("Fetching YAML for category: ".concat(u),{accessToken:d?"present":"missing"}),(0,c.getCategoryYaml)(d,u).then(e=>{console.log("Successfully fetched YAML for ".concat(u,":"),e),b(e.yaml_content),g(l=>({...l,[u]:e.yaml_content}))}).catch(e=>{console.error("Failed to fetch preview YAML for category ".concat(u,":"),e),b("")}).finally(()=>{w(!1)})}else b(""),w(!1)},[u,d]);let C=[{title:"Category",dataIndex:"display_name",key:"display_name",render:(e,l)=>{let t=a.find(e=>e.name===l.category);return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:500},children:e}),(null==t?void 0:t.description)&&(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888",marginTop:"4px"},children:t.description})]})}},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,l)=>(0,n.jsxs)(m.default,{value:e,onChange:e=>s(l.id,"action",e),style:{width:"100%"},children:[(0,n.jsx)(eS,{value:"BLOCK",children:(0,n.jsx)(h.Z,{color:"red",children:"BLOCK"})}),(0,n.jsx)(eS,{value:"MASK",children:(0,n.jsx)(h.Z,{color:"orange",children:"MASK"})})]})},{title:"Severity Threshold",dataIndex:"severity_threshold",key:"severity_threshold",width:180,render:(e,l)=>(0,n.jsxs)(m.default,{value:e,onChange:e=>s(l.id,"severity_threshold",e),style:{width:"100%"},children:[(0,n.jsx)(eS,{value:"low",children:"Low"}),(0,n.jsx)(eS,{value:"medium",children:"Medium"}),(0,n.jsx)(eS,{value:"high",children:"High"})]})},{title:"",key:"actions",width:80,render:(e,l)=>(0,n.jsx)(ei.z,{icon:eg.Z,onClick:()=>r(l.id),variant:"secondary",size:"xs",children:"Remove"})}],S=a.filter(e=>!t.some(l=>l.category===e.name));return(0,n.jsxs)(X.Z,{title:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(ek,{level:5,style:{margin:0},children:"Content Categories"}),(0,n.jsx)(eC,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Detect harmful content, bias, and inappropriate advice using semantic analysis"})]}),size:"small",children:[(0,n.jsxs)("div",{style:{marginBottom:16,display:"flex",gap:8},children:[(0,n.jsx)(m.default,{placeholder:"Select a content category",value:u||void 0,onChange:x,style:{flex:1},showSearch:!0,optionLabelProp:"label",filterOption:(e,l)=>{var a,t;return(null!==(t=null==l?void 0:null===(a=l.label)||void 0===a?void 0:a.toString().toLowerCase())&&void 0!==t?t:"").includes(e.toLowerCase())},children:S.map(e=>(0,n.jsx)(eS,{value:e.name,label:e.display_name,children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontWeight:500},children:e.display_name}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"2px"},children:e.description})]})},e.name))}),(0,n.jsx)(ei.z,{onClick:()=>{if(!u)return;let e=a.find(e=>e.name===u);!e||t.some(e=>e.category===u)||(i({id:"category-".concat(Date.now()),category:e.name,display_name:e.display_name,action:e.default_action,severity_threshold:"medium"}),x(""),b(""))},disabled:!u,icon:ea.Z,children:"Add"})]}),u&&(0,n.jsxs)("div",{style:{marginBottom:16,padding:"12px",background:"#f9f9f9",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,n.jsxs)("div",{style:{marginBottom:8,fontWeight:500,fontSize:"14px"},children:["Preview: ",null===(l=a.find(e=>e.name===u))||void 0===l?void 0:l.display_name]}),N?(0,n.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#888"},children:"Loading YAML..."}):_?(0,n.jsx)("pre",{style:{background:"#fff",padding:"12px",borderRadius:"4px",overflow:"auto",maxHeight:"300px",fontSize:"12px",lineHeight:"1.5",margin:0,border:"1px solid #e0e0e0"},children:(0,n.jsx)("code",{children:_})}):(0,n.jsx)("div",{style:{padding:"8px",textAlign:"center",color:"#888",fontSize:"12px"},children:"Unable to load YAML content"})]}),t.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eh.Z,{dataSource:t,columns:C,pagination:!1,size:"small",rowKey:"id"}),(0,n.jsx)("div",{style:{marginTop:16},children:(0,n.jsx)(eN.default,{activeKey:v,onChange:e=>{let l=Array.isArray(e)?e:e?[e]:[],a=new Set(v);l.forEach(e=>{a.has(e)||p[e]||k(e)}),y(l)},ghost:!0,children:t.map(e=>(0,n.jsx)(eZ,{header:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)(ew.Z,{}),(0,n.jsxs)("span",{children:["View YAML for ",e.display_name]})]}),children:f[e.category]?(0,n.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#888"},children:"Loading YAML..."}):p[e.category]?(0,n.jsx)("pre",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"4px",overflow:"auto",maxHeight:"400px",fontSize:"12px",lineHeight:"1.5",margin:0},children:(0,n.jsx)("code",{children:p[e.category]})}):(0,n.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#888"},children:"YAML will load when expanded"})},e.category))})})]}):(0,n.jsx)("div",{style:{textAlign:"center",padding:"24px",color:"#888",border:"1px dashed #d9d9d9",borderRadius:"4px"},children:"No content categories selected. Add categories to detect harmful content, bias, or inappropriate advice."})]})};let{Title:eA,Text:eO}=u.default;var eI=e=>{let{prebuiltPatterns:l,categories:a,selectedPatterns:t,blockedWords:i,onPatternAdd:r,onPatternRemove:s,onPatternActionChange:d,onBlockedWordAdd:u,onBlockedWordRemove:m,onBlockedWordUpdate:x,onFileUpload:p,accessToken:h,showStep:g,contentCategories:f=[],selectedContentCategories:j=[],onContentCategoryAdd:v,onContentCategoryRemove:y,onContentCategoryUpdate:_}=e,[b,N]=(0,o.useState)(!1),[w,k]=(0,o.useState)(!1),[C,S]=(0,o.useState)(!1),[Z,P]=(0,o.useState)(""),[A,O]=(0,o.useState)("BLOCK"),[I,L]=(0,o.useState)(""),[z,T]=(0,o.useState)(""),[E,B]=(0,o.useState)("BLOCK"),[M,K]=(0,o.useState)(""),[F,G]=(0,o.useState)("BLOCK"),[D,R]=(0,o.useState)(""),[J,V]=(0,o.useState)(!1),U=async e=>{V(!0);try{let l=await e.text();if(h){let e=await (0,c.validateBlockedWordsFile)(h,l);if(e.valid)p&&p(l),Q.Z.success(e.message||"File uploaded successfully");else{let l=e.error||e.errors&&e.errors.join(", ")||"Invalid file";Q.Z.error("Validation failed: ".concat(l))}}}catch(e){Q.Z.error("Failed to upload file: ".concat(e))}finally{V(!1)}return!1};return(0,n.jsxs)("div",{className:"space-y-6",children:[!g&&(0,n.jsx)("div",{children:(0,n.jsx)(eO,{type:"secondary",children:"Configure patterns, keywords, and content categories to detect and filter sensitive information in requests and responses."})}),(!g||"patterns"===g)&&(0,n.jsxs)(X.Z,{title:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(eA,{level:5,style:{margin:0},children:"Pattern Detection"}),(0,n.jsx)(eO,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Detect sensitive information using regex patterns (SSN, credit cards, API keys, etc.)"})]}),size:"small",children:[(0,n.jsx)("div",{style:{marginBottom:16},children:(0,n.jsxs)(ee.Z,{children:[(0,n.jsx)(ei.z,{type:"button",onClick:()=>N(!0),icon:ea.Z,children:"Add prebuilt pattern"}),(0,n.jsx)(ei.z,{type:"button",onClick:()=>S(!0),variant:"secondary",icon:ea.Z,children:"Add custom regex"})]})}),(0,n.jsx)(ev,{patterns:t,onActionChange:d,onRemove:s})]}),(!g||"keywords"===g)&&(0,n.jsxs)(X.Z,{title:(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(eA,{level:5,style:{margin:0},children:"Blocked Keywords"}),(0,n.jsx)(eO,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Block or mask specific sensitive terms and phrases"})]}),size:"small",children:[(0,n.jsx)("div",{style:{marginBottom:16},children:(0,n.jsxs)(ee.Z,{children:[(0,n.jsx)(ei.z,{type:"button",onClick:()=>k(!0),icon:ea.Z,children:"Add keyword"}),(0,n.jsx)(el.default,{beforeUpload:U,accept:".yaml,.yml",showUploadList:!1,children:(0,n.jsx)(ei.z,{type:"button",variant:"secondary",icon:et.Z,loading:J,children:"Upload YAML file"})})]})}),(0,n.jsx)(eb,{keywords:i,onActionChange:x,onRemove:m})]}),(!g||"categories"===g)&&f.length>0&&v&&y&&_&&(0,n.jsx)(eP,{availableCategories:f,selectedCategories:j,onCategoryAdd:v,onCategoryRemove:y,onCategoryUpdate:_,accessToken:h}),(0,n.jsx)(en,{visible:b,prebuiltPatterns:l,categories:a,selectedPatternName:Z,patternAction:A,onPatternNameChange:P,onActionChange:e=>O(e),onAdd:()=>{if(!Z){Q.Z.error("Please select a pattern");return}let e=l.find(e=>e.name===Z);r({id:"pattern-".concat(Date.now()),type:"prebuilt",name:Z,display_name:null==e?void 0:e.display_name,action:A}),N(!1),P(""),O("BLOCK")},onCancel:()=>{N(!1),P(""),O("BLOCK")}}),(0,n.jsx)(ec,{visible:C,patternName:I,patternRegex:z,patternAction:E,onNameChange:L,onRegexChange:T,onActionChange:e=>B(e),onAdd:()=>{if(!I||!z){Q.Z.error("Please provide pattern name and regex");return}r({id:"custom-".concat(Date.now()),type:"custom",name:I,pattern:z,action:E}),S(!1),L(""),T(""),B("BLOCK")},onCancel:()=>{S(!1),L(""),T(""),B("BLOCK")}}),(0,n.jsx)(ep,{visible:w,keyword:M,action:F,description:D,onKeywordChange:K,onActionChange:e=>G(e),onDescriptionChange:R,onAdd:()=>{if(!M){Q.Z.error("Please enter a keyword");return}u({id:"word-".concat(Date.now()),keyword:M,action:F,description:D||void 0}),k(!1),K(""),R(""),G("BLOCK")},onCancel:()=>{k(!1),K(""),R(""),G("BLOCK")}})]})},eL=a(78801),ez=a(4260),eT=a(23496),eE=a(85180),eB=a(15424);let eM={rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""},eK=e=>({...eM,...e||{},rules:(null==e?void 0:e.rules)?[...e.rules]:[]});var eF=e=>{let{value:l,onChange:a,disabled:t=!1}=e,i=eK(l),r=e=>{let l={...i,...e};null==a||a(l)},s=(e,l)=>{r({rules:i.rules.map((a,t)=>t===e?{...a,...l}:a)})},o=e=>{r({rules:i.rules.filter((l,a)=>a!==e)})},d=(e,l)=>{let a=i.rules[e];if(!a)return;let t=Object.entries(a.allowed_param_patterns||{});l(t);let r={};t.forEach(e=>{let[l,a]=e;r[l]=a}),s(e,{allowed_param_patterns:Object.keys(r).length>0?r:void 0})},c=(e,l,a)=>{d(e,e=>{if(!e[l])return;let[,t]=e[l];e[l]=[a,t]})},u=(e,l,a)=>{d(e,e=>{if(!e[l])return;let[t]=e[l];e[l]=[t,a]})},x=(e,l)=>{let a=Object.entries(e.allowed_param_patterns||{});return 0===a.length?(0,n.jsx)(P.ZP,{disabled:t,size:"small",onClick:()=>s(l,{allowed_param_patterns:{"":""}}),children:"+ Restrict tool arguments (optional)"}):(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eL.x,{className:"text-sm text-gray-600",children:"Argument constraints (dot or array paths)"}),a.map((a,i)=>{let[r,s]=a;return(0,n.jsxs)(ee.Z,{align:"start",children:[(0,n.jsx)(ez.default,{disabled:t,placeholder:"messages[0].content",value:r,onChange:e=>c(l,i,e.target.value)}),(0,n.jsx)(ez.default,{disabled:t,placeholder:"^email@.*$",value:s,onChange:e=>u(l,i,e.target.value)}),(0,n.jsx)(P.ZP,{disabled:t,icon:(0,n.jsx)(eg.Z,{}),danger:!0,onClick:()=>d(l,e=>{e.splice(i,1)})})]},"".concat(e.id||l,"-").concat(i))}),(0,n.jsx)(P.ZP,{disabled:t,size:"small",onClick:()=>s(l,{allowed_param_patterns:{...e.allowed_param_patterns||{},"":""}}),children:"+ Add another constraint"})]})};return(0,n.jsxs)(eL.Z,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(eL.x,{className:"text-lg font-semibold",children:"LiteLLM Tool Permission Guardrail"}),(0,n.jsx)(eL.x,{className:"text-sm text-gray-500",children:"Provide regex patterns (e.g., ^mcp__github_.*$) for tool names or types and optionally constrain payload fields."})]}),!t&&(0,n.jsx)(P.ZP,{icon:(0,n.jsx)(ea.Z,{}),type:"primary",onClick:()=>{r({rules:[...i.rules,{id:"rule_".concat(Math.random().toString(36).slice(2,8)),decision:"allow",allowed_param_patterns:void 0}]})},className:"!bg-blue-600 !text-white hover:!bg-blue-500",children:"Add Rule"})]}),(0,n.jsx)(eT.Z,{}),0===i.rules.length?(0,n.jsx)(eE.Z,{description:"No tool rules added yet"}):(0,n.jsx)("div",{className:"space-y-4",children:i.rules.map((e,l)=>{var a,i;return(0,n.jsxs)(eL.Z,{className:"bg-gray-50",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)(eL.x,{className:"font-semibold",children:["Rule ",l+1]}),(0,n.jsx)(P.ZP,{icon:(0,n.jsx)(eg.Z,{}),danger:!0,type:"text",disabled:t,onClick:()=>o(l),children:"Remove"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(eL.x,{className:"text-sm font-medium",children:"Rule ID"}),(0,n.jsx)(ez.default,{disabled:t,placeholder:"unique_rule_id",value:e.id,onChange:e=>s(l,{id:e.target.value})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(eL.x,{className:"text-sm font-medium",children:"Tool Name (optional)"}),(0,n.jsx)(ez.default,{disabled:t,placeholder:"^mcp__github_.*$",value:null!==(a=e.tool_name)&&void 0!==a?a:"",onChange:e=>s(l,{tool_name:""===e.target.value.trim()?void 0:e.target.value})})]})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 mt-4",children:(0,n.jsxs)("div",{children:[(0,n.jsx)(eL.x,{className:"text-sm font-medium",children:"Tool Type (optional)"}),(0,n.jsx)(ez.default,{disabled:t,placeholder:"^function$",value:null!==(i=e.tool_type)&&void 0!==i?i:"",onChange:e=>s(l,{tool_type:""===e.target.value.trim()?void 0:e.target.value})})]})}),(0,n.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,n.jsx)(eL.x,{className:"text-sm font-medium",children:"Decision"}),(0,n.jsxs)(m.default,{disabled:t,value:e.decision,style:{width:200},onChange:e=>s(l,{decision:e}),children:[(0,n.jsx)(m.default.Option,{value:"allow",children:"Allow"}),(0,n.jsx)(m.default.Option,{value:"deny",children:"Deny"})]})]}),(0,n.jsx)("div",{className:"mt-4",children:x(e,l)})]},e.id||l)})}),(0,n.jsx)(eT.Z,{}),(0,n.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(eL.x,{className:"text-sm font-medium",children:"Default action"}),(0,n.jsxs)(m.default,{disabled:t,value:i.default_action,onChange:e=>r({default_action:e}),children:[(0,n.jsx)(m.default.Option,{value:"allow",children:"Allow"}),(0,n.jsx)(m.default.Option,{value:"deny",children:"Deny"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(eL.x,{className:"text-sm font-medium flex items-center gap-1",children:["On disallowed action",(0,n.jsx)(Z.Z,{title:"Block returns an error when a forbidden tool is invoked. Rewrite strips the tool call but lets the rest of the response continue.",children:(0,n.jsx)(eB.Z,{})})]}),(0,n.jsxs)(m.default,{disabled:t,value:i.on_disallowed_action,onChange:e=>r({on_disallowed_action:e}),children:[(0,n.jsx)(m.default.Option,{value:"block",children:"Block"}),(0,n.jsx)(m.default.Option,{value:"rewrite",children:"Rewrite"})]})]})]}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)(eL.x,{className:"text-sm font-medium",children:"Violation message (optional)"}),(0,n.jsx)(ez.default.TextArea,{disabled:t,rows:3,placeholder:"This violates our org policy...",value:i.violation_message_template,onChange:e=>r({violation_message_template:e.target.value})})]})]})};let{Title:eG,Text:eD,Link:eR}=u.default,{Option:eJ}=m.default,{Step:eV}=x.default,eU={pre_call:"Before LLM Call - Runs before the LLM call and checks the input (Recommended)",during_call:"During LLM Call - Runs in parallel with the LLM call, with response held until check completes",post_call:"After LLM Call - Runs after the LLM call and checks only the output",logging_only:"Logging Only - Only runs on logging callbacks without affecting the LLM call",pre_mcp_call:"Before MCP Tool Call - Runs before MCP tool execution and validates tool calls",during_mcp_call:"During MCP Tool Call - Runs in parallel with MCP tool execution for monitoring"};var eW=e=>{let{visible:l,onClose:a,accessToken:t,onSuccess:i}=e,[r]=p.Z.useForm(),[s,d]=(0,o.useState)(!1),[u,j]=(0,o.useState)(null),[k,S]=(0,o.useState)(null),[Z,P]=(0,o.useState)([]),[A,O]=(0,o.useState)({}),[I,L]=(0,o.useState)(0),[z,T]=(0,o.useState)(null),[E,B]=(0,o.useState)([]),[M,K]=(0,o.useState)(2),[F,G]=(0,o.useState)({}),[D,R]=(0,o.useState)([]),[V,U]=(0,o.useState)([]),[W,q]=(0,o.useState)([]),[H,X]=(0,o.useState)({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""}),ee=(0,o.useMemo)(()=>!!u&&"tool_permission"===(_[u]||"").toLowerCase(),[u]);(0,o.useEffect)(()=>{t&&(async()=>{try{let[e,l]=await Promise.all([(0,c.getGuardrailUISettings)(t),(0,c.getGuardrailProviderSpecificParams)(t)]);S(e),T(l),v(l),b(l)}catch(e){console.error("Error fetching guardrail data:",e),Q.Z.fromBackend("Failed to load guardrail configuration")}})()},[t]);let el=e=>{j(e),r.setFieldsValue({config:void 0,presidio_analyzer_api_base:void 0,presidio_anonymizer_api_base:void 0}),P([]),O({}),B([]),K(2),G({}),X({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""})},ea=e=>{P(l=>l.includes(e)?l.filter(l=>l!==e):[...l,e])},et=(e,l)=>{O(a=>({...a,[e]:l}))},ei=async()=>{try{if(0===I&&(await r.validateFields(["guardrail_name","provider","mode","default_on"]),u)){let e=["guardrail_name","provider","mode","default_on"];"PresidioPII"===u&&e.push("presidio_analyzer_api_base","presidio_anonymizer_api_base"),await r.validateFields(e)}if(1===I&&N(u)&&0===Z.length){Q.Z.fromBackend("Please select at least one PII entity to continue");return}L(I+1)}catch(e){console.error("Form validation failed:",e)}},er=()=>{L(I-1)},es=()=>{r.resetFields(),j(null),P([]),O({}),B([]),K(2),G({}),R([]),U([]),q([]),X({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""}),L(0)},en=()=>{es(),a()},eo=async()=>{try{d(!0),await r.validateFields();let l=r.getFieldsValue(!0),s=_[l.provider],n={guardrail_name:l.guardrail_name,litellm_params:{guardrail:s,mode:l.mode,default_on:l.default_on},guardrail_info:{}};if("PresidioPII"===l.provider&&Z.length>0){let e={};Z.forEach(l=>{e[l]=A[l]||"MASK"}),n.litellm_params.pii_entities_config=e,l.presidio_analyzer_api_base&&(n.litellm_params.presidio_analyzer_api_base=l.presidio_analyzer_api_base),l.presidio_anonymizer_api_base&&(n.litellm_params.presidio_anonymizer_api_base=l.presidio_anonymizer_api_base)}if(w(l.provider))D.length>0&&(n.litellm_params.patterns=D.map(e=>({pattern_type:"prebuilt"===e.type?"prebuilt":"regex",pattern_name:"prebuilt"===e.type?e.name:void 0,pattern:"custom"===e.type?e.pattern:void 0,name:e.name,action:e.action}))),V.length>0&&(n.litellm_params.blocked_words=V.map(e=>({keyword:e.keyword,action:e.action,description:e.description}))),W.length>0&&(n.litellm_params.categories=W.map(e=>({category:e.category,enabled:!0,action:e.action,severity_threshold:e.severity_threshold||"medium"})));else if(l.config)try{let e=JSON.parse(l.config);n.guardrail_info=e}catch(e){Q.Z.fromBackend("Invalid JSON in configuration"),d(!1);return}if("tool_permission"===s){if(0===H.rules.length){Q.Z.fromBackend("Add at least one tool permission rule"),d(!1);return}n.litellm_params.rules=H.rules,n.litellm_params.default_action=H.default_action,n.litellm_params.on_disallowed_action=H.on_disallowed_action,H.violation_message_template&&(n.litellm_params.violation_message_template=H.violation_message_template)}if(console.log("values: ",JSON.stringify(l)),z&&u){var e;let a=null===(e=_[u])||void 0===e?void 0:e.toLowerCase();console.log("providerKey: ",a);let t=z[a]||{},i=new Set;console.log("providerSpecificParams: ",JSON.stringify(t)),Object.keys(t).forEach(e=>{"optional_params"!==e&&i.add(e)}),t.optional_params&&t.optional_params.fields&&Object.keys(t.optional_params.fields).forEach(e=>{i.add(e)}),console.log("allowedParams: ",i),i.forEach(e=>{let a=l[e];if(null==a||""===a){var t;a=null===(t=l.optional_params)||void 0===t?void 0:t[e]}null!=a&&""!==a&&(n.litellm_params[e]=a)})}if(!t)throw Error("No access token available");console.log("Sending guardrail data:",JSON.stringify(n)),await (0,c.createGuardrailCall)(t,n),Q.Z.success("Guardrail created successfully"),es(),i(),a()}catch(e){console.error("Failed to create guardrail:",e),Q.Z.fromBackend("Failed to create guardrail: "+(e instanceof Error?e.message:String(e)))}finally{d(!1)}},ed=()=>{var e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.Z.Item,{name:"guardrail_name",label:"Guardrail Name",rules:[{required:!0,message:"Please enter a guardrail name"}],children:(0,n.jsx)(f.o,{placeholder:"Enter a name for this guardrail"})}),(0,n.jsx)(p.Z.Item,{name:"provider",label:"Guardrail Provider",rules:[{required:!0,message:"Please select a provider"}],children:(0,n.jsx)(m.default,{placeholder:"Select a guardrail provider",onChange:el,labelInValue:!1,optionLabelProp:"label",dropdownRender:e=>e,showSearch:!0,children:Object.entries(y()).map(e=>{let[l,a]=e;return(0,n.jsx)(eJ,{value:l,label:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[C[a]&&(0,n.jsx)("img",{src:C[a],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,n.jsx)("span",{children:a})]}),children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[C[a]&&(0,n.jsx)("img",{src:C[a],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,n.jsx)("span",{children:a})]})},l)})})}),(0,n.jsx)(p.Z.Item,{name:"mode",label:"Mode",tooltip:"How the guardrail should be applied",rules:[{required:!0,message:"Please select a mode"}],children:(0,n.jsx)(m.default,{optionLabelProp:"label",mode:"multiple",children:(null==k?void 0:null===(e=k.supported_modes)||void 0===e?void 0:e.map(e=>(0,n.jsx)(eJ,{value:e,label:e,children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:e}),"pre_call"===e&&(0,n.jsx)(h.Z,{color:"green",style:{marginLeft:"8px"},children:"Recommended"})]}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eU[e]})]})},e)))||(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eJ,{value:"pre_call",label:"pre_call",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"pre_call"})," ",(0,n.jsx)(h.Z,{color:"green",children:"Recommended"})]}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eU.pre_call})]})}),(0,n.jsx)(eJ,{value:"during_call",label:"during_call",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:(0,n.jsx)("strong",{children:"during_call"})}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eU.during_call})]})}),(0,n.jsx)(eJ,{value:"post_call",label:"post_call",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:(0,n.jsx)("strong",{children:"post_call"})}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eU.post_call})]})}),(0,n.jsx)(eJ,{value:"logging_only",label:"logging_only",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{children:(0,n.jsx)("strong",{children:"logging_only"})}),(0,n.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eU.logging_only})]})})]})})}),(0,n.jsx)(p.Z.Item,{name:"default_on",label:"Always On",tooltip:"If enabled, this guardrail will be applied to all requests by default.",children:(0,n.jsxs)(m.default,{children:[(0,n.jsx)(m.default.Option,{value:!0,children:"Yes"}),(0,n.jsx)(m.default.Option,{value:!1,children:"No"})]})}),!ee&&!w(u)&&(0,n.jsx)(Y,{selectedProvider:u,accessToken:t,providerParams:z})]})},ec=()=>k&&"PresidioPII"===u?(0,n.jsx)(J,{entities:k.supported_entities,actions:k.supported_actions,selectedEntities:Z,selectedActions:A,onEntitySelect:ea,onActionSelect:et,entityCategories:k.pii_entity_categories}):null,eu=e=>{if(!k||!w(u))return null;let l=k.content_filter_settings;return l?(0,n.jsx)(eI,{prebuiltPatterns:l.prebuilt_patterns||[],categories:l.pattern_categories||[],selectedPatterns:D,blockedWords:V,onPatternAdd:e=>R([...D,e]),onPatternRemove:e=>R(D.filter(l=>l.id!==e)),onPatternActionChange:(e,l)=>{R(D.map(a=>a.id===e?{...a,action:l}:a))},onBlockedWordAdd:e=>U([...V,e]),onBlockedWordRemove:e=>U(V.filter(l=>l.id!==e)),onBlockedWordUpdate:(e,l,a)=>{U(V.map(t=>t.id===e?{...t,[l]:a}:t))},contentCategories:l.content_categories||[],selectedContentCategories:W,onContentCategoryAdd:e=>q([...W,e]),onContentCategoryRemove:e=>q(W.filter(l=>l.id!==e)),onContentCategoryUpdate:(e,l,a)=>{q(W.map(t=>t.id===e?{...t,[l]:a}:t))},accessToken:t,showStep:e}):null},em=()=>{var e;if(!u)return null;if(ee)return(0,n.jsx)(eF,{value:H,onChange:X});if(!z)return null;console.log("guardrail_provider_map: ",_),console.log("selectedProvider: ",u);let l=null===(e=_[u])||void 0===e?void 0:e.toLowerCase(),a=z&&z[l];return a&&a.optional_params?(0,n.jsx)($,{optionalParams:a.optional_params,parentFieldKey:"optional_params"}):null};return(0,n.jsx)(g.Z,{title:"Add Guardrail",open:l,onCancel:en,footer:null,width:800,children:(0,n.jsxs)(p.Z,{form:r,layout:"vertical",initialValues:{mode:"pre_call",default_on:!1},children:[(0,n.jsxs)(x.default,{current:I,className:"mb-6",style:{overflow:"visible"},children:[(0,n.jsx)(eV,{title:"Basic Info"}),(0,n.jsx)(eV,{title:N(u)?"PII Configuration":w(u)?"Default Categories":"Provider Configuration"}),w(u)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eV,{title:"Patterns"}),(0,n.jsx)(eV,{title:"Keywords"})]})]}),(()=>{switch(I){case 0:return ed();case 1:if(N(u))return ec();if(w(u))return eu("categories");return em();case 2:if(w(u))return eu("patterns");return null;case 3:if(w(u))return eu("keywords");return null;default:return null}})(),(()=>{let e=I===(w(u)?4:2)-1;return(0,n.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[I>0&&(0,n.jsx)(f.z,{variant:"secondary",onClick:er,children:"Previous"}),!e&&(0,n.jsx)(f.z,{onClick:ei,children:"Next"}),e&&(0,n.jsx)(f.z,{onClick:eo,loading:s,children:"Create Guardrail"}),(0,n.jsx)(f.z,{variant:"secondary",onClick:en,children:"Cancel"})]})})()]})})},eY=a(78489),eq=a(47323),eH=a(21626),e$=a(97214),eQ=a(28241),eX=a(58834),e0=a(69552),e1=a(71876),e4=a(74998),e2=a(44633),e8=a(86462),e5=a(49084),e6=a(1309),e3=a(71594),e9=a(24525),e7=a(63709);let{Title:le,Text:ll}=u.default,{Option:la}=m.default;var lt=e=>{var l;let{visible:a,onClose:t,accessToken:i,onSuccess:r,guardrailId:s,initialValues:d}=e,[u]=p.Z.useForm(),[x,h]=(0,o.useState)(!1),[j,v]=(0,o.useState)((null==d?void 0:d.provider)||null),[b,N]=(0,o.useState)(null),[w,k]=(0,o.useState)([]),[S,Z]=(0,o.useState)({});(0,o.useEffect)(()=>{(async()=>{try{if(!i)return;let e=await (0,c.getGuardrailUISettings)(i);N(e)}catch(e){console.error("Error fetching guardrail settings:",e),Q.Z.fromBackend("Failed to load guardrail settings")}})()},[i]),(0,o.useEffect)(()=>{(null==d?void 0:d.pii_entities_config)&&Object.keys(d.pii_entities_config).length>0&&(k(Object.keys(d.pii_entities_config)),Z(d.pii_entities_config))},[d]);let P=e=>{k(l=>l.includes(e)?l.filter(l=>l!==e):[...l,e])},A=(e,l)=>{Z(a=>({...a,[e]:l}))},O=async()=>{try{h(!0);let e=await u.validateFields(),l=_[e.provider],a={guardrail_id:s,guardrail:{guardrail_name:e.guardrail_name,litellm_params:{guardrail:l,mode:e.mode,default_on:e.default_on},guardrail_info:{}}};if("PresidioPII"===e.provider&&w.length>0){let e={};w.forEach(l=>{e[l]=S[l]||"MASK"}),a.guardrail.litellm_params.pii_entities_config=e}else if(e.config)try{let l=JSON.parse(e.config);"Bedrock"===e.provider&&l?(l.guardrail_id&&(a.guardrail.litellm_params.guardrailIdentifier=l.guardrail_id),l.guardrail_version&&(a.guardrail.litellm_params.guardrailVersion=l.guardrail_version)):a.guardrail.guardrail_info=l}catch(e){Q.Z.fromBackend("Invalid JSON in configuration"),h(!1);return}if(!i)throw Error("No access token available");console.log("Sending guardrail update data:",JSON.stringify(a));let n=await fetch("/guardrails/".concat(s),{method:"PUT",headers:{[(0,c.getGlobalLitellmHeaderName)()]:"Bearer ".concat(i),"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok){let e=await n.text();throw Error(e||"Failed to update guardrail")}Q.Z.success("Guardrail updated successfully"),r(),t()}catch(e){console.error("Failed to update guardrail:",e),Q.Z.fromBackend("Failed to update guardrail: "+(e instanceof Error?e.message:String(e)))}finally{h(!1)}},I=()=>b&&j&&"PresidioPII"===j?(0,n.jsx)(J,{entities:b.supported_entities,actions:b.supported_actions,selectedEntities:w,selectedActions:S,onEntitySelect:P,onActionSelect:A,entityCategories:b.pii_entity_categories}):null;return(0,n.jsx)(g.Z,{title:"Edit Guardrail",open:a,onCancel:t,footer:null,width:700,children:(0,n.jsxs)(p.Z,{form:u,layout:"vertical",initialValues:d,children:[(0,n.jsx)(p.Z.Item,{name:"guardrail_name",label:"Guardrail Name",rules:[{required:!0,message:"Please enter a guardrail name"}],children:(0,n.jsx)(f.o,{placeholder:"Enter a name for this guardrail"})}),(0,n.jsx)(p.Z.Item,{name:"provider",label:"Guardrail Provider",rules:[{required:!0,message:"Please select a provider"}],children:(0,n.jsx)(m.default,{placeholder:"Select a guardrail provider",onChange:e=>{v(e),u.setFieldsValue({config:void 0}),k([]),Z({})},disabled:!0,optionLabelProp:"label",children:Object.entries(y()).map(e=>{let[l,a]=e;return(0,n.jsx)(la,{value:l,label:a,children:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[C[a]&&(0,n.jsx)("img",{src:C[a],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,n.jsx)("span",{children:a})]})},l)})})}),(0,n.jsx)(p.Z.Item,{name:"mode",label:"Mode",tooltip:"How the guardrail should be applied",rules:[{required:!0,message:"Please select a mode"}],children:(0,n.jsx)(m.default,{children:(null==b?void 0:null===(l=b.supported_modes)||void 0===l?void 0:l.map(e=>(0,n.jsx)(la,{value:e,children:e},e)))||(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(la,{value:"pre_call",children:"pre_call"}),(0,n.jsx)(la,{value:"post_call",children:"post_call"})]})})}),(0,n.jsx)(p.Z.Item,{name:"default_on",label:"Always On",tooltip:"If enabled, this guardrail will be applied to all requests by default",valuePropName:"checked",children:(0,n.jsx)(e7.Z,{})}),(()=>{if(!j)return null;if("PresidioPII"===j)return I();switch(j){case"Aporia":return(0,n.jsx)(p.Z.Item,{label:"Aporia Configuration",name:"config",tooltip:"JSON configuration for Aporia",children:(0,n.jsx)(ez.default.TextArea,{rows:4,placeholder:'{\n  "api_key": "your_aporia_api_key",\n  "project_name": "your_project_name"\n}'})});case"AimSecurity":return(0,n.jsx)(p.Z.Item,{label:"Aim Security Configuration",name:"config",tooltip:"JSON configuration for Aim Security",children:(0,n.jsx)(ez.default.TextArea,{rows:4,placeholder:'{\n  "api_key": "your_aim_api_key"\n}'})});case"Bedrock":return(0,n.jsx)(p.Z.Item,{label:"Amazon Bedrock Configuration",name:"config",tooltip:"JSON configuration for Amazon Bedrock guardrails",children:(0,n.jsx)(ez.default.TextArea,{rows:4,placeholder:'{\n  "guardrail_id": "your_guardrail_id",\n  "guardrail_version": "your_guardrail_version"\n}'})});case"GuardrailsAI":return(0,n.jsx)(p.Z.Item,{label:"Guardrails.ai Configuration",name:"config",tooltip:"JSON configuration for Guardrails.ai",children:(0,n.jsx)(ez.default.TextArea,{rows:4,placeholder:'{\n  "api_key": "your_guardrails_api_key",\n  "guardrail_id": "your_guardrail_id"\n}'})});case"LakeraAI":return(0,n.jsx)(p.Z.Item,{label:"Lakera AI Configuration",name:"config",tooltip:"JSON configuration for Lakera AI",children:(0,n.jsx)(ez.default.TextArea,{rows:4,placeholder:'{\n  "api_key": "your_lakera_api_key"\n}'})});case"PromptInjection":return(0,n.jsx)(p.Z.Item,{label:"Prompt Injection Configuration",name:"config",tooltip:"JSON configuration for prompt injection detection",children:(0,n.jsx)(ez.default.TextArea,{rows:4,placeholder:'{\n  "threshold": 0.8\n}'})});default:return(0,n.jsx)(p.Z.Item,{label:"Custom Configuration",name:"config",tooltip:"JSON configuration for your custom guardrail",children:(0,n.jsx)(ez.default.TextArea,{rows:4,placeholder:'{\n  "key1": "value1",\n  "key2": "value2"\n}'})})}})(),(0,n.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,n.jsx)(f.z,{variant:"secondary",onClick:t,children:"Cancel"}),(0,n.jsx)(f.z,{onClick:O,loading:x,children:"Update Guardrail"})]})]})})};(i=s||(s={})).DB="db",i.CONFIG="config";var li=e=>{let{guardrailsList:l,isLoading:a,onDeleteClick:t,accessToken:i,onGuardrailUpdated:r,isAdmin:d=!1,onGuardrailClick:c}=e,[u,m]=(0,o.useState)([{id:"created_at",desc:!0}]),[x,p]=(0,o.useState)(!1),[h,g]=(0,o.useState)(null),f=e=>e?new Date(e).toLocaleString():"-",j=[{header:"Guardrail ID",accessorKey:"guardrail_id",cell:e=>(0,n.jsx)(Z.Z,{title:String(e.getValue()||""),children:(0,n.jsx)(eY.Z,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>e.getValue()&&c(e.getValue()),children:e.getValue()?"".concat(String(e.getValue()).slice(0,7),"..."):""})})},{header:"Name",accessorKey:"guardrail_name",cell:e=>{let{row:l}=e,a=l.original;return(0,n.jsx)(Z.Z,{title:a.guardrail_name,children:(0,n.jsx)("span",{className:"text-xs font-medium",children:a.guardrail_name||"-"})})}},{header:"Provider",accessorKey:"litellm_params.guardrail",cell:e=>{let{row:l}=e,{logo:a,displayName:t}=S(l.original.litellm_params.guardrail);return(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[a&&(0,n.jsx)("img",{src:a,alt:"".concat(t," logo"),className:"w-4 h-4",onError:e=>{e.target.style.display="none"}}),(0,n.jsx)("span",{className:"text-xs",children:t})]})}},{header:"Mode",accessorKey:"litellm_params.mode",cell:e=>{let{row:l}=e,a=l.original;return(0,n.jsx)("span",{className:"text-xs",children:a.litellm_params.mode})}},{header:"Default On",accessorKey:"litellm_params.default_on",cell:e=>{var l,a;let{row:t}=e,i=t.original;return(0,n.jsx)(e6.C,{color:(null===(l=i.litellm_params)||void 0===l?void 0:l.default_on)?"green":"gray",className:"text-xs font-normal",size:"xs",children:(null===(a=i.litellm_params)||void 0===a?void 0:a.default_on)?"Default On":"Default Off"})}},{header:"Created At",accessorKey:"created_at",cell:e=>{let{row:l}=e,a=l.original;return(0,n.jsx)(Z.Z,{title:a.created_at,children:(0,n.jsx)("span",{className:"text-xs",children:f(a.created_at)})})}},{header:"Updated At",accessorKey:"updated_at",cell:e=>{let{row:l}=e,a=l.original;return(0,n.jsx)(Z.Z,{title:a.updated_at,children:(0,n.jsx)("span",{className:"text-xs",children:f(a.updated_at)})})}},{id:"actions",header:"Actions",cell:e=>{let{row:l}=e,a=l.original,i=a.guardrail_definition_location===s.CONFIG;return(0,n.jsx)("div",{className:"flex space-x-2",children:i?(0,n.jsx)(Z.Z,{title:"Config guardrail cannot be deleted on the dashboard. Please delete it from the config file.",children:(0,n.jsx)(eq.Z,{"data-testid":"config-delete-icon",icon:e4.Z,size:"sm",className:"cursor-not-allowed text-gray-400",title:"Config guardrail cannot be deleted on the dashboard. Please delete it from the config file.","aria-label":"Delete guardrail (config)"})}):(0,n.jsx)(Z.Z,{title:"Delete guardrail",children:(0,n.jsx)(eq.Z,{icon:e4.Z,size:"sm",onClick:()=>a.guardrail_id&&t(a.guardrail_id,a.guardrail_name||"Unnamed Guardrail"),className:"cursor-pointer hover:text-red-500"})})})}}],v=(0,e3.b7)({data:l,columns:j,state:{sorting:u},onSortingChange:m,getCoreRowModel:(0,e9.sC)(),getSortedRowModel:(0,e9.tj)(),enableSorting:!0});return(0,n.jsxs)("div",{className:"rounded-lg custom-border relative",children:[(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)(eH.Z,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,n.jsx)(eX.Z,{children:v.getHeaderGroups().map(e=>(0,n.jsx)(e1.Z,{children:e.headers.map(e=>(0,n.jsx)(e0.Z,{className:"py-1 h-8 ".concat("actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),onClick:e.column.getToggleSortingHandler(),children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,n.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,e3.ie)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,n.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,n.jsx)(e2.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,n.jsx)(e8.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,n.jsx)(e5.Z,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,n.jsx)(e$.Z,{children:a?(0,n.jsx)(e1.Z,{children:(0,n.jsx)(eQ.Z,{colSpan:j.length,className:"h-8 text-center",children:(0,n.jsx)("div",{className:"text-center text-gray-500",children:(0,n.jsx)("p",{children:"Loading..."})})})}):l.length>0?v.getRowModel().rows.map(e=>(0,n.jsx)(e1.Z,{className:"h-8",children:e.getVisibleCells().map(e=>(0,n.jsx)(eQ.Z,{className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ".concat("actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),children:(0,e3.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,n.jsx)(e1.Z,{children:(0,n.jsx)(eQ.Z,{colSpan:j.length,className:"h-8 text-center",children:(0,n.jsx)("div",{className:"text-center text-gray-500",children:(0,n.jsx)("p",{children:"No guardrails found"})})})})})]})}),h&&(0,n.jsx)(lt,{visible:x,onClose:()=>p(!1),accessToken:i,onSuccess:()=>{p(!1),g(null),r()},guardrailId:h.guardrail_id||"",initialValues:{guardrail_name:h.guardrail_name||"",provider:Object.keys(_).find(e=>_[e]===(null==h?void 0:h.litellm_params.guardrail))||"",mode:h.litellm_params.mode,default_on:h.litellm_params.default_on,pii_entities_config:h.litellm_params.pii_entities_config,...h.guardrail_info}})]})},lr=a(20347),ls=a(30078),ln=a(41649),lo=a(12514),ld=a(84264),lc=e=>{let{patterns:l,blockedWords:a,readOnly:t=!0,onPatternActionChange:i,onPatternRemove:r,onBlockedWordUpdate:s,onBlockedWordRemove:o}=e;if(0===l.length&&0===a.length)return null;let d=()=>{};return(0,n.jsxs)(n.Fragment,{children:[l.length>0&&(0,n.jsxs)(lo.Z,{className:"mt-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(ld.Z,{className:"text-lg font-semibold",children:"Pattern Detection"}),(0,n.jsxs)(ln.Z,{color:"blue",children:[l.length," patterns configured"]})]}),(0,n.jsx)(ev,{patterns:l,onActionChange:t?d:i||d,onRemove:t?d:r||d})]}),a.length>0&&(0,n.jsxs)(lo.Z,{className:"mt-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(ld.Z,{className:"text-lg font-semibold",children:"Blocked Keywords"}),(0,n.jsxs)(ln.Z,{color:"blue",children:[a.length," keywords configured"]})]}),(0,n.jsx)(eb,{keywords:a,onActionChange:t?d:s||d,onRemove:t?d:o||d})]})]})},lu=e=>{var l;let{guardrailData:a,guardrailSettings:t,isEditing:i,accessToken:r,onDataChange:s,onUnsavedChanges:d}=e,[c,u]=(0,o.useState)([]),[m,x]=(0,o.useState)([]),[p,h]=(0,o.useState)([]),[g,f]=(0,o.useState)([]);(0,o.useEffect)(()=>{var e,l;if(null==a?void 0:null===(e=a.litellm_params)||void 0===e?void 0:e.patterns){let e=a.litellm_params.patterns.map((e,l)=>({id:"pattern-".concat(l),type:"prebuilt"===e.pattern_type?"prebuilt":"custom",name:e.pattern_name||e.name,display_name:e.display_name,pattern:e.pattern,action:e.action||"BLOCK"}));u(e),h(e)}else u([]),h([]);if(null==a?void 0:null===(l=a.litellm_params)||void 0===l?void 0:l.blocked_words){let e=a.litellm_params.blocked_words.map((e,l)=>({id:"word-".concat(l),keyword:e.keyword,action:e.action||"BLOCK",description:e.description}));x(e),f(e)}else x([]),f([])},[a]),(0,o.useEffect)(()=>{s&&s(c,m)},[c,m,s]);let j=o.useMemo(()=>{let e=JSON.stringify(c)!==JSON.stringify(p),l=JSON.stringify(m)!==JSON.stringify(g);return e||l},[c,m,p,g]);return((0,o.useEffect)(()=>{i&&d&&d(j)},[j,i,d]),(null==a?void 0:null===(l=a.litellm_params)||void 0===l?void 0:l.guardrail)!=="litellm_content_filter")?null:i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eT.Z,{orientation:"left",children:"Content Filter Configuration"}),j&&(0,n.jsx)("div",{className:"mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,n.jsx)("p",{className:"text-sm text-yellow-800 font-medium",children:'âš ï¸ You have unsaved changes to patterns or keywords. Remember to click "Save Changes" at the bottom.'})}),(0,n.jsx)("div",{className:"mb-6",children:t&&t.content_filter_settings&&(0,n.jsx)(eI,{prebuiltPatterns:t.content_filter_settings.prebuilt_patterns||[],categories:t.content_filter_settings.pattern_categories||[],selectedPatterns:c,blockedWords:m,onPatternAdd:e=>u([...c,e]),onPatternRemove:e=>u(c.filter(l=>l.id!==e)),onPatternActionChange:(e,l)=>u(c.map(a=>a.id===e?{...a,action:l}:a)),onBlockedWordAdd:e=>x([...m,e]),onBlockedWordRemove:e=>x(m.filter(l=>l.id!==e)),onBlockedWordUpdate:(e,l,a)=>x(m.map(t=>t.id===e?{...t,[l]:a}:t)),onFileUpload:e=>{console.log("File uploaded:",e)},accessToken:r})})]}):(0,n.jsx)(lc,{patterns:c,blockedWords:m,readOnly:!0})};let lm=(e,l)=>({patterns:e.map(e=>({pattern_type:"prebuilt"===e.type?"prebuilt":"regex",pattern_name:"prebuilt"===e.type?e.name:void 0,pattern:"custom"===e.type?e.pattern:void 0,name:e.name,action:e.action})),blocked_words:l.map(e=>({keyword:e.keyword,action:e.action,description:e.description}))});var lx=a(10900),lp=a(59872),lh=a(30401),lg=a(78867),lf=e=>{var l,a,t,i,r,s,d,u,x,h,g,f,j,v,y,b;let{guardrailId:N,onClose:w,accessToken:k,isAdmin:C}=e,[A,L]=(0,o.useState)(null),[z,T]=(0,o.useState)(null),[E,B]=(0,o.useState)(!0),[M,K]=(0,o.useState)(!1),[F]=p.Z.useForm(),[G,D]=(0,o.useState)([]),[R,V]=(0,o.useState)({}),[U,W]=(0,o.useState)(null),[q,H]=(0,o.useState)({}),[X,ee]=(0,o.useState)(!1),el={rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""},[ea,et]=(0,o.useState)(el),[ei,er]=(0,o.useState)(!1),es=o.useRef({patterns:[],blockedWords:[]}),en=(0,o.useCallback)((e,l)=>{es.current={patterns:e,blockedWords:l}},[]),eo=async()=>{try{var e;if(B(!0),!k)return;let l=await (0,c.getGuardrailInfo)(k,N);if(L(l),null===(e=l.litellm_params)||void 0===e?void 0:e.pii_entities_config){let e=l.litellm_params.pii_entities_config;if(D([]),V({}),Object.keys(e).length>0){let l=[],a={};Object.entries(e).forEach(e=>{let[t,i]=e;l.push(t),a[t]="string"==typeof i?i:"MASK"}),D(l),V(a)}}else D([]),V({})}catch(e){Q.Z.fromBackend("Failed to load guardrail information"),console.error("Error fetching guardrail info:",e)}finally{B(!1)}},ed=async()=>{try{if(!k)return;let e=await (0,c.getGuardrailProviderSpecificParams)(k);T(e)}catch(e){console.error("Error fetching guardrail provider specific params:",e)}},ec=async()=>{try{if(!k)return;let e=await (0,c.getGuardrailUISettings)(k);W(e)}catch(e){console.error("Error fetching guardrail UI settings:",e)}};(0,o.useEffect)(()=>{ed()},[k]),(0,o.useEffect)(()=>{eo(),ec()},[N,k]),(0,o.useEffect)(()=>{if(A&&F){var e;F.setFieldsValue({guardrail_name:A.guardrail_name,...A.litellm_params,guardrail_info:A.guardrail_info?JSON.stringify(A.guardrail_info,null,2):"",...(null===(e=A.litellm_params)||void 0===e?void 0:e.optional_params)&&{optional_params:A.litellm_params.optional_params}})}},[A,z,F]);let eu=(0,o.useCallback)(()=>{var e,l,a,t,i;(null==A?void 0:null===(e=A.litellm_params)||void 0===e?void 0:e.guardrail)==="tool_permission"?et({rules:(null===(l=A.litellm_params)||void 0===l?void 0:l.rules)||[],default_action:((null===(a=A.litellm_params)||void 0===a?void 0:a.default_action)||"deny").toLowerCase(),on_disallowed_action:((null===(t=A.litellm_params)||void 0===t?void 0:t.on_disallowed_action)||"block").toLowerCase(),violation_message_template:(null===(i=A.litellm_params)||void 0===i?void 0:i.violation_message_template)||""}):et(el),er(!1)},[A]);(0,o.useEffect)(()=>{eu()},[eu]);let em=async e=>{try{var l,a,t,i,r,s,n,o,d,u,m,x;if(!k)return;let p={litellm_params:{}};e.guardrail_name!==A.guardrail_name&&(p.guardrail_name=e.guardrail_name),e.default_on!==(null===(l=A.litellm_params)||void 0===l?void 0:l.default_on)&&(p.litellm_params.default_on=e.default_on);let h=A.guardrail_info,g=e.guardrail_info?JSON.parse(e.guardrail_info):void 0;JSON.stringify(h)!==JSON.stringify(g)&&(p.guardrail_info=g);let f=(null===(a=A.litellm_params)||void 0===a?void 0:a.pii_entities_config)||{},j={};if(G.forEach(e=>{j[e]=R[e]||"MASK"}),JSON.stringify(f)!==JSON.stringify(j)&&(p.litellm_params.pii_entities_config=j),(null===(t=A.litellm_params)||void 0===t?void 0:t.guardrail)==="litellm_content_filter"&&X){null===(s=A.litellm_params)||void 0===s||s.patterns,null===(n=A.litellm_params)||void 0===n||n.blocked_words;let e=lm(es.current.patterns||[],es.current.blockedWords||[]);p.litellm_params.patterns=e.patterns,p.litellm_params.blocked_words=e.blocked_words}if((null===(i=A.litellm_params)||void 0===i?void 0:i.guardrail)==="tool_permission"){let e=(null===(o=A.litellm_params)||void 0===o?void 0:o.rules)||[],l=ea.rules||[],a=JSON.stringify(e)!==JSON.stringify(l),t=((null===(d=A.litellm_params)||void 0===d?void 0:d.default_action)||"deny").toLowerCase(),i=(ea.default_action||"deny").toLowerCase(),r=t!==i,s=((null===(u=A.litellm_params)||void 0===u?void 0:u.on_disallowed_action)||"block").toLowerCase(),n=(ea.on_disallowed_action||"block").toLowerCase(),c=s!==n,x=(null===(m=A.litellm_params)||void 0===m?void 0:m.violation_message_template)||"",h=ea.violation_message_template||"",g=x!==h;(ei||a||r||c||g)&&(p.litellm_params.rules=l,p.litellm_params.default_action=i,p.litellm_params.on_disallowed_action=n,p.litellm_params.violation_message_template=h||null)}let v=Object.keys(_).find(e=>{var l;return _[e]===(null===(l=A.litellm_params)||void 0===l?void 0:l.guardrail)});console.log("values: ",JSON.stringify(e)),console.log("currentProvider: ",v);let y=(null===(r=A.litellm_params)||void 0===r?void 0:r.guardrail)==="tool_permission";if(z&&v&&!y){let l=z[null===(x=_[v])||void 0===x?void 0:x.toLowerCase()]||{},a=new Set;console.log("providerSpecificParams: ",JSON.stringify(l)),Object.keys(l).forEach(e=>{"optional_params"!==e&&a.add(e)}),l.optional_params&&l.optional_params.fields&&Object.keys(l.optional_params.fields).forEach(e=>{a.add(e)}),console.log("allowedParams: ",a),a.forEach(l=>{var a,t;if("patterns"===l||"blocked_words"===l)return;let i=e[l];(null==i||""===i)&&(i=null===(t=e.optional_params)||void 0===t?void 0:t[l]);let r=null===(a=A.litellm_params)||void 0===a?void 0:a[l];JSON.stringify(i)!==JSON.stringify(r)&&(null!=i&&""!==i?p.litellm_params[l]=i:null!=r&&""!==r&&(p.litellm_params[l]=null))})}if(0===Object.keys(p.litellm_params).length&&delete p.litellm_params,0===Object.keys(p).length){Q.Z.info("No changes detected"),K(!1);return}await (0,c.updateGuardrailCall)(k,N,p),Q.Z.success("Guardrail updated successfully"),ee(!1),eo(),K(!1)}catch(e){console.error("Error updating guardrail:",e),Q.Z.fromBackend("Failed to update guardrail")}};if(E)return(0,n.jsx)("div",{className:"p-4",children:"Loading..."});if(!A)return(0,n.jsx)("div",{className:"p-4",children:"Guardrail not found"});let ex=e=>e?new Date(e).toLocaleString():"-",{logo:ep,displayName:eh}=S((null===(l=A.litellm_params)||void 0===l?void 0:l.guardrail)||""),eg=async(e,l)=>{await (0,lp.vQ)(e)&&(H(e=>({...e,[l]:!0})),setTimeout(()=>{H(e=>({...e,[l]:!1}))},2e3))},ef="config"===A.guardrail_definition_location;return(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(ls.zx,{icon:lx.Z,variant:"light",onClick:w,className:"mb-4",children:"Back to Guardrails"}),(0,n.jsx)(ls.Dx,{children:A.guardrail_name||"Unnamed Guardrail"}),(0,n.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,n.jsx)(ls.xv,{className:"text-gray-500 font-mono",children:A.guardrail_id}),(0,n.jsx)(P.ZP,{type:"text",size:"small",icon:q["guardrail-id"]?(0,n.jsx)(lh.Z,{size:12}):(0,n.jsx)(lg.Z,{size:12}),onClick:()=>eg(A.guardrail_id,"guardrail-id"),className:"left-2 z-10 transition-all duration-200 ".concat(q["guardrail-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100")})]})]}),(0,n.jsxs)(ls.v0,{children:[(0,n.jsxs)(ls.td,{className:"mb-4",children:[(0,n.jsx)(ls.OK,{children:"Overview"},"overview"),C?(0,n.jsx)(ls.OK,{children:"Settings"},"settings"):(0,n.jsx)(n.Fragment,{})]}),(0,n.jsxs)(ls.nP,{children:[(0,n.jsxs)(ls.x4,{children:[(0,n.jsxs)(ls.rj,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,n.jsxs)(ls.Zb,{children:[(0,n.jsx)(ls.xv,{children:"Provider"}),(0,n.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[ep&&(0,n.jsx)("img",{src:ep,alt:"".concat(eh," logo"),className:"w-6 h-6",onError:e=>{e.target.style.display="none"}}),(0,n.jsx)(ls.Dx,{children:eh})]})]}),(0,n.jsxs)(ls.Zb,{children:[(0,n.jsx)(ls.xv,{children:"Mode"}),(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)(ls.Dx,{children:(null===(a=A.litellm_params)||void 0===a?void 0:a.mode)||"-"}),(0,n.jsx)(ls.Ct,{color:(null===(t=A.litellm_params)||void 0===t?void 0:t.default_on)?"green":"gray",children:(null===(i=A.litellm_params)||void 0===i?void 0:i.default_on)?"Default On":"Default Off"})]})]}),(0,n.jsxs)(ls.Zb,{children:[(0,n.jsx)(ls.xv,{children:"Created At"}),(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)(ls.Dx,{children:ex(A.created_at)}),(0,n.jsxs)(ls.xv,{children:["Last Updated: ",ex(A.updated_at)]})]})]})]}),(null===(r=A.litellm_params)||void 0===r?void 0:r.pii_entities_config)&&Object.keys(A.litellm_params.pii_entities_config).length>0&&(0,n.jsx)(ls.Zb,{className:"mt-6",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)(ls.xv,{className:"font-medium",children:"PII Protection"}),(0,n.jsxs)(ls.Ct,{color:"blue",children:[Object.keys(A.litellm_params.pii_entities_config).length," PII entities configured"]})]})}),(null===(s=A.litellm_params)||void 0===s?void 0:s.pii_entities_config)&&Object.keys(A.litellm_params.pii_entities_config).length>0&&(0,n.jsxs)(ls.Zb,{className:"mt-6",children:[(0,n.jsx)(ls.xv,{className:"mb-4 text-lg font-semibold",children:"PII Entity Configuration"}),(0,n.jsxs)("div",{className:"border rounded-lg overflow-hidden shadow-sm",children:[(0,n.jsxs)("div",{className:"bg-gray-50 px-5 py-3 border-b flex",children:[(0,n.jsx)(ls.xv,{className:"flex-1 font-semibold text-gray-700",children:"Entity Type"}),(0,n.jsx)(ls.xv,{className:"flex-1 font-semibold text-gray-700",children:"Configuration"})]}),(0,n.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:Object.entries(null===(d=A.litellm_params)||void 0===d?void 0:d.pii_entities_config).map(e=>{let[l,a]=e;return(0,n.jsxs)("div",{className:"px-5 py-3 flex border-b hover:bg-gray-50 transition-colors",children:[(0,n.jsx)(ls.xv,{className:"flex-1 font-medium text-gray-900",children:l}),(0,n.jsx)(ls.xv,{className:"flex-1",children:(0,n.jsxs)("span",{className:"inline-flex items-center gap-1.5 ".concat("MASK"===a?"text-blue-600":"text-red-600"),children:["MASK"===a?(0,n.jsx)(O.Z,{}):(0,n.jsx)(I.Z,{}),String(a)]})})]},l)})})]})]}),(null===(u=A.litellm_params)||void 0===u?void 0:u.guardrail)==="tool_permission"&&(0,n.jsx)(ls.Zb,{className:"mt-6",children:(0,n.jsx)(eF,{value:ea,disabled:!0})}),(0,n.jsx)(lu,{guardrailData:A,guardrailSettings:U,isEditing:!1,accessToken:k})]}),C&&(0,n.jsx)(ls.x4,{children:(0,n.jsxs)(ls.Zb,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(ls.Dx,{children:"Guardrail Settings"}),ef&&(0,n.jsx)(Z.Z,{title:"Guardrail is defined in the config file and cannot be edited.",children:(0,n.jsx)(eB.Z,{})}),!M&&!ef&&(0,n.jsx)(ls.zx,{onClick:()=>K(!0),children:"Edit Settings"})]}),M?(0,n.jsxs)(p.Z,{form:F,onFinish:em,initialValues:{guardrail_name:A.guardrail_name,...A.litellm_params,guardrail_info:A.guardrail_info?JSON.stringify(A.guardrail_info,null,2):"",...(null===(x=A.litellm_params)||void 0===x?void 0:x.optional_params)&&{optional_params:A.litellm_params.optional_params}},layout:"vertical",children:[(0,n.jsx)(p.Z.Item,{label:"Guardrail Name",name:"guardrail_name",rules:[{required:!0,message:"Please input a guardrail name"}],children:(0,n.jsx)(ls.oi,{})}),(0,n.jsx)(p.Z.Item,{label:"Default On",name:"default_on",children:(0,n.jsxs)(m.default,{children:[(0,n.jsx)(m.default.Option,{value:!0,children:"Yes"}),(0,n.jsx)(m.default.Option,{value:!1,children:"No"})]})}),(null===(h=A.litellm_params)||void 0===h?void 0:h.guardrail)==="presidio"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eT.Z,{orientation:"left",children:"PII Protection"}),(0,n.jsx)("div",{className:"mb-6",children:U&&(0,n.jsx)(J,{entities:U.supported_entities,actions:U.supported_actions,selectedEntities:G,selectedActions:R,onEntitySelect:e=>{D(l=>l.includes(e)?l.filter(l=>l!==e):[...l,e])},onActionSelect:(e,l)=>{V(a=>({...a,[e]:l}))},entityCategories:U.pii_entity_categories})})]}),(0,n.jsx)(lu,{guardrailData:A,guardrailSettings:U,isEditing:!0,accessToken:k,onDataChange:en,onUnsavedChanges:ee}),(0,n.jsx)(eT.Z,{orientation:"left",children:"Provider Settings"}),(null===(g=A.litellm_params)||void 0===g?void 0:g.guardrail)==="tool_permission"?(0,n.jsx)(eF,{value:ea,onChange:et}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Y,{selectedProvider:Object.keys(_).find(e=>{var l;return _[e]===(null===(l=A.litellm_params)||void 0===l?void 0:l.guardrail)})||null,accessToken:k,providerParams:z,value:A.litellm_params}),z&&(()=>{var e;let l=Object.keys(_).find(e=>{var l;return _[e]===(null===(l=A.litellm_params)||void 0===l?void 0:l.guardrail)});if(!l)return null;let a=z[null===(e=_[l])||void 0===e?void 0:e.toLowerCase()];return a&&a.optional_params?(0,n.jsx)($,{optionalParams:a.optional_params,parentFieldKey:"optional_params",values:A.litellm_params}):null})()]}),(0,n.jsx)(eT.Z,{orientation:"left",children:"Advanced Settings"}),(0,n.jsx)(p.Z.Item,{label:"Guardrail Information",name:"guardrail_info",children:(0,n.jsx)(ez.default.TextArea,{rows:5})}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,n.jsx)(P.ZP,{onClick:()=>{K(!1),ee(!1),eu()},children:"Cancel"}),(0,n.jsx)(ls.zx,{children:"Save Changes"})]})]}):(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(ls.xv,{className:"font-medium",children:"Guardrail ID"}),(0,n.jsx)("div",{className:"font-mono",children:A.guardrail_id})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ls.xv,{className:"font-medium",children:"Guardrail Name"}),(0,n.jsx)("div",{children:A.guardrail_name||"Unnamed Guardrail"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ls.xv,{className:"font-medium",children:"Provider"}),(0,n.jsx)("div",{children:eh})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ls.xv,{className:"font-medium",children:"Mode"}),(0,n.jsx)("div",{children:(null===(f=A.litellm_params)||void 0===f?void 0:f.mode)||"-"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ls.xv,{className:"font-medium",children:"Default On"}),(0,n.jsx)(ls.Ct,{color:(null===(j=A.litellm_params)||void 0===j?void 0:j.default_on)?"green":"gray",children:(null===(v=A.litellm_params)||void 0===v?void 0:v.default_on)?"Yes":"No"})]}),(null===(y=A.litellm_params)||void 0===y?void 0:y.pii_entities_config)&&Object.keys(A.litellm_params.pii_entities_config).length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)(ls.xv,{className:"font-medium",children:"PII Protection"}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsxs)(ls.Ct,{color:"blue",children:[Object.keys(A.litellm_params.pii_entities_config).length," PII entities configured"]})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ls.xv,{className:"font-medium",children:"Created At"}),(0,n.jsx)("div",{children:ex(A.created_at)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(ls.xv,{className:"font-medium",children:"Last Updated"}),(0,n.jsx)("div",{children:ex(A.updated_at)})]}),(null===(b=A.litellm_params)||void 0===b?void 0:b.guardrail)==="tool_permission"&&(0,n.jsx)(eF,{value:ea,disabled:!0})]})]})})]})]})]})},lj=a(49566),lv=a(96761),ly=a(35631),l_=a(29436),lb=a(41169),lN=a(23639),lw=a(77565),lk=a(70464),lC=a(83669),lS=a(5540);let{Text:lZ}=u.default;var lP=function(e){let{results:l,errors:a}=e,[t,i]=(0,o.useState)(new Set),r=e=>{let l=new Set(t);l.has(e)?l.delete(e):l.add(e),i(l)},s=async e=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{let l=document.createElement("textarea");l.value=e,l.style.position="fixed",l.style.opacity="0",document.body.appendChild(l),l.focus(),l.select();let a=document.execCommand("copy");if(document.body.removeChild(l),!a)throw Error("execCommand failed");return!0}}catch(e){return console.error("Copy failed:",e),!1}};return l||a?(0,n.jsxs)("div",{className:"space-y-3 pt-4 border-t border-gray-200",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Results"}),l&&l.map(e=>{let l=t.has(e.guardrailName);return(0,n.jsx)(lo.Z,{className:"bg-green-50 border-green-200",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer flex-1",onClick:()=>r(e.guardrailName),children:[l?(0,n.jsx)(lw.Z,{className:"text-gray-500 text-xs"}):(0,n.jsx)(lk.Z,{className:"text-gray-500 text-xs"}),(0,n.jsx)(lC.Z,{className:"text-green-600 text-lg"}),(0,n.jsx)("span",{className:"text-sm font-medium text-green-800",children:e.guardrailName})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-600",children:[(0,n.jsx)(lS.Z,{}),(0,n.jsxs)("span",{className:"font-medium",children:[e.latency,"ms"]})]}),!l&&(0,n.jsx)(eY.Z,{size:"xs",variant:"secondary",icon:lN.Z,onClick:async()=>{await s(e.response_text)?Q.Z.success("Result copied to clipboard"):Q.Z.fromBackend("Failed to copy result")},children:"Copy"})]})]}),!l&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"bg-white border border-green-200 rounded p-3",children:[(0,n.jsx)("label",{className:"text-xs font-medium text-gray-600 mb-2 block",children:"Output Text"}),(0,n.jsx)("div",{className:"font-mono text-sm text-gray-900 whitespace-pre-wrap break-words",children:e.response_text})]}),(0,n.jsxs)("div",{className:"text-xs text-gray-600",children:[(0,n.jsx)("span",{className:"font-medium",children:"Characters:"})," ",e.response_text.length]})]})]})},e.guardrailName)}),a&&a.map(e=>{let l=t.has(e.guardrailName);return(0,n.jsx)(lo.Z,{className:"bg-red-50 border-red-200",children:(0,n.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,n.jsx)("div",{className:"cursor-pointer mt-0.5",onClick:()=>r(e.guardrailName),children:l?(0,n.jsx)(lw.Z,{className:"text-gray-500 text-xs"}):(0,n.jsx)(lk.Z,{className:"text-gray-500 text-xs"})}),(0,n.jsx)("div",{className:"text-red-600 mt-0.5",children:(0,n.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,n.jsxs)("p",{className:"text-sm font-medium text-red-800 cursor-pointer",onClick:()=>r(e.guardrailName),children:[e.guardrailName," - Error"]}),(0,n.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-600",children:[(0,n.jsx)(lS.Z,{}),(0,n.jsxs)("span",{className:"font-medium",children:[e.latency,"ms"]})]})]}),!l&&(0,n.jsx)("p",{className:"text-sm text-red-700 mt-1",children:e.error.message})]})]})},e.guardrailName)})]}):null};let{TextArea:lA}=ez.default,{Text:lO}=u.default;var lI=function(e){let{guardrailNames:l,onSubmit:a,isLoading:t,results:i,errors:r,onClose:s}=e,[d,c]=(0,o.useState)(""),u=()=>{if(!d.trim()){Q.Z.fromBackend("Please enter text to test");return}a(d)},m=async e=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{let l=document.createElement("textarea");l.value=e,l.style.position="fixed",l.style.opacity="0",document.body.appendChild(l),l.focus(),l.select();let a=document.execCommand("copy");if(document.body.removeChild(l),!a)throw Error("execCommand failed");return!0}}catch(e){return console.error("Copy failed:",e),!1}},x=async()=>{await m(d)?Q.Z.success("Input copied to clipboard"):Q.Z.fromBackend("Failed to copy input")};return(0,n.jsxs)("div",{className:"space-y-4 h-full flex flex-col",children:[(0,n.jsx)("div",{className:"flex items-center justify-between pb-3 border-b border-gray-200",children:(0,n.jsx)("div",{className:"flex items-center space-x-3",children:(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Test Guardrails:"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(e=>(0,n.jsx)("div",{className:"inline-flex items-center space-x-1 bg-blue-50 px-3 py-1 rounded-md border border-blue-200",children:(0,n.jsx)("span",{className:"font-mono text-blue-700 font-medium text-sm",children:e})},e))})]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Test ",l.length>1?"guardrails":"guardrail"," and compare results"]})]})})}),(0,n.jsxs)("div",{className:"flex-1 overflow-auto space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Input Text"}),(0,n.jsx)(Z.Z,{title:"Press Enter to submit. Use Shift+Enter for new line.",children:(0,n.jsx)(eB.Z,{className:"text-gray-400 cursor-help"})})]}),d&&(0,n.jsx)(ei.z,{size:"xs",variant:"secondary",icon:lN.Z,onClick:x,children:"Copy Input"})]}),(0,n.jsx)(lA,{value:d,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||e.ctrlKey||e.metaKey||(e.preventDefault(),u())},placeholder:"Enter text to test with guardrails...",rows:8,className:"font-mono text-sm"}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,n.jsxs)(lO,{className:"text-xs text-gray-500",children:["Press ",(0,n.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs",children:"Enter"})," to submit â€¢ ",(0,n.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs",children:"Shift+Enter"})," for new line"]}),(0,n.jsxs)(lO,{className:"text-xs text-gray-500",children:["Characters: ",d.length]})]})]}),(0,n.jsx)("div",{className:"pt-2",children:(0,n.jsx)(ei.z,{onClick:u,loading:t,disabled:!d.trim(),className:"w-full",children:t?"Testing ".concat(l.length," guardrail").concat(l.length>1?"s":"","..."):"Test ".concat(l.length," guardrail").concat(l.length>1?"s":"")})})]}),(0,n.jsx)(lP,{results:i,errors:r})]})]})},lL=e=>{let{guardrailsList:l,isLoading:a,accessToken:t,onClose:i}=e,[r,s]=(0,o.useState)(new Set),[d,u]=(0,o.useState)(""),[m,x]=(0,o.useState)([]),[p,h]=(0,o.useState)([]),[g,f]=(0,o.useState)(!1),j=l.filter(e=>{var l;return null===(l=e.guardrail_name)||void 0===l?void 0:l.toLowerCase().includes(d.toLowerCase())}),v=e=>{let l=new Set(r);l.has(e)?l.delete(e):l.add(e),s(l)},y=async e=>{if(0===r.size||!t)return;f(!0),x([]),h([]);let l=[],a=[];await Promise.all(Array.from(r).map(async i=>{let r=Date.now();try{let a=await (0,c.applyGuardrail)(t,i,e,null,null),s=Date.now()-r;l.push({guardrailName:i,response_text:a.response_text,latency:s})}catch(l){let e=Date.now()-r;console.error("Error testing guardrail ".concat(i,":"),l),a.push({guardrailName:i,error:l,latency:e})}})),x(l),h(a),f(!1),l.length>0&&Q.Z.success("".concat(l.length," guardrail").concat(l.length>1?"s":""," applied successfully")),a.length>0&&Q.Z.fromBackend("".concat(a.length," guardrail").concat(a.length>1?"s":""," failed"))};return(0,n.jsx)("div",{className:"w-full h-[calc(100vh-200px)]",children:(0,n.jsx)(lo.Z,{className:"h-full",children:(0,n.jsxs)("div",{className:"flex h-full",children:[(0,n.jsxs)("div",{className:"w-1/4 border-r border-gray-200 flex flex-col overflow-hidden",children:[(0,n.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)(lv.Z,{className:"text-lg font-semibold mb-3",children:"Guardrails"}),(0,n.jsx)(lj.Z,{icon:l_.Z,placeholder:"Search guardrails...",value:d,onValueChange:u})]})}),(0,n.jsx)("div",{className:"flex-1 overflow-auto",children:a?(0,n.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,n.jsx)(V.Z,{})}):0===j.length?(0,n.jsx)("div",{className:"p-4",children:(0,n.jsx)(eE.Z,{description:d?"No guardrails match your search":"No guardrails available"})}):(0,n.jsx)(ly.Z,{dataSource:j,renderItem:e=>(0,n.jsx)(ly.Z.Item,{onClick:()=>{e.guardrail_name&&v(e.guardrail_name)},className:"cursor-pointer hover:bg-gray-50 transition-colors px-4 ".concat(r.has(e.guardrail_name||"")?"bg-blue-50 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"),children:(0,n.jsx)(ly.Z.Item.Meta,{avatar:(0,n.jsx)(A.Z,{checked:r.has(e.guardrail_name||""),onClick:l=>{l.stopPropagation(),e.guardrail_name&&v(e.guardrail_name)}}),title:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(lb.Z,{className:"text-gray-400"}),(0,n.jsx)("span",{className:"font-medium text-gray-900",children:e.guardrail_name})]}),description:(0,n.jsxs)("div",{className:"text-xs space-y-1 mt-1",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Type: "}),(0,n.jsx)("span",{className:"text-gray-600",children:e.litellm_params.guardrail})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Mode: "}),(0,n.jsx)("span",{className:"text-gray-600",children:e.litellm_params.mode})]})]})})})})}),(0,n.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:(0,n.jsxs)(ld.Z,{className:"text-xs text-gray-600",children:[r.size," of ",j.length," selected"]})})]}),(0,n.jsxs)("div",{className:"w-3/4 flex flex-col bg-white",children:[(0,n.jsx)("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:(0,n.jsx)(lv.Z,{className:"text-xl font-semibold mb-0",children:"Guardrail Testing Playground"})}),(0,n.jsx)("div",{className:"flex-1 overflow-auto p-4",children:0===r.size?(0,n.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[(0,n.jsx)(lb.Z,{style:{fontSize:"48px",marginBottom:"16px"}}),(0,n.jsx)(ld.Z,{className:"text-lg font-medium text-gray-600 mb-2",children:"Select Guardrails to Test"}),(0,n.jsx)(ld.Z,{className:"text-center text-gray-500 max-w-md",children:"Choose one or more guardrails from the left sidebar to start testing and comparing results."})]}):(0,n.jsx)("div",{className:"h-full",children:(0,n.jsx)(lI,{guardrailNames:Array.from(r),onSubmit:y,results:m.length>0?m:null,errors:p.length>0?p:null,isLoading:g,onClose:()=>s(new Set)})})})]})]})})})},lz=a(21609),lT=e=>{let{accessToken:l,userRole:a}=e,[t,i]=(0,o.useState)([]),[r,s]=(0,o.useState)(!1),[u,m]=(0,o.useState)(!1),[x,p]=(0,o.useState)(!1),[h,g]=(0,o.useState)(null),[f,j]=(0,o.useState)(!1),[v,y]=(0,o.useState)(null),[_,b]=(0,o.useState)(0),N=!!a&&(0,lr.tY)(a),w=async()=>{if(l){m(!0);try{let e=await (0,c.getGuardrailsList)(l);console.log("guardrails: ".concat(JSON.stringify(e))),i(e.guardrails)}catch(e){console.error("Error fetching guardrails:",e)}finally{m(!1)}}};(0,o.useEffect)(()=>{w()},[l]);let k=async()=>{if(h&&l){p(!0);try{await (0,c.deleteGuardrailCall)(l,h.guardrail_id),Q.Z.success('Guardrail "'.concat(h.guardrail_name,'" deleted successfully')),await w()}catch(e){console.error("Error deleting guardrail:",e),Q.Z.fromBackend("Failed to delete guardrail")}finally{p(!1),j(!1),g(null)}}},C=h&&h.litellm_params?S(h.litellm_params.guardrail).displayName:void 0;return(0,n.jsx)("div",{className:"w-full mx-auto flex-auto overflow-y-auto m-8 p-2",children:(0,n.jsxs)(d.v0,{index:_,onIndexChange:b,children:[(0,n.jsxs)(d.td,{className:"mb-4",children:[(0,n.jsx)(d.OK,{children:"Guardrails"}),(0,n.jsx)(d.OK,{disabled:!l||0===t.length,children:"Test Playground"})]}),(0,n.jsxs)(d.nP,{children:[(0,n.jsxs)(d.x4,{children:[(0,n.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,n.jsx)(d.zx,{onClick:()=>{v&&y(null),s(!0)},disabled:!l,children:"+ Add New Guardrail"})}),v?(0,n.jsx)(lf,{guardrailId:v,onClose:()=>y(null),accessToken:l,isAdmin:N}):(0,n.jsx)(li,{guardrailsList:t,isLoading:u,onDeleteClick:(e,l)=>{g(t.find(l=>l.guardrail_id===e)||null),j(!0)},accessToken:l,onGuardrailUpdated:w,isAdmin:N,onGuardrailClick:e=>y(e)}),(0,n.jsx)(eW,{visible:r,onClose:()=>{s(!1)},accessToken:l,onSuccess:()=>{w()}}),(0,n.jsx)(lz.Z,{isOpen:f,title:"Delete Guardrail",message:"Are you sure you want to delete guardrail: ".concat(null==h?void 0:h.guardrail_name,"? This action cannot be undone."),resourceInformationTitle:"Guardrail Information",resourceInformation:[{label:"Name",value:null==h?void 0:h.guardrail_name},{label:"ID",value:null==h?void 0:h.guardrail_id,code:!0},{label:"Provider",value:C},{label:"Mode",value:null==h?void 0:h.litellm_params.mode},{label:"Default On",value:(null==h?void 0:h.litellm_params.default_on)?"Yes":"No"}],onCancel:()=>{j(!1),g(null)},onOk:k,confirmLoading:x})]}),(0,n.jsx)(d.x4,{children:(0,n.jsx)(lL,{guardrailsList:t,isLoading:u,accessToken:l,onClose:()=>b(0)})})]})]})})}}}]);