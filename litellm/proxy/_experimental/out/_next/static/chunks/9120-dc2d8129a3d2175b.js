"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9120],{29120:function(e,l,a){a.d(l,{Z:function(){return el}});var t=a(57437),s=a(2265),i=a(71618),r=a(42264),o=a(22116),n=a(51653),c=a(29271),d=a(15424),h=a(20347),m=a(41649),x=a(78489),u=a(47323),p=a(21626),g=a(97214),y=a(28241),j=a(58834),f=a(69552),v=a(71876),b=a(93416),Z=a(74998),w=a(44633),_=a(86462),N=a(49084),S=a(99981),C=a(3810),k=a(71594),P=a(24525),I=e=>{let{policies:l,isLoading:a,onDeleteClick:i,onEditClick:r,onViewClick:o,isAdmin:n=!1}=e,[c,d]=(0,s.useState)([{id:"created_at",desc:!0}]),h=e=>e?new Date(e).toLocaleString():"-",I=[{header:"Policy ID",accessorKey:"policy_id",cell:e=>(0,t.jsx)(S.Z,{title:String(e.getValue()||""),children:(0,t.jsx)(x.Z,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>e.getValue()&&o(e.getValue()),children:e.getValue()?"".concat(String(e.getValue()).slice(0,7),"..."):""})})},{header:"Name",accessorKey:"policy_name",cell:e=>{let{row:l}=e,a=l.original;return(0,t.jsx)(S.Z,{title:a.policy_name,children:(0,t.jsx)("span",{className:"text-xs font-medium",children:a.policy_name||"-"})})}},{header:"Description",accessorKey:"description",cell:e=>{let{row:l}=e,a=l.original;return(0,t.jsx)(S.Z,{title:a.description,children:(0,t.jsx)("span",{className:"text-xs truncate max-w-[200px] block",children:a.description||"-"})})}},{header:"Inherits From",accessorKey:"inherit",cell:e=>{let{row:l}=e,a=l.original;return a.inherit?(0,t.jsx)(m.Z,{color:"blue",size:"xs",children:a.inherit}):(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Guardrails (Add)",accessorKey:"guardrails_add",cell:e=>{let{row:l}=e,a=l.original.guardrails_add||[];return 0===a.length?(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,t.jsx)(C.Z,{color:"green",className:"text-xs",children:e},l)),a.length>2&&(0,t.jsx)(S.Z,{title:a.slice(2).join(", "),children:(0,t.jsxs)(C.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Guardrails (Remove)",accessorKey:"guardrails_remove",cell:e=>{let{row:l}=e,a=l.original.guardrails_remove||[];return 0===a.length?(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,t.jsx)(C.Z,{color:"red",className:"text-xs",children:e},l)),a.length>2&&(0,t.jsx)(S.Z,{title:a.slice(2).join(", "),children:(0,t.jsxs)(C.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Model Condition",accessorKey:"condition",cell:e=>{var l;let{row:a}=e,s=null===(l=a.original.condition)||void 0===l?void 0:l.model;return s?(0,t.jsx)(S.Z,{title:"string"==typeof s?s:JSON.stringify(s),children:(0,t.jsx)("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"string"==typeof s?s.length>20?s.slice(0,20)+"...":s:"Multiple"})}):(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Created At",accessorKey:"created_at",cell:e=>{let{row:l}=e,a=l.original;return(0,t.jsx)(S.Z,{title:a.created_at,children:(0,t.jsx)("span",{className:"text-xs",children:h(a.created_at)})})}},{id:"actions",header:"Actions",cell:e=>{let{row:l}=e,a=l.original;return(0,t.jsx)("div",{className:"flex space-x-2",children:n&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.Z,{title:"Edit policy",children:(0,t.jsx)(u.Z,{icon:b.Z,size:"sm",onClick:()=>r(a),className:"cursor-pointer hover:text-blue-500"})}),(0,t.jsx)(S.Z,{title:"Delete policy",children:(0,t.jsx)(u.Z,{icon:Z.Z,size:"sm",onClick:()=>a.policy_id&&i(a.policy_id,a.policy_name||"Unnamed Policy"),className:"cursor-pointer hover:text-red-500"})})]})})}}],A=(0,k.b7)({data:l,columns:I,state:{sorting:c},onSortingChange:d,getCoreRowModel:(0,P.sC)(),getSortedRowModel:(0,P.tj)(),enableSorting:!0});return(0,t.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(p.Z,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,t.jsx)(j.Z,{children:A.getHeaderGroups().map(e=>(0,t.jsx)(v.Z,{children:e.headers.map(e=>(0,t.jsx)(f.Z,{className:"py-1 h-8 ".concat("actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),onClick:e.column.getToggleSortingHandler(),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,k.ie)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,t.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,t.jsx)(w.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,t.jsx)(_.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,t.jsx)(N.Z,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,t.jsx)(g.Z,{children:a?(0,t.jsx)(v.Z,{children:(0,t.jsx)(y.Z,{colSpan:I.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"Loading..."})})})}):l.length>0?A.getRowModel().rows.map(e=>(0,t.jsx)(v.Z,{className:"h-8",children:e.getVisibleCells().map(e=>(0,t.jsx)(y.Z,{className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ".concat("actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),children:(0,k.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,t.jsx)(v.Z,{children:(0,t.jsx)(y.Z,{colSpan:I.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"No policies found"})})})})})]})})})},A=a(12514),L=a(10900),F=a(57840),E=a(10353),D=a(76188),G=a(23496),T=a(19250);let{Title:K,Text:V}=F.default;var M=e=>{var l;let{policyId:a,onClose:i,onEdit:r,accessToken:o,isAdmin:c,getPolicy:d}=e,[h,u]=(0,s.useState)(null),[p,g]=(0,s.useState)(!0),[y,j]=(0,s.useState)([]),[f,v]=(0,s.useState)(!1),Z=(0,s.useCallback)(async()=>{if(o&&a){g(!0);try{let e=await d(o,a);u(e),v(!0);try{let e=await (0,T.getResolvedGuardrails)(o,a);j(e.resolved_guardrails||[])}catch(e){console.error("Error fetching resolved guardrails:",e)}finally{v(!1)}}catch(e){console.error("Error fetching policy:",e)}finally{g(!1)}}},[a,o,d]);return((0,s.useEffect)(()=>{Z()},[Z]),p)?(0,t.jsx)("div",{className:"flex justify-center items-center p-12",children:(0,t.jsx)(E.Z,{size:"large"})}):h?(0,t.jsx)(A.Z,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(x.Z,{variant:"secondary",icon:L.Z,onClick:i,children:"Back to Policies"}),c&&(0,t.jsx)(x.Z,{icon:b.Z,onClick:()=>r(h),children:"Edit Policy"})]}),(0,t.jsx)(K,{level:4,children:h.policy_name}),(0,t.jsxs)(D.Z,{bordered:!0,column:1,children:[(0,t.jsx)(D.Z.Item,{label:"Policy ID",children:(0,t.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:h.policy_id})}),(0,t.jsx)(D.Z.Item,{label:"Description",children:h.description||(0,t.jsx)(V,{type:"secondary",children:"No description"})}),(0,t.jsx)(D.Z.Item,{label:"Inherits From",children:h.inherit?(0,t.jsx)(m.Z,{color:"blue",size:"sm",children:h.inherit}):(0,t.jsx)(V,{type:"secondary",children:"None"})}),(0,t.jsx)(D.Z.Item,{label:"Created At",children:h.created_at?new Date(h.created_at).toLocaleString():"-"}),(0,t.jsx)(D.Z.Item,{label:"Updated At",children:h.updated_at?new Date(h.updated_at).toLocaleString():"-"})]}),(0,t.jsx)(G.Z,{orientation:"left",children:(0,t.jsx)(V,{strong:!0,children:"Guardrails Configuration"})}),y.length>0&&(0,t.jsx)(n.Z,{message:"Resolved Guardrails",description:(0,t.jsxs)("div",{children:[(0,t.jsx)(V,{type:"secondary",style:{display:"block",marginBottom:8},children:"Final guardrails that will be applied (including inheritance):"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:y.map(e=>(0,t.jsx)(C.Z,{color:"blue",children:e},e))})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,t.jsxs)(D.Z,{bordered:!0,column:1,children:[(0,t.jsx)(D.Z.Item,{label:"Guardrails to Add",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:h.guardrails_add&&h.guardrails_add.length>0?h.guardrails_add.map(e=>(0,t.jsx)(C.Z,{color:"green",children:e},e)):(0,t.jsx)(V,{type:"secondary",children:"None"})})}),(0,t.jsx)(D.Z.Item,{label:"Guardrails to Remove",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:h.guardrails_remove&&h.guardrails_remove.length>0?h.guardrails_remove.map(e=>(0,t.jsx)(C.Z,{color:"red",children:e},e)):(0,t.jsx)(V,{type:"secondary",children:"None"})})})]}),(0,t.jsx)(G.Z,{orientation:"left",children:(0,t.jsx)(V,{strong:!0,children:"Conditions"})}),(0,t.jsx)(D.Z,{bordered:!0,column:1,children:(0,t.jsx)(D.Z.Item,{label:"Model Condition",children:(null===(l=h.condition)||void 0===l?void 0:l.model)?(0,t.jsx)(C.Z,{color:"purple",children:"string"==typeof h.condition.model?h.condition.model:JSON.stringify(h.condition.model)}):(0,t.jsx)(V,{type:"secondary",children:"No model condition (applies to all models)"})})})]})}):(0,t.jsxs)(A.Z,{children:[(0,t.jsx)(V,{type:"danger",children:"Policy not found"}),(0,t.jsx)("br",{}),(0,t.jsx)(x.Z,{onClick:i,className:"mt-4",children:"Go Back"})]})},z=a(37592),O=a(10032),R=a(29967),B=a(51147),q=a(9114),H=a(39760);let{Text:U}=F.default,{Option:J}=z.default;var Y=e=>{let{visible:l,onClose:a,onSuccess:i,accessToken:r,editingPolicy:c,existingPolicies:d,availableGuardrails:h,createPolicy:m,updatePolicy:x}=e,[u]=O.Z.useForm(),[p,g]=(0,s.useState)(!1),[y,j]=(0,s.useState)([]),[f,v]=(0,s.useState)(!1),[b,Z]=(0,s.useState)("model"),[w,_]=(0,s.useState)([]),{userId:N,userRole:S}=(0,H.Z)(),k=!!c;(0,s.useEffect)(()=>{if(l&&c){var e;let l=null===(e=c.condition)||void 0===e?void 0:e.model;Z(l&&/[.*+?^${}()|[\]\\]/.test(l)?"regex":"model"),u.setFieldsValue({policy_name:c.policy_name,description:c.description,inherit:c.inherit,guardrails_add:c.guardrails_add||[],guardrails_remove:c.guardrails_remove||[],model_condition:l}),c.policy_id&&r&&I(c.policy_id)}else l&&(u.resetFields(),j([]),Z("model"))},[l,c,u]),(0,s.useEffect)(()=>{l&&r&&P()},[l,r]);let P=async()=>{if(r)try{let e=await (0,T.modelAvailableCall)(r,N,S);if(null==e?void 0:e.data){let l=e.data.map(e=>e.id||e.model_name).filter(Boolean);_(l)}}catch(e){console.error("Failed to load available models:",e)}},I=async e=>{if(r){v(!0);try{let l=await (0,T.getResolvedGuardrails)(r,e);j(l.resolved_guardrails||[])}catch(e){console.error("Failed to load resolved guardrails:",e)}finally{v(!1)}}},A=()=>{let e=u.getFieldsValue(!0),l=e.inherit,a=e.guardrails_add||[],t=e.guardrails_remove||[],s=new Set;if(l){let e=d.find(e=>e.policy_name===l);e&&L(e).forEach(e=>s.add(e))}return a.forEach(e=>s.add(e)),t.forEach(e=>s.delete(e)),Array.from(s).sort()},L=e=>{let l=new Set;if(e.inherit){let a=d.find(l=>l.policy_name===e.inherit);a&&L(a).forEach(e=>l.add(e))}return e.guardrails_add&&e.guardrails_add.forEach(e=>l.add(e)),e.guardrails_remove&&e.guardrails_remove.forEach(e=>l.delete(e)),Array.from(l)},F=()=>{u.resetFields()},E=()=>{F(),a()},D=async()=>{try{g(!0),await u.validateFields();let e=u.getFieldsValue(!0);if(!r)throw Error("No access token available");let l={policy_name:e.policy_name,description:e.description||void 0,inherit:e.inherit||void 0,guardrails_add:e.guardrails_add||[],guardrails_remove:e.guardrails_remove||[],condition:e.model_condition?{model:e.model_condition}:void 0};k&&c?(await x(r,c.policy_id,l),q.Z.success("Policy updated successfully")):(await m(r,l),q.Z.success("Policy created successfully")),F(),i(),a()}catch(e){console.error("Failed to save policy:",e),q.Z.fromBackend("Failed to save policy: "+(e instanceof Error?e.message:String(e)))}finally{g(!1)}},K=h.map(e=>({label:e.guardrail_name||e.guardrail_id,value:e.guardrail_name||e.guardrail_id})),V=d.filter(e=>!c||e.policy_id!==c.policy_id).map(e=>({label:e.policy_name,value:e.policy_name}));return(0,t.jsx)(o.Z,{title:k?"Edit Policy":"Create New Policy",open:l,onCancel:E,footer:null,width:700,children:(0,t.jsxs)(O.Z,{form:u,layout:"vertical",initialValues:{guardrails_add:[],guardrails_remove:[]},onValuesChange:()=>{j(A())},children:[(0,t.jsx)(O.Z.Item,{name:"policy_name",label:"Policy Name",rules:[{required:!0,message:"Please enter a policy name"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"Policy name can only contain letters, numbers, hyphens, and underscores"}],children:(0,t.jsx)(B.oi,{placeholder:"e.g., global-baseline, healthcare-compliance",disabled:k})}),(0,t.jsx)(O.Z.Item,{name:"description",label:"Description",children:(0,t.jsx)(B.gx,{rows:2,placeholder:"Describe what this policy does..."})}),(0,t.jsx)(G.Z,{orientation:"left",children:(0,t.jsx)(U,{strong:!0,children:"Inheritance"})}),(0,t.jsx)(O.Z.Item,{name:"inherit",label:"Inherit From",tooltip:"Inherit guardrails from another policy. The child policy will include all guardrails from the parent.",children:(0,t.jsx)(z.default,{allowClear:!0,placeholder:"Select a parent policy (optional)",options:V,style:{width:"100%"}})}),(0,t.jsx)(G.Z,{orientation:"left",children:(0,t.jsx)(U,{strong:!0,children:"Guardrails"})}),(0,t.jsx)(O.Z.Item,{name:"guardrails_add",label:"Guardrails to Add",tooltip:"These guardrails will be added to requests matching this policy",children:(0,t.jsx)(z.default,{mode:"multiple",allowClear:!0,placeholder:"Select guardrails to add",options:K,style:{width:"100%"}})}),(0,t.jsx)(O.Z.Item,{name:"guardrails_remove",label:"Guardrails to Remove",tooltip:"These guardrails will be removed from inherited guardrails",children:(0,t.jsx)(z.default,{mode:"multiple",allowClear:!0,placeholder:"Select guardrails to remove (from inherited)",options:K,style:{width:"100%"}})}),y.length>0&&(0,t.jsx)(n.Z,{message:"Resolved Guardrails",description:(0,t.jsxs)("div",{children:[(0,t.jsx)(U,{type:"secondary",style:{display:"block",marginBottom:8},children:"These are the final guardrails that will be applied (including inheritance):"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:y.map(e=>(0,t.jsx)(C.Z,{color:"blue",children:e},e))})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,t.jsx)(G.Z,{orientation:"left",children:(0,t.jsx)(U,{strong:!0,children:"Conditions (Optional)"})}),(0,t.jsx)(n.Z,{message:"Model Scope",description:"By default, this policy will run on all models. You can optionally restrict it to specific models below.",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,t.jsx)(O.Z.Item,{label:"Model Condition Type",children:(0,t.jsxs)(R.ZP.Group,{value:b,onChange:e=>{Z(e.target.value),u.setFieldValue("model_condition",void 0)},children:[(0,t.jsx)(R.ZP,{value:"model",children:"Select Model"}),(0,t.jsx)(R.ZP,{value:"regex",children:"Custom Regex Pattern"})]})}),(0,t.jsx)(O.Z.Item,{name:"model_condition",label:"model"===b?"Model (Optional)":"Regex Pattern (Optional)",tooltip:"model"===b?"Select a specific model to apply this policy to. Leave empty to apply to all models.":"Enter a regex pattern to match models (e.g., gpt-4.* or bedrock/.*). Leave empty to apply to all models.",children:"model"===b?(0,t.jsx)(z.default,{showSearch:!0,allowClear:!0,placeholder:"Leave empty to apply to all models",options:w.map(e=>({label:e,value:e})),filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}}):(0,t.jsx)(B.oi,{placeholder:"Leave empty to apply to all models (e.g., gpt-4.* or bedrock/claude-.*)"})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,t.jsx)(B.zx,{variant:"secondary",onClick:E,children:"Cancel"}),(0,t.jsx)(B.zx,{onClick:D,loading:p,children:k?"Update Policy":"Create Policy"})]})]})})},$=e=>{let{attachments:l,isLoading:a,onDeleteClick:i,isAdmin:r}=e,[o,n]=(0,s.useState)([{id:"created_at",desc:!0}]),c=e=>e?new Date(e).toLocaleString():"-",d=[{header:"Attachment ID",accessorKey:"attachment_id",cell:e=>(0,t.jsx)(S.Z,{title:String(e.getValue()||""),children:(0,t.jsx)("span",{className:"font-mono text-xs text-gray-600",children:e.getValue()?"".concat(String(e.getValue()).slice(0,7),"..."):""})})},{header:"Policy",accessorKey:"policy_name",cell:e=>{let{row:l}=e,a=l.original;return(0,t.jsx)(m.Z,{color:"blue",size:"xs",children:a.policy_name})}},{header:"Scope",accessorKey:"scope",cell:e=>{let{row:l}=e,a=l.original;return"*"===a.scope?(0,t.jsx)(m.Z,{color:"amber",size:"xs",children:"Global (*)"}):a.scope?(0,t.jsx)("span",{className:"text-xs",children:a.scope}):(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Teams",accessorKey:"teams",cell:e=>{let{row:l}=e,a=l.original.teams||[];return 0===a.length?(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,t.jsx)(C.Z,{color:"cyan",className:"text-xs",children:e},l)),a.length>2&&(0,t.jsx)(S.Z,{title:a.slice(2).join(", "),children:(0,t.jsxs)(C.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Keys",accessorKey:"keys",cell:e=>{let{row:l}=e,a=l.original.keys||[];return 0===a.length?(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,t.jsx)(C.Z,{color:"purple",className:"text-xs",children:e},l)),a.length>2&&(0,t.jsx)(S.Z,{title:a.slice(2).join(", "),children:(0,t.jsxs)(C.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Models",accessorKey:"models",cell:e=>{let{row:l}=e,a=l.original.models||[];return 0===a.length?(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,t.jsx)(C.Z,{color:"green",className:"text-xs",children:e},l)),a.length>2&&(0,t.jsx)(S.Z,{title:a.slice(2).join(", "),children:(0,t.jsxs)(C.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Created At",accessorKey:"created_at",cell:e=>{let{row:l}=e,a=l.original;return(0,t.jsx)(S.Z,{title:a.created_at,children:(0,t.jsx)("span",{className:"text-xs",children:c(a.created_at)})})}},{id:"actions",header:"Actions",cell:e=>{let{row:l}=e,a=l.original;return(0,t.jsx)("div",{className:"flex space-x-2",children:r&&(0,t.jsx)(S.Z,{title:"Delete attachment",children:(0,t.jsx)(u.Z,{icon:Z.Z,size:"sm",onClick:()=>i(a.attachment_id),className:"cursor-pointer hover:text-red-500"})})})}}],h=(0,k.b7)({data:l,columns:d,state:{sorting:o},onSortingChange:n,getCoreRowModel:(0,P.sC)(),getSortedRowModel:(0,P.tj)(),enableSorting:!0});return(0,t.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(p.Z,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,t.jsx)(j.Z,{children:h.getHeaderGroups().map(e=>(0,t.jsx)(v.Z,{children:e.headers.map(e=>(0,t.jsx)(f.Z,{className:"py-1 h-8 ".concat("actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),onClick:e.column.getToggleSortingHandler(),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,k.ie)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,t.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,t.jsx)(w.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,t.jsx)(_.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,t.jsx)(N.Z,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,t.jsx)(g.Z,{children:a?(0,t.jsx)(v.Z,{children:(0,t.jsx)(y.Z,{colSpan:d.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"Loading..."})})})}):l.length>0?h.getRowModel().rows.map(e=>(0,t.jsx)(v.Z,{className:"h-8",children:e.getVisibleCells().map(e=>(0,t.jsx)(y.Z,{className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ".concat("actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),children:(0,k.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,t.jsx)(v.Z,{children:(0,t.jsx)(y.Z,{colSpan:d.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"No attachments found"})})})})})]})})})},W=a(16312);let{Text:Q}=F.default;var X=e=>{let{visible:l,onClose:a,onSuccess:i,accessToken:r,policies:n,createAttachment:c}=e,[d]=O.Z.useForm(),[h,m]=(0,s.useState)(!1),[x,u]=(0,s.useState)("global"),[p,g]=(0,s.useState)([]),[y,j]=(0,s.useState)([]),[f,v]=(0,s.useState)([]),[b,Z]=(0,s.useState)(!1),[w,_]=(0,s.useState)(!1),[N,S]=(0,s.useState)(!1),{userId:C,userRole:k}=(0,H.Z)();(0,s.useEffect)(()=>{l&&r&&P()},[l,r]);let P=async()=>{if(r){Z(!0);try{let e=await (0,T.teamListCall)(r,null,C);if(null==e?void 0:e.data){let l=e.data.map(e=>e.team_alias).filter(Boolean);g(l)}}catch(e){console.error("Failed to load teams:",e)}finally{Z(!1)}_(!0);try{let e=await (0,T.keyInfoCall)(r,[]);if(null==e?void 0:e.data){let l=e.data.map(e=>e.key_alias).filter(Boolean);j(l)}}catch(e){console.error("Failed to load keys:",e)}finally{_(!1)}S(!0);try{let e=await (0,T.modelAvailableCall)(r,C||"",k||"");if(null==e?void 0:e.data){let l=e.data.map(e=>e.id||e.model_name).filter(Boolean);v(l)}}catch(e){console.error("Failed to load models:",e)}finally{S(!1)}}},I=()=>{d.resetFields(),u("global")},A=()=>{I(),a()},L=async()=>{try{m(!0),await d.validateFields();let e=d.getFieldsValue(!0);if(!r)throw Error("No access token available");let l={policy_name:e.policy_name};"global"===x?l.scope="*":(e.teams&&e.teams.length>0&&(l.teams=e.teams),e.keys&&e.keys.length>0&&(l.keys=e.keys),e.models&&e.models.length>0&&(l.models=e.models)),await c(r,l),q.Z.success("Attachment created successfully"),I(),i(),a()}catch(e){console.error("Failed to create attachment:",e),q.Z.fromBackend("Failed to create attachment: "+(e instanceof Error?e.message:String(e)))}finally{m(!1)}},F=n.map(e=>({label:e.policy_name,value:e.policy_name}));return(0,t.jsx)(o.Z,{title:"Create Policy Attachment",open:l,onCancel:A,footer:null,width:600,children:(0,t.jsxs)(O.Z,{form:d,layout:"vertical",initialValues:{scope_type:"global"},children:[(0,t.jsx)(O.Z.Item,{name:"policy_name",label:"Policy",rules:[{required:!0,message:"Please select a policy"}],children:(0,t.jsx)(z.default,{placeholder:"Select a policy to attach",options:F,showSearch:!0,filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}})}),(0,t.jsx)(G.Z,{orientation:"left",children:(0,t.jsx)(Q,{strong:!0,children:"Scope"})}),(0,t.jsx)(O.Z.Item,{label:"Scope Type",children:(0,t.jsxs)(R.ZP.Group,{value:x,onChange:e=>u(e.target.value),children:[(0,t.jsx)(R.ZP,{value:"global",children:"Global (applies to all requests)"}),(0,t.jsx)(R.ZP,{value:"specific",children:"Specific (teams, keys, or models)"})]})}),"specific"===x&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(O.Z.Item,{name:"teams",label:"Teams",tooltip:"Select team aliases or enter custom patterns. Supports wildcards (e.g., healthcare-*)",children:(0,t.jsx)(z.default,{mode:"tags",placeholder:b?"Loading teams...":"Select or enter team aliases",loading:b,options:p.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}})}),(0,t.jsx)(O.Z.Item,{name:"keys",label:"Keys",tooltip:"Select key aliases or enter custom patterns. Supports wildcards (e.g., dev-*)",children:(0,t.jsx)(z.default,{mode:"tags",placeholder:w?"Loading keys...":"Select or enter key aliases",loading:w,options:y.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}})}),(0,t.jsx)(O.Z.Item,{name:"models",label:"Models",tooltip:"Model names this attachment applies to. Supports wildcards (e.g., gpt-4*). Leave empty to apply to all models.",children:(0,t.jsx)(z.default,{mode:"tags",placeholder:N?"Loading models...":"Select or enter model names (e.g., gpt-4, bedrock/*)",loading:N,options:f.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}})})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,t.jsx)(W.z,{variant:"secondary",onClick:A,children:"Cancel"}),(0,t.jsx)(W.z,{onClick:L,loading:h,children:"Create Attachment"})]})]})})},ee=a(21609),el=e=>{let{accessToken:l,userRole:a}=e,[m,x]=(0,s.useState)([]),[u,p]=(0,s.useState)([]),[g,y]=(0,s.useState)([]),[j,f]=(0,s.useState)(!1),[v,b]=(0,s.useState)(!1),[Z,w]=(0,s.useState)(!1),[_,N]=(0,s.useState)(!1),[S,C]=(0,s.useState)(null),[k,P]=(0,s.useState)(null),[A,L]=(0,s.useState)(0),[F,E]=(0,s.useState)(!1),[D,G]=(0,s.useState)(null),[K,V]=(0,s.useState)(!1),z=!!a&&(0,h.tY)(a),O=(0,s.useCallback)(async()=>{if(l){f(!0);try{let e=await (0,T.getPoliciesList)(l);x(e.policies||[])}catch(e){console.error("Error fetching policies:",e),r.ZP.error("Failed to fetch policies")}finally{f(!1)}}},[l]),R=(0,s.useCallback)(async()=>{if(l){b(!0);try{let e=await (0,T.getPolicyAttachmentsList)(l);p(e.attachments||[])}catch(e){console.error("Error fetching attachments:",e),r.ZP.error("Failed to fetch attachments")}finally{b(!1)}}},[l]),B=(0,s.useCallback)(async()=>{if(l)try{let e=await (0,T.getGuardrailsList)(l);y(e.guardrails||[])}catch(e){console.error("Error fetching guardrails:",e)}},[l]);(0,s.useEffect)(()=>{O(),R(),B()},[O,R,B]);let q=async()=>{if(D&&l){E(!0);try{await (0,T.deletePolicyCall)(l,D.policy_id),r.ZP.success('Policy "'.concat(D.policy_name,'" deleted successfully')),await O()}catch(e){console.error("Error deleting policy:",e),r.ZP.error("Failed to delete policy")}finally{E(!1),V(!1),G(null)}}};return(0,t.jsx)("div",{className:"w-full mx-auto flex-auto overflow-y-auto m-8 p-2",children:(0,t.jsxs)(i.v0,{index:A,onIndexChange:L,children:[(0,t.jsxs)(i.td,{className:"mb-4",children:[(0,t.jsx)(i.OK,{children:"Policies"}),(0,t.jsx)(i.OK,{children:"Attachments"})]}),(0,t.jsxs)(i.nP,{children:[(0,t.jsxs)(i.x4,{children:[(0,t.jsx)(n.Z,{message:"About Policies",description:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"mb-3",children:"Use policies to group guardrails and control which ones run for specific teams, keys, or models."}),(0,t.jsx)("p",{className:"mb-2 font-semibold",children:"Why use policies?"}),(0,t.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,t.jsx)("li",{children:"Enable/disable specific guardrails for teams, keys, or models"}),(0,t.jsx)("li",{children:"Group guardrails into a single policy"}),(0,t.jsx)("li",{children:"Inherit from existing policies and override what you need"})]}),(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more in the documentation →"})]}),type:"info",icon:(0,t.jsx)(d.Z,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,t.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,t.jsx)(i.zx,{onClick:()=>{k&&P(null),C(null),w(!0)},disabled:!l,children:"+ Add New Policy"})}),k?(0,t.jsx)(M,{policyId:k,onClose:()=>P(null),onEdit:e=>{C(e),w(!0),P(null)},accessToken:l,isAdmin:z,getPolicy:T.getPolicyInfo}):(0,t.jsx)(I,{policies:m,isLoading:j,onDeleteClick:(e,l)=>{G(m.find(l=>l.policy_id===e)||null),V(!0)},onEditClick:e=>{C(e),w(!0)},onViewClick:e=>P(e),isAdmin:z}),(0,t.jsx)(Y,{visible:Z,onClose:()=>{w(!1),C(null)},onSuccess:()=>{O(),C(null)},accessToken:l,editingPolicy:S,existingPolicies:m,availableGuardrails:g,createPolicy:T.createPolicyCall,updatePolicy:T.updatePolicyCall}),(0,t.jsx)(ee.Z,{isOpen:K,title:"Delete Policy",message:"Are you sure you want to delete policy: ".concat(null==D?void 0:D.policy_name,"? This action cannot be undone."),resourceInformationTitle:"Policy Information",resourceInformation:[{label:"Name",value:null==D?void 0:D.policy_name},{label:"ID",value:null==D?void 0:D.policy_id,code:!0},{label:"Description",value:(null==D?void 0:D.description)||"-"},{label:"Inherits From",value:(null==D?void 0:D.inherit)||"-"}],onCancel:()=>{V(!1),G(null)},onOk:q,confirmLoading:F})]}),(0,t.jsxs)(i.x4,{children:[(0,t.jsx)(n.Z,{message:"About Policy Attachments",description:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"mb-3",children:"Policy attachments control where your policies apply. Policies don't do anything until you attach them to specific teams, keys, models, or globally."}),(0,t.jsx)("p",{className:"mb-2 font-semibold",children:"Attachment Scopes:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Global (*)"})," - Applies to all requests"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Teams"})," - Applies only to specific teams"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Keys"})," - Applies only to specific API keys (supports wildcards like dev-*)"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Models"})," - Applies only when specific models are used"]})]}),(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies#attachments",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more about attachments →"})]}),type:"info",icon:(0,t.jsx)(d.Z,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,t.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,t.jsx)(i.zx,{onClick:()=>N(!0),disabled:!l||0===m.length,children:"+ Add New Attachment"})}),(0,t.jsx)($,{attachments:u,isLoading:v,onDeleteClick:e=>{o.Z.confirm({title:"Delete Attachment",icon:(0,t.jsx)(c.Z,{}),content:"Are you sure you want to delete this attachment? This action cannot be undone.",okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:async()=>{if(l)try{await (0,T.deletePolicyAttachmentCall)(l,e),r.ZP.success("Attachment deleted successfully"),R()}catch(e){console.error("Error deleting attachment:",e),r.ZP.error("Failed to delete attachment")}}})},isAdmin:z}),(0,t.jsx)(X,{visible:_,onClose:()=>N(!1),onSuccess:()=>{R()},accessToken:l,policies:m,createAttachment:T.createPolicyAttachmentCall})]})]})]})})}}}]);