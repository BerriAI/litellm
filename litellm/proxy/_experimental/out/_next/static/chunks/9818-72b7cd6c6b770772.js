"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9818],{25512:function(e,l,s){s.d(l,{P:function(){return i.Z},Q:function(){return n.Z}});var i=s(27281),n=s(43227)},29818:function(e,l,s){s.d(l,{Z:function(){return eW}});var i=s(57437),n=s(2265),t=s(57840),r=s(51653),a=s(99376),o=s(10032),c=s(4260),d=s(5545),u=s(22116);s(25512);var _=s(78489),m=s(94789),g=s(12514),h=s(12485),p=s(18135),x=s(35242),f=s(29706),j=s(77991),v=s(21626),S=s(97214),y=s(28241),I=s(58834),b=s(69552),Z=s(71876),w=s(37592),C=s(61994),N=s(56522),O=s(19250),E=s(9114),k=s(85968);let T={google:"https://artificialanalysis.ai/img/logos/google_small.svg",microsoft:"https://upload.wikimedia.org/wikipedia/commons/a/a8/Microsoft_Azure_Logo.svg",okta:"https://www.okta.com/sites/default/files/Okta_Logo_BrightBlue_Medium.png",generic:""},P={google:{envVarMap:{google_client_id:"GOOGLE_CLIENT_ID",google_client_secret:"GOOGLE_CLIENT_SECRET"},fields:[{label:"Google Client ID",name:"google_client_id"},{label:"Google Client Secret",name:"google_client_secret"}]},microsoft:{envVarMap:{microsoft_client_id:"MICROSOFT_CLIENT_ID",microsoft_client_secret:"MICROSOFT_CLIENT_SECRET",microsoft_tenant:"MICROSOFT_TENANT"},fields:[{label:"Microsoft Client ID",name:"microsoft_client_id"},{label:"Microsoft Client Secret",name:"microsoft_client_secret"},{label:"Microsoft Tenant",name:"microsoft_tenant"}]},okta:{envVarMap:{generic_client_id:"GENERIC_CLIENT_ID",generic_client_secret:"GENERIC_CLIENT_SECRET",generic_authorization_endpoint:"GENERIC_AUTHORIZATION_ENDPOINT",generic_token_endpoint:"GENERIC_TOKEN_ENDPOINT",generic_userinfo_endpoint:"GENERIC_USERINFO_ENDPOINT"},fields:[{label:"Generic Client ID",name:"generic_client_id"},{label:"Generic Client Secret",name:"generic_client_secret"},{label:"Authorization Endpoint",name:"generic_authorization_endpoint",placeholder:"https://your-domain/authorize"},{label:"Token Endpoint",name:"generic_token_endpoint",placeholder:"https://your-domain/token"},{label:"Userinfo Endpoint",name:"generic_userinfo_endpoint",placeholder:"https://your-domain/userinfo"}]},generic:{envVarMap:{generic_client_id:"GENERIC_CLIENT_ID",generic_client_secret:"GENERIC_CLIENT_SECRET",generic_authorization_endpoint:"GENERIC_AUTHORIZATION_ENDPOINT",generic_token_endpoint:"GENERIC_TOKEN_ENDPOINT",generic_userinfo_endpoint:"GENERIC_USERINFO_ENDPOINT"},fields:[{label:"Generic Client ID",name:"generic_client_id"},{label:"Generic Client Secret",name:"generic_client_secret"},{label:"Authorization Endpoint",name:"generic_authorization_endpoint"},{label:"Token Endpoint",name:"generic_token_endpoint"},{label:"Userinfo Endpoint",name:"generic_userinfo_endpoint"}]}};var A=e=>{let{isAddSSOModalVisible:l,isInstructionsModalVisible:s,handleAddSSOOk:t,handleAddSSOCancel:r,handleShowInstructions:a,handleInstructionsOk:_,handleInstructionsCancel:m,form:g,accessToken:h,ssoConfigured:p=!1}=e,[x,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{if(l&&h)try{let l=await (0,O.getSSOSettings)(h);if(console.log("Raw SSO data received:",l),l&&l.values){var e,s,i,n,t,r;console.log("SSO values:",l.values),console.log("user_email from API:",l.values.user_email);let a=null;l.values.google_client_id?a="google":l.values.microsoft_client_id?a="microsoft":l.values.generic_client_id&&(a=(null===(e=l.values.generic_authorization_endpoint)||void 0===e?void 0:e.includes("okta"))||(null===(s=l.values.generic_authorization_endpoint)||void 0===s?void 0:s.includes("auth0"))?"okta":"generic");let o={};if(l.values.role_mappings){let e=l.values.role_mappings,s=e=>e&&0!==e.length?e.join(", "):"";o={use_role_mappings:!0,group_claim:e.group_claim,default_role:e.default_role||"internal_user",proxy_admin_teams:s(null===(i=e.roles)||void 0===i?void 0:i.proxy_admin),admin_viewer_teams:s(null===(n=e.roles)||void 0===n?void 0:n.proxy_admin_viewer),internal_user_teams:s(null===(t=e.roles)||void 0===t?void 0:t.internal_user),internal_viewer_teams:s(null===(r=e.roles)||void 0===r?void 0:r.internal_user_viewer)}}let c={sso_provider:a,proxy_base_url:l.values.proxy_base_url,user_email:l.values.user_email,...l.values,...o};console.log("Setting form values:",c),g.resetFields(),setTimeout(()=>{g.setFieldsValue(c),console.log("Form values set, current form values:",g.getFieldsValue())},100)}}catch(e){console.error("Failed to load SSO settings:",e)}})()},[l,h,g]);let j=async e=>{if(!h){E.Z.fromBackend("No access token available");return}try{let{proxy_admin_teams:l,admin_viewer_teams:s,internal_user_teams:i,internal_viewer_teams:n,default_role:t,group_claim:r,use_role_mappings:o,...c}=e,d={...c};if(o){let e=e=>e&&""!==e.trim()?e.split(",").map(e=>e.trim()).filter(e=>e.length>0):[];d.role_mappings={provider:"generic",group_claim:r,default_role:({internal_user_viewer:"internal_user_viewer",internal_user:"internal_user",proxy_admin_viewer:"proxy_admin_viewer",proxy_admin:"proxy_admin"})[t]||"internal_user",roles:{proxy_admin:e(l),proxy_admin_viewer:e(s),internal_user:e(i),internal_user_viewer:e(n)}}}await (0,O.updateSSOSettings)(h,d),a(e)}catch(e){E.Z.fromBackend("Failed to save SSO settings: "+(0,k.O)(e))}},v=async()=>{if(!h){E.Z.fromBackend("No access token available");return}try{await (0,O.updateSSOSettings)(h,{google_client_id:null,google_client_secret:null,microsoft_client_id:null,microsoft_client_secret:null,microsoft_tenant:null,generic_client_id:null,generic_client_secret:null,generic_authorization_endpoint:null,generic_token_endpoint:null,generic_userinfo_endpoint:null,proxy_base_url:null,user_email:null,sso_provider:null,role_mappings:null}),g.resetFields(),f(!1),t(),E.Z.success("SSO settings cleared successfully")}catch(e){console.error("Failed to clear SSO settings:",e),E.Z.fromBackend("Failed to clear SSO settings")}},S=e=>{let l=P[e];return l?l.fields.map(e=>(0,i.jsx)(o.Z.Item,{label:e.label,name:e.name,rules:[{required:!0,message:"Please enter the ".concat(e.label.toLowerCase())}],children:e.name.includes("client")?(0,i.jsx)(c.default.Password,{}):(0,i.jsx)(N.o,{placeholder:e.placeholder})},e.name)):null};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.Z,{title:p?"Edit SSO Settings":"Add SSO",visible:l,width:800,footer:null,onOk:t,onCancel:r,children:(0,i.jsxs)(o.Z,{form:g,onFinish:j,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:[(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z.Item,{label:"SSO Provider",name:"sso_provider",rules:[{required:!0,message:"Please select an SSO provider"}],children:(0,i.jsx)(w.default,{children:Object.entries(T).map(e=>{let[l,s]=e;return(0,i.jsx)(w.default.Option,{value:l,children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 0"},children:[s&&(0,i.jsx)("img",{src:s,alt:l,style:{height:24,width:24,marginRight:12,objectFit:"contain"}}),(0,i.jsxs)("span",{children:["okta"===l.toLowerCase()?"Okta / Auth0":l.charAt(0).toUpperCase()+l.slice(1)," ","SSO"]})]})},l)})})}),(0,i.jsx)(o.Z.Item,{noStyle:!0,shouldUpdate:(e,l)=>e.sso_provider!==l.sso_provider,children:e=>{let{getFieldValue:l}=e,s=l("sso_provider");return s?S(s):null}}),(0,i.jsx)(o.Z.Item,{label:"Proxy Admin Email",name:"user_email",rules:[{required:!0,message:"Please enter the email of the proxy admin"}],children:(0,i.jsx)(N.o,{})}),(0,i.jsx)(o.Z.Item,{label:"Proxy Base URL",name:"proxy_base_url",normalize:e=>null==e?void 0:e.trim(),rules:[{required:!0,message:"Please enter the proxy base url"},{pattern:/^https?:\/\/.+/,message:"URL must start with http:// or https://"},{validator:(e,l)=>l&&/^https?:\/\/.+/.test(l)&&l.endsWith("/")?Promise.reject("URL must not end with a trailing slash"):Promise.resolve()}],children:(0,i.jsx)(N.o,{placeholder:"https://example.com"})}),(0,i.jsx)(o.Z.Item,{noStyle:!0,shouldUpdate:(e,l)=>e.sso_provider!==l.sso_provider,children:e=>{let{getFieldValue:l}=e,s=l("sso_provider");return"okta"===s||"generic"===s?(0,i.jsx)(o.Z.Item,{label:"Use Role Mappings",name:"use_role_mappings",valuePropName:"checked",children:(0,i.jsx)(C.Z,{})}):null}}),(0,i.jsx)(o.Z.Item,{noStyle:!0,shouldUpdate:(e,l)=>e.use_role_mappings!==l.use_role_mappings,children:e=>{let{getFieldValue:l}=e;return l("use_role_mappings")?(0,i.jsx)(o.Z.Item,{label:"Group Claim",name:"group_claim",rules:[{required:!0,message:"Please enter the group claim"}],children:(0,i.jsx)(N.o,{})}):null}}),(0,i.jsx)(o.Z.Item,{noStyle:!0,shouldUpdate:(e,l)=>e.use_role_mappings!==l.use_role_mappings,children:e=>{let{getFieldValue:l}=e;return l("use_role_mappings")?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z.Item,{label:"Default Role",name:"default_role",initialValue:"Internal User",children:(0,i.jsxs)(w.default,{children:[(0,i.jsx)(w.default.Option,{value:"internal_user_viewer",children:"Internal Viewer"}),(0,i.jsx)(w.default.Option,{value:"internal_user",children:"Internal User"}),(0,i.jsx)(w.default.Option,{value:"proxy_admin_viewer",children:"Admin Viewer"}),(0,i.jsx)(w.default.Option,{value:"proxy_admin",children:"Proxy Admin"})]})}),(0,i.jsx)(o.Z.Item,{label:"Proxy Admin Teams",name:"proxy_admin_teams",children:(0,i.jsx)(N.o,{})}),(0,i.jsx)(o.Z.Item,{label:"Admin Viewer Teams",name:"admin_viewer_teams",children:(0,i.jsx)(N.o,{})}),(0,i.jsx)(o.Z.Item,{label:"Internal User Teams",name:"internal_user_teams",children:(0,i.jsx)(N.o,{})}),(0,i.jsx)(o.Z.Item,{label:"Internal Viewer Teams",name:"internal_viewer_teams",children:(0,i.jsx)(N.o,{})})]}):null}})]}),(0,i.jsxs)("div",{style:{textAlign:"right",marginTop:"10px",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"8px"},children:[p&&(0,i.jsx)(d.ZP,{onClick:()=>f(!0),style:{backgroundColor:"#6366f1",borderColor:"#6366f1",color:"white"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#5558eb",e.currentTarget.style.borderColor="#5558eb"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#6366f1",e.currentTarget.style.borderColor="#6366f1"},children:"Clear"}),(0,i.jsx)(d.ZP,{htmlType:"submit",children:"Save"})]})]})}),(0,i.jsxs)(u.Z,{title:"Confirm Clear SSO Settings",visible:x,onOk:v,onCancel:()=>f(!1),okText:"Yes, Clear",cancelText:"Cancel",okButtonProps:{danger:!0,style:{backgroundColor:"#dc2626",borderColor:"#dc2626"}},children:[(0,i.jsx)("p",{children:"Are you sure you want to clear all SSO settings? This action cannot be undone."}),(0,i.jsx)("p",{children:"Users will no longer be able to login using SSO after this change."})]}),(0,i.jsxs)(u.Z,{title:"SSO Setup Instructions",visible:s,width:800,footer:null,onOk:_,onCancel:m,children:[(0,i.jsx)("p",{children:"Follow these steps to complete the SSO setup:"}),(0,i.jsx)(N.x,{className:"mt-2",children:"1. DO NOT Exit this TAB"}),(0,i.jsx)(N.x,{className:"mt-2",children:"2. Open a new tab, visit your proxy base url"}),(0,i.jsx)(N.x,{className:"mt-2",children:"3. Confirm your SSO is configured correctly and you can login on the new Tab"}),(0,i.jsx)(N.x,{className:"mt-2",children:"4. If Step 3 is successful, you can close this tab"}),(0,i.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,i.jsx)(d.ZP,{onClick:_,children:"Done"})})]})]})},U=s(67982),R=s(67101),F=s(84264),M=s(49566),G=s(96761),L=s(29233),D=s(62272),z=s(23639),B=s(92403),V=s(29271),q=s(34419),Y=e=>{let{accessToken:l,userID:s,proxySettings:t}=e,[r]=o.Z.useForm(),[a,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),[h,p]=(0,n.useState)("<your_proxy_base_url>");(0,n.useEffect)(()=>{let e="<your_proxy_base_url>";p(t&&t.PROXY_BASE_URL&&void 0!==t.PROXY_BASE_URL?t.PROXY_BASE_URL:window.location.origin)},[t]);let x="".concat(h,"/scim/v2"),f=async e=>{if(!l||!s){E.Z.fromBackend("You need to be logged in to create a SCIM token");return}try{c(!0);let i={key_alias:e.key_alias||"SCIM Access Token",team_id:null,models:[],allowed_routes:["/scim/*"]},n=await (0,O.keyCreateCall)(l,s,i);u(n),E.Z.success("SCIM token created successfully")}catch(e){console.error("Error creating SCIM token:",e),E.Z.fromBackend("Failed to create SCIM token: "+(0,k.O)(e))}finally{c(!1)}};return(0,i.jsx)(R.Z,{numItems:1,children:(0,i.jsxs)(g.Z,{children:[(0,i.jsx)("div",{className:"flex items-center mb-4",children:(0,i.jsx)(G.Z,{children:"SCIM Configuration"})}),(0,i.jsx)(F.Z,{className:"text-gray-600",children:"System for Cross-domain Identity Management (SCIM) allows you to automatically provision and manage users and groups in LiteLLM."}),(0,i.jsx)(U.Z,{}),(0,i.jsxs)("div",{className:"space-y-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center mb-2",children:[(0,i.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-700 mr-2",children:"1"}),(0,i.jsxs)(G.Z,{className:"text-lg flex items-center",children:[(0,i.jsx)(D.Z,{className:"h-5 w-5 mr-2"}),"SCIM Tenant URL"]})]}),(0,i.jsx)(F.Z,{className:"text-gray-600 mb-3",children:"Use this URL in your identity provider SCIM integration settings."}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(M.Z,{value:x,disabled:!0,className:"flex-grow"}),(0,i.jsx)(L.CopyToClipboard,{text:x,onCopy:()=>E.Z.success("URL copied to clipboard"),children:(0,i.jsxs)(_.Z,{variant:"primary",className:"ml-2 flex items-center",children:[(0,i.jsx)(z.Z,{className:"h-4 w-4 mr-1"}),"Copy"]})})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center mb-2",children:[(0,i.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-700 mr-2",children:"2"}),(0,i.jsxs)(G.Z,{className:"text-lg flex items-center",children:[(0,i.jsx)(B.Z,{className:"h-5 w-5 mr-2"}),"Authentication Token"]})]}),(0,i.jsx)(m.Z,{title:"Using SCIM",color:"blue",className:"mb-4",children:"You need a SCIM token to authenticate with the SCIM API. Create one below and use it in your SCIM provider configuration."}),d?(0,i.jsxs)(g.Z,{className:"border border-yellow-300 bg-yellow-50",children:[(0,i.jsxs)("div",{className:"flex items-center mb-2 text-yellow-800",children:[(0,i.jsx)(V.Z,{className:"h-5 w-5 mr-2"}),(0,i.jsx)(G.Z,{className:"text-lg text-yellow-800",children:"Your SCIM Token"})]}),(0,i.jsx)(F.Z,{className:"text-yellow-800 mb-4 font-medium",children:"Make sure to copy this token now. You will not be able to see it again."}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(M.Z,{value:d.key,className:"flex-grow mr-2 bg-white",type:"password",disabled:!0}),(0,i.jsx)(L.CopyToClipboard,{text:d.key,onCopy:()=>E.Z.success("Token copied to clipboard"),children:(0,i.jsxs)(_.Z,{variant:"primary",className:"flex items-center",children:[(0,i.jsx)(z.Z,{className:"h-4 w-4 mr-1"}),"Copy"]})})]}),(0,i.jsxs)(_.Z,{className:"mt-4 flex items-center",variant:"secondary",onClick:()=>u(null),children:[(0,i.jsx)(q.Z,{className:"h-4 w-4 mr-1"}),"Create Another Token"]})]}):(0,i.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,i.jsxs)(o.Z,{form:r,onFinish:f,layout:"vertical",children:[(0,i.jsx)(o.Z.Item,{name:"key_alias",label:"Token Name",rules:[{required:!0,message:"Please enter a name for your token"}],children:(0,i.jsx)(M.Z,{placeholder:"SCIM Access Token"})}),(0,i.jsx)(o.Z.Item,{children:(0,i.jsxs)(_.Z,{variant:"primary",type:"submit",loading:a,className:"flex items-center",children:[(0,i.jsx)(B.Z,{className:"h-4 w-4 mr-1"}),"Create SCIM Token"]})})]})})]})]})]})})},K=e=>{let{accessToken:l,onSuccess:s}=e,[t]=o.Z.useForm(),[r,a]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{if(l)try{let e=await (0,O.getSSOSettings)(l);if(e&&e.values){let l=e.values.ui_access_mode,s={};l&&"object"==typeof l?s={ui_access_mode_type:l.type,restricted_sso_group:l.restricted_sso_group,sso_group_jwt_field:l.sso_group_jwt_field}:"string"==typeof l&&(s={ui_access_mode_type:l,restricted_sso_group:e.values.restricted_sso_group,sso_group_jwt_field:e.values.team_ids_jwt_field||e.values.sso_group_jwt_field}),t.setFieldsValue(s)}}catch(e){console.error("Failed to load UI access settings:",e)}})()},[l,t]);let c=async e=>{if(!l){E.Z.fromBackend("No access token available");return}a(!0);try{let i;i="all_authenticated_users"===e.ui_access_mode_type?{ui_access_mode:"none"}:{ui_access_mode:{type:e.ui_access_mode_type,restricted_sso_group:e.restricted_sso_group,sso_group_jwt_field:e.sso_group_jwt_field}},await (0,O.updateSSOSettings)(l,i),s()}catch(e){console.error("Failed to save UI access settings:",e),E.Z.fromBackend("Failed to save UI access settings")}finally{a(!1)}};return(0,i.jsxs)("div",{style:{padding:"16px"},children:[(0,i.jsx)("div",{style:{marginBottom:"16px"},children:(0,i.jsx)(N.x,{style:{fontSize:"14px",color:"#6b7280"},children:"Configure who can access the UI interface and how group information is extracted from JWT tokens."})}),(0,i.jsxs)(o.Z,{form:t,onFinish:c,layout:"vertical",children:[(0,i.jsx)(o.Z.Item,{label:"UI Access Mode",name:"ui_access_mode_type",tooltip:"Controls who can access the UI interface",children:(0,i.jsxs)(w.default,{placeholder:"Select access mode",children:[(0,i.jsx)(w.default.Option,{value:"all_authenticated_users",children:"All Authenticated Users"}),(0,i.jsx)(w.default.Option,{value:"restricted_sso_group",children:"Restricted SSO Group"})]})}),(0,i.jsx)(o.Z.Item,{noStyle:!0,shouldUpdate:(e,l)=>e.ui_access_mode_type!==l.ui_access_mode_type,children:e=>{let{getFieldValue:l}=e;return"restricted_sso_group"===l("ui_access_mode_type")?(0,i.jsx)(o.Z.Item,{label:"Restricted SSO Group",name:"restricted_sso_group",rules:[{required:!0,message:"Please enter the restricted SSO group"}],children:(0,i.jsx)(N.o,{placeholder:"ui-access-group"})}):null}}),(0,i.jsx)(o.Z.Item,{label:"SSO Group JWT Field",name:"sso_group_jwt_field",tooltip:"JWT field name that contains team/group information. Use dot notation to access nested fields.",children:(0,i.jsx)(N.o,{placeholder:"groups"})}),(0,i.jsx)("div",{style:{textAlign:"right",marginTop:"16px"},children:(0,i.jsx)(d.ZP,{type:"primary",htmlType:"submit",loading:r,style:{backgroundColor:"#6366f1",borderColor:"#6366f1"},children:"Update UI Access Control"})})]})]})},W=s(12363),H=s(55584),J=s(29827),X=s(21770),Q=s(90246);let $=(0,Q.n)("uiSettings"),ee=e=>{let l=(0,J.NL)();return(0,X.D)({mutationFn:async l=>{if(!e)throw Error("Access token is required");return(0,O.updateUiSettings)(e,l)},onSuccess:()=>{l.invalidateQueries({queryKey:$.all})}})};var el=s(39760),es=s(5945),ei=s(50337),en=s(58760),et=s(63709);function er(){var e,l,s;let{accessToken:n}=(0,el.Z)(),{data:a,isLoading:o,isError:c,error:d}=(0,H.L)(),{mutate:u,isPending:_,error:m}=ee(n),g=null==a?void 0:a.field_schema,h=null==g?void 0:null===(e=g.properties)||void 0===e?void 0:e.disable_model_add_for_internal_users,p=!!(null!==(l=null==a?void 0:a.values)&&void 0!==l?l:{}).disable_model_add_for_internal_users;return(0,i.jsx)(es.Z,{title:"UI Settings",children:o?(0,i.jsx)(ei.Z,{active:!0}):c?(0,i.jsx)(r.Z,{type:"error",message:"Could not load UI settings",description:d instanceof Error?d.message:void 0}):(0,i.jsxs)(en.Z,{direction:"vertical",size:"large",style:{width:"100%"},children:[(null==g?void 0:g.description)&&(0,i.jsx)(t.default.Paragraph,{style:{marginBottom:0},children:g.description}),m&&(0,i.jsx)(r.Z,{type:"error",message:"Could not update UI settings",description:m instanceof Error?m.message:void 0}),(0,i.jsxs)(en.Z,{align:"start",size:"middle",children:[(0,i.jsx)(et.Z,{checked:p,disabled:_,loading:_,onChange:e=>{u({disable_model_add_for_internal_users:e},{onSuccess:()=>{E.Z.success("UI settings updated successfully")},onError:e=>{E.Z.fromBackend(e)}})},"aria-label":null!==(s=null==h?void 0:h.description)&&void 0!==s?s:"Disable model add for internal users"}),(0,i.jsxs)(en.Z,{direction:"vertical",size:4,children:[(0,i.jsx)(t.default.Text,{strong:!0,children:"Disable model add for internal users"}),(null==h?void 0:h.description)&&(0,i.jsx)(t.default.Text,{type:"secondary",children:h.description})]})]})]})})}var ea=s(11713);let eo=(0,Q.n)("sso"),ec=()=>{let{accessToken:e,userId:l,userRole:s}=(0,el.Z)();return(0,ea.a)({queryKey:eo.detail("settings"),queryFn:async()=>await (0,O.getSSOSettings)(e),enabled:!!(e&&l&&s)})};var ed=s(76188),eu=s(88906),e_=s(15868),em=s(18930);let eg={google:"https://artificialanalysis.ai/img/logos/google_small.svg",microsoft:"https://upload.wikimedia.org/wikipedia/commons/a/a8/Microsoft_Azure_Logo.svg",okta:"https://www.okta.com/sites/default/files/Okta_Logo_BrightBlue_Medium.png",generic:""},eh={google:"Google SSO",microsoft:"Microsoft SSO",okta:"Okta / Auth0 SSO",generic:"Generic SSO"},ep={internal_user_viewer:"Internal Viewer",internal_user:"Internal User",proxy_admin_viewer:"Proxy Admin Viewer",proxy_admin:"Proxy Admin"};var ex=s(31283);let ef={google:{envVarMap:{google_client_id:"GOOGLE_CLIENT_ID",google_client_secret:"GOOGLE_CLIENT_SECRET"},fields:[{label:"Google Client ID",name:"google_client_id"},{label:"Google Client Secret",name:"google_client_secret"}]},microsoft:{envVarMap:{microsoft_client_id:"MICROSOFT_CLIENT_ID",microsoft_client_secret:"MICROSOFT_CLIENT_SECRET",microsoft_tenant:"MICROSOFT_TENANT"},fields:[{label:"Microsoft Client ID",name:"microsoft_client_id"},{label:"Microsoft Client Secret",name:"microsoft_client_secret"},{label:"Microsoft Tenant",name:"microsoft_tenant"}]},okta:{envVarMap:{generic_client_id:"GENERIC_CLIENT_ID",generic_client_secret:"GENERIC_CLIENT_SECRET",generic_authorization_endpoint:"GENERIC_AUTHORIZATION_ENDPOINT",generic_token_endpoint:"GENERIC_TOKEN_ENDPOINT",generic_userinfo_endpoint:"GENERIC_USERINFO_ENDPOINT"},fields:[{label:"Generic Client ID",name:"generic_client_id"},{label:"Generic Client Secret",name:"generic_client_secret"},{label:"Authorization Endpoint",name:"generic_authorization_endpoint",placeholder:"https://your-domain/authorize"},{label:"Token Endpoint",name:"generic_token_endpoint",placeholder:"https://your-domain/token"},{label:"Userinfo Endpoint",name:"generic_userinfo_endpoint",placeholder:"https://your-domain/userinfo"}]},generic:{envVarMap:{generic_client_id:"GENERIC_CLIENT_ID",generic_client_secret:"GENERIC_CLIENT_SECRET",generic_authorization_endpoint:"GENERIC_AUTHORIZATION_ENDPOINT",generic_token_endpoint:"GENERIC_TOKEN_ENDPOINT",generic_userinfo_endpoint:"GENERIC_USERINFO_ENDPOINT"},fields:[{label:"Generic Client ID",name:"generic_client_id"},{label:"Generic Client Secret",name:"generic_client_secret"},{label:"Authorization Endpoint",name:"generic_authorization_endpoint"},{label:"Token Endpoint",name:"generic_token_endpoint"},{label:"Userinfo Endpoint",name:"generic_userinfo_endpoint"}]}},ej=e=>{let l=ef[e];return l?l.fields.map(e=>(0,i.jsx)(o.Z.Item,{label:e.label,name:e.name,rules:[{required:!0,message:"Please enter the ".concat(e.label.toLowerCase())}],children:e.name.includes("client")?(0,i.jsx)(c.default.Password,{}):(0,i.jsx)(ex.o,{placeholder:e.placeholder})},e.name)):null};var ev=e=>{let{form:l,onFormSubmit:s}=e;return(0,i.jsx)("div",{children:(0,i.jsxs)(o.Z,{form:l,onFinish:s,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:[(0,i.jsx)(o.Z.Item,{label:"SSO Provider",name:"sso_provider",rules:[{required:!0,message:"Please select an SSO provider"}],children:(0,i.jsx)(w.default,{children:Object.entries(eg).map(e=>{let[l,s]=e;return(0,i.jsx)(w.default.Option,{value:l,children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 0"},children:[s&&(0,i.jsx)("img",{src:s,alt:l,style:{height:24,width:24,marginRight:12,objectFit:"contain"}}),(0,i.jsx)("span",{children:eh[l]||l.charAt(0).toUpperCase()+l.slice(1)+" SSO"})]})},l)})})}),(0,i.jsx)(o.Z.Item,{noStyle:!0,shouldUpdate:(e,l)=>e.sso_provider!==l.sso_provider,children:e=>{let{getFieldValue:l}=e,s=l("sso_provider");return s?ej(s):null}}),(0,i.jsx)(o.Z.Item,{label:"Proxy Admin Email",name:"user_email",rules:[{required:!0,message:"Please enter the email of the proxy admin"}],children:(0,i.jsx)(ex.o,{})}),(0,i.jsx)(o.Z.Item,{label:"Proxy Base URL",name:"proxy_base_url",normalize:e=>null==e?void 0:e.trim(),rules:[{required:!0,message:"Please enter the proxy base url"},{pattern:/^https?:\/\/.+/,message:"URL must start with http:// or https://"},{validator:(e,l)=>l&&/^https?:\/\/.+/.test(l)&&l.endsWith("/")?Promise.reject("URL must not end with a trailing slash"):Promise.resolve()}],children:(0,i.jsx)(ex.o,{placeholder:"https://example.com"})}),(0,i.jsx)(o.Z.Item,{noStyle:!0,shouldUpdate:(e,l)=>e.sso_provider!==l.sso_provider,children:e=>{let{getFieldValue:l}=e,s=l("sso_provider");return"okta"===s||"generic"===s?(0,i.jsx)(o.Z.Item,{label:"Use Role Mappings",name:"use_role_mappings",valuePropName:"checked",children:(0,i.jsx)(C.Z,{})}):null}}),(0,i.jsx)(o.Z.Item,{noStyle:!0,shouldUpdate:(e,l)=>e.use_role_mappings!==l.use_role_mappings||e.sso_provider!==l.sso_provider,children:e=>{let{getFieldValue:l}=e,s=l("use_role_mappings"),n=l("sso_provider");return s&&("okta"===n||"generic"===n)?(0,i.jsx)(o.Z.Item,{label:"Group Claim",name:"group_claim",rules:[{required:!0,message:"Please enter the group claim"}],children:(0,i.jsx)(ex.o,{})}):null}}),(0,i.jsx)(o.Z.Item,{noStyle:!0,shouldUpdate:(e,l)=>e.use_role_mappings!==l.use_role_mappings||e.sso_provider!==l.sso_provider,children:e=>{let{getFieldValue:l}=e,s=l("use_role_mappings"),n=l("sso_provider");return s&&("okta"===n||"generic"===n)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z.Item,{label:"Default Role",name:"default_role",initialValue:"Internal User",children:(0,i.jsxs)(w.default,{children:[(0,i.jsx)(w.default.Option,{value:"internal_user_viewer",children:"Internal Viewer"}),(0,i.jsx)(w.default.Option,{value:"internal_user",children:"Internal User"}),(0,i.jsx)(w.default.Option,{value:"proxy_admin_viewer",children:"Admin Viewer"}),(0,i.jsx)(w.default.Option,{value:"proxy_admin",children:"Proxy Admin"})]})}),(0,i.jsx)(o.Z.Item,{label:"Proxy Admin Teams",name:"proxy_admin_teams",children:(0,i.jsx)(ex.o,{})}),(0,i.jsx)(o.Z.Item,{label:"Admin Viewer Teams",name:"admin_viewer_teams",children:(0,i.jsx)(ex.o,{})}),(0,i.jsx)(o.Z.Item,{label:"Internal User Teams",name:"internal_user_teams",children:(0,i.jsx)(ex.o,{})}),(0,i.jsx)(o.Z.Item,{label:"Internal Viewer Teams",name:"internal_viewer_teams",children:(0,i.jsx)(ex.o,{})})]}):null}})]})})};let eS=()=>{let{accessToken:e}=(0,el.Z)();return(0,X.D)({mutationFn:async l=>{if(!e)throw Error("Access token is required");return await (0,O.updateSSOSettings)(e,l)}})},ey=e=>{let{proxy_admin_teams:l,admin_viewer_teams:s,internal_user_teams:i,internal_viewer_teams:n,default_role:t,group_claim:r,use_role_mappings:a,...o}=e,c={...o};if(a){let e=e=>e&&""!==e.trim()?e.split(",").map(e=>e.trim()).filter(e=>e.length>0):[];c.role_mappings={provider:"generic",group_claim:r,default_role:({internal_user_viewer:"internal_user_viewer",internal_user:"internal_user",proxy_admin_viewer:"proxy_admin_viewer",proxy_admin:"proxy_admin"})[t]||"internal_user",roles:{proxy_admin:e(l),proxy_admin_viewer:e(s),internal_user:e(i),internal_user_viewer:e(n)}}}return c},eI=e=>{if(e.google_client_id)return"google";if(e.microsoft_client_id)return"microsoft";if(e.generic_client_id){var l,s;return(null===(l=e.generic_authorization_endpoint)||void 0===l?void 0:l.includes("okta"))||(null===(s=e.generic_authorization_endpoint)||void 0===s?void 0:s.includes("auth0"))?"okta":"generic"}return null};var eb=e=>{let{isVisible:l,onCancel:s,onSuccess:n}=e,[t]=o.Z.useForm(),{mutateAsync:r,isPending:a}=eS(),c=async e=>{let l=ey(e);await r(l,{onSuccess:()=>{E.Z.success("SSO settings added successfully"),n()},onError:e=>{E.Z.fromBackend("Failed to save SSO settings: "+(0,k.O)(e))}})},_=()=>{t.resetFields(),s()};return(0,i.jsx)(u.Z,{title:"Add SSO",open:l,width:800,footer:(0,i.jsxs)(en.Z,{children:[(0,i.jsx)(d.ZP,{onClick:_,disabled:a,children:"Cancel"}),(0,i.jsx)(d.ZP,{loading:a,onClick:()=>t.submit(),children:a?"Adding...":"Add SSO"})]}),onCancel:_,children:(0,i.jsx)(ev,{form:t,onFormSubmit:c})})},eZ=s(21609),ew=e=>{let{isVisible:l,onCancel:s,onSuccess:n}=e,{data:t}=ec(),{mutateAsync:r,isPending:a}=eS(),o=async()=>{await r({google_client_id:null,google_client_secret:null,microsoft_client_id:null,microsoft_client_secret:null,microsoft_tenant:null,generic_client_id:null,generic_client_secret:null,generic_authorization_endpoint:null,generic_token_endpoint:null,generic_userinfo_endpoint:null,proxy_base_url:null,user_email:null,sso_provider:null,role_mappings:null},{onSuccess:()=>{E.Z.success("SSO settings cleared successfully"),s(),n()},onError:e=>{E.Z.fromBackend("Failed to clear SSO settings: "+(0,k.O)(e))}})};return(0,i.jsx)(eZ.Z,{isOpen:l,title:"Confirm Clear SSO Settings",alertMessage:"This action cannot be undone.",message:"Are you sure you want to clear all SSO settings? Users will no longer be able to login using SSO after this change.",resourceInformationTitle:"SSO Settings",resourceInformation:[{label:"Provider",value:(null==t?void 0:t.values)&&eI(null==t?void 0:t.values)||"Generic"}],onCancel:s,onOk:o,confirmLoading:a})},eC=e=>{let{isVisible:l,onCancel:s,onSuccess:t}=e,[r]=o.Z.useForm(),a=ec(),{mutateAsync:c,isPending:_}=eS();(0,n.useEffect)(()=>{if(l&&a.data&&a.data.values){var e,s,i,n,t,o;let l=a.data;console.log("Raw SSO data received:",l),console.log("SSO values:",l.values),console.log("user_email from API:",l.values.user_email);let c=null;l.values.google_client_id?c="google":l.values.microsoft_client_id?c="microsoft":l.values.generic_client_id&&(c=(null===(e=l.values.generic_authorization_endpoint)||void 0===e?void 0:e.includes("okta"))||(null===(s=l.values.generic_authorization_endpoint)||void 0===s?void 0:s.includes("auth0"))?"okta":"generic");let d={};if(l.values.role_mappings){let e=l.values.role_mappings,s=e=>e&&0!==e.length?e.join(", "):"";d={use_role_mappings:!0,group_claim:e.group_claim,default_role:e.default_role||"internal_user",proxy_admin_teams:s(null===(i=e.roles)||void 0===i?void 0:i.proxy_admin),admin_viewer_teams:s(null===(n=e.roles)||void 0===n?void 0:n.proxy_admin_viewer),internal_user_teams:s(null===(t=e.roles)||void 0===t?void 0:t.internal_user),internal_viewer_teams:s(null===(o=e.roles)||void 0===o?void 0:o.internal_user_viewer)}}let u={sso_provider:c,...l.values,...d};console.log("Setting form values:",u),r.resetFields(),setTimeout(()=>{r.setFieldsValue(u),console.log("Form values set, current form values:",r.getFieldsValue())},100)}},[l,a.data,r]);let m=async e=>{try{let l=ey(e);await c(l,{onSuccess:()=>{E.Z.success("SSO settings updated successfully"),t()},onError:e=>{E.Z.fromBackend("Failed to save SSO settings: "+(0,k.O)(e))}})}catch(e){E.Z.fromBackend("Failed to process SSO settings: "+(0,k.O)(e))}},g=()=>{r.resetFields(),s()};return(0,i.jsx)(u.Z,{title:"Edit SSO Settings",open:l,width:800,footer:(0,i.jsxs)(en.Z,{children:[(0,i.jsx)(d.ZP,{onClick:g,disabled:_,children:"Cancel"}),(0,i.jsx)(d.ZP,{loading:_,onClick:()=>r.submit(),children:_?"Saving...":"Save"})]}),onCancel:g,children:(0,i.jsx)(ev,{form:r,onFormSubmit:m})})},eN=s(42208),eO=s(87769);function eE(e){let{defaultHidden:l=!0,value:s}=e,[t,r]=(0,n.useState)(l);return(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"font-mono text-gray-600 flex-1",children:s?t?"•".repeat(s.length):s:(0,i.jsx)("span",{className:"text-gray-400 italic",children:"Not configured"})}),s&&(0,i.jsx)(d.ZP,{type:"text",size:"small",icon:t?(0,i.jsx)(eN.Z,{className:"w-4 h-4"}):(0,i.jsx)(eO.Z,{className:"w-4 h-4"}),onClick:()=>r(!t),className:"text-gray-400 hover:text-gray-600"})]})}var ek=s(3810),eT=s(23496),eP=s(56609),eA=s(95805);let{Title:eU,Text:eR}=t.default;function eF(e){let{roleMappings:l}=e;if(!l)return null;let s=[{title:"Role",dataIndex:"role",key:"role",render:e=>(0,i.jsx)(eR,{strong:!0,children:ep[e]})},{title:"Mapped Groups",dataIndex:"groups",key:"groups",render:e=>(0,i.jsx)(i.Fragment,{children:e.length>0?e.map((e,l)=>(0,i.jsx)(ek.Z,{color:"blue",children:e},l)):(0,i.jsx)(eR,{className:"text-gray-400 italic",children:"No groups mapped"})})}];return(0,i.jsxs)(es.Z,{children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(eA.Z,{className:"w-6 h-6 text-gray-400 mb-2"}),(0,i.jsx)(eU,{level:3,children:"Role Mappings"})]}),(0,i.jsxs)("div",{className:"space-y-8",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(eU,{level:5,children:"Group Claim"}),(0,i.jsx)("div",{children:(0,i.jsx)(eR,{code:!0,children:l.group_claim})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eU,{level:5,children:"Default Role"}),(0,i.jsx)("div",{children:(0,i.jsx)(eR,{strong:!0,children:ep[l.default_role]})})]})]}),(0,i.jsx)(eT.Z,{}),(0,i.jsx)(eP.Z,{columns:s,dataSource:Object.entries(l.roles).map(e=>{let[l,s]=e;return{role:l,groups:s}}),pagination:!1,bordered:!0,size:"small",className:"w-full"})]})]})}var eM=s(85180);let{Title:eG,Paragraph:eL}=t.default;function eD(e){let{onAdd:l}=e;return(0,i.jsx)("div",{className:"bg-white p-12 rounded-lg border border-dashed border-gray-300 text-center w-full",children:(0,i.jsx)(eM.Z,{image:eM.Z.PRESENTED_IMAGE_SIMPLE,description:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(eG,{level:4,children:"No SSO Configuration Found"}),(0,i.jsx)(eL,{type:"secondary",className:"max-w-md mx-auto",children:"Configure Single Sign-On (SSO) to enable seamless authentication for your team members using your identity provider."})]}),children:(0,i.jsx)(d.ZP,{type:"primary",size:"large",onClick:l,className:"flex items-center gap-2 mx-auto mt-4",children:"Configure SSO"})})})}let{Title:ez,Text:eB}=t.default;function eV(){return(0,i.jsx)(es.Z,{children:(0,i.jsxs)(en.Z,{direction:"vertical",size:"large",className:"w-full",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(eu.Z,{className:"w-6 h-6 text-gray-400"}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ez,{level:3,children:"SSO Configuration"}),(0,i.jsx)(eB,{type:"secondary",children:"Manage Single Sign-On authentication settings"})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(ei.Z.Button,{active:!0,size:"default",style:{width:170,height:32}}),(0,i.jsx)(ei.Z.Button,{active:!0,size:"default",style:{width:190,height:32}})]})]}),(0,i.jsxs)(ed.Z,{bordered:!0,column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1},children:[(0,i.jsx)(ed.Z.Item,{label:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:80,height:16}}),children:(0,i.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:100,height:16}})})}),(0,i.jsx)(ed.Z.Item,{label:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:80,height:16}}),children:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:200,height:16}})}),(0,i.jsx)(ed.Z.Item,{label:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:80,height:16}}),children:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:250,height:16}})}),(0,i.jsx)(ed.Z.Item,{label:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:80,height:16}}),children:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:180,height:16}})}),(0,i.jsx)(ed.Z.Item,{label:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:80,height:16}}),children:(0,i.jsx)(ei.Z.Node,{active:!0,style:{width:220,height:16}})})]})]})})}let{Title:eq,Text:eY}=t.default;function eK(){let{data:e,refetch:l,isLoading:s}=ec(),[t,r]=(0,n.useState)(!1),[a,o]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),_=!!(null==e?void 0:e.values.google_client_id)||!!(null==e?void 0:e.values.microsoft_client_id)||!!(null==e?void 0:e.values.generic_client_id),m=(null==e?void 0:e.values)?eI(e.values):null,g=!!(null==e?void 0:e.values.role_mappings),h=e=>(0,i.jsx)(eY,{className:"font-mono text-gray-600 text-sm",copyable:!!e,children:e||"-"}),p=e=>e||(0,i.jsx)("span",{className:"text-gray-400 italic",children:"Not configured"}),x={column:{xxl:1,xl:1,lg:1,md:1,sm:1,xs:1}},f={google:{providerText:eh.google,fields:[{label:"Client ID",render:e=>(0,i.jsx)(eE,{value:e.google_client_id})},{label:"Client Secret",render:e=>(0,i.jsx)(eE,{value:e.google_client_secret})},{label:"Proxy Base URL",render:e=>p(e.proxy_base_url)}]},microsoft:{providerText:eh.microsoft,fields:[{label:"Client ID",render:e=>(0,i.jsx)(eE,{value:e.microsoft_client_id})},{label:"Client Secret",render:e=>(0,i.jsx)(eE,{value:e.microsoft_client_secret})},{label:"Tenant",render:e=>p(e.microsoft_tenant)},{label:"Proxy Base URL",render:e=>p(e.proxy_base_url)}]},okta:{providerText:eh.okta,fields:[{label:"Client ID",render:e=>(0,i.jsx)(eE,{value:e.generic_client_id})},{label:"Client Secret",render:e=>(0,i.jsx)(eE,{value:e.generic_client_secret})},{label:"Authorization Endpoint",render:e=>h(e.generic_authorization_endpoint)},{label:"Token Endpoint",render:e=>h(e.generic_token_endpoint)},{label:"User Info Endpoint",render:e=>h(e.generic_userinfo_endpoint)},{label:"Proxy Base URL",render:e=>p(e.proxy_base_url)}]},generic:{providerText:eh.generic,fields:[{label:"Client ID",render:e=>(0,i.jsx)(eE,{value:e.generic_client_id})},{label:"Client Secret",render:e=>(0,i.jsx)(eE,{value:e.generic_client_secret})},{label:"Authorization Endpoint",render:e=>h(e.generic_authorization_endpoint)},{label:"Token Endpoint",render:e=>h(e.generic_token_endpoint)},{label:"User Info Endpoint",render:e=>h(e.generic_userinfo_endpoint)},{label:"Proxy Base URL",render:e=>p(e.proxy_base_url)}]}};return(0,i.jsxs)(i.Fragment,{children:[s?(0,i.jsx)(eV,{}):(0,i.jsxs)(en.Z,{direction:"vertical",size:"large",className:"w-full",children:[(0,i.jsx)(es.Z,{children:(0,i.jsxs)(en.Z,{direction:"vertical",size:"large",className:"w-full",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(eu.Z,{className:"w-6 h-6 text-gray-400"}),(0,i.jsxs)("div",{children:[(0,i.jsx)(eq,{level:3,children:"SSO Configuration"}),(0,i.jsx)(eY,{type:"secondary",children:"Manage Single Sign-On authentication settings"})]})]}),(0,i.jsx)("div",{className:"flex items-center gap-3",children:_&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.ZP,{icon:(0,i.jsx)(e_.Z,{className:"w-4 h-4"}),onClick:()=>u(!0),children:"Edit SSO Settings"}),(0,i.jsx)(d.ZP,{danger:!0,icon:(0,i.jsx)(em.Z,{className:"w-4 h-4"}),onClick:()=>r(!0),children:"Delete SSO Settings"})]})})]}),_?(()=>{if(!(null==e?void 0:e.values)||!m)return null;let{values:l}=e,s=f[m];return s?(0,i.jsxs)(ed.Z,{bordered:!0,...x,children:[(0,i.jsx)(ed.Z.Item,{label:"Provider",children:(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[eg[m]&&(0,i.jsx)("img",{src:eg[m],alt:m,style:{height:24,width:24,objectFit:"contain"}}),(0,i.jsx)("span",{children:s.providerText})]})}),s.fields.map((e,s)=>(0,i.jsx)(ed.Z.Item,{label:e.label,children:e.render(l)},s))]}):null})():(0,i.jsx)(eD,{onAdd:()=>o(!0)})]})}),g&&(0,i.jsx)(eF,{roleMappings:null==e?void 0:e.values.role_mappings})]}),(0,i.jsx)(ew,{isVisible:t,onCancel:()=>r(!1),onSuccess:()=>l()}),(0,i.jsx)(eb,{isVisible:a,onCancel:()=>o(!1),onSuccess:()=>{o(!1),l()}}),(0,i.jsx)(eC,{isVisible:c,onCancel:()=>u(!1),onSuccess:()=>{u(!1),l()}})]})}var eW=e=>{let{searchParams:l,accessToken:s,userID:w,showSSOBanner:C,premiumUser:N,proxySettings:k,userRole:T}=e,[P]=o.Z.useForm(),[U]=o.Z.useForm(),{Title:R,Paragraph:F}=t.default,[M,G]=(0,n.useState)(""),[L,D]=(0,n.useState)(null),[z,B]=(0,n.useState)(null),[V,q]=(0,n.useState)(!1),[H,J]=(0,n.useState)(!1),[X,Q]=(0,n.useState)(!1),[$,ee]=(0,n.useState)(!1),[el,es]=(0,n.useState)(!1),[ei,en]=(0,n.useState)(!1),[et,ea]=(0,n.useState)(!1),[eo,ec]=(0,n.useState)(!1),[ed,eu]=(0,n.useState)(!1),[e_,em]=(0,n.useState)(!1),[eg,eh]=(0,n.useState)([]),[ep,ex]=(0,n.useState)(null),[ef,ej]=(0,n.useState)(!1);(0,a.useRouter)();let[ev,eS]=(0,n.useState)(null);console.log=function(){};let ey=(0,W.n)(),eI="All IP Addresses Allowed",eb=ey;eb+="/fallback/login";let eZ=async()=>{if(s)try{let e=await (0,O.getSSOSettings)(s);if(console.log("SSO data:",e),e&&e.values){let l=e.values.google_client_id&&e.values.google_client_secret,s=e.values.microsoft_client_id&&e.values.microsoft_client_secret,i=e.values.generic_client_id&&e.values.generic_client_secret;ej(l||s||i)}else ej(!1)}catch(e){console.error("Error checking SSO configuration:",e),ej(!1)}},ew=async()=>{try{if(!0!==N){E.Z.fromBackend("This feature is only available for premium users. Please upgrade your account.");return}if(s){let e=await (0,O.getAllowedIPs)(s);eh(e&&e.length>0?e:[eI])}else eh([eI])}catch(e){console.error("Error fetching allowed IPs:",e),E.Z.fromBackend("Failed to fetch allowed IPs ".concat(e)),eh([eI])}finally{!0===N&&ea(!0)}},eC=async e=>{try{if(s){await (0,O.addAllowedIP)(s,e.ip);let l=await (0,O.getAllowedIPs)(s);eh(l),E.Z.success("IP address added successfully")}}catch(e){console.error("Error adding IP:",e),E.Z.fromBackend("Failed to add IP address ".concat(e))}finally{ec(!1)}},eN=async e=>{ex(e),eu(!0)},eO=async()=>{if(ep&&s)try{await (0,O.deleteAllowedIP)(s,ep);let e=await (0,O.getAllowedIPs)(s);eh(e.length>0?e:[eI]),E.Z.success("IP address deleted successfully")}catch(e){console.error("Error deleting IP:",e),E.Z.fromBackend("Failed to delete IP address ".concat(e))}finally{eu(!1),ex(null)}};(0,n.useEffect)(()=>{(async()=>{if(null!=s){let e=[],l=await (0,O.userGetAllUsersCall)(s,"proxy_admin_viewer");console.log("proxy admin viewer response: ",l);let i=l.users;console.log("proxy viewers response: ".concat(i)),i.forEach(l=>{e.push({user_role:l.user_role,user_id:l.user_id,user_email:l.user_email})}),console.log("proxy viewers: ".concat(i));let n=(await (0,O.userGetAllUsersCall)(s,"proxy_admin")).users;n.forEach(l=>{e.push({user_role:l.user_role,user_id:l.user_id,user_email:l.user_email})}),console.log("proxy admins: ".concat(n)),console.log("combinedList: ".concat(e)),D(e),eS(await (0,O.getPossibleUserRoles)(s))}})()},[s]),(0,n.useEffect)(()=>{eZ()},[s,N]);let eE=()=>{em(!1)};return console.log("admins: ".concat(null==L?void 0:L.length)),(0,i.jsxs)("div",{className:"w-full m-2 mt-2 p-8",children:[(0,i.jsx)(R,{level:4,children:"Admin Access "}),(0,i.jsx)(F,{children:"Go to 'Internal Users' page to add other admins."}),(0,i.jsxs)(p.Z,{children:[(0,i.jsxs)(x.Z,{children:[(0,i.jsx)(h.Z,{children:"SSO Settings"}),(0,i.jsx)(h.Z,{children:"Security Settings"}),(0,i.jsx)(h.Z,{children:"SCIM"}),(0,i.jsx)(h.Z,{children:"UI Settings"})]}),(0,i.jsxs)(j.Z,{children:[(0,i.jsx)(f.Z,{children:(0,i.jsx)(eK,{})}),(0,i.jsxs)(f.Z,{children:[(0,i.jsxs)(g.Z,{children:[(0,i.jsx)(R,{level:4,children:" ✨ Security Settings"}),(0,i.jsx)(r.Z,{message:"SSO Configuration Deprecated",description:"Editing SSO Settings on this page is deprecated and will be removed in a future version. Please use the SSO Settings tab for SSO configuration.",type:"warning",showIcon:!0}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginTop:"1rem",marginLeft:"0.5rem"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(_.Z,{style:{width:"150px"},onClick:()=>es(!0),children:ef?"Edit SSO Settings":"Add SSO"})}),(0,i.jsx)("div",{children:(0,i.jsx)(_.Z,{style:{width:"150px"},onClick:ew,children:"Allowed IPs"})}),(0,i.jsx)("div",{children:(0,i.jsx)(_.Z,{style:{width:"150px"},onClick:()=>!0===N?em(!0):E.Z.fromBackend("Only premium users can configure UI access control"),children:"UI Access Control"})})]})]}),(0,i.jsxs)("div",{className:"flex justify-start mb-4",children:[(0,i.jsx)(A,{isAddSSOModalVisible:el,isInstructionsModalVisible:ei,handleAddSSOOk:()=>{es(!1),P.resetFields(),s&&N&&eZ()},handleAddSSOCancel:()=>{es(!1),P.resetFields()},handleShowInstructions:e=>{es(!1),en(!0)},handleInstructionsOk:()=>{en(!1),s&&N&&eZ()},handleInstructionsCancel:()=>{en(!1),s&&N&&eZ()},form:P,accessToken:s,ssoConfigured:ef}),(0,i.jsx)(u.Z,{title:"Manage Allowed IP Addresses",width:800,visible:et,onCancel:()=>ea(!1),footer:[(0,i.jsx)(_.Z,{className:"mx-1",onClick:()=>ec(!0),children:"Add IP Address"},"add"),(0,i.jsx)(_.Z,{onClick:()=>ea(!1),children:"Close"},"close")],children:(0,i.jsxs)(v.Z,{children:[(0,i.jsx)(I.Z,{children:(0,i.jsxs)(Z.Z,{children:[(0,i.jsx)(b.Z,{children:"IP Address"}),(0,i.jsx)(b.Z,{className:"text-right",children:"Action"})]})}),(0,i.jsx)(S.Z,{children:eg.map((e,l)=>(0,i.jsxs)(Z.Z,{children:[(0,i.jsx)(y.Z,{children:e}),(0,i.jsx)(y.Z,{className:"text-right",children:e!==eI&&(0,i.jsx)(_.Z,{onClick:()=>eN(e),color:"red",size:"xs",children:"Delete"})})]},l))})]})}),(0,i.jsx)(u.Z,{title:"Add Allowed IP Address",visible:eo,onCancel:()=>ec(!1),footer:null,children:(0,i.jsxs)(o.Z,{onFinish:eC,children:[(0,i.jsx)(o.Z.Item,{name:"ip",rules:[{required:!0,message:"Please enter an IP address"}],children:(0,i.jsx)(c.default,{placeholder:"Enter IP address"})}),(0,i.jsx)(o.Z.Item,{children:(0,i.jsx)(d.ZP,{htmlType:"submit",children:"Add IP Address"})})]})}),(0,i.jsx)(u.Z,{title:"Confirm Delete",visible:ed,onCancel:()=>eu(!1),onOk:eO,footer:[(0,i.jsx)(_.Z,{className:"mx-1",onClick:()=>eO(),children:"Yes"},"delete"),(0,i.jsx)(_.Z,{onClick:()=>eu(!1),children:"Close"},"close")],children:(0,i.jsxs)("p",{children:["Are you sure you want to delete the IP address: ",ep,"?"]})}),(0,i.jsx)(u.Z,{title:"UI Access Control Settings",visible:e_,width:600,footer:null,onOk:eE,onCancel:()=>{em(!1)},children:(0,i.jsx)(K,{accessToken:s,onSuccess:()=>{eE(),E.Z.success("UI Access Control settings updated successfully")}})})]}),(0,i.jsxs)(m.Z,{title:"Login without SSO",color:"teal",children:["If you need to login without sso, you can access"," ",(0,i.jsxs)("a",{href:eb,target:"_blank",children:[(0,i.jsx)("b",{children:eb})," "]})]})]}),(0,i.jsx)(f.Z,{children:(0,i.jsx)(Y,{accessToken:s,userID:w,proxySettings:k})}),(0,i.jsx)(f.Z,{children:(0,i.jsx)(er,{})})]})]})]})}}}]);