(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{20661:function(e,t,n){Promise.resolve().then(n.bind(n,48016))},48016:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ec}});var s=n(3827),l=n(64090),r=n(47907),a=n(8792),o=n(2179),i=e=>{let{userID:t,userRole:n,userEmail:l}=e;return console.log("User ID:",t),console.log("userEmail:",l),(0,s.jsxs)("nav",{className:"left-0 right-0 top-0 flex justify-between items-center h-12 mb-4",children:[(0,s.jsx)("div",{className:"text-left mx-4 my-2 absolute top-0 left-0",children:(0,s.jsx)("div",{className:"flex flex-col items-center",children:(0,s.jsx)(a.default,{href:"/",children:(0,s.jsx)("button",{className:"text-gray-800 text-2xl px-4 py-1 rounded text-center",children:"\uD83D\uDE85 LiteLLM"})})})}),(0,s.jsx)("div",{className:"text-right mx-4 my-2 absolute top-0 right-0",children:(0,s.jsxs)(o.Z,{variant:"secondary",children:[l,(0,s.jsxs)("p",{children:["Role: ",n]}),(0,s.jsxs)("p",{children:["ID: ",t]})]})})]})},c=n(80588);let d=async(e,t,n)=>{try{if(console.log("Form Values in keyCreateCall:",n),n.description&&(n.metadata||(n.metadata={}),n.metadata.description=n.description,delete n.description,n.metadata=JSON.stringify(n.metadata)),n.metadata){console.log("formValues.metadata:",n.metadata);try{n.metadata=JSON.parse(n.metadata)}catch(e){throw c.ZP.error("Failed to parse metadata: "+e),Error("Failed to parse metadata: "+e)}}console.log("Form Values after check:",n);let s=await fetch("/key/generate",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({user_id:t,...n})});if(!s.ok){let e=await s.text();throw c.ZP.error("Failed to create key: "+e),console.error("Error response from the server:",e),Error("Network response was not ok")}let l=await s.json();return console.log("API Response:",l),l}catch(e){throw console.error("Failed to create key:",e),e}},m=async(e,t)=>{try{console.log("in keyDeleteCall:",t),c.ZP.info("Making key delete request");let n=await fetch("/key/delete",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({keys:[t]})});if(!n.ok){let e=await n.text();throw c.ZP.error("Failed to delete key: "+e),Error("Network response was not ok")}let s=await n.json();return console.log(s),c.ZP.success("API Key Deleted"),s}catch(e){throw console.error("Failed to create key:",e),e}},h=async(e,t,n)=>{try{let s="/user/info";"App Owner"==n&&(s="".concat(s,"/?user_id=").concat(t)),c.ZP.info("Requesting user data");let l=await fetch(s,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!l.ok){let e=await l.text();throw c.ZP.error(e),Error("Network response was not ok")}let r=await l.json();return c.ZP.info("Received user data"),r}catch(e){throw console.error("Failed to create key:",e),e}},u=async(e,t,n)=>{try{c.ZP.info("Requesting model data");let t=await fetch("/model/info",{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok){let e=await t.text();throw c.ZP.error(e),Error("Network response was not ok")}let n=await t.json();return c.ZP.info("Received model data"),n}catch(e){throw console.error("Failed to create key:",e),e}},x=async(e,t)=>{try{let n="/spend/logs";console.log("in keySpendLogsCall:",n);let s=await fetch("".concat(n,"/?api_key=").concat(t),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!s.ok){let e=await s.text();throw c.ZP.error(e),Error("Network response was not ok")}let l=await s.json();return console.log(l),l}catch(e){throw console.error("Failed to create key:",e),e}},p=async(e,t,n,s,l,r)=>{try{let t="/spend/logs";t="App Owner"==n?"".concat(t,"/?user_id=").concat(s,"&start_date=").concat(l,"&end_date=").concat(r):"".concat(t,"/?start_date=").concat(l,"&end_date=").concat(r),c.ZP.info("Making spend logs request");let a=await fetch(t,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){let e=await a.text();throw c.ZP.error(e),Error("Network response was not ok")}let o=await a.json();return console.log(o),c.ZP.success("Spend Logs received"),o}catch(e){throw console.error("Failed to create key:",e),e}},j=async(e,t)=>{try{let n=await fetch("/key/info",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({keys:t})});if(!n.ok){let e=await n.text();throw c.ZP.error(e),Error("Network response was not ok")}let s=await n.json();return console.log(s),s}catch(e){throw console.error("Failed to create key:",e),e}},g=async(e,t)=>{try{let n="/spend/users";console.log("in spendUsersCall:",n);let s=await fetch("".concat(n,"/?user_id=").concat(t),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!s.ok){let e=await s.text();throw c.ZP.error(e),Error("Network response was not ok")}let l=await s.json();return console.log(l),l}catch(e){throw console.error("Failed to get spend for user",e),e}};var y=n(10384),f=n(46453),Z=n(71801),w=n(13969),k=n(12143),_=n(77171),v=n(29714),b=n(88707),S=n(1861);let{Option:N}=w.default;var I=e=>{let{userID:t,userRole:n,accessToken:r,data:a,userModels:i,setData:m}=e,[h]=k.Z.useForm(),[u,x]=(0,l.useState)(!1),[p,j]=(0,l.useState)(null),g=()=>{x(!1),h.resetFields()},I=()=>{x(!1),j(null),h.resetFields()},A=async e=>{try{c.ZP.info("Making API Call"),x(!0);let n=await d(r,t,e);m(e=>e?[...e,n]:[n]),j(n.key),c.ZP.success("API Key Created"),h.resetFields(),localStorage.removeItem("userData"+t)}catch(e){console.error("Error creating the key:",e)}};return(0,s.jsxs)("div",{children:[(0,s.jsx)(o.Z,{className:"mx-auto",onClick:()=>x(!0),children:"+ Create New Key"}),(0,s.jsx)(_.Z,{title:"Create Key",visible:u,width:800,footer:null,onOk:g,onCancel:I,children:(0,s.jsxs)(k.Z,{form:h,onFinish:A,labelCol:{span:6},wrapperCol:{span:16},labelAlign:"left",children:["App Owner"===n||"Admin"===n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.Z.Item,{label:"Key Name",name:"key_alias",children:(0,s.jsx)(v.Z,{})}),(0,s.jsx)(k.Z.Item,{label:"Team ID",name:"team_id",children:(0,s.jsx)(v.Z,{placeholder:"ai_team"})}),(0,s.jsx)(k.Z.Item,{label:"Models",name:"models",children:(0,s.jsx)(w.default,{mode:"multiple",placeholder:"Select models",style:{width:"100%"},children:i.map(e=>(0,s.jsx)(N,{value:e,children:e},e))})}),(0,s.jsx)(k.Z.Item,{label:"Max Budget (USD)",name:"max_budget",children:(0,s.jsx)(b.Z,{step:.01,precision:2,width:200})}),(0,s.jsx)(k.Z.Item,{label:"Duration (eg: 30s, 30h, 30d)",name:"duration",children:(0,s.jsx)(v.Z,{})}),(0,s.jsx)(k.Z.Item,{label:"Metadata",name:"metadata",children:(0,s.jsx)(v.Z.TextArea,{rows:4,placeholder:"Enter metadata as JSON"})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.Z.Item,{label:"Key Name",name:"key_alias",children:(0,s.jsx)(v.Z,{})}),(0,s.jsx)(k.Z.Item,{label:"Team ID (Contact Group)",name:"team_id",children:(0,s.jsx)(v.Z,{placeholder:"ai_team"})}),(0,s.jsx)(k.Z.Item,{label:"Description",name:"description",children:(0,s.jsx)(v.Z.TextArea,{placeholder:"Enter description",rows:4})})]}),(0,s.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,s.jsx)(S.ZP,{htmlType:"submit",children:"Create Key"})})]})}),p&&(0,s.jsx)(_.Z,{title:"Save your key",visible:u,onOk:g,onCancel:I,footer:null,children:(0,s.jsxs)(f.Z,{numItems:1,className:"gap-2 w-full",children:[(0,s.jsx)(y.Z,{numColSpan:1,children:(0,s.jsxs)("p",{children:["Please save this secret key somewhere safe and accessible. For security reasons, ",(0,s.jsx)("b",{children:"you will not be able to view it again"})," ","through your LiteLLM account. If you lose this secret key, you will need to generate a new one."]})}),(0,s.jsx)(y.Z,{numColSpan:1,children:null!=p?(0,s.jsxs)(Z.Z,{children:["API Key: ",p]}):(0,s.jsx)(Z.Z,{children:"Key being created, this might take 30s"})})]})})]})},A=n(33393),C=n(13810),D=n(61244),T=n(10827),P=n(3851),E=n(2044),O=n(64167),R=n(74480),M=n(7178),U=n(42440),F=n(9853),K=n(67989),L=n(56863),z=e=>{let{token:t,accessToken:n,keySpend:r,keyBudget:a,keyName:i}=e,[c,d]=(0,l.useState)(!1),[m,h]=(0,l.useState)(null),[u,p]=(0,l.useState)(null),j=async()=>{try{if(null==n||null==t)return;console.log("accessToken: ".concat(n,"; token: ").concat(t));let e=await x(n,t);console.log("Response:",e);let s=Object.values(e).reduce((e,t)=>{let n=new Date(t.startTime),s=new Intl.DateTimeFormat("en-US",{day:"2-digit",month:"short"}).format(n);return e[s]=(e[s]||0)+t.spend,e},{}),l=Object.entries(s);l.sort((e,t)=>{let[n]=e,[s]=t,l=new Date(n),r=new Date(s);return l.getTime()-r.getTime()});let r=Object.fromEntries(l);console.log(r);let a=Object.values(e).reduce((e,t)=>{let n=t.user;return e[n]=(e[n]||0)+t.spend,e},{});console.log(s),console.log(a);let o=[];for(let[e,t]of Object.entries(r))o.push({day:e,spend:t});let i=Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,5).map(e=>{let[t,n]=e;return{name:t,value:n}});h(o),p(i),console.log("arrayBarChart:",o)}catch(e){console.error("There was an error fetching the data",e)}};return t?(0,s.jsxs)("div",{children:[(0,s.jsx)(o.Z,{className:"mx-auto",onClick:()=>{console.log("Show Modal triggered"),d(!0),j()},children:"View Spend Report"}),(0,s.jsxs)(_.Z,{visible:c,width:1e3,onOk:()=>{d(!1)},onCancel:()=>{d(!1)},footer:null,children:[(0,s.jsxs)(U.Z,{style:{textAlign:"left"},children:["Key Name: ",i]}),(0,s.jsxs)(L.Z,{children:["Monthly Spend $",r]}),(0,s.jsx)(C.Z,{className:"mt-6 mb-6",children:m&&(0,s.jsx)(F.Z,{className:"mt-6",data:m,colors:["green"],index:"day",categories:["spend"],yAxisWidth:48})}),(0,s.jsx)(U.Z,{className:"mt-6",children:"Top 5 Users Spend (USD)"}),(0,s.jsx)(C.Z,{className:"mb-6",children:u&&(0,s.jsx)(K.Z,{className:"mt-6",data:u,color:"teal"})})]})]}):null},B=e=>{let{userID:t,accessToken:n,data:r,setData:a}=e,[i,c]=(0,l.useState)(!1),[d,h]=(0,l.useState)(!1),[u,x]=(0,l.useState)(null),p=async e=>{null!=r&&(x(e),localStorage.removeItem("userData"+t),h(!0))},j=async()=>{if(null!=u&&null!=r){try{await m(n,u);let e=r.filter(e=>e.token!==u);a(e)}catch(e){console.error("Error deleting the key:",e)}h(!1),x(null)}};if(null!=r)return console.log("RERENDER TRIGGERED"),(0,s.jsxs)(C.Z,{className:"w-full mx-auto flex-auto overflow-y-auto max-h-[50vh] mb-4",children:[(0,s.jsx)(U.Z,{children:"API Keys"}),(0,s.jsxs)(T.Z,{className:"mt-5",children:[(0,s.jsx)(O.Z,{children:(0,s.jsxs)(M.Z,{children:[(0,s.jsx)(R.Z,{children:"Key Alias"}),(0,s.jsx)(R.Z,{children:"Secret Key"}),(0,s.jsx)(R.Z,{children:"Spend (USD)"}),(0,s.jsx)(R.Z,{children:"Key Budget (USD)"}),(0,s.jsx)(R.Z,{children:"Team ID"}),(0,s.jsx)(R.Z,{children:"Metadata"}),(0,s.jsx)(R.Z,{children:"Models"}),(0,s.jsx)(R.Z,{children:"TPM / RPM Limits"}),(0,s.jsx)(R.Z,{children:"Expires"})]})}),(0,s.jsx)(P.Z,{children:r.map(e=>(console.log(e),"litellm-dashboard"===e.team_id)?null:(0,s.jsxs)(M.Z,{children:[(0,s.jsx)(E.Z,{children:null!=e.key_alias?(0,s.jsx)(Z.Z,{children:e.key_alias}):(0,s.jsx)(Z.Z,{children:"Not Set"})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(Z.Z,{children:e.key_name})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(Z.Z,{children:e.spend})}),(0,s.jsx)(E.Z,{children:null!=e.max_budget?(0,s.jsx)(Z.Z,{children:e.max_budget}):(0,s.jsx)(Z.Z,{children:"Unlimited Budget"})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(Z.Z,{children:e.team_id})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(Z.Z,{children:JSON.stringify(e.metadata)})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(Z.Z,{children:JSON.stringify(e.models)})}),(0,s.jsx)(E.Z,{children:(0,s.jsxs)(Z.Z,{children:["TPM Limit: ",e.tpm_limit?e.tpm_limit:"Unlimited"," ",(0,s.jsx)("br",{})," RPM Limit:"," ",e.rpm_limit?e.rpm_limit:"Unlimited"]})}),(0,s.jsx)(E.Z,{children:null!=e.expires?(0,s.jsx)(Z.Z,{children:e.expires}):(0,s.jsx)(Z.Z,{children:"Never expires"})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(D.Z,{onClick:()=>p(e.token),icon:A.Z,size:"sm"})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(z,{token:e.token,accessToken:n,keySpend:e.spend,keyBudget:e.max_budget,keyName:e.key_name})})]},e.token))})]}),d&&(0,s.jsx)("div",{className:"fixed z-10 inset-0 overflow-y-auto",children:(0,s.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,s.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:(0,s.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),(0,s.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),(0,s.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[(0,s.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:(0,s.jsx)("div",{className:"sm:flex sm:items-start",children:(0,s.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[(0,s.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Delete Key"}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this key ?"})})]})})}),(0,s.jsxs)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[(0,s.jsx)(o.Z,{onClick:j,color:"red",className:"ml-2",children:"Delete"}),(0,s.jsx)(o.Z,{onClick:()=>{h(!1),x(null)},children:"Cancel"})]})]})]})})]})},J=e=>{let{userID:t,userSpendData:n,userRole:r,accessToken:a}=e;console.log("User SpendData:",n);let[o,i]=(0,l.useState)(null==n?void 0:n.spend),[c,d]=(0,l.useState)((null==n?void 0:n.max_budget)||null);return(0,l.useEffect)(()=>{(async()=>{if("Admin"===r)try{let e=await g(a,"litellm-proxy-budget");console.log("Result from callSpendUsers:",e);let t=e[0];i(null==t?void 0:t.spend),d((null==t?void 0:t.max_budget)||null)}catch(e){console.error("Failed to get spend for user",e)}})()},[r,a,t]),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(C.Z,{className:"mx-auto mb-4",children:[(0,s.jsxs)(L.Z,{children:["$",o]}),(0,s.jsxs)(U.Z,{children:["/ ",null!==c?"$".concat(c," limit"):"No limit"]})]})})},q=n(37963);console.log("isLocal:",!1);var G=e=>{let{userID:t,userRole:n,setUserRole:a,userEmail:o,setUserEmail:i}=e,[c,d]=(0,l.useState)(null),[m,x]=(0,l.useState)(null),p=(0,r.useSearchParams)();p.get("viewSpend"),(0,r.useRouter)();let j=p.get("token"),[g,Z]=(0,l.useState)(null),[w,k]=(0,l.useState)([]);if((0,l.useEffect)(()=>{if(j){let e=(0,q.o)(j);if(e){if(console.log("Decoded token:",e),console.log("Decoded key:",e.key),Z(e.key),e.user_role){let t=function(e){if(!e)return"Undefined Role";switch(console.log("Received user role: ".concat(e)),e.toLowerCase()){case"app_owner":case"demo_app_owner":return"App Owner";case"app_admin":return"Admin";case"app_user":return"App User";default:return"Unknown Role"}}(e.user_role);console.log("Decoded user_role:",t),a(t)}else console.log("User role not defined");e.user_email?i(e.user_email):console.log("User Email is not set ".concat(e))}}if(t&&g&&n&&!c){let e=localStorage.getItem("userData"+t),s=localStorage.getItem("userSpendData"+t),l=localStorage.getItem("userModels"+t);e&&s&&l?(d(JSON.parse(e)),x(JSON.parse(s)),k(JSON.parse(l))):(async()=>{try{let e=await h(g,t,n);x(e.user_info),d(e.keys),localStorage.setItem("userData"+t,JSON.stringify(e.keys)),localStorage.setItem("userSpendData"+t,JSON.stringify(e.user_info));let s=await u(g,t,n);console.log("model_info:",s);let l=s.data.map(e=>e.model_name);console.log("available_model_names:",l),k(l),console.log("userModels:",w),localStorage.setItem("userModels"+t,JSON.stringify(l))}catch(e){console.error("There was an error fetching the data",e)}})()}},[t,j,g,c,n]),null==t||null==j){let e="/sso/key/generate";return console.log("Full URL:",e),window.location.href=e,null}return null==g?null:(null==n&&a("App Owner"),(0,s.jsx)("div",{children:(0,s.jsx)(f.Z,{numItems:1,className:"gap-0 p-10 h-[75vh] w-full",children:(0,s.jsxs)(y.Z,{numColSpan:1,children:[(0,s.jsx)(J,{userID:t,userSpendData:m,userRole:n,accessToken:g}),(0,s.jsx)(B,{userID:t,accessToken:g,data:c,setData:d}),(0,s.jsx)(I,{userID:t,userRole:n,userModels:w,accessToken:g,data:c,setData:d})]})})}))},$=e=>{let{accessToken:t,token:n,userRole:r,userID:a}=e,[o,i]=(0,l.useState)({data:[]});if((0,l.useEffect)(()=>{if(!t||!n||!r||!a)return;let e=async()=>{try{let e=await u(t,a,r);console.log("Model data response:",e.data),i(e)}catch(e){console.error("There was an error fetching the model data",e)}};t&&n&&r&&a&&e()},[t,n,r,a]),!o)return(0,s.jsx)("div",{children:"Loading..."});for(let e=0;e<o.data.length;e++){var c;let t=o.data[e],n=null==t?void 0:null===(c=t.litellm_params)||void 0===c?void 0:c.model,s=null==t?void 0:t.model_info,l="openai",r="",a="Undefined",i="Undefined",d="Undefined";if(n){let e=n.split("/"),t=e[0];console.log("Provider:",r=1===e.length?l:t)}else console.log("Provider:",r=l);s&&(a=null==s?void 0:s.input_cost_per_token,i=null==s?void 0:s.output_cost_per_token,d=null==s?void 0:s.max_tokens),o.data[e].provider=r,o.data[e].input_cost=a,o.data[e].output_cost=i,o.data[e].max_tokens=d}return(0,s.jsx)("div",{style:{width:"100%"},children:(0,s.jsx)(f.Z,{className:"gap-2 p-10 h-[75vh] w-full",children:(0,s.jsx)(C.Z,{children:(0,s.jsxs)(T.Z,{className:"mt-5",children:[(0,s.jsx)(O.Z,{children:(0,s.jsxs)(M.Z,{children:[(0,s.jsx)(E.Z,{children:(0,s.jsx)(U.Z,{children:"Model Name "})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(U.Z,{children:"Provider"})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(U.Z,{children:"Input Price per token ($)"})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(U.Z,{children:"Output Price per token ($)"})}),(0,s.jsx)(E.Z,{children:(0,s.jsx)(U.Z,{children:"Max Tokens"})})]})}),(0,s.jsx)(P.Z,{children:o.data.map(e=>(0,s.jsxs)(M.Z,{children:[(0,s.jsx)(E.Z,{children:(0,s.jsx)(U.Z,{children:e.model_name})}),(0,s.jsx)(E.Z,{children:e.provider}),(0,s.jsx)(E.Z,{children:e.input_cost}),(0,s.jsx)(E.Z,{children:e.output_cost}),(0,s.jsx)(E.Z,{children:e.max_tokens})]},e.model_name))})]})})})})},V=n(92836),W=n(26734),H=n(41608),Y=n(32126),X=n(23682),Q=n(12968),ee=n(67951);async function et(e,t,n,s){console.log("isLocal:",!1);let l=window.location.origin,r=new Q.ZP.OpenAI({apiKey:s,baseURL:l,dangerouslyAllowBrowser:!0});for await(let s of(await r.chat.completions.create({model:n,stream:!0,messages:[{role:"user",content:e}]})))console.log(s),s.choices[0].delta.content&&t(s.choices[0].delta.content)}var en=e=>{let{accessToken:t,token:n,userRole:r,userID:a}=e,[o,i]=(0,l.useState)(""),[c,d]=(0,l.useState)([]),[m,h]=(0,l.useState)(void 0),[x,p]=(0,l.useState)(null);(0,l.useEffect)(()=>{t&&n&&r&&a&&(async()=>{let e=await u(t,a,r);console.log("model_info:",e),(null==e?void 0:e.data.length)>0&&(p(e),h(e.data[0].model_name))})()},[t,a,r]);let j=(e,t)=>{d(n=>{let s=n[n.length-1];return s&&s.role===e?[...n.slice(0,n.length-1),{role:e,content:s.content+t}]:[...n,{role:e,content:t}]})},g=async()=>{if(""!==o.trim()&&t&&n&&r&&a){d(e=>[...e,{role:"user",content:o}]);try{m&&await et(o,e=>j("assistant",e),m,t)}catch(e){console.error("Error fetching model response",e),j("assistant","Error fetching model response")}i("")}};return(0,s.jsx)("div",{style:{width:"100%",position:"relative"},children:(0,s.jsx)(f.Z,{className:"gap-2 p-10 h-[75vh] w-full",children:(0,s.jsx)(C.Z,{children:(0,s.jsxs)(W.Z,{children:[(0,s.jsxs)(H.Z,{className:"mt-4",children:[(0,s.jsx)(V.Z,{children:"Chat"}),(0,s.jsx)(V.Z,{children:"API Reference"})]}),(0,s.jsxs)(X.Z,{children:[(0,s.jsxs)(Y.Z,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{children:"Select Model:"}),(0,s.jsx)("select",{value:m||"",onChange:e=>h(e.target.value),children:null==x?void 0:x.data.map(e=>(0,s.jsx)("option",{value:e.model_name,children:e.model_name},e.model_name))})]}),(0,s.jsxs)(T.Z,{className:"mt-5",style:{display:"block",maxHeight:"60vh",overflowY:"auto"},children:[(0,s.jsx)(O.Z,{children:(0,s.jsx)(M.Z,{children:(0,s.jsx)(E.Z,{children:(0,s.jsx)(U.Z,{children:"Chat"})})})}),(0,s.jsx)(P.Z,{children:c.map((e,t)=>(0,s.jsx)(M.Z,{children:(0,s.jsx)(E.Z,{children:"".concat(e.role,": ").concat(e.content)})},t))})]}),(0,s.jsx)("div",{className:"mt-3",style:{position:"absolute",bottom:5,width:"95%"},children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("input",{type:"text",value:o,onChange:e=>i(e.target.value),className:"flex-1 p-2 border rounded-md mr-2",placeholder:"Type your message..."}),(0,s.jsx)("button",{onClick:g,className:"p-2 bg-blue-500 text-white rounded-md",children:"Send"})]})})]}),(0,s.jsx)(Y.Z,{children:(0,s.jsxs)(W.Z,{children:[(0,s.jsxs)(H.Z,{children:[(0,s.jsx)(V.Z,{children:"OpenAI Python SDK"}),(0,s.jsx)(V.Z,{children:"LlamaIndex"}),(0,s.jsx)(V.Z,{children:"Langchain Py"})]}),(0,s.jsxs)(X.Z,{children:[(0,s.jsx)(Y.Z,{children:(0,s.jsx)(ee.Z,{language:"python",children:'\nimport openai\nclient = openai.OpenAI(\n    api_key="your_api_key",\n    base_url="http://0.0.0.0:4000" # proxy base url\n)\n\nresponse = client.chat.completions.create(\n    model="gpt-3.5-turbo", # model to use from Models Tab\n    messages = [\n        {\n            "role": "user",\n            "content": "this is a test request, write a short poem"\n        }\n    ],\n    extra_body={\n        "metadata": {\n            "generation_name": "ishaan-generation-openai-client",\n            "generation_id": "openai-client-gen-id22",\n            "trace_id": "openai-client-trace-id22",\n            "trace_user_id": "openai-client-user-id2"\n        }\n    }\n)\n\nprint(response)\n            '})}),(0,s.jsx)(Y.Z,{children:(0,s.jsx)(ee.Z,{language:"python",children:'\nimport os, dotenv\n\nfrom llama_index.llms import AzureOpenAI\nfrom llama_index.embeddings import AzureOpenAIEmbedding\nfrom llama_index import VectorStoreIndex, SimpleDirectoryReader, ServiceContext\n\nllm = AzureOpenAI(\n    engine="azure-gpt-3.5",               # model_name on litellm proxy\n    temperature=0.0,\n    azure_endpoint="http://0.0.0.0:4000", # litellm proxy endpoint\n    api_key="sk-1234",                    # litellm proxy API Key\n    api_version="2023-07-01-preview",\n)\n\nembed_model = AzureOpenAIEmbedding(\n    deployment_name="azure-embedding-model",\n    azure_endpoint="http://0.0.0.0:4000",\n    api_key="sk-1234",\n    api_version="2023-07-01-preview",\n)\n\n\ndocuments = SimpleDirectoryReader("llama_index_data").load_data()\nservice_context = ServiceContext.from_defaults(llm=llm, embed_model=embed_model)\nindex = VectorStoreIndex.from_documents(documents, service_context=service_context)\n\nquery_engine = index.as_query_engine()\nresponse = query_engine.query("What did the author do growing up?")\nprint(response)\n\n            '})}),(0,s.jsx)(Y.Z,{children:(0,s.jsx)(ee.Z,{language:"python",children:'\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.prompts.chat import (\n    ChatPromptTemplate,\n    HumanMessagePromptTemplate,\n    SystemMessagePromptTemplate,\n)\nfrom langchain.schema import HumanMessage, SystemMessage\n\nchat = ChatOpenAI(\n    openai_api_base="http://0.0.0.0:8000",\n    model = "gpt-3.5-turbo",\n    temperature=0.1,\n    extra_body={\n        "metadata": {\n            "generation_name": "ishaan-generation-langchain-client",\n            "generation_id": "langchain-client-gen-id22",\n            "trace_id": "langchain-client-trace-id22",\n            "trace_user_id": "langchain-client-user-id2"\n        }\n    }\n)\n\nmessages = [\n    SystemMessage(\n        content="You are a helpful assistant that im using to make a test request to."\n    ),\n    HumanMessage(\n        content="test from litellm. tell me why it\'s amazing in 1 sentence"\n    ),\n]\nresponse = chat(messages)\n\nprint(response)\n\n            '})})]})]})})]})]})})})})},es=n(33509),el=n(30569);let{Sider:er}=es.default;var ea=e=>{let{setPage:t}=e;return(0,s.jsx)(es.default,{style:{minHeight:"100vh",maxWidth:"120px"},children:(0,s.jsx)(er,{width:120,children:(0,s.jsxs)(el.Z,{mode:"inline",defaultSelectedKeys:["1"],style:{height:"100%",borderRight:0},children:[(0,s.jsx)(el.Z.Item,{onClick:()=>t("api-keys"),children:"API Keys"},"1"),(0,s.jsx)(el.Z.Item,{onClick:()=>t("models"),children:"Models"},"2"),(0,s.jsx)(el.Z.Item,{onClick:()=>t("llm-playground"),children:"Chat UI"},"3"),(0,s.jsx)(el.Z.Item,{onClick:()=>t("usage"),children:"Usage"},"4")]})})})};let eo=e=>{let{payload:t,active:n}=e;if(!n||!t)return null;let l=t[0].payload,r=l.startTime,a=Object.entries(l.models).map(e=>{let[t,n]=e;return[t,n]});a.sort((e,t)=>t[1]-e[1]);let o=a.slice(0,5);return(0,s.jsxs)("div",{className:"w-56 rounded-tremor-default border border-tremor-border bg-tremor-background p-2 text-tremor-default shadow-tremor-dropdown",children:[r,o.map(e=>{let[t,n]=e;return(0,s.jsx)("div",{className:"flex flex-1 space-x-10",children:(0,s.jsx)("div",{className:"p-2",children:(0,s.jsxs)("p",{className:"text-tremor-content text-xs",children:[t,":",(0,s.jsxs)("span",{className:"text-xs text-tremor-content-emphasis",children:[" ",n?n<.01?"<$0.01":n.toFixed(2):""]})]})})},t)})]})};var ei=e=>{let{accessToken:t,token:n,userRole:r,userID:a}=e,o=new Date,[i,c]=(0,l.useState)([]),[d,m]=(0,l.useState)([]),[h,u]=(0,l.useState)([]),x=new Date(o.getFullYear(),o.getMonth(),1),g=new Date(o.getFullYear(),o.getMonth()+1,0),Z=k(x),w=k(g);function k(e){let t=e.getFullYear(),n=e.getMonth()+1,s=e.getDate();return"".concat(t,"-").concat(n<10?"0"+n:n,"-").concat(s<10?"0"+s:s)}return console.log("Start date is ".concat(Z)),console.log("End date is ".concat(w)),(0,l.useEffect)(()=>{t&&n&&r&&a&&(async()=>{try{await p(t,n,r,a,Z,w).then(async e=>{let n=(await j(t,function(e){let t=[];e.forEach(e=>{Object.entries(e).forEach(e=>{let[n,s]=e;"spend"!==n&&"startTime"!==n&&"models"!==n&&"users"!==n&&t.push({key:n,spend:s})})}),t.sort((e,t)=>Number(t.spend)-Number(e.spend));let n=t.slice(0,5).map(e=>e.key);return console.log("topKeys: ".concat(Object.keys(n[0]))),n}(e))).info.map(e=>({key:(e.key_name||e.key_alias||e.token).substring(0,7),spend:e.spend}));m(n),u(function(e){let t={};e.forEach(e=>{Object.entries(e.users).forEach(e=>{let[n,s]=e;""!==n&&null!=n&&"None"!=n&&(t[n]||(t[n]=0),t[n]+=s)})});let n=Object.entries(t).map(e=>{let[t,n]=e;return{user_id:t,spend:n}});n.sort((e,t)=>t.spend-e.spend);let s=n.slice(0,5);return console.log("topKeys: ".concat(Object.values(s[0]))),s}(e)),c(e)})}catch(e){console.error("There was an error fetching the data",e)}})()},[t,n,r,a,Z,w]),(0,s.jsx)("div",{style:{width:"100%"},children:(0,s.jsxs)(f.Z,{numItems:2,className:"gap-2 p-10 h-[75vh] w-full",children:[(0,s.jsx)(y.Z,{numColSpan:2,children:(0,s.jsxs)(C.Z,{children:[(0,s.jsx)(U.Z,{children:"Monthly Spend"}),(0,s.jsx)(F.Z,{data:i,index:"startTime",categories:["spend"],colors:["blue"],valueFormatter:e=>"$ ".concat(new Intl.NumberFormat("us").format(e).toString()),yAxisWidth:100,tickGap:5,customTooltip:eo})]})}),(0,s.jsx)(y.Z,{numColSpan:1,children:(0,s.jsxs)(C.Z,{children:[(0,s.jsx)(U.Z,{children:"Top API Keys"}),(0,s.jsx)(F.Z,{className:"mt-4 h-40",data:d,index:"key",categories:["spend"],colors:["blue"],yAxisWidth:80,tickGap:5,layout:"vertical",showXAxis:!1,showLegend:!1})]})}),(0,s.jsx)(y.Z,{numColSpan:1,children:(0,s.jsxs)(C.Z,{children:[(0,s.jsx)(U.Z,{children:"Top Users"}),(0,s.jsx)(F.Z,{className:"mt-4 h-40",data:h,index:"user_id",categories:["spend"],colors:["blue"],yAxisWidth:200,layout:"vertical",showXAxis:!1,showLegend:!1})]})})]})})},ec=()=>{let[e,t]=(0,l.useState)(null),[n,a]=(0,l.useState)(null),o=(0,r.useSearchParams)(),c=o.get("userID"),d=o.get("token"),[m,h]=(0,l.useState)("api-keys"),[u,x]=(0,l.useState)(null);return(0,l.useEffect)(()=>{if(d){let e=(0,q.o)(d);if(e){if(console.log("Decoded token:",e),console.log("Decoded key:",e.key),x(e.key),e.user_role){let n=function(e){if(!e)return"Undefined Role";switch(console.log("Received user role: ".concat(e)),e.toLowerCase()){case"app_owner":case"demo_app_owner":return"App Owner";case"app_admin":return"Admin";case"app_user":return"App User";default:return"Unknown Role"}}(e.user_role);console.log("Decoded user_role:",n),t(n)}else console.log("User role not defined");e.user_email?a(e.user_email):console.log("User Email is not set ".concat(e))}}},[d]),(0,s.jsx)(l.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading..."}),children:(0,s.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,s.jsx)(i,{userID:c,userRole:e,userEmail:n}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-auto",children:[(0,s.jsx)(ea,{setPage:h}),"api-keys"==m?(0,s.jsx)(G,{userID:c,userRole:e,setUserRole:t,userEmail:n,setUserEmail:a}):"models"==m?(0,s.jsx)($,{userID:c,userRole:e,token:d,accessToken:u}):"llm-playground"==m?(0,s.jsx)(en,{userID:c,userRole:e,token:d,accessToken:u}):(0,s.jsx)(ei,{userID:c,userRole:e,token:d,accessToken:u})]})]})})}}},function(e){e.O(0,[145,971,69,744],function(){return e(e.s=20661)}),_N_E=e.O()}]);