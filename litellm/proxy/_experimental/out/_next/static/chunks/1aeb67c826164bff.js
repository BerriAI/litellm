(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,418371,e=>{"use strict";var t=e.i(843476),s=e.i(271645),a=e.i(916925);e.s(["ProviderLogo",0,({provider:e,className:r="w-4 h-4"})=>{let[l,i]=(0,s.useState)(!1),{logo:n}=(0,a.getProviderLogoAndName)(e);return l||!n?(0,t.jsx)("div",{className:`${r} rounded-full bg-gray-200 flex items-center justify-center text-xs`,children:e?.charAt(0)||"-"}):(0,t.jsx)("img",{src:n,alt:`${e} logo`,className:r,onError:()=>i(!0)})}])},149121,e=>{"use strict";var t=e.i(843476),s=e.i(271645),a=e.i(152990),r=e.i(682830),l=e.i(269200),i=e.i(427612),n=e.i(64848),o=e.i(942232),c=e.i(496020),d=e.i(977572);function m({data:e=[],columns:m,onRowClick:u,renderSubComponent:x,renderChildRows:h,getRowCanExpand:p,isLoading:f=!1,loadingMessage:g="ðŸš… Loading logs...",noDataMessage:_="No logs found"}){let j=!!(x||h)&&!!p,y=(0,a.useReactTable)({data:e,columns:m,...j&&{getRowCanExpand:p},getRowId:(e,t)=>e?.request_id??String(t),getCoreRowModel:(0,r.getCoreRowModel)(),...j&&{getExpandedRowModel:(0,r.getExpandedRowModel)()}});return(0,t.jsx)("div",{className:"rounded-lg custom-border overflow-x-auto w-full max-w-full box-border",children:(0,t.jsxs)(l.Table,{className:"[&_td]:py-0.5 [&_th]:py-1 table-fixed w-full box-border",style:{minWidth:"400px"},children:[(0,t.jsx)(i.TableHead,{children:y.getHeaderGroups().map(e=>(0,t.jsx)(c.TableRow,{children:e.headers.map(e=>(0,t.jsx)(n.TableHeaderCell,{className:"py-1 h-8",children:e.isPlaceholder?null:(0,a.flexRender)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,t.jsx)(o.TableBody,{children:f?(0,t.jsx)(c.TableRow,{children:(0,t.jsx)(d.TableCell,{colSpan:m.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:g})})})}):y.getRowModel().rows.length>0?y.getRowModel().rows.map(e=>(0,t.jsxs)(s.Fragment,{children:[(0,t.jsx)(c.TableRow,{className:`h-8 ${u?"cursor-pointer hover:bg-gray-50":""}`,onClick:()=>u?.(e.original),children:e.getVisibleCells().map(e=>(0,t.jsx)(d.TableCell,{className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap",children:(0,a.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))}),j&&e.getIsExpanded()&&h&&h({row:e}),j&&e.getIsExpanded()&&x&&!h&&(0,t.jsx)(c.TableRow,{children:(0,t.jsx)(d.TableCell,{colSpan:e.getVisibleCells().length,className:"p-0",children:(0,t.jsx)("div",{className:"w-full max-w-full overflow-hidden box-border",children:x({row:e})})})})]},e.id)):(0,t.jsx)(c.TableRow,{children:(0,t.jsx)(d.TableCell,{colSpan:m.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:_})})})})})]})})}e.s(["DataTable",()=>m])},37091,e=>{"use strict";var t=e.i(290571),s=e.i(95779),a=e.i(444755),r=e.i(673706),l=e.i(271645);let i=l.default.forwardRef((e,i)=>{let{color:n,children:o,className:c}=e,d=(0,t.__rest)(e,["color","children","className"]);return l.default.createElement("p",Object.assign({ref:i,className:(0,a.tremorTwMerge)(n?(0,r.getColorClassNames)(n,s.colorPalette.lightText).textColor:"text-tremor-content-emphasis dark:text-dark-tremor-content-emphasis",c)},d),o)});i.displayName="Subtitle",e.s(["Subtitle",()=>i],37091)},797305,289793,497650,e=>{"use strict";var t=e.i(843476),s=e.i(827252),a=e.i(56456),r=e.i(771674),l=e.i(584935),i=e.i(304967),n=e.i(309426),o=e.i(350967),c=e.i(197647),d=e.i(653824),m=e.i(881073),u=e.i(404206),x=e.i(723731),h=e.i(599724),p=e.i(629569),f=e.i(560445),g=e.i(560025),_=e.i(199133),j=e.i(592968),y=e.i(898586),b=e.i(152473),k=e.i(271645),v=e.i(764205),N=e.i(266027),T=e.i(243652),C=e.i(708347),w=e.i(135214);let q=(0,T.createQueryKeys)("agents"),S=()=>{let{accessToken:e,userRole:t}=(0,w.default)();return(0,N.useQuery)({queryKey:q.list({}),queryFn:async()=>await (0,v.getAgentsList)(e),enabled:!!e&&C.all_admin_roles.includes(t||"")})};e.s(["useAgents",0,S],289793);let L=(0,T.createQueryKeys)("customers");var D=e.i(738014),A=e.i(621482);let E=(0,T.createQueryKeys)("infiniteUsers"),O=50;var M=e.i(500330),F=e.i(994388),$=e.i(980187),R=e.i(476961),U=e.i(362024);let V={blue:"#3b82f6",cyan:"#06b6d4",indigo:"#6366f1",green:"#22c55e",red:"#ef4444",purple:"#8b5cf6",emerald:"#37bc7d"},P=({active:e,payload:s,label:a})=>e&&s&&s.length?(0,t.jsxs)("div",{className:"w-56 rounded-tremor-default border border-tremor-border bg-tremor-background p-2 text-tremor-default shadow-tremor-dropdown",children:[(0,t.jsx)("p",{className:"text-tremor-content-strong",children:a}),s.map(e=>{let s=e.dataKey?.toString();if(!s||!e.payload)return null;let a=((e,t)=>{let s=t.substring(t.indexOf(".")+1);if(e.metrics&&s in e.metrics)return e.metrics[s]})(e.payload,s),r=s.includes("spend"),l=void 0!==a?r?`$${a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`:a.toLocaleString():"N/A",i=V[e.color]||e.color;return(0,t.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"h-2 w-2 shrink-0 rounded-full ring-2 ring-white drop-shadow-md",style:{backgroundColor:i}}),(0,t.jsx)("p",{className:"font-medium text-tremor-content dark:text-dark-tremor-content",children:s.replace("metrics.","").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]}),(0,t.jsx)("p",{className:"font-medium text-tremor-content-emphasis dark:text-dark-tremor-content-emphasis",children:l})]},s)})]}):null,z=({categories:e,colors:s})=>(0,t.jsx)("div",{className:"flex items-center justify-end space-x-4",children:e.map((e,a)=>{let r=V[s[a]]||s[a];return(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"h-2 w-2 shrink-0 rounded-full ring-4 ring-white",style:{backgroundColor:r}}),(0,t.jsx)("p",{className:"text-sm text-tremor-content dark:text-dark-tremor-content",children:e.replace("metrics.","").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]},e)})});var I=e.i(291542);let W=[{title:"Model",dataIndex:"model",key:"model",render:e=>e||"-"},{title:"Spend (USD)",dataIndex:"spend",key:"spend",render:e=>`$${(0,M.formatNumberWithCommas)(e,2)}`},{title:"Successful",dataIndex:"successful_requests",key:"successful_requests",render:e=>(0,t.jsx)("span",{className:"text-green-600",children:e?.toLocaleString()||0})},{title:"Failed",dataIndex:"failed_requests",key:"failed_requests",render:e=>(0,t.jsx)("span",{className:"text-red-600",children:e?.toLocaleString()||0})},{title:"Tokens",dataIndex:"tokens",key:"tokens",render:e=>e?.toLocaleString()||0}],B=({topModels:e})=>{let[s,a]=(0,k.useState)("table");return 0===e.length?null:(0,t.jsxs)(i.Card,{className:"mt-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsx)(p.Title,{children:"Model Usage"}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>a("table"),className:`px-3 py-1 text-sm rounded-md ${"table"===s?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Table"}),(0,t.jsx)("button",{onClick:()=>a("chart"),className:`px-3 py-1 text-sm rounded-md ${"chart"===s?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Chart"})]})]}),"chart"===s?(0,t.jsx)("div",{className:"max-h-[234px] overflow-y-auto",children:(0,t.jsx)(l.BarChart,{style:{height:40*e.length},data:e.map(e=>({key:e.model,spend:e.spend})),index:"key",categories:["spend"],colors:["cyan"],valueFormatter:e=>`$${(0,M.formatNumberWithCommas)(e,2)}`,layout:"vertical",yAxisWidth:180,tickGap:5,showLegend:!1})}):(0,t.jsx)(I.Table,{columns:W,dataSource:e,rowKey:"model",size:"small",pagination:!1,scroll:e.length>5?{y:195}:void 0})]})};function H(e){return e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?e/1e3+"k":e.toString()}function Y(e){return 0===e?"$0":e>=1e6?"$"+e/1e6+"M":e>=1e3?"$"+e/1e3+"k":"$"+e}let K=({modelName:e,metrics:s,hidePromptCachingMetrics:a=!1})=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(o.Grid,{numItems:4,className:"gap-4",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(h.Text,{children:"Total Requests"}),(0,t.jsx)(p.Title,{children:s.total_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(h.Text,{children:"Total Successful Requests"}),(0,t.jsx)(p.Title,{children:s.total_successful_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(h.Text,{children:"Total Tokens"}),(0,t.jsx)(p.Title,{children:s.total_tokens.toLocaleString()}),(0,t.jsxs)(h.Text,{children:[Math.round(s.total_tokens/s.total_successful_requests)," avg per successful request"]})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(h.Text,{children:"Total Spend"}),(0,t.jsxs)(p.Title,{children:["$",(0,M.formatNumberWithCommas)(s.total_spend,2)]}),(0,t.jsxs)(h.Text,{children:["$",(0,M.formatNumberWithCommas)(s.total_spend/s.total_successful_requests,3)," per successful request"]})]})]}),s.top_api_keys&&s.top_api_keys.length>0&&(0,t.jsxs)(i.Card,{className:"mt-4",children:[(0,t.jsx)(p.Title,{children:"Top Virtual Keys by Spend"}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)("div",{className:"grid grid-cols-1 gap-2",children:s.top_api_keys.map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"font-medium",children:e.key_alias||`${e.api_key.substring(0,10)}...`}),e.team_id&&(0,t.jsxs)(h.Text,{className:"text-xs text-gray-500",children:["Team: ",e.team_id]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)(h.Text,{className:"font-medium",children:["$",(0,M.formatNumberWithCommas)(e.spend,2)]}),(0,t.jsxs)(h.Text,{className:"text-xs text-gray-500",children:[e.requests.toLocaleString()," requests | ",e.tokens.toLocaleString()," tokens"]})]})]},e.api_key))})})]}),s.top_models&&s.top_models.length>0&&(0,t.jsx)(B,{topModels:s.top_models}),(0,t.jsxs)(i.Card,{className:"mt-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(p.Title,{children:"Spend per day"}),(0,t.jsx)(z,{categories:["metrics.spend"],colors:["green"]})]}),(0,t.jsx)(l.BarChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.spend"],colors:["green"],valueFormatter:e=>`$${(0,M.formatNumberWithCommas)(e,2,!0)}`,yAxisWidth:72})]}),(0,t.jsxs)(o.Grid,{numItems:2,className:"gap-4 mt-4",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(p.Title,{children:"Total Tokens"}),(0,t.jsx)(z,{categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"]})]}),(0,t.jsx)(R.AreaChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"],valueFormatter:H,customTooltip:P,showLegend:!1})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(p.Title,{children:"Requests per day"}),(0,t.jsx)(z,{categories:["metrics.api_requests"],colors:["blue"]})]}),(0,t.jsx)(l.BarChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.api_requests"],colors:["blue"],valueFormatter:H,customTooltip:P,showLegend:!1})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(p.Title,{children:"Success vs Failed Requests"}),(0,t.jsx)(z,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"]})]}),(0,t.jsx)(R.AreaChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"],valueFormatter:H,customTooltip:P,showLegend:!1})]}),!a&&(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(p.Title,{children:"Prompt Caching Metrics"}),(0,t.jsx)(z,{categories:["metrics.cache_read_input_tokens","metrics.cache_creation_input_tokens"],colors:["cyan","purple"]})]}),(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsxs)(h.Text,{children:["Cache Read: ",s.total_cache_read_input_tokens?.toLocaleString()||0," tokens"]}),(0,t.jsxs)(h.Text,{children:["Cache Creation: ",s.total_cache_creation_input_tokens?.toLocaleString()||0," tokens"]})]}),(0,t.jsx)(R.AreaChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.cache_read_input_tokens","metrics.cache_creation_input_tokens"],colors:["cyan","purple"],valueFormatter:H,customTooltip:P,showLegend:!1})]})]})]}),G=({modelMetrics:e,hidePromptCachingMetrics:s=!1})=>{let a=Object.keys(e).sort((t,s)=>""===t?1:""===s?-1:e[s].total_spend-e[t].total_spend),r={total_requests:0,total_successful_requests:0,total_tokens:0,total_spend:0,total_cache_read_input_tokens:0,total_cache_creation_input_tokens:0,daily_data:{}};Object.values(e).forEach(e=>{r.total_requests+=e.total_requests,r.total_successful_requests+=e.total_successful_requests,r.total_tokens+=e.total_tokens,r.total_spend+=e.total_spend,r.total_cache_read_input_tokens+=e.total_cache_read_input_tokens||0,r.total_cache_creation_input_tokens+=e.total_cache_creation_input_tokens||0,e.daily_data.forEach(e=>{r.daily_data[e.date]||(r.daily_data[e.date]={prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,spend:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0}),r.daily_data[e.date].prompt_tokens+=e.metrics.prompt_tokens,r.daily_data[e.date].completion_tokens+=e.metrics.completion_tokens,r.daily_data[e.date].total_tokens+=e.metrics.total_tokens,r.daily_data[e.date].api_requests+=e.metrics.api_requests,r.daily_data[e.date].spend+=e.metrics.spend,r.daily_data[e.date].successful_requests+=e.metrics.successful_requests,r.daily_data[e.date].failed_requests+=e.metrics.failed_requests,r.daily_data[e.date].cache_read_input_tokens+=e.metrics.cache_read_input_tokens||0,r.daily_data[e.date].cache_creation_input_tokens+=e.metrics.cache_creation_input_tokens||0})});let l=Object.entries(r.daily_data).map(([e,t])=>({date:e,metrics:t})).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)(p.Title,{children:"Overall Usage"}),(0,t.jsxs)(o.Grid,{numItems:4,className:"gap-4 mb-4",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(h.Text,{children:"Total Requests"}),(0,t.jsx)(p.Title,{children:r.total_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(h.Text,{children:"Total Successful Requests"}),(0,t.jsx)(p.Title,{children:r.total_successful_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(h.Text,{children:"Total Tokens"}),(0,t.jsx)(p.Title,{children:r.total_tokens.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(h.Text,{children:"Total Spend"}),(0,t.jsxs)(p.Title,{children:["$",(0,M.formatNumberWithCommas)(r.total_spend,2)]})]})]}),(0,t.jsxs)(o.Grid,{numItems:2,className:"gap-4",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(p.Title,{children:"Total Tokens Over Time"}),(0,t.jsx)(z,{categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"]})]}),(0,t.jsx)(R.AreaChart,{className:"mt-4",data:l,index:"date",categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"],valueFormatter:H,customTooltip:P,showLegend:!1})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(p.Title,{children:"Total Requests Over Time"}),(0,t.jsx)(z,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["emerald","red"]})]}),(0,t.jsx)(R.AreaChart,{className:"mt-4",data:l,index:"date",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["emerald","red"],valueFormatter:e=>e.toLocaleString(),customTooltip:P,showLegend:!1})]})]})]}),(0,t.jsx)(U.Collapse,{defaultActiveKey:a[0],children:a.map(a=>(0,t.jsx)(U.Collapse.Panel,{header:(0,t.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,t.jsx)(p.Title,{children:e[a].label||"Unknown Item"}),(0,t.jsxs)("div",{className:"flex space-x-4 text-sm text-gray-500",children:[(0,t.jsxs)("span",{children:["$",(0,M.formatNumberWithCommas)(e[a].total_spend,2)]}),(0,t.jsxs)("span",{children:[e[a].total_requests.toLocaleString()," requests"]})]})]}),children:(0,t.jsx)(K,{modelName:a||"Unknown Model",metrics:e[a],hidePromptCachingMetrics:s})},a))})]})},Z=(e,t,s=[])=>{let a={};return e.results.forEach(e=>{Object.entries(e.breakdown[t]||{}).forEach(([r,l])=>{a[r]||(a[r]={label:"api_keys"===t?((e,t,s)=>{let a=e.metadata.key_alias||`key-hash-${t}`,r=e.metadata.team_id;if(r){let e=(0,$.resolveTeamAliasFromTeamID)(r,s);return e?`${a} (team: ${e})`:`${a} (team_id: ${r})`}return a})(l,r,s):r,total_requests:0,total_successful_requests:0,total_failed_requests:0,total_tokens:0,prompt_tokens:0,completion_tokens:0,total_spend:0,total_cache_read_input_tokens:0,total_cache_creation_input_tokens:0,top_api_keys:[],top_models:[],daily_data:[]}),a[r].total_requests+=l.metrics.api_requests,a[r].prompt_tokens+=l.metrics.prompt_tokens,a[r].completion_tokens+=l.metrics.completion_tokens,a[r].total_tokens+=l.metrics.total_tokens,a[r].total_spend+=l.metrics.spend,a[r].total_successful_requests+=l.metrics.successful_requests,a[r].total_failed_requests+=l.metrics.failed_requests,a[r].total_cache_read_input_tokens+=l.metrics.cache_read_input_tokens||0,a[r].total_cache_creation_input_tokens+=l.metrics.cache_creation_input_tokens||0,a[r].daily_data.push({date:e.date,metrics:{prompt_tokens:l.metrics.prompt_tokens,completion_tokens:l.metrics.completion_tokens,total_tokens:l.metrics.total_tokens,api_requests:l.metrics.api_requests,spend:l.metrics.spend,successful_requests:l.metrics.successful_requests,failed_requests:l.metrics.failed_requests,cache_read_input_tokens:l.metrics.cache_read_input_tokens||0,cache_creation_input_tokens:l.metrics.cache_creation_input_tokens||0}})})}),"api_keys"!==t&&Object.entries(a).forEach(([s,r])=>{let l={};e.results.forEach(e=>{let a=e.breakdown[t]?.[s];a&&"api_key_breakdown"in a&&Object.entries(a.api_key_breakdown||{}).forEach(([e,t])=>{l[e]||(l[e]={api_key:e,key_alias:t.metadata.key_alias,team_id:t.metadata.team_id,spend:0,requests:0,tokens:0}),l[e].spend+=t.metrics.spend,l[e].requests+=t.metrics.api_requests,l[e].tokens+=t.metrics.total_tokens})}),a[s].top_api_keys=Object.values(l).sort((e,t)=>t.spend-e.spend).slice(0,5)}),"api_keys"===t&&Object.entries(a).forEach(([t,s])=>{let r={};e.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(([e,s])=>{if(s&&"api_key_breakdown"in s){let a=s.api_key_breakdown?.[t];a&&(r[e]||(r[e]={model:e,spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0}),r[e].spend+=a.metrics.spend,r[e].requests+=a.metrics.api_requests,r[e].successful_requests+=a.metrics.successful_requests||0,r[e].failed_requests+=a.metrics.failed_requests||0,r[e].tokens+=a.metrics.total_tokens)}})}),a[t].top_models=Object.values(r).sort((e,t)=>t.spend-e.spend)}),Object.values(a).forEach(e=>{e.daily_data.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())}),a};var J=e.i(366283),Q=e.i(779241),X=e.i(212931),ee=e.i(808613),et=e.i(482725),es=e.i(727749);let ea=({isOpen:e,onClose:s,accessToken:a})=>{let[r]=ee.Form.useForm(),[l,i]=(0,k.useState)(!1),[n,o]=(0,k.useState)(null),[c,d]=(0,k.useState)(!1),[m,u]=(0,k.useState)("cloudzero"),[x,p]=(0,k.useState)(!1);(0,k.useEffect)(()=>{e&&a&&f()},[e,a]);let f=async()=>{d(!0);try{let e=await fetch("/cloudzero/settings",{method:"GET",headers:{[(0,v.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"}});if(e.ok){let t=await e.json();o(t),r.setFieldsValue({connection_id:t.connection_id})}else if(404!==e.status){let t=await e.json();es.default.fromBackend(`Failed to load existing settings: ${t.error||"Unknown error"}`)}}catch(e){console.error("Error loading CloudZero settings:",e),es.default.fromBackend("Failed to load existing settings")}finally{d(!1)}},g=async e=>{if(!a)return void es.default.fromBackend("No access token available");i(!0);try{let t=n?"/cloudzero/settings":"/cloudzero/init",s=n?"PUT":"POST",r={...e,timezone:"UTC"},l=await fetch(t,{method:s,headers:{[(0,v.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(r)}),i=await l.json();if(l.ok)return es.default.success(i.message||"CloudZero settings saved successfully"),o({api_key_masked:e.api_key.substring(0,4)+"****"+e.api_key.slice(-4),connection_id:e.connection_id,status:"configured"}),!0;return es.default.fromBackend(i.error||"Failed to save CloudZero settings"),!1}catch(e){return console.error("Error saving CloudZero settings:",e),es.default.fromBackend("Failed to save CloudZero settings"),!1}finally{i(!1)}},j=async()=>{if(!a)return void es.default.fromBackend("No access token available");p(!0);try{let e=await fetch("/cloudzero/export",{method:"POST",headers:{[(0,v.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({limit:1e5,operation:"replace_hourly"})}),t=await e.json();e.ok?(es.default.success(t.message||"Export to CloudZero completed successfully"),s()):es.default.fromBackend(t.error||"Failed to export to CloudZero")}catch(e){console.error("Error exporting to CloudZero:",e),es.default.fromBackend("Failed to export to CloudZero")}finally{p(!1)}},y=async()=>{p(!0);try{es.default.info("CSV export functionality coming soon!"),s()}catch(e){console.error("Error exporting CSV:",e),es.default.fromBackend("Failed to export CSV")}finally{p(!1)}},b=async()=>{if("cloudzero"===m){if(!n){let e=await r.validateFields();if(!await g(e))return}await j()}else await y()},N=()=>{r.resetFields(),u("cloudzero"),o(null),s()},T=[{value:"cloudzero",label:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("img",{src:"/cloudzero.png",alt:"CloudZero",className:"w-5 h-5",onError:e=>{e.target.style.display="none"}}),(0,t.jsx)("span",{children:"Export to CloudZero"})]})},{value:"csv",label:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsx)("span",{children:"Export to CSV"})]})}];return(0,t.jsx)(X.Modal,{title:"Export Data",open:e,onCancel:N,footer:null,width:600,destroyOnHidden:!0,children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"font-medium mb-2 block",children:"Export Destination"}),(0,t.jsx)(_.Select,{value:m,onChange:u,options:T,className:"w-full",size:"large"})]}),"cloudzero"===m&&(0,t.jsx)("div",{children:c?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)(et.Spin,{size:"large"})}):(0,t.jsxs)(t.Fragment,{children:[n&&(0,t.jsx)(J.Callout,{title:"Existing CloudZero Configuration",icon:()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"green",className:"mb-4",children:(0,t.jsxs)(h.Text,{children:["API Key: ",n.api_key_masked,(0,t.jsx)("br",{}),"Connection ID: ",n.connection_id]})}),!n&&(0,t.jsxs)(ee.Form,{form:r,layout:"vertical",children:[(0,t.jsx)(ee.Form.Item,{label:"CloudZero API Key",name:"api_key",rules:[{required:!0,message:"Please enter your CloudZero API key"}],children:(0,t.jsx)(Q.TextInput,{type:"password",placeholder:"Enter your CloudZero API key"})}),(0,t.jsx)(ee.Form.Item,{label:"Connection ID",name:"connection_id",rules:[{required:!0,message:"Please enter the CloudZero connection ID"}],children:(0,t.jsx)(Q.TextInput,{placeholder:"Enter CloudZero connection ID"})})]})]})}),"csv"===m&&(0,t.jsx)(J.Callout,{title:"CSV Export",icon:()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),color:"blue",children:(0,t.jsx)(h.Text,{children:"Export your usage data as a CSV file for analysis in spreadsheet applications."})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,t.jsx)(F.Button,{variant:"secondary",onClick:N,children:"Cancel"}),(0,t.jsx)(F.Button,{onClick:b,loading:l||x,disabled:l||x,children:"cloudzero"===m?"Export to CloudZero":"Export CSV"})]})]})})};var er=e.i(785242),el=e.i(464571),ei=e.i(981339);let en=({value:e,onChange:s})=>(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Format"}),(0,t.jsx)(_.Select,{value:e,onChange:s,className:"w-full",options:[{value:"csv",label:"CSV (Excel, Google Sheets)"},{value:"json",label:"JSON (includes metadata)"}]})]}),eo=({dateRange:e,selectedFilters:s})=>(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:[e.from?.toLocaleDateString()," - ",e.to?.toLocaleDateString(),s.length>0&&` \xb7 ${s.length} filter${s.length>1?"s":""}`]});var ec=e.i(91739);let ed=({value:e,onChange:s,entityType:a})=>(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Export type"}),(0,t.jsx)(ec.Radio.Group,{value:e,onChange:e=>s(e.target.value),className:"w-full",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,t.jsx)(ec.Radio,{value:"daily",className:"mt-0.5"}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[(0,t.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day breakdown by ",a]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Daily metrics for each ",a]})]})]}),(0,t.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,t.jsx)(ec.Radio,{value:"daily_with_keys",className:"mt-0.5"}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[(0,t.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day breakdown by ",a," and key"]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Daily metrics for each ",a,", split by API key"]})]})]}),(0,t.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,t.jsx)(ec.Radio,{value:"daily_with_models",className:"mt-0.5"}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[(0,t.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day by ",a," and model"]}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:"Daily metrics split by model"})]})]})]})})]});var em=e.i(59935);let eu=e=>{if(!e)return null;for(let t of Object.values(e)){let e=t?.metadata?.team_id;if(e)return e}return null},ex=(e,t,s,a={})=>{switch(t){case"daily":default:return((e,t,s={})=>{let a=[];return e.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(([r,l])=>{let i=eu(l.api_key_breakdown),n=i&&s[i]||null;a.push({Date:e.date,[t]:n||"-",[`${t} ID`]:i||"-","Spend ($)":(0,M.formatNumberWithCommas)(l.metrics.spend,4),Requests:l.metrics.api_requests,"Successful Requests":l.metrics.successful_requests,"Failed Requests":l.metrics.failed_requests,"Total Tokens":l.metrics.total_tokens,"Prompt Tokens":l.metrics.prompt_tokens||0,"Completion Tokens":l.metrics.completion_tokens||0})})}),a.sort((e,t)=>new Date(e.Date).getTime()-new Date(t.Date).getTime())})(e,s,a);case"daily_with_keys":return((e,t,s={})=>{let a={};return e.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(([t,r])=>{Object.entries(r.api_key_breakdown||{}).forEach(([r,l])=>{let i=l?.metadata?.key_alias||null,n=l?.metadata?.team_id||t,o=n&&s[n]||null,c=`${e.date}_${n}_${r}`;a[c]?(a[c].metrics.spend+=l.metrics?.spend||0,a[c].metrics.api_requests+=l.metrics?.api_requests||0,a[c].metrics.successful_requests+=l.metrics?.successful_requests||0,a[c].metrics.failed_requests+=l.metrics?.failed_requests||0,a[c].metrics.total_tokens+=l.metrics?.total_tokens||0,a[c].metrics.prompt_tokens+=l.metrics?.prompt_tokens||0,a[c].metrics.completion_tokens+=l.metrics?.completion_tokens||0):a[c]={Date:e.date,teamId:n,teamAlias:o,keyId:r,keyAlias:i,metrics:{spend:l.metrics?.spend||0,api_requests:l.metrics?.api_requests||0,successful_requests:l.metrics?.successful_requests||0,failed_requests:l.metrics?.failed_requests||0,total_tokens:l.metrics?.total_tokens||0,prompt_tokens:l.metrics?.prompt_tokens||0,completion_tokens:l.metrics?.completion_tokens||0}}})})}),Object.values(a).map(e=>({Date:e.Date,[t]:e.teamAlias||"-",[`${t} ID`]:e.teamId||"-","Key Alias":e.keyAlias||"-","Key ID":e.keyId,"Spend ($)":(0,M.formatNumberWithCommas)(e.metrics.spend,4),Requests:e.metrics.api_requests,"Successful Requests":e.metrics.successful_requests,"Failed Requests":e.metrics.failed_requests,"Total Tokens":e.metrics.total_tokens,"Prompt Tokens":e.metrics.prompt_tokens,"Completion Tokens":e.metrics.completion_tokens})).sort((e,t)=>new Date(e.Date).getTime()-new Date(t.Date).getTime())})(e,s,a);case"daily_with_models":return((e,t,s={})=>{let a=[];return e.results.forEach(e=>{let r={};Object.entries(e.breakdown.entities||{}).forEach(([t,s])=>{r[t]||(r[t]={}),Object.entries(e.breakdown.models||{}).forEach(([e,a])=>{Object.entries(s.api_key_breakdown||{}).forEach(([s,a])=>{r[t][e]||(r[t][e]={spend:0,requests:0,successful:0,failed:0,tokens:0}),r[t][e].spend+=a.metrics.spend||0,r[t][e].requests+=a.metrics.api_requests||0,r[t][e].successful+=a.metrics.successful_requests||0,r[t][e].failed+=a.metrics.failed_requests||0,r[t][e].tokens+=a.metrics.total_tokens||0})})}),Object.entries(r).forEach(([r,l])=>{let i=e.breakdown.entities?.[r],n=eu(i?.api_key_breakdown),o=n&&s[n]||null;Object.entries(l).forEach(([s,r])=>{a.push({Date:e.date,[t]:o||"-",[`${t} ID`]:n||"-",Model:s,"Spend ($)":(0,M.formatNumberWithCommas)(r.spend,4),Requests:r.requests,Successful:r.successful,Failed:r.failed,"Total Tokens":r.tokens})})})}),a.sort((e,t)=>new Date(e.Date).getTime()-new Date(t.Date).getTime())})(e,s,a)}},eh=({isOpen:e,onClose:s,entityType:a,spendData:r,dateRange:l,selectedFilters:i,customTitle:n})=>{let[o,c]=(0,k.useState)("csv"),[d,m]=(0,k.useState)("daily"),[u,x]=(0,k.useState)(!1),{data:h,isLoading:p}=(0,er.useTeams)(),f=a.charAt(0).toUpperCase()+a.slice(1),g=n||`Export ${f} Usage`,_=(0,k.useMemo)(()=>(0,$.createTeamAliasMap)(h),[h]),j=async e=>{let t=e||o;x(!0);try{"csv"===t?(((e,t,s,a,r={})=>{let l=ex(e,t,s,r),i=new Blob([em.default.unparse(l)],{type:"text/csv;charset=utf-8;"}),n=window.URL.createObjectURL(i),o=document.createElement("a");o.href=n,o.download=`${a}_usage_${t}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)})(r,d,f,a,_),es.default.success(`${f} usage data exported successfully as CSV`)):(((e,t,s,a,r,l,i={})=>{let n=ex(e,t,s,i),o={export_date:new Date().toISOString(),entity_type:a,date_range:{from:r.from?.toISOString(),to:r.to?.toISOString()},filters_applied:l.length>0?l:"None",export_scope:t,summary:{total_spend:e.metadata.total_spend,total_requests:e.metadata.total_api_requests,successful_requests:e.metadata.total_successful_requests,failed_requests:e.metadata.total_failed_requests,total_tokens:e.metadata.total_tokens}},c=new Blob([JSON.stringify({metadata:o,data:n},null,2)],{type:"application/json"}),d=window.URL.createObjectURL(c),m=document.createElement("a");m.href=d,m.download=`${a}_usage_${t}_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(d)})(r,d,f,a,l,i,_),es.default.success(`${f} usage data exported successfully as JSON`)),s()}catch(e){console.error("Error exporting data:",e),es.default.fromBackend("Failed to export data")}finally{x(!1)}};return(0,t.jsx)(X.Modal,{title:(0,t.jsx)("span",{className:"text-base font-semibold",children:g}),open:e,onCancel:s,footer:null,width:480,children:(0,t.jsxs)("div",{className:"space-y-5 py-2",children:[p?(0,t.jsx)(ei.Skeleton,{active:!0}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eo,{dateRange:l,selectedFilters:i}),(0,t.jsx)(ed,{value:d,onChange:m,entityType:a}),(0,t.jsx)(en,{value:o,onChange:c})]}),p?(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-4 border-t",children:[(0,t.jsx)(ei.Skeleton.Button,{active:!0}),(0,t.jsx)(ei.Skeleton.Button,{active:!0})]}):(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-4 border-t",children:[(0,t.jsx)(el.Button,{variant:"outlined",onClick:s,disabled:u,children:"Cancel"}),(0,t.jsx)(el.Button,{onClick:()=>j(),loading:u||p,disabled:u||p,type:"primary",children:u?"Exporting...":`Export ${o.toUpperCase()}`})]})]})})},ep=({dateValue:e,entityType:s,spendData:a,showFilters:r=!1,filterLabel:l,filterPlaceholder:i,selectedFilters:n=[],onFiltersChange:o,filterOptions:c=[],customTitle:d,compactLayout:m=!1,teams:u=[]})=>{let[x,p]=(0,k.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)("div",{className:`grid ${r&&c.length>0?"grid-cols-[1fr_auto]":"grid-cols-[auto]"} items-end gap-4`,children:[r&&c.length>0&&(0,t.jsxs)("div",{children:[l&&(0,t.jsx)(h.Text,{className:"mb-2",children:l}),(0,t.jsx)(_.Select,{mode:"multiple",style:{width:"100%"},placeholder:i,value:n,onChange:o,options:c,allowClear:!0})]}),(0,t.jsx)("div",{className:"justify-self-end",children:(0,t.jsx)(F.Button,{onClick:()=>p(!0),icon:()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),children:"Export Data"})})]})}),(0,t.jsx)(eh,{isOpen:x,onClose:()=>p(!1),entityType:s,spendData:a,dateRange:e,selectedFilters:n,customTitle:d,teams:u})]})};e.i(247167);var ef=e.i(931067);let eg={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"}}]},name:"calendar",theme:"outlined"};var e_=e.i(9583),ej=k.forwardRef(function(e,t){return k.createElement(e_.default,(0,ef.default)({},e,{ref:t,icon:eg}))}),ey=e.i(637235),eb=e.i(166540);let ek=[{label:"Today",shortLabel:"today",getValue:()=>({from:(0,eb.default)().startOf("day").toDate(),to:(0,eb.default)().endOf("day").toDate()})},{label:"Last 7 days",shortLabel:"7d",getValue:()=>({from:(0,eb.default)().subtract(7,"days").startOf("day").toDate(),to:(0,eb.default)().endOf("day").toDate()})},{label:"Last 30 days",shortLabel:"30d",getValue:()=>({from:(0,eb.default)().subtract(30,"days").startOf("day").toDate(),to:(0,eb.default)().endOf("day").toDate()})},{label:"Month to date",shortLabel:"MTD",getValue:()=>({from:(0,eb.default)().startOf("month").toDate(),to:(0,eb.default)().endOf("day").toDate()})},{label:"Year to date",shortLabel:"YTD",getValue:()=>({from:(0,eb.default)().startOf("year").toDate(),to:(0,eb.default)().endOf("day").toDate()})}],ev=({value:e,onValueChange:s,label:a="Select Time Range",showTimeRange:r=!0})=>{let[l,i]=(0,k.useState)(!1),[n,o]=(0,k.useState)(e),[c,d]=(0,k.useState)(null),[m,u]=(0,k.useState)(""),[x,p]=(0,k.useState)(""),f=(0,k.useRef)(null),g=(0,k.useCallback)(e=>{if(!e.from||!e.to)return null;for(let t of ek){let s=t.getValue(),a=(0,eb.default)(e.from).isSame((0,eb.default)(s.from),"day"),r=(0,eb.default)(e.to).isSame((0,eb.default)(s.to),"day");if(a&&r)return t.shortLabel}return null},[]);(0,k.useEffect)(()=>{d(g(e))},[e,g]);let _=(0,k.useCallback)(()=>{if(!m||!x)return{isValid:!0,error:""};let e=(0,eb.default)(m,"YYYY-MM-DD"),t=(0,eb.default)(x,"YYYY-MM-DD");return e.isValid()&&t.isValid()?t.isBefore(e)?{isValid:!1,error:"End date cannot be before start date"}:{isValid:!0,error:""}:{isValid:!1,error:"Invalid date format"}},[m,x])();(0,k.useEffect)(()=>{e.from&&u((0,eb.default)(e.from).format("YYYY-MM-DD")),e.to&&p((0,eb.default)(e.to).format("YYYY-MM-DD")),o(e)},[e]),(0,k.useEffect)(()=>{let e=e=>{f.current&&!f.current.contains(e.target)&&i(!1)};return l&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[l]);let j=(0,k.useCallback)((e,t)=>{if(!e||!t)return"Select date range";let s=e=>(0,eb.default)(e).format("D MMM, HH:mm");return`${s(e)} - ${s(t)}`},[]),y=(0,k.useCallback)(e=>{let t;if(!e.from)return e;let s={...e},a=new Date(e.from);return t=new Date(e.to?e.to:e.from),a.toDateString()===t.toDateString(),a.setHours(0,0,0,0),t.setHours(23,59,59,999),s.from=a,s.to=t,s},[]),b=(0,k.useCallback)(()=>{try{if(m&&x&&_.isValid){let e=(0,eb.default)(m,"YYYY-MM-DD").startOf("day"),t=(0,eb.default)(x,"YYYY-MM-DD").endOf("day");if(e.isValid()&&t.isValid()){let s={from:e.toDate(),to:t.toDate()};o(s);let a=g(s);d(a)}}}catch(e){console.warn("Invalid date format:",e)}},[m,x,_.isValid,g]);return(0,k.useEffect)(()=>{b()},[b]),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[a&&(0,t.jsx)(h.Text,{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:a}),(0,t.jsxs)("div",{className:"relative",ref:f,children:[(0,t.jsx)("div",{className:"w-[300px] px-3 py-2 text-sm border border-gray-300 rounded-md bg-white cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",onClick:()=>i(!l),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ey.ClockCircleOutlined,{className:"text-gray-600"}),(0,t.jsx)("span",{className:"text-gray-900",children:j(e.from,e.to)})]}),(0,t.jsx)("svg",{className:`w-4 h-4 text-gray-400 transition-transform ${l?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),l&&(0,t.jsx)("div",{className:"absolute top-full right-0 z-[9999] min-w-[600px] mt-1 bg-white border border-gray-200 rounded-lg shadow-xl",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("div",{className:"w-1/2 border-r border-gray-200",children:[(0,t.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Relative time"})}),(0,t.jsx)("div",{className:"h-[350px] overflow-y-auto",children:ek.map(e=>{let s=c===e.shortLabel;return(0,t.jsxs)("div",{className:`flex items-center justify-between px-5 py-4 cursor-pointer border-b border-gray-100 transition-colors ${s?"bg-blue-50 hover:bg-blue-100 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>(e=>{let{from:t,to:s}=e.getValue();o({from:t,to:s}),d(e.shortLabel),u((0,eb.default)(t).format("YYYY-MM-DD")),p((0,eb.default)(s).format("YYYY-MM-DD"))})(e),children:[(0,t.jsx)("span",{className:`text-sm ${s?"text-blue-700 font-medium":"text-gray-700"}`,children:e.label}),(0,t.jsx)("span",{className:`text-xs px-2 py-1 rounded capitalize ${s?"text-blue-700 bg-blue-100":"text-gray-500 bg-gray-100"}`,children:e.shortLabel})]},e.label)})})]}),(0,t.jsxs)("div",{className:"w-1/2 relative",children:[(0,t.jsx)("div",{className:"p-3.5 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ej,{className:"text-gray-600"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Start and end dates"})]})}),(0,t.jsxs)("div",{className:"p-6 space-y-6 pb-20",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-700 mb-1 block",children:"Start date"}),(0,t.jsx)("input",{type:"date",value:m,onChange:e=>u(e.target.value),className:`w-65 px-3 py-2 text-sm border rounded-md cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 ${!_.isValid?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300"}`})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-700 mb-1 block",children:"End date"}),(0,t.jsx)("input",{type:"date",value:x,onChange:e=>p(e.target.value),className:`w-65 px-3 py-2 text-sm border rounded-md cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 ${!_.isValid?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300"}`})]}),!_.isValid&&_.error&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,t.jsx)("span",{className:"text-sm text-red-700 font-medium",children:_.error})]})}),n.from&&n.to&&_.isValid&&(0,t.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md space-y-1",children:[(0,t.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,t.jsx)("span",{className:"font-medium",children:"From:"})," ",(0,eb.default)(n.from).format("MMM D, YYYY [at] HH:mm:ss")]}),(0,t.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,t.jsx)("span",{className:"font-medium",children:"To:"})," ",(0,eb.default)(n.to).format("MMM D, YYYY [at] HH:mm:ss")]})]})]}),(0,t.jsx)("div",{className:"absolute bottom-4 right-4",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(F.Button,{variant:"secondary",onClick:()=>{o(e),e.from&&u((0,eb.default)(e.from).format("YYYY-MM-DD")),e.to&&p((0,eb.default)(e.to).format("YYYY-MM-DD")),d(g(e)),i(!1)},children:"Cancel"}),(0,t.jsx)(F.Button,{onClick:()=>{n.from&&n.to&&_.isValid&&(s(n),requestIdleCallback(()=>{s(y(n))},{timeout:100}),i(!1))},disabled:!n.from||!n.to||!_.isValid,children:"Apply"})]})})]})]})})]})]})};var eN=e.i(571303);let eT=({isDateChanging:e=!1})=>(0,t.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)(eN.UiLoadingSpinner,{className:"size-5"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-gray-600 text-sm font-medium",children:e?"Processing date selection...":"Loading chart data..."}),(0,t.jsx)("span",{className:"text-gray-400 text-xs mt-1",children:e?"This will only take a moment":"Fetching your data"})]})]})});var eC=e.i(290571),ew=e.i(95779),eq=e.i(444755),eS=e.i(673706);let eL=k.default.forwardRef((e,t)=>{let{color:s,children:a,className:r}=e,l=(0,eC.__rest)(e,["color","children","className"]);return k.default.createElement("p",Object.assign({ref:t,className:(0,eq.tremorTwMerge)("font-semibold text-tremor-metric",s?(0,eS.getColorClassNames)(s,ew.colorPalette.darkText).textColor:"text-tremor-content-strong dark:text-dark-tremor-content-strong",r)},l),a)});eL.displayName="Metric";var eD=e.i(37091),eA=e.i(269200),eE=e.i(427612),eO=e.i(496020),eM=e.i(64848),eF=e.i(942232),e$=e.i(977572);let eR=({accessToken:e,selectedTags:s,formatAbbreviatedNumber:a})=>{let r,i,n,o,[f,g]=(0,k.useState)({results:[],total_count:0,page:1,page_size:50,total_pages:0}),[_,j]=(0,k.useState)(!1),[y,b]=(0,k.useState)(1),N=async()=>{if(e){j(!0);try{let t=await (0,v.perUserAnalyticsCall)(e,y,50,s.length>0?s:void 0);g(t)}catch(e){console.error("Failed to fetch per-user data:",e)}finally{j(!1)}}};return(0,k.useEffect)(()=>{N()},[e,s,y]),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)(p.Title,{children:"Per User Usage"}),(0,t.jsx)(eD.Subtitle,{children:"Individual developer usage metrics"}),(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)(m.TabList,{className:"mb-6",children:[(0,t.jsx)(c.Tab,{children:"User Details"}),(0,t.jsx)(c.Tab,{children:"Usage Distribution"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsxs)(u.TabPanel,{children:[(0,t.jsxs)(eA.Table,{children:[(0,t.jsx)(eE.TableHead,{children:(0,t.jsxs)(eO.TableRow,{children:[(0,t.jsx)(eM.TableHeaderCell,{children:"User ID"}),(0,t.jsx)(eM.TableHeaderCell,{children:"User Email"}),(0,t.jsx)(eM.TableHeaderCell,{children:"User Agent"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-right",children:"Success Generations"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-right",children:"Total Tokens"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-right",children:"Failed Requests"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-right",children:"Total Cost"})]})}),(0,t.jsx)(eF.TableBody,{children:f.results.slice(0,10).map((e,s)=>(0,t.jsxs)(eO.TableRow,{children:[(0,t.jsx)(e$.TableCell,{children:(0,t.jsx)(h.Text,{className:"font-medium",children:e.user_id})}),(0,t.jsx)(e$.TableCell,{children:(0,t.jsx)(h.Text,{children:e.user_email||"N/A"})}),(0,t.jsx)(e$.TableCell,{children:(0,t.jsx)(h.Text,{children:e.user_agent||"Unknown"})}),(0,t.jsx)(e$.TableCell,{className:"text-right",children:(0,t.jsx)(h.Text,{children:a(e.successful_requests)})}),(0,t.jsx)(e$.TableCell,{className:"text-right",children:(0,t.jsx)(h.Text,{children:a(e.total_tokens)})}),(0,t.jsx)(e$.TableCell,{className:"text-right",children:(0,t.jsx)(h.Text,{children:a(e.failed_requests)})}),(0,t.jsx)(e$.TableCell,{className:"text-right",children:(0,t.jsxs)(h.Text,{children:["$",a(e.spend,4)]})})]},s))})]}),f.results.length>10&&(0,t.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,t.jsxs)(h.Text,{className:"text-sm text-gray-500",children:["Showing 10 of ",f.total_count," results"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(F.Button,{size:"sm",variant:"secondary",onClick:()=>{y>1&&b(y-1)},disabled:1===y,children:"Previous"}),(0,t.jsx)(F.Button,{size:"sm",variant:"secondary",onClick:()=>{y<f.total_pages&&b(y+1)},disabled:y>=f.total_pages,children:"Next"})]})]})]}),(0,t.jsxs)(u.TabPanel,{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)(p.Title,{className:"text-lg",children:"User Usage Distribution"}),(0,t.jsx)(eD.Subtitle,{children:"Number of users by successful request frequency"})]}),(0,t.jsx)(l.BarChart,{data:(r=new Map,f.results.forEach(e=>{let t=e.user_agent||"Unknown";r.set(t,(r.get(t)||0)+1)}),i=Array.from(r.entries()).sort(([,e],[,t])=>t-e).slice(0,8).map(([e])=>e),n={"1-9 requests":{range:[1,9],agents:{}},"10-99 requests":{range:[10,99],agents:{}},"100-999 requests":{range:[100,999],agents:{}},"1K-9.9K requests":{range:[1e3,9999],agents:{}},"10K-99.9K requests":{range:[1e4,99999],agents:{}},"100K+ requests":{range:[1e5,1/0],agents:{}}},f.results.forEach(e=>{let t=e.successful_requests,s=e.user_agent||"Unknown";i.includes(s)&&Object.entries(n).forEach(([e,a])=>{t>=a.range[0]&&t<=a.range[1]&&(a.agents[s]||(a.agents[s]=0),a.agents[s]++)})}),Object.entries(n).map(([e,t])=>{let s={category:e};return i.forEach(e=>{s[e]=t.agents[e]||0}),s})),index:"category",categories:(o=new Map,f.results.forEach(e=>{let t=e.user_agent||"Unknown";o.set(t,(o.get(t)||0)+1)}),Array.from(o.entries()).sort(([,e],[,t])=>t-e).slice(0,8).map(([e])=>e)),colors:["blue","green","orange","red","purple","yellow","pink","indigo"],valueFormatter:e=>`${e} users`,yAxisWidth:80,showLegend:!0,stack:!0})]})]})]})]})},eU=({accessToken:e,userRole:s,dateValue:a,onDateChange:r})=>{let[n,f]=(0,k.useState)({results:[]}),[g,y]=(0,k.useState)({results:[]}),[b,N]=(0,k.useState)({results:[]}),[T,C]=(0,k.useState)({results:[]}),[w,q]=(0,k.useState)(""),[S,L]=(0,k.useState)([]),[D,A]=(0,k.useState)([]),[E,O]=(0,k.useState)(!1),[M,F]=(0,k.useState)(!1),[$,R]=(0,k.useState)(!1),[U,V]=(0,k.useState)(!1),[P,z]=(0,k.useState)(!1),I=new Date,W=async()=>{if(e){O(!0);try{let t=await (0,v.tagDistinctCall)(e);L(t.results.map(e=>e.tag))}catch(e){console.error("Failed to fetch available tags:",e)}finally{O(!1)}}},B=async()=>{if(e){F(!0);try{let t=await (0,v.tagDauCall)(e,I,w||void 0,D.length>0?D:void 0);f(t)}catch(e){console.error("Failed to fetch DAU data:",e)}finally{F(!1)}}},H=async()=>{if(e){R(!0);try{let t=await (0,v.tagWauCall)(e,I,w||void 0,D.length>0?D:void 0);y(t)}catch(e){console.error("Failed to fetch WAU data:",e)}finally{R(!1)}}},Y=async()=>{if(e){V(!0);try{let t=await (0,v.tagMauCall)(e,I,w||void 0,D.length>0?D:void 0);N(t)}catch(e){console.error("Failed to fetch MAU data:",e)}finally{V(!1)}}},K=async()=>{if(e&&a.from&&a.to){z(!0);try{let t=await (0,v.userAgentSummaryCall)(e,a.from,a.to,D.length>0?D:void 0);C(t)}catch(e){console.error("Failed to fetch user agent summary data:",e)}finally{z(!1)}}};(0,k.useEffect)(()=>{W()},[e]),(0,k.useEffect)(()=>{if(!e)return;let t=setTimeout(()=>{B(),H(),Y()},50);return()=>clearTimeout(t)},[e,w,D]),(0,k.useEffect)(()=>{if(!a.from||!a.to)return;let e=setTimeout(()=>{K()},50);return()=>clearTimeout(e)},[e,a,D]);let G=e=>e.startsWith("User-Agent: ")?e.replace("User-Agent: ",""):e,Z=e=>Object.entries(e.reduce((e,t)=>(e[t.tag]=(e[t.tag]||0)+t.active_users,e),{})).sort(([,e],[,t])=>t-e).map(([e])=>e),J=Z(n.results).slice(0,10),Q=Z(g.results).slice(0,10),X=Z(b.results).slice(0,10),ee=(()=>{let e=[],t=new Date;for(let s=6;s>=0;s--){let a=new Date(t);a.setDate(a.getDate()-s);let r={date:a.toISOString().split("T")[0]};J.forEach(e=>{r[G(e)]=0}),e.push(r)}return n.results.forEach(t=>{let s=G(t.tag),a=e.find(e=>e.date===t.date);a&&(a[s]=t.active_users)}),e})(),et=(()=>{let e=[];for(let t=1;t<=7;t++){let s={week:`Week ${t}`};Q.forEach(e=>{s[G(e)]=0}),e.push(s)}return g.results.forEach(t=>{let s=G(t.tag),a=t.date.match(/Week (\d+)/);if(a){let r=`Week ${a[1]}`,l=e.find(e=>e.week===r);l&&(l[s]=t.active_users)}}),e})(),es=(()=>{let e=[];for(let t=1;t<=7;t++){let s={month:`Month ${t}`};X.forEach(e=>{s[G(e)]=0}),e.push(s)}return b.results.forEach(t=>{let s=G(t.tag),a=t.date.match(/Month (\d+)/);if(a){let r=`Month ${a[1]}`,l=e.find(e=>e.month===r);l&&(l[s]=t.active_users)}}),e})(),ea=(e,t=0)=>{if(e>=1e8||e>=1e7)return(e/1e6).toFixed(t)+"M";if(e>=1e6)return(e/1e6).toFixed(t)+"M";if(e>=1e4)return(e/1e3).toFixed(t)+"K";if(e>=1e3)return(e/1e3).toFixed(t)+"K";else return e.toFixed(t)};return(0,t.jsxs)("div",{className:"space-y-6 mt-6",children:[(0,t.jsx)(i.Card,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Title,{children:"Summary by User Agent"}),(0,t.jsx)(eD.Subtitle,{children:"Performance metrics for different user agents"})]}),(0,t.jsxs)("div",{className:"w-96",children:[(0,t.jsx)(h.Text,{className:"text-sm font-medium block mb-2",children:"Filter by User Agents"}),(0,t.jsx)(_.Select,{mode:"multiple",placeholder:"All User Agents",value:D,onChange:A,style:{width:"100%"},showSearch:!0,allowClear:!0,loading:E,optionFilterProp:"label",className:"rounded-md",maxTagCount:"responsive",children:S.map(e=>{let s=G(e),a=s.length>50?`${s.substring(0,50)}...`:s;return(0,t.jsx)(_.Select.Option,{value:e,label:a,title:s,children:a},e)})})]})]}),P?(0,t.jsx)(eT,{isDateChanging:!1}):(0,t.jsxs)(o.Grid,{numItems:4,className:"gap-4",children:[(T.results||[]).slice(0,4).map((e,s)=>{let a=G(e.tag),r=a.length>15?a.substring(0,15)+"...":a;return(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(j.Tooltip,{title:a,placement:"top",children:(0,t.jsx)(p.Title,{className:"truncate",children:r})}),(0,t.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Success Requests"}),(0,t.jsx)(eL,{className:"text-lg",children:ea(e.successful_requests)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Total Tokens"}),(0,t.jsx)(eL,{className:"text-lg",children:ea(e.total_tokens)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Total Cost"}),(0,t.jsxs)(eL,{className:"text-lg",children:["$",ea(e.total_spend,4)]})]})]})]},s)}),Array.from({length:Math.max(0,4-(T.results||[]).length)}).map((e,s)=>(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"No Data"}),(0,t.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Success Requests"}),(0,t.jsx)(eL,{className:"text-lg",children:"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Total Tokens"}),(0,t.jsx)(eL,{className:"text-lg",children:"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Total Cost"}),(0,t.jsx)(eL,{className:"text-lg",children:"-"})]})]})]},`empty-${s}`))]})]})}),(0,t.jsx)(i.Card,{children:(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)(m.TabList,{className:"mb-6",children:[(0,t.jsx)(c.Tab,{children:"DAU/WAU/MAU"}),(0,t.jsx)(c.Tab,{children:"Per User Usage (Last 30 Days)"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsxs)(u.TabPanel,{children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)(p.Title,{children:"DAU, WAU & MAU per Agent"}),(0,t.jsx)(eD.Subtitle,{children:"Active users across different time periods"})]}),(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)(m.TabList,{className:"mb-6",children:[(0,t.jsx)(c.Tab,{children:"DAU"}),(0,t.jsx)(c.Tab,{children:"WAU"}),(0,t.jsx)(c.Tab,{children:"MAU"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsxs)(u.TabPanel,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(p.Title,{className:"text-lg",children:"Daily Active Users - Last 7 Days"})}),M?(0,t.jsx)(eT,{isDateChanging:!1}):(0,t.jsx)(l.BarChart,{data:ee,index:"date",categories:J.map(G),valueFormatter:e=>ea(e),yAxisWidth:60,showLegend:!0,stack:!0})]}),(0,t.jsxs)(u.TabPanel,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(p.Title,{className:"text-lg",children:"Weekly Active Users - Last 7 Weeks"})}),$?(0,t.jsx)(eT,{isDateChanging:!1}):(0,t.jsx)(l.BarChart,{data:et,index:"week",categories:Q.map(G),valueFormatter:e=>ea(e),yAxisWidth:60,showLegend:!0,stack:!0})]}),(0,t.jsxs)(u.TabPanel,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(p.Title,{className:"text-lg",children:"Monthly Active Users - Last 7 Months"})}),U?(0,t.jsx)(eT,{isDateChanging:!1}):(0,t.jsx)(l.BarChart,{data:es,index:"month",categories:X.map(G),valueFormatter:e=>ea(e),yAxisWidth:60,showLegend:!0,stack:!0})]})]})]})]}),(0,t.jsx)(u.TabPanel,{children:(0,t.jsx)(eR,{accessToken:e,selectedTags:D,formatAbbreviatedNumber:ea})})]})]})})]})};var eV=e.i(617802);let eP=({endpointData:e})=>{let s=e||{},a=k.default.useMemo(()=>Object.entries(s).map(([e,t])=>({endpoint:e,"metrics.successful_requests":t.metrics.successful_requests,"metrics.failed_requests":t.metrics.failed_requests,metrics:{successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests}})),[s]);return(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(p.Title,{children:"Success vs Failed Requests by Endpoint"}),(0,t.jsx)(z,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"]})]}),(0,t.jsx)(l.BarChart,{className:"mt-4",data:a,index:"endpoint",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"],valueFormatter:e=>e.toLocaleString(),customTooltip:P,showLegend:!1,stack:!0,yAxisWidth:60})]})};var ez=e.i(731195),eI=e.i(883966),eW=e.i(555706),eB=e.i(785183),eH=e.i(93230),eY=e.i(844171),eK=(0,eI.generateCategoricalChart)({chartName:"LineChart",GraphicalChild:eW.Line,axisComponents:[{axisType:"xAxis",AxisComp:eB.XAxis},{axisType:"yAxis",AxisComp:eH.YAxis}],formatAxisMap:eY.formatAxisMap}),eG=e.i(872526),eZ=e.i(800494),eJ=e.i(234239),eQ=e.i(559559),eX=e.i(238279),e0=e.i(114887),e1=e.i(933303),e2=e.i(628781),e4=e.i(472007),e3=e.i(480731);let e6=k.default.forwardRef((e,t)=>{let{data:s=[],categories:a=[],index:r,colors:l=ew.themeColorRange,valueFormatter:i=eS.defaultValueFormatter,startEndOnly:n=!1,showXAxis:o=!0,showYAxis:c=!0,yAxisWidth:d=56,intervalType:m="equidistantPreserveStart",animationDuration:u=900,showAnimation:x=!1,showTooltip:h=!0,showLegend:p=!0,showGridLines:f=!0,autoMinValue:g=!1,curveType:_="linear",minValue:j,maxValue:y,connectNulls:b=!1,allowDecimals:v=!0,noDataText:N,className:T,onValueChange:C,enableLegendSlider:w=!1,customTooltip:q,rotateLabelX:S,padding:L=o||c?{left:20,right:20}:{left:0,right:0},tickGap:D=5,xAxisLabel:A,yAxisLabel:E}=e,O=(0,eC.__rest)(e,["data","categories","index","colors","valueFormatter","startEndOnly","showXAxis","showYAxis","yAxisWidth","intervalType","animationDuration","showAnimation","showTooltip","showLegend","showGridLines","autoMinValue","curveType","minValue","maxValue","connectNulls","allowDecimals","noDataText","className","onValueChange","enableLegendSlider","customTooltip","rotateLabelX","padding","tickGap","xAxisLabel","yAxisLabel"]),[M,F]=(0,k.useState)(60),[$,R]=(0,k.useState)(void 0),[U,V]=(0,k.useState)(void 0),P=(0,e4.constructCategoryColors)(a,l),z=(0,e4.getYAxisDomain)(g,j,y),I=!!C;function W(e){I&&(e===U&&!$||(0,e4.hasOnlyOneValueForThisKey)(s,e)&&$&&$.dataKey===e?(V(void 0),null==C||C(null)):(V(e),null==C||C({eventType:"category",categoryClicked:e})),R(void 0))}return k.default.createElement("div",Object.assign({ref:t,className:(0,eq.tremorTwMerge)("w-full h-80",T)},O),k.default.createElement(ez.ResponsiveContainer,{className:"h-full w-full"},(null==s?void 0:s.length)?k.default.createElement(eK,{data:s,onClick:I&&(U||$)?()=>{R(void 0),V(void 0),null==C||C(null)}:void 0,margin:{bottom:A?30:void 0,left:E?20:void 0,right:E?5:void 0,top:5}},f?k.default.createElement(eG.CartesianGrid,{className:(0,eq.tremorTwMerge)("stroke-1","stroke-tremor-border","dark:stroke-dark-tremor-border"),horizontal:!0,vertical:!1}):null,k.default.createElement(eB.XAxis,{padding:L,hide:!o,dataKey:r,interval:n?"preserveStartEnd":m,tick:{transform:"translate(0, 6)"},ticks:n?[s[0][r],s[s.length-1][r]]:void 0,fill:"",stroke:"",className:(0,eq.tremorTwMerge)("text-tremor-label","fill-tremor-content","dark:fill-dark-tremor-content"),tickLine:!1,axisLine:!1,minTickGap:D,angle:null==S?void 0:S.angle,dy:null==S?void 0:S.verticalShift,height:null==S?void 0:S.xAxisHeight},A&&k.default.createElement(eZ.Label,{position:"insideBottom",offset:-20,className:"fill-tremor-content-emphasis text-tremor-default font-medium dark:fill-dark-tremor-content-emphasis"},A)),k.default.createElement(eH.YAxis,{width:d,hide:!c,axisLine:!1,tickLine:!1,type:"number",domain:z,tick:{transform:"translate(-3, 0)"},fill:"",stroke:"",className:(0,eq.tremorTwMerge)("text-tremor-label","fill-tremor-content","dark:fill-dark-tremor-content"),tickFormatter:i,allowDecimals:v},E&&k.default.createElement(eZ.Label,{position:"insideLeft",style:{textAnchor:"middle"},angle:-90,offset:-15,className:"fill-tremor-content-emphasis text-tremor-default font-medium dark:fill-dark-tremor-content-emphasis"},E)),k.default.createElement(eJ.Tooltip,{wrapperStyle:{outline:"none"},isAnimationActive:!1,cursor:{stroke:"#d1d5db",strokeWidth:1},content:h?({active:e,payload:t,label:s})=>q?k.default.createElement(q,{payload:null==t?void 0:t.map(e=>{var t;return Object.assign(Object.assign({},e),{color:null!=(t=P.get(e.dataKey))?t:e3.BaseColors.Gray})}),active:e,label:s}):k.default.createElement(e1.default,{active:e,payload:t,label:s,valueFormatter:i,categoryColors:P}):k.default.createElement(k.default.Fragment,null),position:{y:0}}),p?k.default.createElement(eQ.Legend,{verticalAlign:"top",height:M,content:({payload:e})=>(0,e0.default)({payload:e},P,F,U,I?e=>W(e):void 0,w)}):null,a.map(e=>{var t;return k.default.createElement(eW.Line,{className:(0,eq.tremorTwMerge)((0,eS.getColorClassNames)(null!=(t=P.get(e))?t:e3.BaseColors.Gray,ew.colorPalette.text).strokeColor),strokeOpacity:$||U&&U!==e?.3:1,activeDot:e=>{var t;let{cx:a,cy:r,stroke:l,strokeLinecap:i,strokeLinejoin:n,strokeWidth:o,dataKey:c}=e;return k.default.createElement(eX.Dot,{className:(0,eq.tremorTwMerge)("stroke-tremor-background dark:stroke-dark-tremor-background",C?"cursor-pointer":"",(0,eS.getColorClassNames)(null!=(t=P.get(c))?t:e3.BaseColors.Gray,ew.colorPalette.text).fillColor),cx:a,cy:r,r:5,fill:"",stroke:l,strokeLinecap:i,strokeLinejoin:n,strokeWidth:o,onClick:(t,a)=>{a.stopPropagation(),I&&(e.index===(null==$?void 0:$.index)&&e.dataKey===(null==$?void 0:$.dataKey)||(0,e4.hasOnlyOneValueForThisKey)(s,e.dataKey)&&U&&U===e.dataKey?(V(void 0),R(void 0),null==C||C(null)):(V(e.dataKey),R({index:e.index,dataKey:e.dataKey}),null==C||C(Object.assign({eventType:"dot",categoryClicked:e.dataKey},e.payload))))}})},dot:t=>{var a;let{stroke:r,strokeLinecap:l,strokeLinejoin:i,strokeWidth:n,cx:o,cy:c,dataKey:d,index:m}=t;return(0,e4.hasOnlyOneValueForThisKey)(s,e)&&!($||U&&U!==e)||(null==$?void 0:$.index)===m&&(null==$?void 0:$.dataKey)===e?k.default.createElement(eX.Dot,{key:m,cx:o,cy:c,r:5,stroke:r,fill:"",strokeLinecap:l,strokeLinejoin:i,strokeWidth:n,className:(0,eq.tremorTwMerge)("stroke-tremor-background dark:stroke-dark-tremor-background",C?"cursor-pointer":"",(0,eS.getColorClassNames)(null!=(a=P.get(d))?a:e3.BaseColors.Gray,ew.colorPalette.text).fillColor)}):k.default.createElement(k.Fragment,{key:m})},key:e,name:e,type:_,dataKey:e,stroke:"",strokeWidth:2,strokeLinejoin:"round",strokeLinecap:"round",isAnimationActive:x,animationDuration:u,connectNulls:b})}),C?a.map(e=>k.default.createElement(eW.Line,{className:(0,eq.tremorTwMerge)("cursor-pointer"),strokeOpacity:0,key:e,name:e,type:_,dataKey:e,stroke:"transparent",fill:"transparent",legendType:"none",tooltipType:"none",strokeWidth:12,connectNulls:b,onClick:(e,t)=>{t.stopPropagation();let{name:s}=e;W(s)}})):null):k.default.createElement(e2.default,{noDataText:N})))});e6.displayName="LineChart";let e5=function({dailyData:e,endpointData:s}){let a=(0,k.useMemo)(()=>{var t;let s,a;return e?.results&&0!==e.results.length?(t=e.results,s=[],a=new Set,t.forEach(e=>{e.breakdown.endpoints&&Object.keys(e.breakdown.endpoints).forEach(e=>a.add(e))}),t.forEach(e=>{let t={date:new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})};a.forEach(s=>{let a=e.breakdown.endpoints?.[s];t[s]=a?.metrics.api_requests||0}),s.push(t)}),s.reverse()):[]},[e]),r=(0,k.useMemo)(()=>0===a.length?[]:Object.keys(a[0]).filter(e=>"date"!==e),[a]);return(0,t.jsxs)(i.Card,{className:"mb-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsx)(p.Title,{children:"Endpoint Usage Trends"})}),(0,t.jsx)(e6,{className:"h-80",data:a,index:"date",categories:r,colors:["blue","cyan","indigo","violet","purple","fuchsia","pink","rose","red","orange"].slice(0,r.length),valueFormatter:e=>e.toLocaleString(),showLegend:!0,showGridLines:!0,yAxisWidth:60,connectNulls:!0,curveType:"natural"})]})};var e7=e.i(309821);e.s(["Progress",()=>e7.default],497650);var e7=e7;let e9=({endpointData:e})=>{let s=Object.entries(e).map(([e,t])=>{var s,a;return{key:e,endpoint:e,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,api_requests:t.metrics.api_requests,total_tokens:t.metrics.total_tokens,spend:t.metrics.spend,successRate:(s=t.metrics.successful_requests,0===(a=t.metrics.api_requests)?0:s/a*100)}}),a=[{title:"Endpoint",dataIndex:"endpoint",key:"endpoint",render:e=>(0,t.jsx)("span",{className:"font-medium",children:e})},{title:"Successful / Failed",key:"requests",render:(e,s)=>{let a=s.api_requests>0?s.successful_requests/s.api_requests*100:0,r=s.api_requests>0?s.failed_requests/s.api_requests*100:0,l={"0%":"#22c55e"};return a>0&&a<100&&(l[`${a}%`]="#22c55e",l[`${a+.01}%`]="#ef4444"),l["100%"]=r>0?"#ef4444":"#22c55e",(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"flex-1 relative",children:(0,t.jsx)(e7.default,{percent:a+r,size:"small",strokeColor:l,showInfo:!1})}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm min-w-[100px]",children:[(0,t.jsx)("span",{className:"text-green-600 font-medium",children:s.successful_requests.toLocaleString()}),(0,t.jsx)("span",{className:"text-gray-400",children:"/"}),(0,t.jsx)("span",{className:"text-red-600 font-medium",children:s.failed_requests.toLocaleString()})]})]})}},{title:"Total Request",dataIndex:"api_requests",key:"api_requests",render:e=>e.toLocaleString()},{title:"Success Rate",dataIndex:"successRate",key:"successRate",render:e=>{let s=e.toFixed(2);return(0,t.jsxs)("span",{className:e>=95?"text-green-600 font-medium":e>=80?"text-yellow-600 font-medium":"text-red-600 font-medium",children:[s,"%"]})}},{title:"Total Tokens",dataIndex:"total_tokens",key:"total_tokens",render:e=>e.toLocaleString()},{title:"Spend",dataIndex:"spend",key:"spend",render:e=>`$${(0,M.formatNumberWithCommas)(e,2)}`}];return(0,t.jsx)(I.Table,{columns:a,dataSource:s,pagination:!1})},e8=({userSpendData:e})=>{let s=(0,k.useMemo)(()=>{let t={};return e?.results&&e.results.forEach(e=>{Object.entries(e.breakdown.endpoints||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:s.metadata||{},api_key_breakdown:{}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests||0,t[e].metrics.failed_requests+=s.metrics.failed_requests||0,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),t},[e]);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(e9,{endpointData:s}),(0,t.jsx)(eP,{endpointData:s}),(0,t.jsx)(e5,{dailyData:e,endpointData:s})]})};var te=e.i(214541),tt=e.i(413990),ts=e.i(916925),ta=e.i(1023),tr=e.i(149121);function tl({topModels:e,topModelsLimit:s,setTopModelsLimit:a}){let[r,i]=(0,k.useState)("table"),n=[{header:"Model",accessorKey:"key",cell:e=>e.getValue()||"-"},{header:"Spend (USD)",accessorKey:"spend",cell:e=>{let t=e.getValue();return`$${(0,M.formatNumberWithCommas)(t,2)}`}},{header:"Successful",accessorKey:"successful_requests",cell:e=>(0,t.jsx)("span",{className:"text-green-600",children:e.getValue()?.toLocaleString()||0})},{header:"Failed",accessorKey:"failed_requests",cell:e=>(0,t.jsx)("span",{className:"text-red-600",children:e.getValue()?.toLocaleString()||0})},{header:"Tokens",accessorKey:"tokens",cell:e=>e.getValue()?.toLocaleString()||0}],o=e.slice(0,s);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,t.jsx)(g.Segmented,{options:[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25},{label:"50",value:50}],value:s,onChange:e=>a(e)}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>i("table"),className:`px-3 py-1 text-sm rounded-md ${"table"===r?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Table View"}),(0,t.jsx)("button",{onClick:()=>i("chart"),className:`px-3 py-1 text-sm rounded-md ${"chart"===r?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Chart View"})]})]}),"chart"===r?(0,t.jsx)("div",{className:"relative max-h-[600px] overflow-y-auto",children:(0,t.jsx)(l.BarChart,{className:"mt-4 cursor-pointer hover:opacity-90",style:{height:52*Math.min(o.length,s)},data:o,index:"key",categories:["spend"],colors:["cyan"],valueFormatter:e=>`$${(0,M.formatNumberWithCommas)(e,2)}`,layout:"vertical",yAxisWidth:200,tickGap:5,showLegend:!1})}):(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden max-h-[600px] overflow-y-auto",children:(0,t.jsx)(tr.DataTable,{columns:n,data:o,renderSubComponent:()=>(0,t.jsx)(t.Fragment,{}),getRowCanExpand:()=>!1,isLoading:!1})})]})}let ti=({accessToken:e,entityType:s,entityId:a,entityList:r,dateValue:f})=>{let g,_,[j,y]=(0,k.useState)({results:[],metadata:{total_spend:0,total_api_requests:0,total_successful_requests:0,total_failed_requests:0,total_tokens:0}}),{teams:b}=(0,te.default)(),N=Z(j,"models",b||[]),T=Z(j,"api_keys",b||[]),[C,w]=(0,k.useState)([]),[q,S]=(0,k.useState)(5),[L,D]=(0,k.useState)(5),A=async()=>{if(!e||!f.from||!f.to)return;let t=new Date(f.from),a=new Date(f.to);if("tag"===s)y(await (0,v.tagDailyActivityCall)(e,t,a,1,C.length>0?C:null));else if("team"===s)y(await (0,v.teamDailyActivityCall)(e,t,a,1,C.length>0?C:null));else if("organization"===s)y(await (0,v.organizationDailyActivityCall)(e,t,a,1,C.length>0?C:null));else if("customer"===s)y(await (0,v.customerDailyActivityCall)(e,t,a,1,C.length>0?C:null));else if("agent"===s)y(await (0,v.agentDailyActivityCall)(e,t,a,1,C.length>0?C:null));else throw Error("Invalid entity type")};(0,k.useEffect)(()=>{A()},[e,f,a,C]);let E=()=>{let e={};return j.results.forEach(t=>{Object.entries(t.breakdown.providers||{}).forEach(([t,s])=>{e[t]||(e[t]={provider:t,spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0});try{e[t].spend+=s.metrics.spend,e[t].requests+=s.metrics.api_requests,e[t].successful_requests+=s.metrics.successful_requests,e[t].failed_requests+=s.metrics.failed_requests,e[t].tokens+=s.metrics.total_tokens}catch(e){console.error(`Error processing provider ${t}: ${e}`)}})}),Object.values(e).filter(e=>e.spend>0).sort((e,t)=>t.spend-e.spend)},O=(e,t)=>{if(r){let t=r.find(t=>t.value===e);if(t)return t.label}return t?.team_alias?t.team_alias:e},F=()=>{var e;let t={};return j.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{alias:O(e,s.metadata),id:e}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests,t[e].metrics.failed_requests+=s.metrics.failed_requests,t[e].metrics.total_tokens+=s.metrics.total_tokens})}),e=Object.values(t).sort((e,t)=>t.metrics.spend-e.metrics.spend),0===C.length?e:e.filter(e=>C.includes(e.metadata.id))},$=s.charAt(0).toUpperCase()+s.slice(1);return(0,t.jsxs)("div",{style:{width:"100%"},className:"relative",children:[(0,t.jsx)(ep,{dateValue:f,entityType:s,spendData:j,showFilters:null!==r&&r.length>0,filterLabel:`Filter by ${s}`,filterPlaceholder:`Select ${s} to filter...`,selectedFilters:C,onFiltersChange:w,filterOptions:(()=>{if(r)return r})()||void 0,teams:b||[]}),(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)(m.TabList,{variant:"solid",className:"mt-1",children:[(0,t.jsx)(c.Tab,{children:"Cost"}),(0,t.jsx)(c.Tab,{children:"agent"===s?"Request / Token Consumption":"Model Activity"}),(0,t.jsx)(c.Tab,{children:"Key Activity"}),(0,t.jsx)(c.Tab,{children:"Endpoint Activity"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsx)(u.TabPanel,{children:(0,t.jsxs)(o.Grid,{numItems:2,className:"gap-2 w-full",children:[(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)(p.Title,{children:[$," Spend Overview"]}),(0,t.jsxs)(o.Grid,{numItems:5,className:"gap-4 mt-4",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Spend"}),(0,t.jsxs)(h.Text,{className:"text-2xl font-bold mt-2",children:["$",(0,M.formatNumberWithCommas)(j.metadata.total_spend,2)]})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2",children:j.metadata.total_api_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Successful Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2 text-green-600",children:j.metadata.total_successful_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Failed Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2 text-red-600",children:j.metadata.total_failed_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Tokens"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2",children:j.metadata.total_tokens.toLocaleString()})]})]})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Daily Spend"}),(0,t.jsx)(l.BarChart,{data:[...j.results].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),index:"date",categories:["metrics.spend"],colors:["cyan"],valueFormatter:Y,yAxisWidth:100,showLegend:!1,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload,r=Object.keys(a.breakdown.entities||{}).length;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.date}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Total Spend: $",(0,M.formatNumberWithCommas)(a.metrics.spend,2)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total Requests: ",a.metrics.api_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Successful: ",a.metrics.successful_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Failed: ",a.metrics.failed_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total Tokens: ",a.metrics.total_tokens]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total ",$,"s: ",r]}),(0,t.jsxs)("div",{className:"mt-2 border-t pt-2",children:[(0,t.jsxs)("p",{className:"font-semibold",children:["Spend by ",$,":"]}),Object.entries(a.breakdown.entities||{}).sort(([,e],[,t])=>{let s=e.metrics.spend;return t.metrics.spend-s}).slice(0,5).map(([e,s])=>(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[O(e,s.metadata),": $",(0,M.formatNumberWithCommas)(s.metrics.spend,2)]},e)),r>5&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 italic",children:["...and ",r-5," more"]})]})]})}})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsx)(i.Card,{children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,t.jsxs)(p.Title,{children:["Spend Per ",$]}),(0,t.jsx)(eD.Subtitle,{className:"text-xs",children:"Showing Top 5 by Spend"}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,t.jsxs)("span",{children:["Get Started by Tracking cost per ",$," "]}),(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/enterprise#spend-tracking",className:"text-blue-500 hover:text-blue-700 ml-1",children:"here"})]})]}),(0,t.jsxs)(o.Grid,{numItems:2,className:"gap-6",children:[(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsx)(l.BarChart,{className:"mt-4 h-52",data:F().slice(0,5).map(e=>({...e,metadata:{...e.metadata,alias_display:e.metadata.alias&&e.metadata.alias.length>15?`${e.metadata.alias.slice(0,15)}...`:e.metadata.alias}})),index:"metadata.alias_display",categories:["metrics.spend"],colors:["cyan"],valueFormatter:Y,layout:"vertical",showLegend:!1,yAxisWidth:150,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.metadata.alias}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,M.formatNumberWithCommas)(a.metrics.spend,4)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Requests: ",a.metrics.api_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-green-600",children:["Successful: ",a.metrics.successful_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-red-600",children:["Failed: ",a.metrics.failed_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",a.metrics.total_tokens.toLocaleString()]})]})}})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsx)("div",{className:"h-52 overflow-y-auto",children:(0,t.jsxs)(eA.Table,{children:[(0,t.jsx)(eE.TableHead,{children:(0,t.jsxs)(eO.TableRow,{children:[(0,t.jsx)(eM.TableHeaderCell,{children:$}),(0,t.jsx)(eM.TableHeaderCell,{children:"Spend"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-green-600",children:"Successful"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-red-600",children:"Failed"}),(0,t.jsx)(eM.TableHeaderCell,{children:"Tokens"})]})}),(0,t.jsx)(eF.TableBody,{children:F().filter(e=>e.metrics.spend>0).map(e=>(0,t.jsxs)(eO.TableRow,{children:[(0,t.jsx)(e$.TableCell,{children:e.metadata.alias}),(0,t.jsxs)(e$.TableCell,{children:["$",(0,M.formatNumberWithCommas)(e.metrics.spend,4)]}),(0,t.jsx)(e$.TableCell,{className:"text-green-600",children:e.metrics.successful_requests.toLocaleString()}),(0,t.jsx)(e$.TableCell,{className:"text-red-600",children:e.metrics.failed_requests.toLocaleString()}),(0,t.jsx)(e$.TableCell,{children:e.metrics.total_tokens.toLocaleString()})]},e.metadata.id))})]})})})]})]})})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Top Virtual Keys"}),(0,t.jsx)(ta.default,{topKeys:(console.log("debugTags",{spendData:j}),g={},j.results.forEach(e=>{let{breakdown:t}=e,{entities:s}=t;console.log("debugTags",{entities:s});let a=Object.keys(s).reduce((e,t)=>{let{api_key_breakdown:a}=s[t];return Object.keys(a).forEach(s=>{let r={tag:t,usage:a[s].metrics.spend};e[s]?e[s].push(r):e[s]=[r]}),e},{});console.log("debugTags",{tagDictionary:a}),Object.entries(e.breakdown.api_keys||{}).forEach(([e,t])=>{g[e]||(g[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{key_alias:t.metadata.key_alias,team_id:t.metadata.team_id||null,tags:a[e]||[]}},console.log("debugTags",{keySpend:g})),g[e].metrics.spend+=t.metrics.spend,g[e].metrics.prompt_tokens+=t.metrics.prompt_tokens,g[e].metrics.completion_tokens+=t.metrics.completion_tokens,g[e].metrics.total_tokens+=t.metrics.total_tokens,g[e].metrics.api_requests+=t.metrics.api_requests,g[e].metrics.successful_requests+=t.metrics.successful_requests,g[e].metrics.failed_requests+=t.metrics.failed_requests,g[e].metrics.cache_read_input_tokens+=t.metrics.cache_read_input_tokens||0,g[e].metrics.cache_creation_input_tokens+=t.metrics.cache_creation_input_tokens||0})}),Object.entries(g).map(([e,t])=>({api_key:e,key_alias:t.metadata.key_alias||"-",tags:t.metadata.tags||"-",spend:t.metrics.spend})).sort((e,t)=>t.spend-e.spend).slice(0,q)),teams:null,showTags:"tag"===s,topKeysLimit:q,setTopKeysLimit:S})]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"agent"===s?"Top Agents":"Top Models"}),(0,t.jsx)(tl,{topModels:(_={},j.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(([e,t])=>{_[e]||(_[e]={spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0});try{_[e].spend+=t.metrics.spend}catch(s){console.error(`Error adding spend for ${e}: ${s}, got metrics: ${JSON.stringify(t)}`)}_[e].requests+=t.metrics.api_requests,_[e].successful_requests+=t.metrics.successful_requests,_[e].failed_requests+=t.metrics.failed_requests,_[e].tokens+=t.metrics.total_tokens})}),Object.entries(_).map(([e,t])=>({key:e,...t})).sort((e,t)=>t.spend-e.spend).slice(0,L)),topModelsLimit:L,setTopModelsLimit:D})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsx)(i.Card,{children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsx)(p.Title,{children:"Provider Usage"}),(0,t.jsxs)(o.Grid,{numItems:2,children:[(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsx)(tt.DonutChart,{className:"mt-4 h-40",data:E(),index:"provider",category:"spend",valueFormatter:e=>`$${(0,M.formatNumberWithCommas)(e,2)}`,colors:["cyan","blue","indigo","violet","purple"]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(eA.Table,{children:[(0,t.jsx)(eE.TableHead,{children:(0,t.jsxs)(eO.TableRow,{children:[(0,t.jsx)(eM.TableHeaderCell,{children:"Provider"}),(0,t.jsx)(eM.TableHeaderCell,{children:"Spend"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-green-600",children:"Successful"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-red-600",children:"Failed"}),(0,t.jsx)(eM.TableHeaderCell,{children:"Tokens"})]})}),(0,t.jsx)(eF.TableBody,{children:E().map(e=>(0,t.jsxs)(eO.TableRow,{children:[(0,t.jsx)(e$.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[e.provider&&(0,t.jsx)("img",{src:(0,ts.getProviderLogoAndName)(e.provider).logo,alt:`${e.provider} logo`,className:"w-4 h-4",onError:t=>{let s=t.target,a=s.parentElement;if(a){let t=document.createElement("div");t.className="w-4 h-4 rounded-full bg-gray-200 flex items-center justify-center text-xs",t.textContent=e.provider?.charAt(0)||"-",a.replaceChild(t,s)}}}),(0,t.jsx)("span",{children:e.provider})]})}),(0,t.jsxs)(e$.TableCell,{children:["$",(0,M.formatNumberWithCommas)(e.spend,2)]}),(0,t.jsx)(e$.TableCell,{className:"text-green-600",children:e.successful_requests.toLocaleString()}),(0,t.jsx)(e$.TableCell,{className:"text-red-600",children:e.failed_requests.toLocaleString()}),(0,t.jsx)(e$.TableCell,{children:e.tokens.toLocaleString()})]},e.provider))})]})})]})]})})})]})}),(0,t.jsx)(u.TabPanel,{children:(0,t.jsx)(G,{modelMetrics:N,hidePromptCachingMetrics:"agent"===s})}),(0,t.jsx)(u.TabPanel,{children:(0,t.jsx)(G,{modelMetrics:T,hidePromptCachingMetrics:"agent"===s})}),(0,t.jsx)(u.TabPanel,{children:(0,t.jsx)(e8,{userSpendData:j})})]})]})]})};var tn=e.i(793130),to=e.i(418371);let tc=({loading:e,isDateChanging:a,providerSpend:r})=>{let[l,c]=(0,k.useState)(!1),[d,m]=(0,k.useState)(!1),u=r.filter(e=>e.provider?.toLowerCase()==="unknown"?d:!!l||e.spend>0);return(0,t.jsxs)(i.Card,{className:"h-full",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(p.Title,{children:"Spend by Provider"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm text-gray-700",children:"Show Zero Spend"}),(0,t.jsx)(tn.Switch,{checked:l,onChange:c})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("label",{className:"text-sm text-gray-700",children:"Show Unknown"}),(0,t.jsx)(j.Tooltip,{title:"Requests that failed to route to a provider",children:(0,t.jsx)(s.InfoCircleOutlined,{className:"text-gray-400 hover:text-gray-600"})})]}),(0,t.jsx)(tn.Switch,{checked:d,onChange:m})]})]})]}),e?(0,t.jsx)(eT,{isDateChanging:a}):(0,t.jsxs)(o.Grid,{numItems:2,children:[(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsx)(tt.DonutChart,{className:"mt-4 h-40",data:u,index:"provider",category:"spend",valueFormatter:e=>`$${(0,M.formatNumberWithCommas)(e,2)}`,colors:["cyan"]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(eA.Table,{children:[(0,t.jsx)(eE.TableHead,{children:(0,t.jsxs)(eO.TableRow,{children:[(0,t.jsx)(eM.TableHeaderCell,{children:"Provider"}),(0,t.jsx)(eM.TableHeaderCell,{children:"Spend"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-green-600",children:"Successful"}),(0,t.jsx)(eM.TableHeaderCell,{className:"text-red-600",children:"Failed"}),(0,t.jsx)(eM.TableHeaderCell,{children:"Tokens"})]})}),(0,t.jsx)(eF.TableBody,{children:u.map(e=>(0,t.jsxs)(eO.TableRow,{children:[(0,t.jsx)(e$.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[e.provider&&(0,t.jsx)(to.ProviderLogo,{provider:e.provider,className:"w-4 h-4"}),(0,t.jsx)("span",{children:e.provider})]})}),(0,t.jsxs)(e$.TableCell,{children:["$",(0,M.formatNumberWithCommas)(e.spend,2)]}),(0,t.jsx)(e$.TableCell,{className:"text-green-600",children:e.successful_requests.toLocaleString()}),(0,t.jsx)(e$.TableCell,{className:"text-red-600",children:e.failed_requests.toLocaleString()}),(0,t.jsx)(e$.TableCell,{children:e.tokens.toLocaleString()})]},e.provider))})]})})]})]})};var td=e.i(299251),tm=e.i(153702);let tu={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.4 800.9c.2-.3.5-.6.7-.9C920.6 722.1 960 621.7 960 512s-39.4-210.1-104.8-288c-.2-.3-.5-.5-.7-.8-1.1-1.3-2.1-2.5-3.2-3.7-.4-.5-.8-.9-1.2-1.4l-4.1-4.7-.1-.1c-1.5-1.7-3.1-3.4-4.6-5.1l-.1-.1c-3.2-3.4-6.4-6.8-9.7-10.1l-.1-.1-4.8-4.8-.3-.3c-1.5-1.5-3-2.9-4.5-4.3-.5-.5-1-1-1.6-1.5-1-1-2-1.9-3-2.8-.3-.3-.7-.6-1-1C736.4 109.2 629.5 64 512 64s-224.4 45.2-304.3 119.2c-.3.3-.7.6-1 1-1 .9-2 1.9-3 2.9-.5.5-1 1-1.6 1.5-1.5 1.4-3 2.9-4.5 4.3l-.3.3-4.8 4.8-.1.1c-3.3 3.3-6.5 6.7-9.7 10.1l-.1.1c-1.6 1.7-3.1 3.4-4.6 5.1l-.1.1c-1.4 1.5-2.8 3.1-4.1 4.7-.4.5-.8.9-1.2 1.4-1.1 1.2-2.1 2.5-3.2 3.7-.2.3-.5.5-.7.8C103.4 301.9 64 402.3 64 512s39.4 210.1 104.8 288c.2.3.5.6.7.9l3.1 3.7c.4.5.8.9 1.2 1.4l4.1 4.7c0 .1.1.1.1.2 1.5 1.7 3 3.4 4.6 5l.1.1c3.2 3.4 6.4 6.8 9.6 10.1l.1.1c1.6 1.6 3.1 3.2 4.7 4.7l.3.3c3.3 3.3 6.7 6.5 10.1 9.6 80.1 74 187 119.2 304.5 119.2s224.4-45.2 304.3-119.2a300 300 0 0010-9.6l.3-.3c1.6-1.6 3.2-3.1 4.7-4.7l.1-.1c3.3-3.3 6.5-6.7 9.6-10.1l.1-.1c1.5-1.7 3.1-3.3 4.6-5 0-.1.1-.1.1-.2 1.4-1.5 2.8-3.1 4.1-4.7.4-.5.8-.9 1.2-1.4a99 99 0 003.3-3.7zm4.1-142.6c-13.8 32.6-32 62.8-54.2 90.2a444.07 444.07 0 00-81.5-55.9c11.6-46.9 18.8-98.4 20.7-152.6H887c-3 40.9-12.6 80.6-28.5 118.3zM887 484H743.5c-1.9-54.2-9.1-105.7-20.7-152.6 29.3-15.6 56.6-34.4 81.5-55.9A373.86 373.86 0 01887 484zM658.3 165.5c39.7 16.8 75.8 40 107.6 69.2a394.72 394.72 0 01-59.4 41.8c-15.7-45-35.8-84.1-59.2-115.4 3.7 1.4 7.4 2.9 11 4.4zm-90.6 700.6c-9.2 7.2-18.4 12.7-27.7 16.4V697a389.1 389.1 0 01115.7 26.2c-8.3 24.6-17.9 47.3-29 67.8-17.4 32.4-37.8 58.3-59 75.1zm59-633.1c11 20.6 20.7 43.3 29 67.8A389.1 389.1 0 01540 327V141.6c9.2 3.7 18.5 9.1 27.7 16.4 21.2 16.7 41.6 42.6 59 75zM540 640.9V540h147.5c-1.6 44.2-7.1 87.1-16.3 127.8l-.3 1.2A445.02 445.02 0 00540 640.9zm0-156.9V383.1c45.8-2.8 89.8-12.5 130.9-28.1l.3 1.2c9.2 40.7 14.7 83.5 16.3 127.8H540zm-56 56v100.9c-45.8 2.8-89.8 12.5-130.9 28.1l-.3-1.2c-9.2-40.7-14.7-83.5-16.3-127.8H484zm-147.5-56c1.6-44.2 7.1-87.1 16.3-127.8l.3-1.2c41.1 15.6 85 25.3 130.9 28.1V484H336.5zM484 697v185.4c-9.2-3.7-18.5-9.1-27.7-16.4-21.2-16.7-41.7-42.7-59.1-75.1-11-20.6-20.7-43.3-29-67.8 37.2-14.6 75.9-23.3 115.8-26.1zm0-370a389.1 389.1 0 01-115.7-26.2c8.3-24.6 17.9-47.3 29-67.8 17.4-32.4 37.8-58.4 59.1-75.1 9.2-7.2 18.4-12.7 27.7-16.4V327zM365.7 165.5c3.7-1.5 7.3-3 11-4.4-23.4 31.3-43.5 70.4-59.2 115.4-21-12-40.9-26-59.4-41.8 31.8-29.2 67.9-52.4 107.6-69.2zM165.5 365.7c13.8-32.6 32-62.8 54.2-90.2 24.9 21.5 52.2 40.3 81.5 55.9-11.6 46.9-18.8 98.4-20.7 152.6H137c3-40.9 12.6-80.6 28.5-118.3zM137 540h143.5c1.9 54.2 9.1 105.7 20.7 152.6a444.07 444.07 0 00-81.5 55.9A373.86 373.86 0 01137 540zm228.7 318.5c-39.7-16.8-75.8-40-107.6-69.2 18.5-15.8 38.4-29.7 59.4-41.8 15.7 45 35.8 84.1 59.2 115.4-3.7-1.4-7.4-2.9-11-4.4zm292.6 0c-3.7 1.5-7.3 3-11 4.4 23.4-31.3 43.5-70.4 59.2-115.4 21 12 40.9 26 59.4 41.8a373.81 373.81 0 01-107.6 69.2z"}}]},name:"global",theme:"outlined"};var tx=k.forwardRef(function(e,t){return k.createElement(e_.default,(0,ef.default)({},e,{ref:t,icon:tu}))}),th=e.i(777579),tp=e.i(983561);let tf={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"}}]},name:"shopping-cart",theme:"outlined"};var tg=k.forwardRef(function(e,t){return k.createElement(e_.default,(0,ef.default)({},e,{ref:t,icon:tf}))}),t_=e.i(232164),tj=e.i(645526),ty=e.i(906579);let tb=[{value:"global",label:"Global Usage",showForAdmin:"Global Usage",showForNonAdmin:"Your Usage",description:"View usage across all resources",descriptionForAdmin:"View usage across all resources",descriptionForNonAdmin:"View your usage",icon:(0,t.jsx)(tx,{style:{fontSize:"16px"}})},{value:"organization",label:"Organization Usage",showForAdmin:"Organization Usage",showForNonAdmin:"Your Organization Usage",description:"View organization-level usage",descriptionForAdmin:"View usage across all organizations",descriptionForNonAdmin:"View your organization's usage",icon:(0,t.jsx)(td.BankOutlined,{style:{fontSize:"16px"}})},{value:"team",label:"Team Usage",description:"View usage by team",icon:(0,t.jsx)(tj.TeamOutlined,{style:{fontSize:"16px"}})},{value:"customer",label:"Customer Usage",description:"View usage by customer accounts",icon:(0,t.jsx)(tg,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"tag",label:"Tag Usage",description:"View usage grouped by tags",icon:(0,t.jsx)(t_.TagsOutlined,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"agent",label:"Agent Usage (A2A)",description:"View usage by AI agents",icon:(0,t.jsx)(tp.RobotOutlined,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"user-agent-activity",label:"User Agent Activity",description:"View detailed user agent activity logs",icon:(0,t.jsx)(th.LineChartOutlined,{style:{fontSize:"16px"}}),adminOnly:!0}],tk=({value:e,onChange:s,isAdmin:a,title:r="Usage View",description:l="Select the usage data you want to view","data-id":i})=>{let n=tb.filter(e=>!e.adminOnly||!!a).map(e=>{let t=e.label,s=e.description;return e.showForAdmin&&e.showForNonAdmin&&(t=a?e.showForAdmin:e.showForNonAdmin),e.descriptionForAdmin&&e.descriptionForNonAdmin&&(s=a?e.descriptionForAdmin:e.descriptionForNonAdmin),{value:e.value,label:t,description:s,icon:e.icon,badgeText:e.badgeText}});return(0,t.jsx)("div",{className:"w-full","data-id":i,children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-start gap-4",children:[(0,t.jsxs)("div",{className:"flex items-stretch gap-2 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,t.jsx)(tm.BarChartOutlined,{style:{fontSize:"32px"}})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-0.5 leading-tight",children:r}),(0,t.jsx)("p",{className:"text-xs text-gray-600 leading-tight",children:l})]})]}),(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(_.Select,{value:e,onChange:s,className:"w-54 sm:w-64 md:w-72",size:"large",options:n.map(e=>({value:e.value,label:e.label})),optionRender:e=>{let s=n.find(t=>t.value===e.value);return s?(0,t.jsxs)("div",{className:"flex items-center gap-2 py-1",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:s.icon}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:s.label}),(0,t.jsx)("div",{className:"text-xs text-gray-600 mt-0.5",children:s.description})]}),s.badgeText&&(0,t.jsx)("div",{className:"items-center",children:(0,t.jsx)(ty.Badge,{color:"blue",count:s.badgeText})})]}):e.label},labelRender:e=>{let s=n.find(t=>t.value===e.value);return s?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{children:s.icon}),(0,t.jsx)("span",{className:"text-sm",children:s.label})]}):e.label}})})]})})};e.s(["default",0,({teams:e,organizations:T})=>{let q,$,{accessToken:R,userRole:U,userId:V,premiumUser:P}=(0,w.default)(),[z,I]=(0,k.useState)({results:[],metadata:{}}),[W,B]=(0,k.useState)(!1),[H,K]=(0,k.useState)(!1),J=(0,k.useMemo)(()=>new Date(Date.now()-6048e5),[]),Q=(0,k.useMemo)(()=>new Date,[]),[X,ee]=(0,k.useState)({from:J,to:Q}),[et,es]=(0,k.useState)([]),{data:er=[]}=(()=>{let{accessToken:e,userRole:t}=(0,w.default)();return(0,N.useQuery)({queryKey:L.list({}),queryFn:async()=>await (0,v.allEndUsersCall)(e),enabled:!!e&&C.all_admin_roles.includes(t)})})(),{data:el}=S(),{data:ei}=(0,D.useCurrentUser)();console.log(`currentUser: ${JSON.stringify(ei)}`),console.log(`currentUser max budget: ${ei?.max_budget}`);let en=C.all_admin_roles.includes(U||""),[eo,ec]=(0,k.useState)(""),[ed,em]=(0,b.useDebouncedState)("",{wait:300}),{data:eu,fetchNextPage:ex,hasNextPage:ep,isFetchingNextPage:ef,isLoading:eg}=((e=O,t)=>{let{accessToken:s,userRole:a}=(0,w.default)();return(0,A.useInfiniteQuery)({queryKey:E.list({filters:{pageSize:e,...t&&{searchEmail:t}}}),queryFn:async({pageParam:a})=>await (0,v.userListCall)(s,null,a,e,t||null),initialPageParam:1,getNextPageParam:e=>{if(e.page<e.total_pages)return e.page+1},enabled:!!s&&C.all_admin_roles.includes(a)})})(50,ed||void 0),e_=(0,k.useMemo)(()=>{if(!eu?.pages)return[];let e=new Set,t=[];for(let s of eu.pages)for(let a of s.users)e.has(a.user_id)||(e.add(a.user_id),t.push({value:a.user_id,label:a.user_alias?`${a.user_alias} (${a.user_id})`:a.user_email?`${a.user_email} (${a.user_id})`:a.user_id}));return t},[eu]),[ej,ey]=(0,k.useState)(en?null:V||null),[eb,ek]=(0,k.useState)("groups"),[eN,eC]=(0,k.useState)(!1),[ew,eq]=(0,k.useState)(!1),[eS,eL]=(0,k.useState)("global"),[eD,eA]=(0,k.useState)(!0),[eE,eO]=(0,k.useState)(5),[eM,eF]=(0,k.useState)(5),e$=async()=>{R&&es(Object.values(await (0,v.tagListCall)(R)).map(e=>({label:e.name,value:e.name})))};(0,k.useEffect)(()=>{e$()},[R]),(0,k.useEffect)(()=>{!en&&V&&ey(V)},[en,V]);let eR=z.metadata?.total_spend||0,eP=(0,k.useCallback)(async()=>{if(!R||!X.from||!X.to)return;let e=en?ej:V||null;B(!0);let t=new Date(X.from),s=new Date(X.to);try{try{let a=await (0,v.userDailyActivityAggregatedCall)(R,t,s,e);I(a);return}catch(e){}let a=await (0,v.userDailyActivityCall)(R,t,s,1,e);if(a.metadata.total_pages<=1)return void I(a);let r=[...a.results],l={...a.metadata};for(let i=2;i<=a.metadata.total_pages;i++){let a=await (0,v.userDailyActivityCall)(R,t,s,i,e);r.push(...a.results),a.metadata&&(l.total_spend+=a.metadata.total_spend||0,l.total_api_requests+=a.metadata.total_api_requests||0,l.total_successful_requests+=a.metadata.total_successful_requests||0,l.total_failed_requests+=a.metadata.total_failed_requests||0,l.total_tokens+=a.metadata.total_tokens||0)}I({results:r,metadata:l})}catch(e){console.error("Error fetching user spend data:",e)}finally{B(!1),K(!1)}},[R,X.from,X.to,ej,en,V]),ez=(0,k.useCallback)(e=>{K(!0),B(!0),ee(e)},[]);(0,k.useEffect)(()=>{if(!X.from||!X.to)return;let e=setTimeout(()=>{eP()},50);return()=>clearTimeout(e)},[eP]);let eI=Z(z,"models",e),eW=Z(z,"api_keys",e),eB=Z(z,"mcp_servers",e);return(0,t.jsxs)("div",{style:{width:"100%"},className:"p-8 relative",children:[(0,t.jsx)("div",{className:"flex items-end justify-between gap-6 mb-6",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-end justify-between gap-6 mb-4 w-full",children:[(0,t.jsx)(tk,{value:eS,onChange:e=>eL(e),isAdmin:en}),(0,t.jsx)(ev,{value:X,onValueChange:ez})]}),"global"===eS&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(m.TabList,{variant:"solid",className:"mt-1",children:[(0,t.jsx)(c.Tab,{children:"Cost"}),(0,t.jsx)(c.Tab,{children:"Model Activity"}),(0,t.jsx)(c.Tab,{children:"Key Activity"}),(0,t.jsx)(c.Tab,{children:"MCP Server Activity"}),(0,t.jsx)(c.Tab,{children:"Endpoint Activity"})]}),(0,t.jsx)(F.Button,{onClick:()=>eq(!0),icon:()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),children:"Export Data"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsx)(u.TabPanel,{children:(0,t.jsxs)(o.Grid,{numItems:2,className:"gap-2 w-full",children:[(0,t.jsxs)(n.Col,{numColSpan:2,children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-2 mb-2",children:[(0,t.jsxs)(h.Text,{className:"text-tremor-default text-tremor-content dark:text-dark-tremor-content text-lg",children:["Project Spend"," ",X.from&&X.to&&(0,t.jsxs)(t.Fragment,{children:[X.from.toLocaleDateString("en-US",{month:"short",day:"numeric",year:X.from.getFullYear()!==X.to.getFullYear()?"numeric":void 0})," - ",X.to.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),en&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r.UserOutlined,{style:{fontSize:"14px",color:"#6b7280"}}),(0,t.jsx)(_.Select,{showSearch:!0,allowClear:!0,style:{width:300},placeholder:"All Users (Global View)",value:ej,onChange:e=>ey(e??null),filterOption:!1,onSearch:e=>{ec(e),em(e)},searchValue:eo,onPopupScroll:e=>{let t=e.currentTarget;(t.scrollTop+t.clientHeight)/t.scrollHeight>=.8&&ep&&!ef&&ex()},loading:eg,notFoundContent:eg?(0,t.jsx)(a.LoadingOutlined,{spin:!0}):"No users found",options:e_,popupRender:e=>(0,t.jsxs)(t.Fragment,{children:[e,ef&&(0,t.jsx)("div",{style:{textAlign:"center",padding:8},children:(0,t.jsx)(a.LoadingOutlined,{spin:!0})})]})}),ej&&(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"Filtering by user"})]})]}),(0,t.jsx)(eV.default,{userSpend:eR,selectedTeam:null,userMaxBudget:ei?.max_budget||null})]}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Usage Metrics"}),(0,t.jsxs)(o.Grid,{numItems:5,className:"gap-4 mt-4",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2",children:z.metadata?.total_api_requests?.toLocaleString()||0})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Successful Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2 text-green-600",children:z.metadata?.total_successful_requests?.toLocaleString()||0})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.Title,{children:"Failed Requests"}),(0,t.jsx)(j.Tooltip,{title:"Includes requests that failed to route to a provider, tool usage failures, and other request errors where the provider cannot be determined.",children:(0,t.jsx)(s.InfoCircleOutlined,{className:"text-gray-400 hover:text-gray-600"})})]}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2 text-red-600",children:z.metadata?.total_failed_requests?.toLocaleString()||0})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Tokens"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2",children:z.metadata?.total_tokens?.toLocaleString()||0})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Average Cost per Request"}),(0,t.jsxs)(h.Text,{className:"text-2xl font-bold mt-2",children:["$",(0,M.formatNumberWithCommas)((eR||0)/(z.metadata?.total_api_requests||1),4)]})]})]})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Daily Spend"}),W?(0,t.jsx)(eT,{isDateChanging:H}):(0,t.jsx)(l.BarChart,{data:[...z.results].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),index:"date",categories:["metrics.spend"],colors:["cyan"],valueFormatter:Y,yAxisWidth:100,showLegend:!1,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.date}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,M.formatNumberWithCommas)(a.metrics.spend,2)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Requests: ",a.metrics.api_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Successful: ",a.metrics.successful_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Failed: ",a.metrics.failed_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",a.metrics.total_tokens]})]})}})]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(i.Card,{className:"h-full",children:[(0,t.jsx)(p.Title,{children:"Top Virtual Keys"}),(0,t.jsx)(ta.default,{topKeys:((e=5)=>{let t={};return z.results.forEach(e=>{Object.entries(e.breakdown.api_keys||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{key_alias:s.metadata.key_alias,team_id:null,tags:s.metadata.tags||[]}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests,t[e].metrics.failed_requests+=s.metrics.failed_requests,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),console.log("debugTags",{keySpend:t,userSpendData:z}),Object.entries(t).map(([e,t])=>({api_key:e,key_alias:t.metadata.key_alias||"-",tags:t.metadata.tags||[],spend:t.metrics.spend})).sort((e,t)=>t.spend-e.spend).slice(0,e)})(eE),teams:null,topKeysLimit:eE,setTopKeysLimit:eO})]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(i.Card,{className:"h-full",children:[(0,t.jsx)(p.Title,{children:"groups"===eb?"Top Public Model Names":"Top Litellm Models"}),(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(g.Segmented,{options:[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25},{label:"50",value:50}],value:eM,onChange:e=>eF(e)}),(0,t.jsxs)("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[(0,t.jsx)("button",{className:`px-3 py-1 text-sm rounded-md transition-colors ${"groups"===eb?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,onClick:()=>ek("groups"),children:"Public Model Name"}),(0,t.jsx)("button",{className:`px-3 py-1 text-sm rounded-md transition-colors ${"individual"===eb?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,onClick:()=>ek("individual"),children:"Litellm Model Name"})]})]}),W?(0,t.jsx)(eT,{isDateChanging:H}):(0,t.jsx)("div",{className:"relative max-h-[600px] overflow-y-auto",children:(q="groups"===eb?((e=5)=>{let t={};return z.results.forEach(e=>{Object.entries(e.breakdown.model_groups||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests||0,t[e].metrics.failed_requests+=s.metrics.failed_requests||0,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),Object.entries(t).map(([e,t])=>({key:e,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens})).sort((e,t)=>t.spend-e.spend).slice(0,e)})(eM):((e=5)=>{let t={};return z.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests||0,t[e].metrics.failed_requests+=s.metrics.failed_requests||0,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),Object.entries(t).map(([e,t])=>({key:e,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens})).sort((e,t)=>t.spend-e.spend).slice(0,e)})(eM),(0,t.jsx)(l.BarChart,{className:"mt-4",style:{height:52*Math.min(q.length,eM)},data:q,index:"key",categories:["spend"],colors:["cyan"],valueFormatter:Y,layout:"vertical",yAxisWidth:200,showLegend:!1,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.key}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,M.formatNumberWithCommas)(a.spend,2)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total Requests: ",a.requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-green-600",children:["Successful: ",a.successful_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-red-600",children:["Failed: ",a.failed_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",a.tokens.toLocaleString()]})]})}}))})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsx)(tc,{loading:W,isDateChanging:H,providerSpend:($={},z.results.forEach(e=>{Object.entries(e.breakdown.providers||{}).forEach(([e,t])=>{$[e]||($[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),$[e].metrics.spend+=t.metrics.spend,$[e].metrics.prompt_tokens+=t.metrics.prompt_tokens,$[e].metrics.completion_tokens+=t.metrics.completion_tokens,$[e].metrics.total_tokens+=t.metrics.total_tokens,$[e].metrics.api_requests+=t.metrics.api_requests,$[e].metrics.successful_requests+=t.metrics.successful_requests||0,$[e].metrics.failed_requests+=t.metrics.failed_requests||0,$[e].metrics.cache_read_input_tokens+=t.metrics.cache_read_input_tokens||0,$[e].metrics.cache_creation_input_tokens+=t.metrics.cache_creation_input_tokens||0})}),Object.entries($).map(([e,t])=>({provider:e,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens})))})})]})}),(0,t.jsx)(u.TabPanel,{children:(0,t.jsx)(G,{modelMetrics:eI})}),(0,t.jsx)(u.TabPanel,{children:(0,t.jsx)(G,{modelMetrics:eW})}),(0,t.jsx)(u.TabPanel,{children:(0,t.jsx)(G,{modelMetrics:eB})}),(0,t.jsx)(u.TabPanel,{children:(0,t.jsx)(e8,{userSpendData:z})})]})]})}),"organization"===eS&&(0,t.jsx)(ti,{accessToken:R,entityType:"organization",userID:V,userRole:U,dateValue:X,entityList:T?.map(e=>({label:e.organization_alias,value:e.organization_id}))||null,premiumUser:P}),"team"===eS&&(0,t.jsx)(ti,{accessToken:R,entityType:"team",userID:V,userRole:U,entityList:e?.map(e=>({label:e.team_alias,value:e.team_id}))||null,premiumUser:P,dateValue:X}),"customer"===eS&&(0,t.jsx)(ti,{accessToken:R,entityType:"customer",userID:V,userRole:U,entityList:er?.map(e=>({label:e.alias||e.user_id,value:e.user_id}))||null,premiumUser:P,dateValue:X}),"tag"===eS&&(0,t.jsxs)(t.Fragment,{children:[eD&&(0,t.jsx)(f.Alert,{banner:!0,type:"info",message:"Reusable credentials are automatically tracked as tags",description:(0,t.jsxs)(y.Typography.Text,{children:["When a reusable credential is used, it will appear as a tag prefixed with"," ",(0,t.jsx)(y.Typography.Text,{code:!0,children:"Credential: "}),"in this view."]}),closable:!0,onClose:()=>eA(!1),className:"mb-5"}),(0,t.jsx)(ti,{accessToken:R,entityType:"tag",userID:V,userRole:U,entityList:et,premiumUser:P,dateValue:X})]}),"agent"===eS&&(0,t.jsx)(ti,{accessToken:R,entityType:"agent",userID:V,userRole:U,entityList:el?.agents?.map(e=>({label:e.agent_name,value:e.agent_id}))||null,premiumUser:P,dateValue:X}),"user-agent-activity"===eS&&(0,t.jsx)(eU,{accessToken:R,userRole:U,dateValue:X})]})}),(0,t.jsx)(ea,{isOpen:eN,onClose:()=>eC(!1),accessToken:R}),(0,t.jsx)(eh,{isOpen:ew,onClose:()=>eq(!1),entityType:"team",spendData:{results:z.results,metadata:z.metadata},dateRange:X,selectedFilters:[],customTitle:"Export Usage Data"})]})}],797305)}]);