"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1739],{12011:function(e,l,t){t.r(l),t.d(l,{default:function(){return w}});var s=t(57437),r=t(2265),a=t(99376),n=t(20831),i=t(94789),o=t(12514),c=t(49804),d=t(67101),u=t(84264),m=t(49566),x=t(96761),g=t(84566),h=t(19250),y=t(14474),f=t(13634),p=t(73002),j=t(3914);function w(){let[e]=f.Z.useForm(),l=(0,a.useSearchParams)();(0,j.e)("token");let t=l.get("invitation_id"),w=l.get("action"),[b,k]=(0,r.useState)(null),[v,S]=(0,r.useState)(""),[_,N]=(0,r.useState)(""),[C,I]=(0,r.useState)(null),[D,Z]=(0,r.useState)(""),[K,A]=(0,r.useState)(""),[E,O]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{(0,h.getUiConfig)().then(e=>{console.log("ui config in onboarding.tsx:",e),O(!1)})},[]),(0,r.useEffect)(()=>{t&&!E&&(0,h.getOnboardingCredentials)(t).then(e=>{let l=e.login_url;console.log("login_url:",l),Z(l);let t=e.token,s=(0,y.o)(t);A(t),console.log("decoded:",s),k(s.key),console.log("decoded user email:",s.user_email),N(s.user_email),I(s.user_id)})},[t,E]),(0,s.jsx)("div",{className:"mx-auto w-full max-w-md mt-10",children:(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(x.Z,{className:"text-sm mb-5 text-center",children:"\uD83D\uDE85 LiteLLM"}),(0,s.jsx)(x.Z,{className:"text-xl",children:"reset_password"===w?"Reset Password":"Sign up"}),(0,s.jsx)(u.Z,{children:"reset_password"===w?"Reset your password to access Admin UI.":"Claim your user account to login to Admin UI."}),"reset_password"!==w&&(0,s.jsx)(i.Z,{className:"mt-4",title:"SSO",icon:g.GH$,color:"sky",children:(0,s.jsxs)(d.Z,{numItems:2,className:"flex justify-between items-center",children:[(0,s.jsx)(c.Z,{children:"SSO is under the Enterprise Tier."}),(0,s.jsx)(c.Z,{children:(0,s.jsx)(n.Z,{variant:"primary",className:"mb-2",children:(0,s.jsx)("a",{href:"https://forms.gle/W3U4PZpJGFHWtHyA9",target:"_blank",children:"Get Free Trial"})})})]})}),(0,s.jsxs)(f.Z,{className:"mt-10 mb-5 mx-auto",layout:"vertical",onFinish:e=>{console.log("in handle submit. accessToken:",b,"token:",K,"formValues:",e),b&&K&&(e.user_email=_,C&&t&&(0,h.claimOnboardingToken)(b,t,C,e.password).then(e=>{let l="/ui/";l+="?login=success",document.cookie="token="+K,console.log("redirecting to:",l);let t=(0,h.getProxyBaseUrl)();console.log("proxyBaseUrl:",t),t?window.location.href=t+l:window.location.href=l}))},children:[(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z.Item,{label:"Email Address",name:"user_email",children:(0,s.jsx)(m.Z,{type:"email",disabled:!0,value:_,defaultValue:_,className:"max-w-md"})}),(0,s.jsx)(f.Z.Item,{label:"Password",name:"password",rules:[{required:!0,message:"password required to sign up"}],help:"reset_password"===w?"Enter your new password":"Create a password for your account",children:(0,s.jsx)(m.Z,{placeholder:"",type:"password",className:"max-w-md"})})]}),(0,s.jsx)("div",{className:"mt-10",children:(0,s.jsx)(p.ZP,{htmlType:"submit",children:"reset_password"===w?"Reset Password":"Sign Up"})})]})]})})}},49924:function(e,l,t){var s=t(2265),r=t(19250);l.Z=e=>{let{selectedTeam:l,currentOrg:t,selectedKeyAlias:a,accessToken:n,createClicked:i}=e,[o,c]=(0,s.useState)({keys:[],total_count:0,current_page:1,total_pages:0}),[d,u]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(console.log("calling fetchKeys"),!n){console.log("accessToken",n);return}u(!0);let l="number"==typeof e.page?e.page:1,t="number"==typeof e.pageSize?e.pageSize:100,s=await (0,r.keyListCall)(n,null,null,null,null,null,l,t);console.log("data",s),c(s),x(null)}catch(e){x(e instanceof Error?e:Error("An error occurred"))}finally{u(!1)}};return(0,s.useEffect)(()=>{g(),console.log("selectedTeam",l,"currentOrg",t,"accessToken",n,"selectedKeyAlias",a)},[l,t,n,a,i]),{keys:o.keys,isLoading:d,error:m,pagination:{currentPage:o.current_page,totalPages:o.total_pages,totalCount:o.total_count},refresh:g,setKeys:e=>{c(l=>{let t="function"==typeof e?e(l.keys):e;return{...l,keys:t}})}}}},21739:function(e,l,t){t.d(l,{Z:function(){return B}});var s=t(57437),r=t(2265),a=t(19250),n=t(39210),i=t(49804),o=t(67101),c=t(30874),d=t(7366),u=t(16721),m=t(46468),x=t(13634),g=t(82680),h=t(20577),y=t(29233),f=t(49924);t(25512);var p=t(16312),j=t(94292),w=t(89970),b=t(23048),k=t(16593),v=t(30841),S=t(7310),_=t.n(S),N=t(12363),C=t(59872),I=t(71594),D=t(24525),Z=t(10178),K=t(86462),A=t(47686),E=t(44633),O=t(49084),T=t(40728);function P(e){let{keys:l,setKeys:t,isLoading:n=!1,pagination:i,onPageChange:o,pageSize:c=50,teams:d,selectedTeam:u,setSelectedTeam:x,selectedKeyAlias:g,setSelectedKeyAlias:h,accessToken:y,userID:f,userRole:S,organizations:P,setCurrentOrg:U,refresh:L,onSortChange:z,currentSort:R,premiumUser:V,setAccessToken:F}=e,[M,B]=(0,r.useState)(null),[J,W]=(0,r.useState)([]),[H,q]=r.useState(()=>R?[{id:R.sortBy,desc:"desc"===R.sortOrder}]:[{id:"created_at",desc:!0}]),[G,X]=(0,r.useState)({}),{filters:$,filteredKeys:Y,allKeyAliases:Q,allTeams:ee,allOrganizations:el,handleFilterChange:et,handleFilterReset:es}=function(e){let{keys:l,teams:t,organizations:s,accessToken:n}=e,i={"Team ID":"","Organization ID":"","Key Alias":"","User ID":"","Sort By":"created_at","Sort Order":"desc"},[o,c]=(0,r.useState)(i),[d,u]=(0,r.useState)(t||[]),[m,x]=(0,r.useState)(s||[]),[g,h]=(0,r.useState)(l),y=(0,r.useRef)(0),f=(0,r.useCallback)(_()(async e=>{if(!n)return;let l=Date.now();y.current=l;try{let t=await (0,a.keyListCall)(n,e["Organization ID"]||null,e["Team ID"]||null,e["Key Alias"]||null,e["User ID"]||null,e["Key Hash"]||null,1,N.d,e["Sort By"]||null,e["Sort Order"]||null);l===y.current&&t&&(h(t.keys),console.log("called from debouncedSearch filters:",JSON.stringify(e)),console.log("called from debouncedSearch data:",JSON.stringify(t)))}catch(e){console.error("Error searching users:",e)}},300),[n]);(0,r.useEffect)(()=>{if(!l){h([]);return}let e=[...l];o["Team ID"]&&(e=e.filter(e=>e.team_id===o["Team ID"])),o["Organization ID"]&&(e=e.filter(e=>e.organization_id===o["Organization ID"])),h(e)},[l,o]),(0,r.useEffect)(()=>{let e=async()=>{let e=await (0,v.IE)(n);e.length>0&&u(e);let l=await (0,v.cT)(n);l.length>0&&x(l)};n&&e()},[n]);let p=(0,k.a)({queryKey:["allKeys"],queryFn:async()=>{if(!n)throw Error("Access token required");return await (0,v.LO)(n)},enabled:!!n}).data||[];return(0,r.useEffect)(()=>{t&&t.length>0&&u(e=>e.length<t.length?t:e)},[t]),(0,r.useEffect)(()=>{s&&s.length>0&&x(e=>e.length<s.length?s:e)},[s]),{filters:o,filteredKeys:g,allKeyAliases:p,allTeams:d,allOrganizations:m,handleFilterChange:e=>{c({"Team ID":e["Team ID"]||"","Organization ID":e["Organization ID"]||"","Key Alias":e["Key Alias"]||"","User ID":e["User ID"]||"","Sort By":e["Sort By"]||"created_at","Sort Order":e["Sort Order"]||"desc"}),f({...o,...e})},handleFilterReset:()=>{c(i),f(i)}}}({keys:l,teams:d,organizations:P,accessToken:y});(0,r.useEffect)(()=>{if(y){let e=l.map(e=>e.user_id).filter(e=>null!==e);(async()=>{W((await (0,a.userListCall)(y,e,1,100)).users)})()}},[y,l]),(0,r.useEffect)(()=>{if(L){let e=()=>{L()};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}},[L]);let er=[{id:"expander",header:()=>null,cell:e=>{let{row:l}=e;return l.getCanExpand()?(0,s.jsx)("button",{onClick:l.getToggleExpandedHandler(),style:{cursor:"pointer"},children:l.getIsExpanded()?"▼":"▶"}):null}},{id:"token",accessorKey:"token",header:"Key ID",cell:e=>(0,s.jsx)("div",{className:"overflow-hidden",children:(0,s.jsx)(w.Z,{title:e.getValue(),children:(0,s.jsx)(p.z,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>B(e.getValue()),children:e.getValue()?"".concat(e.getValue().slice(0,7),"..."):"-"})})})},{id:"key_alias",accessorKey:"key_alias",header:"Key Alias",cell:e=>{let l=e.getValue();return(0,s.jsx)(w.Z,{title:l,children:l?l.length>20?"".concat(l.slice(0,20),"..."):l:"-"})}},{id:"key_name",accessorKey:"key_name",header:"Secret Key",cell:e=>(0,s.jsx)("span",{className:"font-mono text-xs",children:e.getValue()})},{id:"team_alias",accessorKey:"team_id",header:"Team Alias",cell:e=>{let{row:l,getValue:t}=e,s=t(),r=null==d?void 0:d.find(e=>e.team_id===s);return(null==r?void 0:r.team_alias)||"Unknown"}},{id:"team_id",accessorKey:"team_id",header:"Team ID",cell:e=>(0,s.jsx)(w.Z,{title:e.getValue(),children:e.getValue()?"".concat(e.getValue().slice(0,7),"..."):"-"})},{id:"organization_id",accessorKey:"organization_id",header:"Organization ID",cell:e=>e.getValue()?e.renderValue():"-"},{id:"user_email",accessorKey:"user_id",header:"User Email",cell:e=>{let l=e.getValue(),t=J.find(e=>e.user_id===l);return(null==t?void 0:t.user_email)?(0,s.jsx)(w.Z,{title:null==t?void 0:t.user_email,children:(0,s.jsxs)("span",{children:[null==t?void 0:t.user_email.slice(0,20),"..."]})}):"-"}},{id:"user_id",accessorKey:"user_id",header:"User ID",cell:e=>{let l=e.getValue();return l&&l.length>15?(0,s.jsx)(w.Z,{title:l,children:(0,s.jsxs)("span",{children:[l.slice(0,7),"..."]})}):l||"-"}},{id:"created_at",accessorKey:"created_at",header:"Created At",cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleDateString():"-"}},{id:"created_by",accessorKey:"created_by",header:"Created By",cell:e=>{let l=e.getValue();return l&&l.length>15?(0,s.jsx)(w.Z,{title:l,children:(0,s.jsxs)("span",{children:[l.slice(0,7),"..."]})}):l}},{id:"updated_at",accessorKey:"updated_at",header:"Updated At",cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleDateString():"Never"}},{id:"expires",accessorKey:"expires",header:"Expires",cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleDateString():"Never"}},{id:"spend",accessorKey:"spend",header:"Spend (USD)",cell:e=>(0,C.pw)(e.getValue(),4)},{id:"max_budget",accessorKey:"max_budget",header:"Budget (USD)",cell:e=>{let l=e.getValue();return null===l?"Unlimited":"$".concat((0,C.pw)(l))}},{id:"budget_reset_at",accessorKey:"budget_reset_at",header:"Budget Reset",cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleString():"Never"}},{id:"models",accessorKey:"models",header:"Models",cell:e=>{let l=e.getValue();return(0,s.jsx)("div",{className:"flex flex-col py-2",children:Array.isArray(l)?(0,s.jsx)("div",{className:"flex flex-col",children:0===l.length?(0,s.jsx)(T.C,{size:"xs",className:"mb-1",color:"red",children:(0,s.jsx)(T.x,{children:"All Proxy Models"})}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex items-start",children:[l.length>3&&(0,s.jsx)("div",{children:(0,s.jsx)(Z.JO,{icon:G[e.row.id]?K.Z:A.Z,className:"cursor-pointer",size:"xs",onClick:()=>{X(l=>({...l,[e.row.id]:!l[e.row.id]}))}})}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[l.slice(0,3).map((e,l)=>"all-proxy-models"===e?(0,s.jsx)(T.C,{size:"xs",color:"red",children:(0,s.jsx)(T.x,{children:"All Proxy Models"})},l):(0,s.jsx)(T.C,{size:"xs",color:"blue",children:(0,s.jsx)(T.x,{children:e.length>30?"".concat((0,m.W0)(e).slice(0,30),"..."):(0,m.W0)(e)})},l)),l.length>3&&!G[e.row.id]&&(0,s.jsx)(T.C,{size:"xs",color:"gray",className:"cursor-pointer",children:(0,s.jsxs)(T.x,{children:["+",l.length-3," ",l.length-3==1?"more model":"more models"]})}),G[e.row.id]&&(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:l.slice(3).map((e,l)=>"all-proxy-models"===e?(0,s.jsx)(T.C,{size:"xs",color:"red",children:(0,s.jsx)(T.x,{children:"All Proxy Models"})},l+3):(0,s.jsx)(T.C,{size:"xs",color:"blue",children:(0,s.jsx)(T.x,{children:e.length>30?"".concat((0,m.W0)(e).slice(0,30),"..."):(0,m.W0)(e)})},l+3))})]})]})})}):null})}},{id:"rate_limits",header:"Rate Limits",cell:e=>{let{row:l}=e,t=l.original;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{children:["TPM: ",null!==t.tpm_limit?t.tpm_limit:"Unlimited"]}),(0,s.jsxs)("div",{children:["RPM: ",null!==t.rpm_limit?t.rpm_limit:"Unlimited"]})]})}}];console.log("keys: ".concat(JSON.stringify(l)));let ea=(0,I.b7)({data:Y,columns:er.filter(e=>"expander"!==e.id),state:{sorting:H},onSortingChange:e=>{let l="function"==typeof e?e(H):e;if(console.log("newSorting: ".concat(JSON.stringify(l))),q(l),l&&l.length>0){let e=l[0],t=e.id,s=e.desc?"desc":"asc";console.log("sortBy: ".concat(t,", sortOrder: ").concat(s)),et({...$,"Sort By":t,"Sort Order":s}),null==z||z(t,s)}},getCoreRowModel:(0,D.sC)(),getSortedRowModel:(0,D.tj)(),enableSorting:!0,manualSorting:!1});return r.useEffect(()=>{R&&q([{id:R.sortBy,desc:"desc"===R.sortOrder}])},[R]),(0,s.jsx)("div",{className:"w-full h-full overflow-hidden",children:M?(0,s.jsx)(j.Z,{keyId:M,onClose:()=>B(null),keyData:Y.find(e=>e.token===M),onKeyDataUpdate:e=>{t(l=>l.map(l=>l.token===e.token?(0,C.nl)(l,e):l)),L&&L()},onDelete:()=>{t(e=>e.filter(e=>e.token!==M)),L&&L()},accessToken:y,userID:f,userRole:S,teams:ee,premiumUser:V,setAccessToken:F}):(0,s.jsxs)("div",{className:"border-b py-4 flex-1 overflow-hidden",children:[(0,s.jsx)("div",{className:"w-full mb-6",children:(0,s.jsx)(b.Z,{options:[{name:"Team ID",label:"Team ID",isSearchable:!0,searchFn:async e=>ee&&0!==ee.length?ee.filter(l=>l.team_id.toLowerCase().includes(e.toLowerCase())||l.team_alias&&l.team_alias.toLowerCase().includes(e.toLowerCase())).map(e=>({label:"".concat(e.team_alias||e.team_id," (").concat(e.team_id,")"),value:e.team_id})):[]},{name:"Organization ID",label:"Organization ID",isSearchable:!0,searchFn:async e=>el&&0!==el.length?el.filter(l=>{var t,s;return null!==(s=null===(t=l.organization_id)||void 0===t?void 0:t.toLowerCase().includes(e.toLowerCase()))&&void 0!==s&&s}).filter(e=>null!==e.organization_id&&void 0!==e.organization_id).map(e=>({label:"".concat(e.organization_id||"Unknown"," (").concat(e.organization_id,")"),value:e.organization_id})):[]},{name:"Key Alias",label:"Key Alias",isSearchable:!0,searchFn:async e=>Q.filter(l=>l.toLowerCase().includes(e.toLowerCase())).map(e=>({label:e,value:e}))},{name:"User ID",label:"User ID",isSearchable:!1},{name:"Key Hash",label:"Key Hash",isSearchable:!1}],onApplyFilters:et,initialValues:$,onResetFilters:es})}),(0,s.jsxs)("div",{className:"flex items-center justify-between w-full mb-4",children:[(0,s.jsxs)("span",{className:"inline-flex text-sm text-gray-700",children:["Showing"," ",n?"...":"".concat((i.currentPage-1)*c+1," - ").concat(Math.min(i.currentPage*c,i.totalCount))," ","of ",n?"...":i.totalCount," results"]}),(0,s.jsxs)("div",{className:"inline-flex items-center gap-2",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-700",children:["Page ",n?"...":i.currentPage," of ",n?"...":i.totalPages]}),(0,s.jsx)("button",{onClick:()=>o(i.currentPage-1),disabled:n||1===i.currentPage,className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,s.jsx)("button",{onClick:()=>o(i.currentPage+1),disabled:n||i.currentPage===i.totalPages,className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]}),(0,s.jsx)("div",{className:"h-[75vh] overflow-auto",children:(0,s.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(Z.iA,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,s.jsx)(Z.ss,{children:ea.getHeaderGroups().map(e=>(0,s.jsx)(Z.SC,{children:e.headers.map(e=>(0,s.jsx)(Z.xs,{className:"py-1 h-8 ".concat("actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),onClick:e.column.getToggleSortingHandler(),children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,I.ie)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,s.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,s.jsx)(E.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,s.jsx)(K.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,s.jsx)(O.Z,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,s.jsx)(Z.RM,{children:n?(0,s.jsx)(Z.SC,{children:(0,s.jsx)(Z.pj,{colSpan:er.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"\uD83D\uDE85 Loading keys..."})})})}):Y.length>0?ea.getRowModel().rows.map(e=>(0,s.jsx)(Z.SC,{className:"h-8",children:e.getVisibleCells().map(e=>(0,s.jsx)(Z.pj,{style:{maxWidth:"8-x",whiteSpace:"pre-wrap",overflow:"hidden"},className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ".concat("models"===e.column.id&&e.getValue().length>3?"px-0":""),children:(0,I.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,s.jsx)(Z.SC,{children:(0,s.jsx)(Z.pj,{colSpan:er.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"No keys found"})})})})})]})})})})]})})}var U=t(9114),L=e=>{let{userID:l,userRole:t,accessToken:n,selectedTeam:i,setSelectedTeam:o,data:c,setData:p,teams:j,premiumUser:w,currentOrg:b,organizations:k,setCurrentOrg:v,selectedKeyAlias:S,setSelectedKeyAlias:_,createClicked:N,setAccessToken:C}=e,[I,D]=(0,r.useState)(!1),[Z,K]=(0,r.useState)(!1),[A,E]=(0,r.useState)(null),[O,T]=(0,r.useState)(""),[L,z]=(0,r.useState)(null),[R,V]=(0,r.useState)(null),[F,M]=(0,r.useState)((null==i?void 0:i.team_id)||"");(0,r.useEffect)(()=>{M((null==i?void 0:i.team_id)||"")},[i]);let{keys:B,isLoading:J,error:W,pagination:H,refresh:q,setKeys:G}=(0,f.Z)({selectedTeam:i||void 0,currentOrg:b,selectedKeyAlias:S,accessToken:n||"",createClicked:N}),[X,$]=(0,r.useState)(!1),[Y,Q]=(0,r.useState)(!1),[ee,el]=(0,r.useState)(null),[et,es]=(0,r.useState)([]),er=new Set,[ea,en]=(0,r.useState)(!1),[ei,eo]=(0,r.useState)(!1),[ec,ed]=(0,r.useState)(null),[eu,em]=(0,r.useState)(null),[ex]=x.Z.useForm(),[eg,eh]=(0,r.useState)(null),[ey,ef]=(0,r.useState)(er),[ep,ej]=(0,r.useState)([]);(0,r.useEffect)(()=>{console.log("in calculateNewExpiryTime for selectedToken",ee),(null==eu?void 0:eu.duration)?eh((e=>{if(!e)return null;try{let l;let t=new Date;if(e.endsWith("s"))l=(0,d.Z)(t,{seconds:parseInt(e)});else if(e.endsWith("h"))l=(0,d.Z)(t,{hours:parseInt(e)});else if(e.endsWith("d"))l=(0,d.Z)(t,{days:parseInt(e)});else throw Error("Invalid duration format");return l.toLocaleString("en-US",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})}catch(e){return null}})(eu.duration)):eh(null),console.log("calculateNewExpiryTime:",eg)},[ee,null==eu?void 0:eu.duration]),(0,r.useEffect)(()=>{(async()=>{try{if(null===l||null===t||null===n)return;let e=await (0,m.K2)(l,t,n);e&&es(e)}catch(e){U.Z.error({description:"Error fetching user models"})}})()},[n,l,t]),(0,r.useEffect)(()=>{if(j){let e=new Set;j.forEach((l,t)=>{let s=l.team_id;e.add(s)}),ef(e)}},[j]);let ew=async()=>{if(null!=A&&null!=B){try{if(!n)return;await (0,a.keyDeleteCall)(n,A);let e=B.filter(e=>e.token!==A);G(e)}catch(e){U.Z.error({description:"Error deleting the key"})}K(!1),E(null),T("")}},eb=()=>{K(!1),E(null),T("")},ek=(e,l)=>{em(t=>({...t,[e]:l}))},ev=async()=>{if(!w){U.Z.warning({description:"Regenerate API Key is an Enterprise feature. Please upgrade to use this feature."});return}if(null!=ee)try{let e=await ex.validateFields();if(!n)return;let l=await (0,a.regenerateKeyCall)(n,ee.token||ee.token_id,e);if(ed(l.key),c){let t=c.map(t=>t.token===(null==ee?void 0:ee.token)?{...t,key_name:l.key_name,...e}:t);p(t)}eo(!1),ex.resetFields(),U.Z.success({description:"API Key regenerated successfully"})}catch(e){console.error("Error regenerating key:",e),U.Z.error({description:"Failed to regenerate API Key"})}};return(0,s.jsxs)("div",{children:[(0,s.jsx)(P,{keys:B,setKeys:G,isLoading:J,pagination:H,onPageChange:e=>{q({page:e})},pageSize:100,teams:j,selectedTeam:i,setSelectedTeam:o,accessToken:n,userID:l,userRole:t,organizations:k,setCurrentOrg:v,refresh:q,selectedKeyAlias:S,setSelectedKeyAlias:_,premiumUser:w,setAccessToken:C}),Z&&(()=>{let e=null==B?void 0:B.find(e=>e.token===A),l=(null==e?void 0:e.key_alias)||(null==e?void 0:e.token_id)||A,t=O===l;return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl min-h-[380px] py-6 overflow-hidden transform transition-all flex flex-col justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete Key"}),(0,s.jsx)("button",{onClick:()=>{eb(),T("")},className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"px-6 py-4",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-red-50 border border-red-100 rounded-md mb-5",children:[(0,s.jsx)("div",{className:"text-red-500 mt-0.5",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-base font-medium text-red-600",children:"Warning: You are about to delete this API key."}),(0,s.jsx)("p",{className:"text-base text-red-600 mt-2",children:"This action is irreversible and will immediately revoke access for any applications using this key."})]})]}),(0,s.jsx)("p",{className:"text-base text-gray-600 mb-5",children:"Are you sure you want to delete this API key?"}),(0,s.jsxs)("div",{className:"mb-5",children:[(0,s.jsxs)("label",{className:"block text-base font-medium text-gray-700 mb-2",children:["Type ",(0,s.jsx)("span",{className:"underline",children:l})," to confirm deletion:"]}),(0,s.jsx)("input",{type:"text",value:O,onChange:e=>T(e.target.value),placeholder:"Enter key name exactly",className:"w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base",autoFocus:!0})]})]})]}),(0,s.jsxs)("div",{className:"px-6 py-4 bg-gray-50 flex justify-end gap-4",children:[(0,s.jsx)("button",{onClick:()=>{eb(),T("")},className:"px-5 py-3 bg-white border border-gray-300 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),(0,s.jsx)("button",{onClick:ew,disabled:!t,className:"px-5 py-3 rounded-md text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 ".concat(t?"bg-red-600 hover:bg-red-700":"bg-red-300 cursor-not-allowed"),children:"Delete Key"})]})]})})})(),(0,s.jsx)(g.Z,{title:"Regenerate API Key",visible:ei,onCancel:()=>{eo(!1),ex.resetFields()},footer:[(0,s.jsx)(u.zx,{onClick:()=>{eo(!1),ex.resetFields()},className:"mr-2",children:"Cancel"},"cancel"),(0,s.jsx)(u.zx,{onClick:ev,disabled:!w,children:w?"Regenerate":"Upgrade to Regenerate"},"regenerate")],children:w?(0,s.jsxs)(x.Z,{form:ex,layout:"vertical",onValuesChange:(e,l)=>{"duration"in e&&ek("duration",e.duration)},children:[(0,s.jsx)(x.Z.Item,{name:"key_alias",label:"Key Alias",children:(0,s.jsx)(u.oi,{disabled:!0})}),(0,s.jsx)(x.Z.Item,{name:"max_budget",label:"Max Budget (USD)",children:(0,s.jsx)(h.Z,{step:.01,precision:2,style:{width:"100%"}})}),(0,s.jsx)(x.Z.Item,{name:"tpm_limit",label:"TPM Limit",children:(0,s.jsx)(h.Z,{style:{width:"100%"}})}),(0,s.jsx)(x.Z.Item,{name:"rpm_limit",label:"RPM Limit",children:(0,s.jsx)(h.Z,{style:{width:"100%"}})}),(0,s.jsx)(x.Z.Item,{name:"duration",label:"Expire Key (eg: 30s, 30h, 30d)",className:"mt-8",children:(0,s.jsx)(u.oi,{placeholder:""})}),(0,s.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:["Current expiry:"," ",(null==ee?void 0:ee.expires)!=null?new Date(ee.expires).toLocaleString():"Never"]}),eg&&(0,s.jsxs)("div",{className:"mt-2 text-sm text-green-600",children:["New expiry: ",eg]})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-2 text-gray-500 italic text-[12px]",children:"Upgrade to use this feature"}),(0,s.jsx)(u.zx,{variant:"primary",className:"mb-2",children:(0,s.jsx)("a",{href:"https://calendly.com/d/4mp-gd3-k5k/litellm-1-1-onboarding-chat",target:"_blank",children:"Get Free Trial"})})]})}),ec&&(0,s.jsx)(g.Z,{visible:!!ec,onCancel:()=>ed(null),footer:[(0,s.jsx)(u.zx,{onClick:()=>ed(null),children:"Close"},"close")],children:(0,s.jsxs)(u.rj,{numItems:1,className:"gap-2 w-full",children:[(0,s.jsx)(u.Dx,{children:"Regenerated Key"}),(0,s.jsx)(u.JX,{numColSpan:1,children:(0,s.jsxs)("p",{children:["Please replace your old key with the new key generated. For security reasons,"," ",(0,s.jsx)("b",{children:"you will not be able to view it again"})," through your LiteLLM account. If you lose this secret key, you will need to generate a new one."]})}),(0,s.jsxs)(u.JX,{numColSpan:1,children:[(0,s.jsx)(u.xv,{className:"mt-3",children:"Key Alias:"}),(0,s.jsx)("div",{style:{background:"#f8f8f8",padding:"10px",borderRadius:"5px",marginBottom:"10px"},children:(0,s.jsx)("pre",{style:{wordWrap:"break-word",whiteSpace:"normal"},children:(null==ee?void 0:ee.key_alias)||"No alias set"})}),(0,s.jsx)(u.xv,{className:"mt-3",children:"New API Key:"}),(0,s.jsx)("div",{style:{background:"#f8f8f8",padding:"10px",borderRadius:"5px",marginBottom:"10px"},children:(0,s.jsx)("pre",{style:{wordWrap:"break-word",whiteSpace:"normal"},children:ec})}),(0,s.jsx)(y.CopyToClipboard,{text:ec,onCopy:()=>U.Z.success({description:"API Key copied to clipboard"}),children:(0,s.jsx)(u.zx,{className:"mt-3",children:"Copy API Key"})})]})]})})]})},z=t(12011),R=t(99376),V=t(14474),F=t(93192),M=t(3914),B=e=>{let{userID:l,userRole:t,teams:d,keys:u,setUserRole:m,userEmail:x,setUserEmail:g,setTeams:h,setKeys:y,premiumUser:f,organizations:p,addKey:j,createClicked:w}=e,[b,k]=(0,r.useState)(null),[v,S]=(0,r.useState)(null),_=(0,R.useSearchParams)(),N=function(e){console.log("COOKIES",document.cookie);let l=document.cookie.split("; ").find(l=>l.startsWith(e+"="));return l?l.split("=")[1]:null}("token"),C=_.get("invitation_id"),[I,D]=(0,r.useState)(null),[Z,K]=(0,r.useState)(null),[A,E]=(0,r.useState)([]),[O,T]=(0,r.useState)(null),[P,U]=(0,r.useState)(null),[B,J]=(0,r.useState)(null);if(window.addEventListener("beforeunload",function(){sessionStorage.clear()}),(0,r.useEffect)(()=>{if(N){let e=(0,V.o)(N);if(e){if(console.log("Decoded token:",e),console.log("Decoded key:",e.key),D(e.key),e.user_role){let l=function(e){if(!e)return"Undefined Role";switch(console.log("Received user role: ".concat(e)),e.toLowerCase()){case"app_owner":case"demo_app_owner":return"App Owner";case"app_admin":case"proxy_admin":return"Admin";case"proxy_admin_viewer":return"Admin Viewer";case"app_user":return"App User";case"internal_user":return"Internal User";case"internal_user_viewer":return"Internal Viewer";default:return"Unknown Role"}}(e.user_role);console.log("Decoded user_role:",l),m(l)}else console.log("User role not defined");e.user_email?g(e.user_email):console.log("User Email is not set ".concat(e))}}if(l&&I&&t&&!u&&!b){let e=sessionStorage.getItem("userModels"+l);e?E(JSON.parse(e)):(console.log("currentOrg: ".concat(JSON.stringify(v))),(async()=>{try{let e=await (0,a.getProxyUISettings)(I);T(e);let s=await (0,a.userInfoCall)(I,l,t,!1,null,null);k(s.user_info),console.log("userSpendData: ".concat(JSON.stringify(b))),(null==s?void 0:s.teams[0].keys)?y(s.keys.concat(s.teams.filter(e=>"Admin"===t||e.user_id===l).flatMap(e=>e.keys))):y(s.keys),sessionStorage.setItem("userData"+l,JSON.stringify(s.keys)),sessionStorage.setItem("userSpendData"+l,JSON.stringify(s.user_info));let r=(await (0,a.modelAvailableCall)(I,l,t)).data.map(e=>e.id);console.log("available_model_names:",r),E(r),console.log("userModels:",A),sessionStorage.setItem("userModels"+l,JSON.stringify(r))}catch(e){console.error("There was an error fetching the data",e),e.message.includes("Invalid proxy server token passed")&&W()}})(),(0,n.Z)(I,l,t,v,h))}},[l,N,I,u,t]),(0,r.useEffect)(()=>{I&&(async()=>{try{let e=await (0,a.keyInfoCall)(I,[I]);console.log("keyInfo: ",e)}catch(e){e.message.includes("Invalid proxy server token passed")&&W()}})()},[I]),(0,r.useEffect)(()=>{console.log("currentOrg: ".concat(JSON.stringify(v),", accessToken: ").concat(I,", userID: ").concat(l,", userRole: ").concat(t)),I&&(console.log("fetching teams"),(0,n.Z)(I,l,t,v,h))},[v]),(0,r.useEffect)(()=>{if(null!==u&&null!=P&&null!==P.team_id){let e=0;for(let l of(console.log("keys: ".concat(JSON.stringify(u))),u))P.hasOwnProperty("team_id")&&null!==l.team_id&&l.team_id===P.team_id&&(e+=l.spend);console.log("sum: ".concat(e)),K(e)}else if(null!==u){let e=0;for(let l of u)e+=l.spend;K(e)}},[P]),null!=C)return(0,s.jsx)(z.default,{});function W(){(0,M.b)();let e=(0,a.getProxyBaseUrl)();console.log("proxyBaseUrl:",e);let l=e?"".concat(e,"/sso/key/generate"):"/sso/key/generate";return console.log("Full URL:",l),window.location.href=l,null}if(null==N)return console.log("All cookies before redirect:",document.cookie),W(),null;try{let e=(0,V.o)(N);console.log("Decoded token:",e);let l=e.exp,t=Math.floor(Date.now()/1e3);if(l&&t>=l)return console.log("Token expired, redirecting to login"),W(),null}catch(e){return console.error("Error decoding token:",e),(0,M.b)(),W(),null}if(null==I)return null;if(null==l)return(0,s.jsx)("h1",{children:"User ID is not set"});if(null==t&&m("App Owner"),t&&"Admin Viewer"==t){let{Title:e,Paragraph:l}=F.default;return(0,s.jsxs)("div",{children:[(0,s.jsx)(e,{level:1,children:"Access Denied"}),(0,s.jsx)(l,{children:"Ask your proxy admin for access to create keys"})]})}return console.log("inside user dashboard, selected team",P),console.log("All cookies after redirect:",document.cookie),(0,s.jsx)("div",{className:"w-full mx-4 h-[75vh]",children:(0,s.jsx)(o.Z,{numItems:1,className:"gap-2 p-8 w-full mt-2",children:(0,s.jsxs)(i.Z,{numColSpan:1,className:"flex flex-col gap-2",children:[(0,s.jsx)(c.ZP,{userID:l,team:P,teams:d,userRole:t,accessToken:I,data:u,addKey:j,premiumUser:f},P?P.team_id:null),(0,s.jsx)(L,{userID:l,userRole:t,accessToken:I,selectedTeam:P||null,setSelectedTeam:U,selectedKeyAlias:B,setSelectedKeyAlias:J,data:u,setData:y,premiumUser:f,teams:d,currentOrg:v,setCurrentOrg:S,organizations:p,createClicked:w,setAccessToken:D})]})})})}}}]);