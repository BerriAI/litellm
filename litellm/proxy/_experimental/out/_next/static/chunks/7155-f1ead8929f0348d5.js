"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7155],{88913:function(e,s,l){l.d(s,{Dx:function(){return d.Z},Zb:function(){return a.Z},iz:function(){return r.Z},oi:function(){return n.Z},xv:function(){return i.Z},zx:function(){return t.Z}});var t=l(20831),a=l(12514),r=l(67982),i=l(84264),n=l(49566),d=l(96761)},21609:function(e,s,l){l.d(s,{Z:function(){return c}});var t=l(57437),a=l(57840),r=l(22116),i=l(61778),n=l(76188),d=l(64482),o=l(2265);function c(e){let{isOpen:s,title:l,alertMessage:c,message:u,resourceInformationTitle:m,resourceInformation:x,onCancel:h,onOk:g,confirmLoading:j,requiredConfirmation:v}=e,{Title:p,Text:f}=a.default,[y,b]=(0,o.useState)("");return(0,o.useEffect)(()=>{s&&b("")},[s]),(0,t.jsx)(r.Z,{title:l,open:s,onOk:g,onCancel:h,confirmLoading:j,okText:j?"Deleting...":"Delete",cancelText:"Cancel",okButtonProps:{danger:!0,disabled:!!v&&y!==v||j},cancelButtonProps:{disabled:j},children:(0,t.jsxs)("div",{className:"space-y-4",children:[c&&(0,t.jsx)(i.Z,{message:c,type:"warning"}),(0,t.jsx)("div",{children:(0,t.jsx)(f,{children:u})}),(0,t.jsxs)("div",{className:"mt-4 p-4 bg-red-50 rounded-lg border border-red-200",children:[(0,t.jsx)(p,{level:5,className:"mb-3 text-gray-900",children:m}),(0,t.jsx)(n.Z,{column:1,size:"small",children:x&&x.map(e=>{let{label:s,value:l,...a}=e;return(0,t.jsx)(n.Z.Item,{label:(0,t.jsx)("span",{className:"font-semibold text-gray-700",children:s}),children:(0,t.jsx)(f,{...a,children:null!=l?l:"-"})},s)})})]}),v&&(0,t.jsxs)("div",{className:"mb-5",children:[(0,t.jsxs)(f,{className:"block text-base font-medium text-gray-700 mb-2",children:["Type ",(0,t.jsx)("span",{className:"underline",children:v})," to confirm deletion:"]}),(0,t.jsx)(d.default,{value:y,onChange:e=>b(e.target.value),placeholder:v,className:"rounded-md",autoFocus:!0})]})]})})}},77155:function(e,s,l){l.d(s,{Z:function(){return eN}});var t=l(57437),a=l(58643),r=l(2265),i=l(16312),n=l(57840),d=l(42264),o=l(22116),c=l(61994),u=l(81915),m=l(23496),x=l(5945),h=l(93142),g=l(52787),j=l(20577),v=l(19250),p=l(13634),f=l(89970),y=l(24199),b=l(57365),_=l(49566),N=l(16853),w=l(46468),k=l(20347),Z=l(15424),S=l(65925);function C(e){let{userData:s,onCancel:l,onSubmit:a,teams:n,accessToken:d,userID:o,userRole:c,userModels:u,possibleUIRoles:m,isBulkEdit:x=!1}=e,[h]=p.Z.useForm();return r.useEffect(()=>{var e,l,t,a,r,i,n;h.setFieldsValue({user_id:s.user_id,user_email:null===(e=s.user_info)||void 0===e?void 0:e.user_email,user_alias:null===(l=s.user_info)||void 0===l?void 0:l.user_alias,user_role:null===(t=s.user_info)||void 0===t?void 0:t.user_role,models:(null===(a=s.user_info)||void 0===a?void 0:a.models)||[],max_budget:null===(r=s.user_info)||void 0===r?void 0:r.max_budget,budget_duration:null===(i=s.user_info)||void 0===i?void 0:i.budget_duration,metadata:(null===(n=s.user_info)||void 0===n?void 0:n.metadata)?JSON.stringify(s.user_info.metadata,null,2):void 0})},[s,h]),(0,t.jsxs)(p.Z,{form:h,onFinish:e=>{if(e.metadata&&"string"==typeof e.metadata)try{e.metadata=JSON.parse(e.metadata)}catch(e){console.error("Error parsing metadata JSON:",e);return}a(e)},layout:"vertical",children:[!x&&(0,t.jsx)(p.Z.Item,{label:"User ID",name:"user_id",children:(0,t.jsx)(_.Z,{disabled:!0})}),!x&&(0,t.jsx)(p.Z.Item,{label:"Email",name:"user_email",children:(0,t.jsx)(_.Z,{})}),(0,t.jsx)(p.Z.Item,{label:"User Alias",name:"user_alias",children:(0,t.jsx)(_.Z,{})}),(0,t.jsx)(p.Z.Item,{label:(0,t.jsxs)("span",{children:["Global Proxy Role"," ",(0,t.jsx)(f.Z,{title:"This is the role that the user will globally on the proxy. This role is independent of any team/org specific roles.",children:(0,t.jsx)(Z.Z,{})})]}),name:"user_role",children:(0,t.jsx)(g.default,{children:m&&Object.entries(m).map(e=>{let[s,{ui_label:l,description:a}]=e;return(0,t.jsx)(b.Z,{value:s,title:l,children:(0,t.jsxs)("div",{className:"flex",children:[l," ",(0,t.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:a})]})},s)})})}),(0,t.jsx)(p.Z.Item,{label:(0,t.jsxs)("span",{children:["Personal Models"," ",(0,t.jsx)(f.Z,{title:"Select which models this user can access outside of team-scope. Choose 'All Proxy Models' to grant access to all models available on the proxy.",children:(0,t.jsx)(Z.Z,{style:{marginLeft:"4px"}})})]}),name:"models",children:(0,t.jsxs)(g.default,{mode:"multiple",placeholder:"Select models",style:{width:"100%"},disabled:!k.ZL.includes(c||""),children:[(0,t.jsx)(g.default.Option,{value:"all-proxy-models",children:"All Proxy Models"},"all-proxy-models"),(0,t.jsx)(g.default.Option,{value:"no-default-models",children:"No Default Models"},"no-default-models"),u.map(e=>(0,t.jsx)(g.default.Option,{value:e,children:(0,w.W0)(e)},e))]})}),(0,t.jsx)(p.Z.Item,{label:"Max Budget (USD)",name:"max_budget",children:(0,t.jsx)(y.Z,{step:.01,precision:2,style:{width:"100%"}})}),(0,t.jsx)(p.Z.Item,{label:"Reset Budget",name:"budget_duration",children:(0,t.jsx)(S.Z,{})}),(0,t.jsx)(p.Z.Item,{label:"Metadata",name:"metadata",children:(0,t.jsx)(N.Z,{rows:4,placeholder:"Enter metadata as JSON"})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(i.z,{variant:"secondary",type:"button",onClick:l,children:"Cancel"}),(0,t.jsx)(i.z,{type:"submit",children:"Save Changes"})]})]})}var U=l(9114);let{Text:I,Title:D}=n.default;var z=e=>{let{visible:s,onCancel:l,selectedUsers:a,possibleUIRoles:i,accessToken:n,onSuccess:p,teams:f,userRole:y,userModels:b,allowAllUsers:_=!1}=e,[N,w]=(0,r.useState)(!1),[k,Z]=(0,r.useState)([]),[S,z]=(0,r.useState)(null),[A,L]=(0,r.useState)(!1),[B,E]=(0,r.useState)(!1),T=()=>{Z([]),z(null),L(!1),E(!1),l()},O=r.useMemo(()=>({user_id:"bulk_edit",user_info:{user_email:"",user_role:"",teams:[],models:[],max_budget:null,spend:0,metadata:{},created_at:null,updated_at:null},keys:[],teams:f||[]}),[f,s]),M=async e=>{if(console.log("formValues",e),!n){U.Z.fromBackend("Access token not found");return}w(!0);try{let s=a.map(e=>e.user_id),t={};e.user_role&&""!==e.user_role&&(t.user_role=e.user_role),null!==e.max_budget&&void 0!==e.max_budget&&(t.max_budget=e.max_budget),e.models&&e.models.length>0&&(t.models=e.models),e.budget_duration&&""!==e.budget_duration&&(t.budget_duration=e.budget_duration),e.metadata&&Object.keys(e.metadata).length>0&&(t.metadata=e.metadata);let r=Object.keys(t).length>0,i=A&&k.length>0;if(!r&&!i){U.Z.fromBackend("Please modify at least one field or select teams to add users to");return}let o=[];if(r){if(B){let e=await (0,v.userBulkUpdateUserCall)(n,t,void 0,!0);o.push("Updated all users (".concat(e.total_requested," total)"))}else await (0,v.userBulkUpdateUserCall)(n,t,s),o.push("Updated ".concat(s.length," user(s)"))}if(i){let e=[];for(let s of k)try{let l=null;B?l=null:a.map(e=>({user_id:e.user_id,role:"user",user_email:e.user_email||null}));let t=await (0,v.teamBulkMemberAddCall)(n,s,l||null,S||void 0,B);console.log("result",t),e.push({teamId:s,success:!0,successfulAdditions:t.successful_additions,failedAdditions:t.failed_additions})}catch(l){console.error("Failed to add users to team ".concat(s,":"),l),e.push({teamId:s,success:!1,error:l})}let s=e.filter(e=>e.success),l=e.filter(e=>!e.success);if(s.length>0){let e=s.reduce((e,s)=>e+s.successfulAdditions,0);o.push("Added users to ".concat(s.length," team(s) (").concat(e," total additions)"))}l.length>0&&d.ZP.warning("Failed to add users to ".concat(l.length," team(s)"))}o.length>0&&U.Z.success(o.join(". ")),Z([]),z(null),L(!1),E(!1),p(),l()}catch(e){console.error("Bulk operation failed:",e),U.Z.fromBackend("Failed to perform bulk operations")}finally{w(!1)}};return(0,t.jsxs)(o.Z,{visible:s,onCancel:T,footer:null,title:B?"Bulk Edit All Users":"Bulk Edit ".concat(a.length," User(s)"),width:800,children:[_&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)(c.Z,{checked:B,onChange:e=>E(e.target.checked),children:(0,t.jsx)(I,{strong:!0,children:"Update ALL users in the system"})}),B&&(0,t.jsx)("div",{style:{marginTop:8},children:(0,t.jsx)(I,{type:"warning",style:{fontSize:"12px"},children:"⚠️ This will apply changes to ALL users in the system, not just the selected ones."})})]}),!B&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)(D,{level:5,children:["Selected Users (",a.length,"):"]}),(0,t.jsx)(u.Z,{size:"small",bordered:!0,dataSource:a,pagination:!1,scroll:{y:200},rowKey:"user_id",columns:[{title:"User ID",dataIndex:"user_id",key:"user_id",width:"30%",render:e=>(0,t.jsx)(I,{strong:!0,style:{fontSize:"12px"},children:e.length>20?"".concat(e.slice(0,20),"..."):e})},{title:"Email",dataIndex:"user_email",key:"user_email",width:"25%",render:e=>(0,t.jsx)(I,{type:"secondary",style:{fontSize:"12px"},children:e||"No email"})},{title:"Current Role",dataIndex:"user_role",key:"user_role",width:"25%",render:e=>{var s;return(0,t.jsx)(I,{style:{fontSize:"12px"},children:(null==i?void 0:null===(s=i[e])||void 0===s?void 0:s.ui_label)||e})}},{title:"Budget",dataIndex:"max_budget",key:"max_budget",width:"20%",render:e=>(0,t.jsx)(I,{style:{fontSize:"12px"},children:null!==e?"$".concat(e):"Unlimited"})}]})]}),(0,t.jsx)(m.Z,{}),(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)(I,{children:[(0,t.jsx)("strong",{children:"Instructions:"})," Fill in the fields below with the values you want to apply to all selected users. You can bulk edit: role, budget, models, and metadata. You can also add users to teams."]})}),(0,t.jsx)(x.Z,{title:"Team Management",size:"small",className:"mb-4",style:{backgroundColor:"#fafafa"},children:(0,t.jsxs)(h.Z,{direction:"vertical",style:{width:"100%"},children:[(0,t.jsx)(c.Z,{checked:A,onChange:e=>L(e.target.checked),children:"Add selected users to teams"}),A&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(I,{strong:!0,children:"Select Teams:"}),(0,t.jsx)(g.default,{mode:"multiple",placeholder:"Select teams to add users to",value:k,onChange:Z,style:{width:"100%",marginTop:8},options:(null==f?void 0:f.map(e=>({label:e.team_alias||e.team_id,value:e.team_id})))||[]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(I,{strong:!0,children:"Team Budget (Optional):"}),(0,t.jsx)(j.Z,{placeholder:"Max budget per user in team",value:S,onChange:e=>z(e),style:{width:"100%",marginTop:8},min:0,step:.01,precision:2}),(0,t.jsx)(I,{type:"secondary",style:{fontSize:"12px"},children:"Leave empty for unlimited budget within team limits"})]}),(0,t.jsx)(I,{type:"secondary",style:{fontSize:"12px"},children:'Users will be added with "user" role by default. All users will be added to each selected team.'})]})]})}),(0,t.jsx)(C,{userData:O,onCancel:T,onSubmit:M,teams:f,accessToken:n,userID:"bulk_edit",userRole:y,userModels:b,possibleUIRoles:i,isBulkEdit:!0}),N&&(0,t.jsx)("div",{style:{textAlign:"center",marginTop:"10px"},children:(0,t.jsxs)(I,{children:["Updating ",B?"all users":a.length," user(s)..."]})})]})},A=l(7765),L=l(73002),B=e=>{let{visible:s,possibleUIRoles:l,onCancel:a,user:i,onSubmit:n}=e,[d,c]=(0,r.useState)(i),[u]=p.Z.useForm();(0,r.useEffect)(()=>{u.resetFields()},[i]);let m=async()=>{u.resetFields(),a()},x=async e=>{n(e),u.resetFields(),a()};return i?(0,t.jsx)(o.Z,{visible:s,onCancel:m,footer:null,title:"Edit User "+i.user_id,width:1e3,children:(0,t.jsx)(p.Z,{form:u,onFinish:x,initialValues:i,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Z.Item,{className:"mt-8",label:"User Email",tooltip:"Email of the User",name:"user_email",children:(0,t.jsx)(_.Z,{})}),(0,t.jsx)(p.Z.Item,{label:"user_id",name:"user_id",hidden:!0,children:(0,t.jsx)(_.Z,{})}),(0,t.jsx)(p.Z.Item,{label:"User Role",name:"user_role",children:(0,t.jsx)(g.default,{children:l&&Object.entries(l).map(e=>{let[s,{ui_label:l,description:a}]=e;return(0,t.jsx)(b.Z,{value:s,title:l,children:(0,t.jsxs)("div",{className:"flex",children:[l," ",(0,t.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:a})]})},s)})})}),(0,t.jsx)(p.Z.Item,{label:"Spend (USD)",name:"spend",tooltip:"(float) - Spend of all LLM calls completed by this user",help:"Across all keys (including keys with team_id).",children:(0,t.jsx)(j.Z,{min:0,step:.01})}),(0,t.jsx)(p.Z.Item,{label:"User Budget (USD)",name:"max_budget",tooltip:"(float) - Maximum budget of this user",help:"Maximum budget of this user.",children:(0,t.jsx)(y.Z,{min:0,step:.01})}),(0,t.jsx)(p.Z.Item,{label:"Reset Budget",name:"budget_duration",children:(0,t.jsx)(S.Z,{})}),(0,t.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,t.jsx)(L.ZP,{htmlType:"submit",children:"Save"})}),(0,t.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,t.jsx)(L.ZP,{htmlType:"submit",children:"Save"})})]})})}):null},E=l(98187),T=l(59872),O=l(19616),M=l(29827),P=l(16593),R=l(21609),F=l(88913),K=l(63709),V=l(87908),q=l(26349),G=l(96473),J=e=>{var s;let{accessToken:l,possibleUIRoles:a,userID:i,userRole:d}=e,[o,c]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null),[x,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)({}),[y,b]=(0,r.useState)(!1),[_,N]=(0,r.useState)([]),{Paragraph:k}=n.default,{Option:Z}=g.default;(0,r.useEffect)(()=>{(async()=>{if(!l){c(!1);return}try{let e=await (0,v.getInternalUserSettings)(l);if(m(e),f(e.values||{}),l)try{let e=await (0,v.modelAvailableCall)(l,i,d);if(e&&e.data){let s=e.data.map(e=>e.id);N(s)}}catch(e){console.error("Error fetching available models:",e)}}catch(e){console.error("Error fetching SSO settings:",e),U.Z.fromBackend("Failed to fetch SSO settings")}finally{c(!1)}})()},[l]);let C=async()=>{if(l){b(!0);try{let e=Object.entries(p).reduce((e,s)=>{let[l,t]=s;return e[l]=""===t?null:t,e},{}),s=await (0,v.updateInternalUserSettings)(l,e);m({...u,values:s.settings}),h(!1)}catch(e){console.error("Error updating SSO settings:",e),U.Z.fromBackend("Failed to update settings: "+e)}finally{b(!1)}}},I=(e,s)=>{f(l=>({...l,[e]:s}))},D=e=>e&&Array.isArray(e)?e.map(e=>"string"==typeof e?{team_id:e,user_role:"user"}:"object"==typeof e&&e.team_id?{team_id:e.team_id,max_budget_in_team:e.max_budget_in_team,user_role:e.user_role||"user"}:{team_id:"",user_role:"user"}):[],z=e=>{let s=D(e),l=(e,l,t)=>{let a=[...s];a[e]={...a[e],[l]:t},I("teams",a)},a=e=>{I("teams",s.filter((s,l)=>l!==e))};return(0,t.jsxs)("div",{className:"space-y-3",children:[s.map((e,s)=>(0,t.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)(F.xv,{className:"font-medium",children:["Team ",s+1]}),(0,t.jsx)(F.zx,{size:"sm",variant:"secondary",icon:q.Z,onClick:()=>a(s),className:"text-red-500 hover:text-red-700",children:"Remove"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(F.xv,{className:"text-sm font-medium mb-1",children:"Team ID"}),(0,t.jsx)(F.oi,{value:e.team_id,onChange:e=>l(s,"team_id",e.target.value),placeholder:"Enter team ID"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(F.xv,{className:"text-sm font-medium mb-1",children:"Max Budget in Team"}),(0,t.jsx)(j.Z,{style:{width:"100%"},value:e.max_budget_in_team,onChange:e=>l(s,"max_budget_in_team",e),placeholder:"Optional",min:0,step:.01,precision:2})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(F.xv,{className:"text-sm font-medium mb-1",children:"User Role"}),(0,t.jsxs)(g.default,{style:{width:"100%"},value:e.user_role,onChange:e=>l(s,"user_role",e),children:[(0,t.jsx)(Z,{value:"user",children:"User"}),(0,t.jsx)(Z,{value:"admin",children:"Admin"})]})]})]})]},s)),(0,t.jsx)(F.zx,{variant:"secondary",icon:G.Z,onClick:()=>{I("teams",[...s,{team_id:"",user_role:"user"}])},className:"w-full",children:"Add Team"})]})},A=(e,s,l)=>{var r;let i=s.type;if("teams"===e)return(0,t.jsx)("div",{className:"mt-2",children:z(p[e]||[])});if("user_role"===e&&a)return(0,t.jsx)(g.default,{style:{width:"100%"},value:p[e]||"",onChange:s=>I(e,s),className:"mt-2",children:Object.entries(a).filter(e=>{let[s]=e;return s.includes("internal_user")}).map(e=>{let[s,{ui_label:l,description:a}]=e;return(0,t.jsx)(Z,{value:s,children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{children:l}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:a})]})},s)})});if("budget_duration"===e)return(0,t.jsx)(S.Z,{value:p[e]||null,onChange:s=>I(e,s),className:"mt-2"});if("boolean"===i)return(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(K.Z,{checked:!!p[e],onChange:s=>I(e,s)})});if("array"===i&&(null===(r=s.items)||void 0===r?void 0:r.enum))return(0,t.jsx)(g.default,{mode:"multiple",style:{width:"100%"},value:p[e]||[],onChange:s=>I(e,s),className:"mt-2",children:s.items.enum.map(e=>(0,t.jsx)(Z,{value:e,children:e},e))});if("models"===e)return(0,t.jsxs)(g.default,{mode:"multiple",style:{width:"100%"},value:p[e]||[],onChange:s=>I(e,s),className:"mt-2",children:[(0,t.jsx)(Z,{value:"no-default-models",children:"No Default Models"}),_.map(e=>(0,t.jsx)(Z,{value:e,children:(0,w.W0)(e)},e))]});if("string"===i&&s.enum)return(0,t.jsx)(g.default,{style:{width:"100%"},value:p[e]||"",onChange:s=>I(e,s),className:"mt-2",children:s.enum.map(e=>(0,t.jsx)(Z,{value:e,children:e},e))});else return(0,t.jsx)(F.oi,{value:void 0!==p[e]?String(p[e]):"",onChange:s=>I(e,s.target.value),placeholder:s.description||"",className:"mt-2"})},L=(e,s)=>{if(null==s)return(0,t.jsx)("span",{className:"text-gray-400",children:"Not set"});if("teams"===e&&Array.isArray(s)){if(0===s.length)return(0,t.jsx)("span",{className:"text-gray-400",children:"No teams assigned"});let e=D(s);return(0,t.jsx)("div",{className:"space-y-2 mt-1",children:e.map((e,s)=>(0,t.jsx)("div",{className:"border rounded-lg p-3 bg-white",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Team ID:"}),(0,t.jsx)("p",{className:"text-gray-900",children:e.team_id||"Not specified"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Max Budget:"}),(0,t.jsx)("p",{className:"text-gray-900",children:void 0!==e.max_budget_in_team?"$".concat((0,T.pw)(e.max_budget_in_team,4)):"No limit"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Role:"}),(0,t.jsx)("p",{className:"text-gray-900 capitalize",children:e.user_role})]})]})},s))})}if("user_role"===e&&a&&a[s]){let{ui_label:e,description:l}=a[s];return(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:e}),l&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:l})]})}return"budget_duration"===e?(0,t.jsx)("span",{children:(0,S.m)(s)}):"boolean"==typeof s?(0,t.jsx)("span",{children:s?"Enabled":"Disabled"}):"models"===e&&Array.isArray(s)?0===s.length?(0,t.jsx)("span",{className:"text-gray-400",children:"None"}):(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:s.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:(0,w.W0)(e)},s))}):"object"==typeof s?Array.isArray(s)?0===s.length?(0,t.jsx)("span",{className:"text-gray-400",children:"None"}):(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:s.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:"object"==typeof e?JSON.stringify(e):String(e)},s))}):(0,t.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(s,null,2)}):(0,t.jsx)("span",{children:String(s)})};return o?(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)(V.Z,{size:"large"})}):u?(0,t.jsxs)(F.Zb,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(F.Dx,{children:"Default User Settings"}),!o&&u&&(x?(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(F.zx,{variant:"secondary",onClick:()=>{h(!1),f(u.values||{})},disabled:y,children:"Cancel"}),(0,t.jsx)(F.zx,{onClick:C,loading:y,children:"Save Changes"})]}):(0,t.jsx)(F.zx,{onClick:()=>h(!0),children:"Edit Settings"}))]}),(null==u?void 0:null===(s=u.field_schema)||void 0===s?void 0:s.description)&&(0,t.jsx)(k,{className:"mb-4",children:u.field_schema.description}),(0,t.jsx)(F.iz,{}),(0,t.jsx)("div",{className:"mt-4 space-y-4",children:(()=>{let{values:e,field_schema:s}=u;return s&&s.properties?Object.entries(s.properties).map(s=>{let[l,a]=s,r=e[l],i=l.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return(0,t.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200 last:border-0",children:[(0,t.jsx)(F.xv,{className:"font-medium text-lg",children:i}),(0,t.jsx)(k,{className:"text-sm text-gray-500 mt-1",children:a.description||"No description available"}),x?(0,t.jsx)("div",{className:"mt-2",children:A(l,a,r)}):(0,t.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded",children:L(l,r)})]},l)}):(0,t.jsx)(F.xv,{children:"No schema information available"})})()})]}):(0,t.jsx)(F.Zb,{children:(0,t.jsx)(F.xv,{children:"No settings available or you do not have permission to view them."})})},W=l(41649),Q=l(67101),$=l(47323),H=l(15731),Y=l(53410),X=l(74998),ee=l(23628);let es=(e,s,l,a,r,i)=>{let n=[{header:"User ID",accessorKey:"user_id",cell:e=>{let{row:s}=e;return(0,t.jsx)(f.Z,{title:s.original.user_id,children:(0,t.jsx)("span",{className:"text-xs",children:s.original.user_id?"".concat(s.original.user_id.slice(0,7),"..."):"-"})})}},{header:"Email",accessorKey:"user_email",cell:e=>{let{row:s}=e;return(0,t.jsx)("span",{className:"text-xs",children:s.original.user_email||"-"})}},{header:"Global Proxy Role",accessorKey:"user_role",cell:s=>{var l;let{row:a}=s;return(0,t.jsx)("span",{className:"text-xs",children:(null==e?void 0:null===(l=e[a.original.user_role])||void 0===l?void 0:l.ui_label)||"-"})}},{header:"Spend (USD)",accessorKey:"spend",cell:e=>{let{row:s}=e;return(0,t.jsx)("span",{className:"text-xs",children:s.original.spend?(0,T.pw)(s.original.spend,4):"-"})}},{header:"Budget (USD)",accessorKey:"max_budget",cell:e=>{let{row:s}=e;return(0,t.jsx)("span",{className:"text-xs",children:null!==s.original.max_budget?s.original.max_budget:"Unlimited"})}},{header:()=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"SSO ID"}),(0,t.jsx)(f.Z,{title:"SSO ID is the ID of the user in the SSO provider. If the user is not using SSO, this will be null.",children:(0,t.jsx)(H.Z,{className:"w-4 h-4"})})]}),accessorKey:"sso_user_id",cell:e=>{let{row:s}=e;return(0,t.jsx)("span",{className:"text-xs",children:null!==s.original.sso_user_id?s.original.sso_user_id:"-"})}},{header:"API Keys",accessorKey:"key_count",cell:e=>{let{row:s}=e;return(0,t.jsx)(Q.Z,{numItems:2,children:s.original.key_count>0?(0,t.jsxs)(W.Z,{size:"xs",color:"indigo",children:[s.original.key_count," Keys"]}):(0,t.jsx)(W.Z,{size:"xs",color:"gray",children:"No Keys"})})}},{header:"Created At",accessorKey:"created_at",sortingFn:"datetime",cell:e=>{let{row:s}=e;return(0,t.jsx)("span",{className:"text-xs",children:s.original.created_at?new Date(s.original.created_at).toLocaleDateString():"-"})}},{header:"Updated At",accessorKey:"updated_at",sortingFn:"datetime",cell:e=>{let{row:s}=e;return(0,t.jsx)("span",{className:"text-xs",children:s.original.updated_at?new Date(s.original.updated_at).toLocaleDateString():"-"})}},{id:"actions",header:"Actions",cell:e=>{let{row:s}=e;return(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(f.Z,{title:"Edit user details",children:(0,t.jsx)($.Z,{icon:Y.Z,size:"sm",onClick:()=>r(s.original.user_id,!0),className:"cursor-pointer hover:text-blue-600"})}),(0,t.jsx)(f.Z,{title:"Delete user",children:(0,t.jsx)($.Z,{icon:X.Z,size:"sm",onClick:()=>l(s.original),className:"cursor-pointer hover:text-red-600"})}),(0,t.jsx)(f.Z,{title:"Reset Password",children:(0,t.jsx)($.Z,{icon:ee.Z,size:"sm",onClick:()=>a(s.original.user_id),className:"cursor-pointer hover:text-green-600"})})]})}}];if(i){let{onSelectUser:e,onSelectAll:s,isUserSelected:l,isAllSelected:a,isIndeterminate:r}=i;return[{id:"select",header:()=>(0,t.jsx)(c.Z,{indeterminate:r,checked:a,onChange:e=>s(e.target.checked),onClick:e=>e.stopPropagation()}),cell:s=>{let{row:a}=s;return(0,t.jsx)(c.Z,{checked:l(a.original),onChange:s=>e(a.original,s.target.checked),onClick:e=>e.stopPropagation()})}},...n]}return n};var el=l(71594),et=l(24525),ea=l(27281),er=l(21626),ei=l(97214),en=l(28241),ed=l(58834),eo=l(69552),ec=l(71876),eu=l(44633),em=l(86462),ex=l(49084),eh=l(84717),eg=l(10900),ej=l(30401),ev=l(78867);function ep(e){var s,l,a,i,n,d,o,c,u,m,x,h,g,j,p,f,y,b,_,N,w,Z,I,D,z,A,B,O,M,P,R,F,K,V,q,G,J,W;let{userId:Q,onClose:$,accessToken:H,userRole:Y,onDelete:es,possibleUIRoles:el,initialTab:et=0,startInEditMode:ea=!1}=e,[er,ei]=(0,r.useState)(null),[en,ed]=(0,r.useState)(!1),[eo,ec]=(0,r.useState)(!0),[eu,em]=(0,r.useState)(ea),[ex,ep]=(0,r.useState)([]),[ef,ey]=(0,r.useState)(!1),[eb,e_]=(0,r.useState)(null),[eN,ew]=(0,r.useState)(null),[ek,eZ]=(0,r.useState)(et),[eS,eC]=(0,r.useState)({}),[eU,eI]=(0,r.useState)(!1);r.useEffect(()=>{ew((0,v.getProxyBaseUrl)())},[]),r.useEffect(()=>{console.log("userId: ".concat(Q,", userRole: ").concat(Y,", accessToken: ").concat(H)),(async()=>{try{if(!H)return;let e=await (0,v.userInfoCall)(H,Q,Y||"",!1,null,null,!0);ei(e);let s=(await (0,v.modelAvailableCall)(H,Q,Y||"")).data.map(e=>e.id);ep(s)}catch(e){console.error("Error fetching user data:",e),U.Z.fromBackend("Failed to fetch user data")}finally{ec(!1)}})()},[H,Q,Y]);let eD=async()=>{if(!H){U.Z.fromBackend("Access token not found");return}try{U.Z.success("Generating password reset link...");let e=await (0,v.invitationCreateCall)(H,Q);e_(e),ey(!0)}catch(e){U.Z.fromBackend("Failed to generate password reset link")}},ez=async()=>{try{if(!H)return;await (0,v.userDeleteCall)(H,[Q]),U.Z.success("User deleted successfully"),es&&es(),$()}catch(e){console.error("Error deleting user:",e),U.Z.fromBackend("Failed to delete user")}},eA=async e=>{try{if(!H||!er)return;await (0,v.userUpdateUserCall)(H,e,null),ei({...er,user_info:{...er.user_info,user_email:e.user_email,user_alias:e.user_alias,models:e.models,max_budget:e.max_budget,budget_duration:e.budget_duration,metadata:e.metadata}}),U.Z.success("User updated successfully"),em(!1)}catch(e){console.error("Error updating user:",e),U.Z.fromBackend("Failed to update user")}};if(eo)return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)(eh.zx,{icon:eg.Z,variant:"light",onClick:$,className:"mb-4",children:"Back to Users"}),(0,t.jsx)(eh.xv,{children:"Loading user data..."})]});if(!er)return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)(eh.zx,{icon:eg.Z,variant:"light",onClick:$,className:"mb-4",children:"Back to Users"}),(0,t.jsx)(eh.xv,{children:"User not found"})]});let eL=async(e,s)=>{await (0,T.vQ)(e)&&(eC(e=>({...e,[s]:!0})),setTimeout(()=>{eC(e=>({...e,[s]:!1}))},2e3))};return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.zx,{icon:eg.Z,variant:"light",onClick:$,className:"mb-4",children:"Back to Users"}),(0,t.jsx)(eh.Dx,{children:(null===(s=er.user_info)||void 0===s?void 0:s.user_email)||"User"}),(0,t.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,t.jsx)(eh.xv,{className:"text-gray-500 font-mono",children:er.user_id}),(0,t.jsx)(L.ZP,{type:"text",size:"small",icon:eS["user-id"]?(0,t.jsx)(ej.Z,{size:12}):(0,t.jsx)(ev.Z,{size:12}),onClick:()=>eL(er.user_id,"user-id"),className:"left-2 z-10 transition-all duration-200 ".concat(eS["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100")})]})]}),Y&&k.LQ.includes(Y)&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eh.zx,{icon:ee.Z,variant:"secondary",onClick:eD,className:"flex items-center",children:"Reset Password"}),(0,t.jsx)(eh.zx,{icon:X.Z,variant:"secondary",onClick:()=>ed(!0),className:"flex items-center",children:"Delete User"})]})]}),en&&(0,t.jsx)("div",{className:"fixed z-10 inset-0 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,t.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:(0,t.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),(0,t.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),(0,t.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[(0,t.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:(0,t.jsx)("div",{className:"sm:flex sm:items-start",children:(0,t.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[(0,t.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Delete User"}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this user?"})})]})})}),(0,t.jsxs)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[(0,t.jsx)(eh.zx,{onClick:ez,color:"red",className:"ml-2",children:"Delete"}),(0,t.jsx)(eh.zx,{onClick:()=>ed(!1),children:"Cancel"})]})]})]})}),(0,t.jsxs)(eh.v0,{defaultIndex:ek,onIndexChange:eZ,children:[(0,t.jsxs)(eh.td,{className:"mb-4",children:[(0,t.jsx)(eh.OK,{children:"Overview"}),(0,t.jsx)(eh.OK,{children:"Details"})]}),(0,t.jsxs)(eh.nP,{children:[(0,t.jsx)(eh.x4,{children:(0,t.jsxs)(eh.rj,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,t.jsxs)(eh.Zb,{children:[(0,t.jsx)(eh.xv,{children:"Spend"}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsxs)(eh.Dx,{children:["$",(0,T.pw)((null===(l=er.user_info)||void 0===l?void 0:l.spend)||0,4)]}),(0,t.jsxs)(eh.xv,{children:["of"," ",(null===(a=er.user_info)||void 0===a?void 0:a.max_budget)!==null?"$".concat((0,T.pw)(er.user_info.max_budget,4)):"Unlimited"]})]})]}),(0,t.jsxs)(eh.Zb,{children:[(0,t.jsx)(eh.xv,{children:"Teams"}),(0,t.jsx)("div",{className:"mt-2",children:(null===(i=er.teams)||void 0===i?void 0:i.length)&&(null===(n=er.teams)||void 0===n?void 0:n.length)>0?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[null===(d=er.teams)||void 0===d?void 0:d.slice(0,eU?er.teams.length:20).map((e,s)=>(0,t.jsx)(eh.Ct,{color:"blue",title:e.team_alias,children:e.team_alias},s)),!eU&&(null===(o=er.teams)||void 0===o?void 0:o.length)>20&&(0,t.jsxs)(eh.Ct,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>eI(!0),children:["+",er.teams.length-20," more"]}),eU&&(null===(c=er.teams)||void 0===c?void 0:c.length)>20&&(0,t.jsx)(eh.Ct,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>eI(!1),children:"Show Less"})]}):(0,t.jsx)(eh.xv,{children:"No teams"})})]}),(0,t.jsxs)(eh.Zb,{children:[(0,t.jsx)(eh.xv,{children:"API Keys"}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsxs)(eh.xv,{children:[(null===(u=er.keys)||void 0===u?void 0:u.length)||0," keys"]})})]}),(0,t.jsxs)(eh.Zb,{children:[(0,t.jsx)(eh.xv,{children:"Personal Models"}),(0,t.jsx)("div",{className:"mt-2",children:(null===(x=er.user_info)||void 0===x?void 0:null===(m=x.models)||void 0===m?void 0:m.length)&&(null===(g=er.user_info)||void 0===g?void 0:null===(h=g.models)||void 0===h?void 0:h.length)>0?null===(p=er.user_info)||void 0===p?void 0:null===(j=p.models)||void 0===j?void 0:j.map((e,s)=>(0,t.jsx)(eh.xv,{children:e},s)):(0,t.jsx)(eh.xv,{children:"All proxy models"})})]})]})}),(0,t.jsx)(eh.x4,{children:(0,t.jsxs)(eh.Zb,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(eh.Dx,{children:"User Settings"}),!eu&&Y&&k.LQ.includes(Y)&&(0,t.jsx)(eh.zx,{onClick:()=>em(!0),children:"Edit Settings"})]}),eu&&er?(0,t.jsx)(C,{userData:er,onCancel:()=>em(!1),onSubmit:eA,teams:er.teams,accessToken:H,userID:Q,userRole:Y,userModels:ex,possibleUIRoles:el}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"User ID"}),(0,t.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,t.jsx)(eh.xv,{className:"font-mono",children:er.user_id}),(0,t.jsx)(L.ZP,{type:"text",size:"small",icon:eS["user-id"]?(0,t.jsx)(ej.Z,{size:12}):(0,t.jsx)(ev.Z,{size:12}),onClick:()=>eL(er.user_id,"user-id"),className:"left-2 z-10 transition-all duration-200 ".concat(eS["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100")})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"Email"}),(0,t.jsx)(eh.xv,{children:(null===(f=er.user_info)||void 0===f?void 0:f.user_email)||"Not Set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"User Alias"}),(0,t.jsx)(eh.xv,{children:(null===(y=er.user_info)||void 0===y?void 0:y.user_alias)||"Not Set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"Global Proxy Role"}),(0,t.jsx)(eh.xv,{children:(null===(b=er.user_info)||void 0===b?void 0:b.user_role)||"Not Set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"Created"}),(0,t.jsx)(eh.xv,{children:(null===(_=er.user_info)||void 0===_?void 0:_.created_at)?new Date(er.user_info.created_at).toLocaleString():"Unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"Last Updated"}),(0,t.jsx)(eh.xv,{children:(null===(N=er.user_info)||void 0===N?void 0:N.updated_at)?new Date(er.user_info.updated_at).toLocaleString():"Unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"Teams"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:(null===(w=er.teams)||void 0===w?void 0:w.length)&&(null===(Z=er.teams)||void 0===Z?void 0:Z.length)>0?(0,t.jsxs)(t.Fragment,{children:[null===(I=er.teams)||void 0===I?void 0:I.slice(0,eU?er.teams.length:20).map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",title:e.team_alias||e.team_id,children:e.team_alias||e.team_id},s)),!eU&&(null===(D=er.teams)||void 0===D?void 0:D.length)>20&&(0,t.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>eI(!0),children:["+",er.teams.length-20," more"]}),eU&&(null===(z=er.teams)||void 0===z?void 0:z.length)>20&&(0,t.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>eI(!1),children:"Show Less"})]}):(0,t.jsx)(eh.xv,{children:"No teams"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"Personal Models"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:(null===(B=er.user_info)||void 0===B?void 0:null===(A=B.models)||void 0===A?void 0:A.length)&&(null===(M=er.user_info)||void 0===M?void 0:null===(O=M.models)||void 0===O?void 0:O.length)>0?null===(R=er.user_info)||void 0===R?void 0:null===(P=R.models)||void 0===P?void 0:P.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:e},s)):(0,t.jsx)(eh.xv,{children:"All proxy models"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"API Keys"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:(null===(F=er.keys)||void 0===F?void 0:F.length)&&(null===(K=er.keys)||void 0===K?void 0:K.length)>0?er.keys.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-green-100 rounded text-xs",children:e.key_alias||e.token},s)):(0,t.jsx)(eh.xv,{children:"No API keys"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"Max Budget"}),(0,t.jsx)(eh.xv,{children:(null===(V=er.user_info)||void 0===V?void 0:V.max_budget)!==null&&(null===(q=er.user_info)||void 0===q?void 0:q.max_budget)!==void 0?"$".concat((0,T.pw)(er.user_info.max_budget,4)):"Unlimited"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"Budget Reset"}),(0,t.jsx)(eh.xv,{children:(0,S.m)(null!==(W=null===(G=er.user_info)||void 0===G?void 0:G.budget_duration)&&void 0!==W?W:null)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(eh.xv,{className:"font-medium",children:"Metadata"}),(0,t.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify((null===(J=er.user_info)||void 0===J?void 0:J.metadata)||{},null,2)})]})]})]})})]})]}),(0,t.jsx)(E.Z,{isInvitationLinkModalVisible:ef,setIsInvitationLinkModalVisible:ey,baseUrl:eN||"",invitationLinkData:eb,modalType:"resetPassword"})]})}function ef(e){let{data:s=[],columns:l,isLoading:a=!1,onSortChange:i,currentSort:n,accessToken:d,userRole:o,possibleUIRoles:c,handleEdit:u,handleDelete:m,handleResetPassword:x,selectedUsers:h=[],onSelectionChange:g,enableSelection:j=!1,filters:v,updateFilters:p,initialFilters:f,teams:y,userListResponse:_,currentPage:N,handlePageChange:w}=e,[k,Z]=r.useState([{id:(null==n?void 0:n.sortBy)||"created_at",desc:(null==n?void 0:n.sortOrder)==="desc"}]),[S,C]=r.useState(null),[U,I]=r.useState(!1),[D,z]=r.useState(!1),A=function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];C(e),I(s)},L=(e,s)=>{g&&(s?g([...h,e]):g(h.filter(s=>s.user_id!==e.user_id)))},B=e=>{g&&(e?g(s):g([]))},E=e=>h.some(s=>s.user_id===e.user_id),T=s.length>0&&h.length===s.length,O=h.length>0&&h.length<s.length,M=r.useMemo(()=>c?es(c,u,m,x,A,j?{selectedUsers:h,onSelectUser:L,onSelectAll:B,isUserSelected:E,isAllSelected:T,isIndeterminate:O}:void 0):l,[c,u,m,x,A,l,j,h,T,O]),P=(0,el.b7)({data:s,columns:M,state:{sorting:k},onSortingChange:e=>{if(Z(e),e.length>0){let s=e[0],l=s.id,t=s.desc?"desc":"asc";null==i||i(l,t)}},getCoreRowModel:(0,et.sC)(),getSortedRowModel:(0,et.tj)(),enableSorting:!0});return(r.useEffect(()=>{n&&Z([{id:n.sortBy,desc:"desc"===n.sortOrder}])},[n]),S)?(0,t.jsx)(ep,{userId:S,onClose:()=>{C(null),I(!1)},accessToken:d,userRole:o,possibleUIRoles:c,initialTab:U?1:0,startInEditMode:U}):(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,t.jsx)("div",{className:"border-b px-6 py-4",children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative w-64",children:[(0,t.jsx)("input",{type:"text",placeholder:"Search by email...",className:"w-full px-3 py-2 pl-8 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:v.email,onChange:e=>p({email:e.target.value})}),(0,t.jsx)("svg",{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),(0,t.jsxs)("button",{className:"px-3 py-2 text-sm border rounded-md hover:bg-gray-50 flex items-center gap-2 ".concat(D?"bg-gray-100":""),onClick:()=>z(!D),children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filters",(v.user_id||v.user_role||v.team)&&(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-blue-500"})]}),(0,t.jsxs)("button",{className:"px-3 py-2 text-sm border rounded-md hover:bg-gray-50 flex items-center gap-2",onClick:()=>{p(f)},children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Reset Filters"]})]}),D&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[(0,t.jsxs)("div",{className:"relative w-64",children:[(0,t.jsx)("input",{type:"text",placeholder:"Filter by User ID",className:"w-full px-3 py-2 pl-8 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:v.user_id,onChange:e=>p({user_id:e.target.value})}),(0,t.jsx)("svg",{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),(0,t.jsx)("div",{className:"w-64",children:(0,t.jsx)(ea.Z,{value:v.user_role,onValueChange:e=>p({user_role:e}),placeholder:"Select Role",children:c&&Object.entries(c).map(e=>{let[s,l]=e;return(0,t.jsx)(b.Z,{value:s,children:l.ui_label},s)})})}),(0,t.jsx)("div",{className:"w-64",children:(0,t.jsx)(ea.Z,{value:v.team,onValueChange:e=>p({team:e}),placeholder:"Select Team",children:null==y?void 0:y.map(e=>(0,t.jsx)(b.Z,{value:e.team_id,children:e.team_alias||e.team_id},e.team_id))})}),(0,t.jsx)("div",{className:"relative w-64",children:(0,t.jsx)("input",{type:"text",placeholder:"Filter by SSO ID",className:"w-full px-3 py-2 pl-8 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:v.sso_user_id,onChange:e=>p({sso_user_id:e.target.value})})})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-700",children:["Showing"," ",_&&_.users&&_.users.length>0?(_.page-1)*_.page_size+1:0," ","-"," ",_&&_.users?Math.min(_.page*_.page_size,_.total):0," ","of ",_?_.total:0," results"]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>w(N-1),disabled:1===N,className:"px-3 py-1 text-sm border rounded-md ".concat(1===N?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"),children:"Previous"}),(0,t.jsx)("button",{onClick:()=>w(N+1),disabled:!_||N>=_.total_pages,className:"px-3 py-1 text-sm border rounded-md ".concat(!_||N>=_.total_pages?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"),children:"Next"})]})]})]})}),(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(er.Z,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,t.jsx)(ed.Z,{children:P.getHeaderGroups().map(e=>(0,t.jsx)(ec.Z,{children:e.headers.map(e=>(0,t.jsx)(eo.Z,{className:"py-1 h-8 ".concat("actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),onClick:e.column.getToggleSortingHandler(),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,el.ie)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,t.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,t.jsx)(eu.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,t.jsx)(em.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,t.jsx)(ex.Z,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,t.jsx)(ei.Z,{children:a?(0,t.jsx)(ec.Z,{children:(0,t.jsx)(en.Z,{colSpan:M.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"\uD83D\uDE85 Loading users..."})})})}):s.length>0?P.getRowModel().rows.map(e=>(0,t.jsx)(ec.Z,{className:"h-8",children:e.getVisibleCells().map(e=>(0,t.jsx)(en.Z,{className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ".concat("actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),onClick:()=>{"user_id"===e.column.id&&A(e.getValue(),!1)},style:{cursor:"user_id"===e.column.id?"pointer":"default",color:"user_id"===e.column.id?"#3b82f6":"inherit"},children:(0,el.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,t.jsx)(ec.Z,{children:(0,t.jsx)(en.Z,{colSpan:M.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"No users found"})})})})})]})})})})]})}let{Text:ey,Title:eb}=n.default,e_={email:"",user_id:"",user_role:"",sso_user_id:"",team:"",model:"",min_spend:null,max_spend:null,sort_by:"created_at",sort_order:"desc"};var eN=e=>{var s,l,n;let{accessToken:d,token:o,userRole:c,userID:u,teams:m}=e,x=(0,M.NL)(),[h,g]=(0,r.useState)(1),[j,p]=(0,r.useState)(!1),[f,y]=(0,r.useState)(null),[b,_]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!1),[Z,S]=(0,r.useState)(null),[C,I]=(0,r.useState)("users"),[D,L]=(0,r.useState)(e_),[F,K,V]=(0,O.G)(D,{wait:300}),[q,G]=(0,r.useState)(!1),[W,Q]=(0,r.useState)(null),[$,H]=(0,r.useState)(null),[Y,X]=(0,r.useState)([]),[ee,el]=(0,r.useState)(!1),[et,ea]=(0,r.useState)(!1),[er,ei]=(0,r.useState)([]),en=e=>{S(e),_(!0)};(0,r.useEffect)(()=>()=>{V.cancel()},[V]),(0,r.useEffect)(()=>{H((0,v.getProxyBaseUrl)())},[]),(0,r.useEffect)(()=>{(async()=>{try{if(!u||!c||!d)return;let e=(await (0,v.modelAvailableCall)(d,u,c)).data.map(e=>e.id);console.log("available_model_names:",e),ei(e)}catch(e){console.error("Error fetching user models:",e)}})()},[d,u,c]);let ed=e=>{L(s=>{let l={...s,...e};return K(l),l})},eo=async e=>{if(!d){U.Z.fromBackend("Access token not found");return}try{U.Z.success("Generating password reset link...");let s=await (0,v.invitationCreateCall)(d,e);Q(s),G(!0)}catch(e){U.Z.fromBackend("Failed to generate password reset link")}},ec=async()=>{if(Z&&d)try{w(!0),await (0,v.userDeleteCall)(d,[Z.user_id]),x.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let s=e.users.filter(e=>e.user_id!==Z.user_id);return{...e,users:s}}),U.Z.success("User deleted successfully")}catch(e){console.error("Error deleting user:",e),U.Z.fromBackend("Failed to delete user")}finally{_(!1),S(null),w(!1)}},eu=async()=>{y(null),p(!1)},em=async e=>{if(console.log("inside handleEditSubmit:",e),d&&o&&c&&u){try{let s=await (0,v.userUpdateUserCall)(d,e,null);x.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let l=e.users.map(e=>e.user_id===s.data.user_id?(0,T.nl)(e,s.data):e);return{...e,users:l}}),U.Z.success("User ".concat(e.user_id," updated successfully"))}catch(e){console.error("There was an error updating the user",e)}y(null),p(!1)}},ex=async e=>{g(e)},eh=(0,P.a)({queryKey:["userList",{debouncedFilter:F,currentPage:h}],queryFn:async()=>{if(!d)throw Error("Access token required");return await (0,v.userListCall)(d,F.user_id?[F.user_id]:null,h,25,F.email||null,F.user_role||null,F.team||null,F.sso_user_id||null,F.sort_by,F.sort_order)},enabled:!!(d&&o&&c&&u),placeholderData:e=>e}),eg=eh.data,ej=(0,P.a)({queryKey:["userRoles"],initialData:()=>({}),queryFn:async()=>{if(!d)throw Error("Access token required");return await (0,v.getPossibleUserRoles)(d)},enabled:!!(d&&o&&c&&u)}).data;if(eh.isLoading||!d||!o||!c||!u)return(0,t.jsx)("div",{children:"Loading..."});let ev=es(ej,e=>{y(e),p(!0)},en,eo,()=>{});return(0,t.jsxs)("div",{className:"w-full p-8 overflow-hidden",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)(A.Z,{userID:u,accessToken:d,teams:m,possibleUIRoles:ej}),(0,t.jsx)(i.z,{onClick:()=>{ea(!et),X([])},variant:et?"primary":"secondary",className:"flex items-center",children:et?"Cancel Selection":"Select Users"}),et&&(0,t.jsxs)(i.z,{onClick:()=>{if(0===Y.length){U.Z.fromBackend("Please select users to edit");return}el(!0)},disabled:0===Y.length,className:"flex items-center",children:["Bulk Edit (",Y.length," selected)"]})]})}),(0,t.jsxs)(a.v0,{defaultIndex:0,onIndexChange:e=>I(0===e?"users":"settings"),children:[(0,t.jsxs)(a.td,{className:"mb-4",children:[(0,t.jsx)(a.OK,{children:"Users"}),(0,t.jsx)(a.OK,{children:"Default User Settings"})]}),(0,t.jsxs)(a.nP,{children:[(0,t.jsx)(a.x4,{children:(0,t.jsx)(ef,{data:(null===(s=eh.data)||void 0===s?void 0:s.users)||[],columns:ev,isLoading:eh.isLoading,accessToken:d,userRole:c,onSortChange:(e,s)=>{ed({sort_by:e,sort_order:s})},currentSort:{sortBy:D.sort_by,sortOrder:D.sort_order},possibleUIRoles:ej,handleEdit:e=>{y(e),p(!0)},handleDelete:en,handleResetPassword:eo,enableSelection:et,selectedUsers:Y,onSelectionChange:e=>{X(e)},filters:D,updateFilters:ed,initialFilters:e_,teams:m,userListResponse:eg,currentPage:h,handlePageChange:ex})}),(0,t.jsx)(a.x4,{children:(0,t.jsx)(J,{accessToken:d,possibleUIRoles:ej,userID:u,userRole:c})})]})]}),(0,t.jsx)(B,{visible:j,possibleUIRoles:ej,onCancel:eu,user:f,onSubmit:em}),(0,t.jsx)(R.Z,{isOpen:b,title:"Delete User?",message:"Are you sure you want to delete this user? This action cannot be undone.",resourceInformationTitle:"User Information",resourceInformation:[{label:"Email",value:null==Z?void 0:Z.user_email},{label:"User ID",value:null==Z?void 0:Z.user_id,code:!0},{label:"Global Proxy Role",value:Z&&(null==ej?void 0:null===(l=ej[Z.user_role])||void 0===l?void 0:l.ui_label)||(null==Z?void 0:Z.user_role)||"-"},{label:"Total Spend (USD)",value:null==Z?void 0:null===(n=Z.spend)||void 0===n?void 0:n.toFixed(2)}],onCancel:()=>{_(!1),S(null)},onOk:ec,confirmLoading:N}),(0,t.jsx)(E.Z,{isInvitationLinkModalVisible:q,setIsInvitationLinkModalVisible:G,baseUrl:$||"",invitationLinkData:W,modalType:"resetPassword"}),(0,t.jsx)(z,{visible:ee,onCancel:()=>el(!1),selectedUsers:Y,possibleUIRoles:ej,accessToken:d,onSuccess:()=>{x.invalidateQueries({queryKey:["userList"]}),X([]),ea(!1)},teams:m,userRole:c,userModels:er,allowAllUsers:!!c&&(0,k.tY)(c)})]})}}}]);