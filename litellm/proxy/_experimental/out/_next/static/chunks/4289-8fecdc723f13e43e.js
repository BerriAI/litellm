"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4289],{64289:function(e,l,t){t.d(l,{Z:function(){return J}});var s=t(57437),a=t(2265),r=t(41649),n=t(20831),i=t(12514),c=t(47323),d=t(21626),o=t(97214),u=t(28241),m=t(58834),x=t(69552),g=t(71876),h=t(84264),f=t(58643),p=t(19250),j=t(20577),y=t(44643),b=t(74998),_=t(16312),v=t(9114),N=t(31283);let k={ttl:3600,lowest_latency_buffer:0};var w=e=>{let{routingStrategyArgs:l}=e,t={ttl:"Sliding window to look back over when calculating the average latency of a deployment. Default - 1 hour (in seconds).",lowest_latency_buffer:"Shuffle between deployments within this % of the lowest latency. Default - 0 (i.e. always pick lowest latency)."};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"max-w-3xl",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Latency-Based Configuration"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Fine-tune latency-based routing behavior"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 xl:grid-cols-3",children:Object.entries(l||k).map(e=>{let[l,a]=e;return(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("label",{className:"block",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide",children:l.replace(/_/g," ")}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-0.5 mb-2",children:t[l]||""}),(0,s.jsx)(N.o,{name:l,defaultValue:"object"==typeof a?JSON.stringify(a,null,2):null==a?void 0:a.toString(),className:"font-mono text-sm w-full"})]})},l)})})]}),(0,s.jsx)("div",{className:"border-t border-gray-200"})]})},S=e=>{let{routerSettings:l,routerFieldsMetadata:t}=e;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"max-w-3xl",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Reliability & Retries"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Configure retry logic and failure handling"})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 xl:grid-cols-3",children:Object.entries(l).filter(e=>{let[l,t]=e;return"fallbacks"!=l&&"context_window_fallbacks"!=l&&"routing_strategy_args"!=l&&"routing_strategy"!=l&&"enable_tag_filtering"!=l}).map(e=>{var l,a;let[r,n]=e;return(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("label",{className:"block",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide",children:(null===(l=t[r])||void 0===l?void 0:l.ui_field_name)||r}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-0.5 mb-2",children:(null===(a=t[r])||void 0===a?void 0:a.field_description)||""}),(0,s.jsx)(N.o,{name:r,defaultValue:"object"==typeof n?JSON.stringify(n,null,2):(null==n?void 0:n.toString())||"",placeholder:"â€”",className:"font-mono text-sm w-full"})]})},r)})})]})},Z=t(52787),C=e=>{var l,t;let{selectedStrategy:a,availableStrategies:r,routingStrategyDescriptions:n,routerFieldsMetadata:i,onStrategyChange:c}=e;return(0,s.jsxs)("div",{className:"space-y-2 max-w-3xl",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide",children:(null===(l=i.routing_strategy)||void 0===l?void 0:l.ui_field_name)||"Routing Strategy"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-0.5 mb-2",children:(null===(t=i.routing_strategy)||void 0===t?void 0:t.field_description)||""})]}),(0,s.jsx)("div",{className:"routing-strategy-select max-w-3xl",children:(0,s.jsx)(Z.default,{value:a,onChange:c,style:{width:"100%"},size:"large",children:r.map(e=>(0,s.jsx)(Z.default.Option,{value:e,label:e,children:(0,s.jsxs)("div",{className:"flex flex-col gap-0.5 py-1",children:[(0,s.jsx)("span",{className:"font-mono text-sm font-medium",children:e}),n[e]&&(0,s.jsx)("span",{className:"text-xs text-gray-500 font-normal",children:n[e]})]})},e))})})]})},F=t(92858),O=e=>{var l,t,a;let{enabled:r,routerFieldsMetadata:n,onToggle:i}=e;return(0,s.jsx)("div",{className:"space-y-3 max-w-3xl",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"text-xs font-medium text-gray-700 uppercase tracking-wide",children:(null===(l=n.enable_tag_filtering)||void 0===l?void 0:l.ui_field_name)||"Enable Tag Filtering"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:[(null===(t=n.enable_tag_filtering)||void 0===t?void 0:t.field_description)||"",(null===(a=n.enable_tag_filtering)||void 0===a?void 0:a.link)&&(0,s.jsxs)(s.Fragment,{children:[" ",(0,s.jsx)("a",{href:n.enable_tag_filtering.link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:"Learn more"})]})]})]}),(0,s.jsx)(F.Z,{checked:r,onChange:i,className:"ml-4"})]})})},A=e=>{let{accessToken:l,userRole:t,userID:r,modelData:n}=e,[i,c]=(0,a.useState)({}),[d,o]=(0,a.useState)(null),[u,m]=(0,a.useState)([]),[x,g]=(0,a.useState)({}),[h,f]=(0,a.useState)({}),[j,y]=(0,a.useState)(!1);(0,a.useEffect)(()=>{l&&t&&r&&((0,p.getCallbacksCall)(l,r,t).then(e=>{console.log("callbacks",e);let l=e.router_settings;"model_group_retry_policy"in l&&delete l.model_group_retry_policy,c(l),l.routing_strategy&&o(l.routing_strategy)}),(0,p.getRouterSettingsCall)(l).then(e=>{if(console.log("router settings from API",e),e.fields){let l={};e.fields.forEach(e=>{l[e.field_name]={ui_field_name:e.ui_field_name,field_description:e.field_description,options:e.options,link:e.link}}),g(l);let t=e.fields.find(e=>"routing_strategy"===e.field_name);(null==t?void 0:t.options)&&m(t.options),e.routing_strategy_descriptions&&f(e.routing_strategy_descriptions);let s=e.fields.find(e=>"enable_tag_filtering"===e.field_name);(null==s?void 0:s.field_value)!==null&&(null==s?void 0:s.field_value)!==void 0&&y(s.field_value)}}))},[l,t,r]);let b=e=>{if(!l)return;console.log("router_settings",e);let t=new Set(["allowed_fails","cooldown_time","num_retries","timeout","retry_after"]),s=new Set(["model_group_alias","retry_policy"]),a=(e,l,a)=>{if(void 0===l)return a;let r=l.trim();if("null"===r.toLowerCase())return null;if(t.has(e)){let e=Number(r);return Number.isNaN(e)?a:e}if(s.has(e)){if(""===r)return null;try{return JSON.parse(r)}catch(e){return a}}return"true"===r.toLowerCase()||"false"!==r.toLowerCase()&&r},r=Object.fromEntries(Object.entries({...e,enable_tag_filtering:j}).map(e=>{let[l,t]=e;if("routing_strategy_args"!==l&&"routing_strategy"!==l&&"enable_tag_filtering"!==l){let e=document.querySelector('input[name="'.concat(l,'"]')),s=a(l,null==e?void 0:e.value,t);return[l,s]}if("routing_strategy"===l)return[l,d];if("enable_tag_filtering"===l)return[l,j];if("routing_strategy_args"===l&&"latency-based-routing"===d){let e={},l=document.querySelector('input[name="lowest_latency_buffer"]'),t=document.querySelector('input[name="ttl"]');return(null==l?void 0:l.value)&&(e.lowest_latency_buffer=Number(l.value)),(null==t?void 0:t.value)&&(e.ttl=Number(t.value)),console.log("setRoutingStrategyArgs: ".concat(e)),["routing_strategy_args",e]}return null}).filter(e=>null!=e));console.log("updatedVariables",r);try{(0,p.setCallbacksCall)(l,{router_settings:r})}catch(e){v.Z.fromBackend("Failed to update router settings: "+e)}v.Z.success("router settings updated successfully")};return l?(0,s.jsxs)("div",{className:"w-full space-y-8 py-2",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"max-w-3xl",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"Routing Settings"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Configure how requests are routed to deployments"})]}),i.routing_strategy&&(0,s.jsx)(C,{selectedStrategy:d||i.routing_strategy,availableStrategies:u,routingStrategyDescriptions:h,routerFieldsMetadata:x,onStrategyChange:o}),(0,s.jsx)(O,{enabled:j,routerFieldsMetadata:x,onToggle:y})]}),(0,s.jsx)("div",{className:"border-t border-gray-200"}),"latency-based-routing"===d&&(0,s.jsx)(w,{routingStrategyArgs:i.routing_strategy_args}),(0,s.jsx)(S,{routerSettings:i,routerFieldsMetadata:x}),(0,s.jsxs)("div",{className:"border-t border-gray-200 pt-6 flex justify-end gap-3",children:[(0,s.jsx)(_.z,{variant:"secondary",size:"sm",onClick:()=>window.location.reload(),className:"text-sm",children:"Reset"}),(0,s.jsx)(_.z,{size:"sm",onClick:()=>b(i),className:"text-sm font-medium",children:"Save Changes"})]})]}):null},R=t(91126),D=t(10178),E=t(89970),T=t(22116),z=t(26433),V=t(54250),I=t(70450),q=t(13634),B=t(10703),L=e=>{let{models:l,accessToken:t,routerSettings:r,setRouterSettings:n}=e,[i]=q.Z.useForm(),[c,d]=(0,a.useState)(!1),[o,u]=(0,a.useState)(""),[m,x]=(0,a.useState)([]),[g,h]=(0,a.useState)([]);(0,a.useEffect)(()=>{(async()=>{try{let e=await (0,B.p)(t);console.log("Fetched models for fallbacks:",e),x(e)}catch(e){console.error("Error fetching model info for fallbacks:",e)}})()},[t]);let f=()=>{d(!1),i.resetFields(),h([]),u("")};return(0,s.jsxs)("div",{children:[(0,s.jsx)(_.z,{className:"mx-auto",onClick:()=>d(!0),icon:()=>(0,s.jsx)("span",{className:"mr-1",children:"+"}),children:"Add Fallbacks"}),(0,s.jsx)(T.Z,{title:(0,s.jsx)("div",{className:"pb-4 border-b border-gray-100",children:(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Add Fallbacks"})}),open:c,width:900,footer:null,onOk:()=>{d(!1),i.resetFields(),h([]),u("")},onCancel:f,className:"top-8",styles:{body:{padding:"24px"},header:{padding:"24px 24px 0 24px",border:"none"}},children:(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Configure fallback models to improve reliability. When the primary model fails or is unavailable, requests will automatically route to the specified fallback models in order."})}),(0,s.jsxs)(q.Z,{form:i,onFinish:e=>{console.log(e);let{model_name:l,models:s}=e,a=[...r.fallbacks||[],{[l]:s}],c={...r,fallbacks:a};console.log(c);try{(0,p.setCallbacksCall)(t,{router_settings:c}),n(c)}catch(e){v.Z.fromBackend("Failed to update router settings: "+e)}v.Z.success("router settings updated successfully"),d(!1),i.resetFields(),h([]),u("")},layout:"vertical",className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-6",children:[(0,s.jsxs)(q.Z.Item,{label:(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Primary Model ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),name:"model_name",rules:[{required:!0,message:"Please select the primary model that needs fallbacks"}],className:"!mb-0",children:[(0,s.jsx)(V.Z,{placeholder:"Select the model that needs fallback protection",value:o,onValueChange:e=>{u(e);let l=g.filter(l=>l!==e);h(l),i.setFieldValue("models",l),i.setFieldValue("model_name",e)},children:Array.from(new Set(m.map(e=>e.model_group))).map((e,l)=>(0,s.jsx)(I.Z,{value:e,children:e},l))}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"This is the primary model that users will request"})]}),(0,s.jsx)("div",{className:"border-t border-gray-200 my-6"}),(0,s.jsxs)(q.Z.Item,{label:(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Fallback Models (select multiple) ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),name:"models",rules:[{required:!0,message:"Please select at least one fallback model"}],className:"!mb-0",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[g.length>0&&(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Fallback Order:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:g.map((e,l)=>(0,s.jsxs)("div",{className:"flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm",children:[(0,s.jsxs)("span",{className:"font-medium mr-2",children:[l+1,"."]}),(0,s.jsx)("span",{children:e}),(0,s.jsx)("button",{type:"button",onClick:()=>{let l=g.filter(l=>l!==e);h(l),i.setFieldValue("models",l)},className:"ml-2 text-blue-600 hover:text-blue-800",children:"\xd7"})]},e))})]}),(0,s.jsx)(V.Z,{placeholder:"Add a fallback model",value:"",onValueChange:e=>{if(e&&!g.includes(e)){let l=[...g,e];h(l),i.setFieldValue("models",l)}},children:Array.from(new Set(m.map(e=>e.model_group))).filter(e=>e!==o&&!g.includes(e)).sort().map(e=>(0,s.jsx)(I.Z,{value:e,children:e},e))})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[(0,s.jsx)("strong",{children:"Order matters:"})," Models will be tried in the order shown above (1st, 2nd, 3rd, etc.)"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-100",children:[(0,s.jsx)(_.z,{variant:"secondary",onClick:f,children:"Cancel"}),(0,s.jsx)(_.z,{variant:"primary",type:"submit",children:"Add Fallbacks"})]})]})]})})]})};async function M(e,l){console.log=function(){};let t=window.location.origin,a=new z.ZP.OpenAI({apiKey:l,baseURL:t,dangerouslyAllowBrowser:!0});try{v.Z.info("Testing fallback model response...");let l=await a.chat.completions.create({model:e,messages:[{role:"user",content:"Hi, this is a test message"}],mock_testing_fallbacks:!0});v.Z.success((0,s.jsxs)("span",{children:["Test model=",(0,s.jsx)("strong",{children:e}),", received model=",(0,s.jsx)("strong",{children:l.model}),". See"," ",(0,s.jsx)("a",{href:"#",onClick:()=>window.open("https://docs.litellm.ai/docs/proxy/reliability","_blank"),style:{textDecoration:"underline",color:"blue"},children:"curl"})]}))}catch(e){v.Z.fromBackend("Error occurred while generating model response. Please try again. Error: ".concat(e))}}var P=e=>{let{accessToken:l,userRole:t,userID:r,modelData:n}=e,[i,c]=(0,a.useState)({}),[d,o]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null);(0,a.useEffect)(()=>{l&&t&&r&&(0,p.getCallbacksCall)(l,r,t).then(e=>{console.log("callbacks",e);let l=e.router_settings;"model_group_retry_policy"in l&&delete l.model_group_retry_policy,c(l)})},[l,t,r]);let x=e=>{m(e)},g=async()=>{if(!u||!l)return;let e=Object.keys(u)[0];if(!e)return;o(!0);let t=i.fallbacks.map(l=>(e in l&&Array.isArray(l[e])&&delete l[e],l)).filter(e=>Object.keys(e).length>0),s={...i,fallbacks:t};try{await (0,p.setCallbacksCall)(l,{router_settings:s}),c(s),v.Z.success("Router settings updated successfully")}catch(e){v.Z.fromBackend("Failed to update router settings: "+e)}finally{o(!1),m(null)}};return l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L,{models:(null==n?void 0:n.data)?n.data.map(e=>e.model_name):[],accessToken:l,routerSettings:i,setRouterSettings:c}),(0,s.jsxs)(D.iA,{children:[(0,s.jsx)(D.ss,{children:(0,s.jsxs)(D.SC,{children:[(0,s.jsx)(D.xs,{children:"Model Name"}),(0,s.jsx)(D.xs,{children:"Fallbacks"}),(0,s.jsx)(D.xs,{children:"Actions"})]})}),(0,s.jsx)(D.RM,{children:i.fallbacks&&i.fallbacks.map((e,t)=>Object.entries(e).map(a=>{let[r,n]=a;return(0,s.jsxs)(D.SC,{children:[(0,s.jsx)(D.pj,{children:r}),(0,s.jsx)(D.pj,{children:Array.isArray(n)?n.join(", "):n}),(0,s.jsxs)(D.pj,{children:[(0,s.jsx)(E.Z,{title:"Test fallback",children:(0,s.jsx)(D.JO,{icon:R.Z,size:"sm",onClick:()=>M(Object.keys(e)[0],l||""),className:"cursor-pointer hover:text-blue-600"})}),(0,s.jsx)(E.Z,{title:"Delete fallback",children:(0,s.jsx)(D.JO,{icon:b.Z,size:"sm",onClick:()=>x(e),className:"cursor-pointer hover:text-red-600"})})]})]},t.toString()+r)}))})]}),u&&(0,s.jsxs)(T.Z,{title:"Delete Fallback",open:null!==u,onOk:g,onCancel:()=>{m(null)},confirmLoading:d,okText:"Delete",okButtonProps:{danger:!0},children:[(0,s.jsxs)("p",{children:["Are you sure you want to delete fallback: ",Object.keys(u)[0]," ?"]}),(0,s.jsx)("p",{children:"This action cannot be undone."})]})]}):null},J=e=>{let{accessToken:l,userRole:t,userID:_,modelData:v}=e,[N,k]=(0,a.useState)([]);(0,a.useEffect)(()=>{l&&(0,p.getGeneralSettingsCall)(l).then(e=>{k(e)})},[l]);let w=(e,l)=>{k(N.map(t=>t.field_name===e?{...t,field_value:l}:t))},S=(e,t)=>{if(!l)return;let s=N[t].field_value;if(null!=s&&void 0!=s)try{(0,p.updateConfigFieldSetting)(l,e,s);let t=N.map(l=>l.field_name===e?{...l,stored_in_db:!0}:l);k(t)}catch(e){}},Z=(e,t)=>{if(l)try{(0,p.deleteConfigFieldSetting)(l,e);let t=N.map(l=>l.field_name===e?{...l,stored_in_db:null,field_value:null}:l);k(t)}catch(e){}};return l?(0,s.jsx)("div",{className:"w-full",children:(0,s.jsxs)(f.v0,{className:"h-[75vh] w-full",children:[(0,s.jsxs)(f.td,{variant:"line",defaultValue:"1",className:"px-8 pt-4",children:[(0,s.jsx)(f.OK,{value:"1",children:"Loadbalancing"}),(0,s.jsx)(f.OK,{value:"2",children:"Fallbacks"}),(0,s.jsx)(f.OK,{value:"3",children:"General"})]}),(0,s.jsxs)(f.nP,{className:"px-8 py-6",children:[(0,s.jsx)(f.x4,{children:(0,s.jsx)(A,{accessToken:l,userRole:t,userID:_,modelData:v})}),(0,s.jsx)(f.x4,{children:(0,s.jsx)(P,{accessToken:l,userRole:t,userID:_,modelData:v})}),(0,s.jsx)(f.x4,{children:(0,s.jsx)(i.Z,{children:(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(m.Z,{children:(0,s.jsxs)(g.Z,{children:[(0,s.jsx)(x.Z,{children:"Setting"}),(0,s.jsx)(x.Z,{children:"Value"}),(0,s.jsx)(x.Z,{children:"Status"}),(0,s.jsx)(x.Z,{children:"Action"})]})}),(0,s.jsx)(o.Z,{children:N.filter(e=>"TypedDictionary"!==e.field_type).map((e,l)=>(0,s.jsxs)(g.Z,{children:[(0,s.jsxs)(u.Z,{children:[(0,s.jsx)(h.Z,{children:e.field_name}),(0,s.jsx)("p",{style:{fontSize:"0.65rem",color:"#808080",fontStyle:"italic"},className:"mt-1",children:e.field_description})]}),(0,s.jsx)(u.Z,{children:"Integer"==e.field_type?(0,s.jsx)(j.Z,{step:1,value:e.field_value,onChange:l=>w(e.field_name,l)}):null}),(0,s.jsx)(u.Z,{children:!0==e.stored_in_db?(0,s.jsx)(r.Z,{icon:y.Z,className:"text-white",children:"In DB"}):!1==e.stored_in_db?(0,s.jsx)(r.Z,{className:"text-gray bg-white outline",children:"In Config"}):(0,s.jsx)(r.Z,{className:"text-gray bg-white outline",children:"Not Set"})}),(0,s.jsxs)(u.Z,{children:[(0,s.jsx)(n.Z,{onClick:()=>S(e.field_name,l),children:"Update"}),(0,s.jsx)(c.Z,{icon:b.Z,color:"red",onClick:()=>Z(e.field_name,l),children:"Reset"})]})]},l))})]})})})]})]})}):null}}}]);