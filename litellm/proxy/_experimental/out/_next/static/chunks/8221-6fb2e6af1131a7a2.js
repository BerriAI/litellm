"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8221],{98221:function(e,l,a){a.d(l,{Z:function(){return e_}});var s=a(57437),t=a(2265),i=a(71618),r=a(42264),n=a(22116),c=a(51653),o=a(29271),d=a(15424),m=a(20347),h=a(41649),x=a(78489),u=a(47323),p=a(21626),g=a(97214),y=a(28241),j=a(58834),f=a(69552),v=a(71876),b=a(93416),N=a(74998),w=a(44633),_=a(86462),Z=a(49084),k=a(99981),S=a(3810),C=a(71594),P=a(24525),I=e=>{let{policies:l,isLoading:a,onDeleteClick:i,onEditClick:r,onViewClick:n,isAdmin:c=!1}=e,[o,d]=(0,t.useState)([{id:"created_at",desc:!0}]),m=e=>e?new Date(e).toLocaleString():"-",I=[{header:"Policy ID",accessorKey:"policy_id",cell:e=>(0,s.jsx)(k.Z,{title:String(e.getValue()||""),children:(0,s.jsx)(x.Z,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>e.getValue()&&n(e.getValue()),children:e.getValue()?"".concat(String(e.getValue()).slice(0,7),"..."):""})})},{header:"Name",accessorKey:"policy_name",cell:e=>{let{row:l}=e,a=l.original;return(0,s.jsx)(k.Z,{title:a.policy_name,children:(0,s.jsx)("span",{className:"text-xs font-medium",children:a.policy_name||"-"})})}},{header:"Description",accessorKey:"description",cell:e=>{let{row:l}=e,a=l.original;return(0,s.jsx)(k.Z,{title:a.description,children:(0,s.jsx)("span",{className:"text-xs truncate max-w-[200px] block",children:a.description||"-"})})}},{header:"Inherits From",accessorKey:"inherit",cell:e=>{let{row:l}=e,a=l.original;return a.inherit?(0,s.jsx)(h.Z,{color:"blue",size:"xs",children:a.inherit}):(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Guardrails (Add)",accessorKey:"guardrails_add",cell:e=>{let{row:l}=e,a=l.original.guardrails_add||[];return 0===a.length?(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,s.jsx)(S.Z,{color:"green",className:"text-xs",children:e},l)),a.length>2&&(0,s.jsx)(k.Z,{title:a.slice(2).join(", "),children:(0,s.jsxs)(S.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Guardrails (Remove)",accessorKey:"guardrails_remove",cell:e=>{let{row:l}=e,a=l.original.guardrails_remove||[];return 0===a.length?(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,s.jsx)(S.Z,{color:"red",className:"text-xs",children:e},l)),a.length>2&&(0,s.jsx)(k.Z,{title:a.slice(2).join(", "),children:(0,s.jsxs)(S.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Model Condition",accessorKey:"condition",cell:e=>{var l;let{row:a}=e,t=null===(l=a.original.condition)||void 0===l?void 0:l.model;return t?(0,s.jsx)(k.Z,{title:"string"==typeof t?t:JSON.stringify(t),children:(0,s.jsx)("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"string"==typeof t?t.length>20?t.slice(0,20)+"...":t:"Multiple"})}):(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Created At",accessorKey:"created_at",cell:e=>{let{row:l}=e,a=l.original;return(0,s.jsx)(k.Z,{title:a.created_at,children:(0,s.jsx)("span",{className:"text-xs",children:m(a.created_at)})})}},{id:"actions",header:"Actions",cell:e=>{let{row:l}=e,a=l.original;return(0,s.jsx)("div",{className:"flex space-x-2",children:c&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.Z,{title:"Edit policy",children:(0,s.jsx)(u.Z,{icon:b.Z,size:"sm",onClick:()=>r(a),className:"cursor-pointer hover:text-blue-500"})}),(0,s.jsx)(k.Z,{title:"Delete policy",children:(0,s.jsx)(u.Z,{icon:N.Z,size:"sm",onClick:()=>a.policy_id&&i(a.policy_id,a.policy_name||"Unnamed Policy"),className:"cursor-pointer hover:text-red-500"})})]})})}}],A=(0,C.b7)({data:l,columns:I,state:{sorting:o},onSortingChange:d,getCoreRowModel:(0,P.sC)(),getSortedRowModel:(0,P.tj)(),enableSorting:!0});return(0,s.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(p.Z,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,s.jsx)(j.Z,{children:A.getHeaderGroups().map(e=>(0,s.jsx)(v.Z,{children:e.headers.map(e=>(0,s.jsx)(f.Z,{className:"py-1 h-8 ".concat("actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),onClick:e.column.getToggleSortingHandler(),children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,C.ie)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,s.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,s.jsx)(w.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,s.jsx)(_.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,s.jsx)(Z.Z,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,s.jsx)(g.Z,{children:a?(0,s.jsx)(v.Z,{children:(0,s.jsx)(y.Z,{colSpan:I.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"Loading..."})})})}):l.length>0?A.getRowModel().rows.map(e=>(0,s.jsx)(v.Z,{className:"h-8",children:e.getVisibleCells().map(e=>(0,s.jsx)(y.Z,{className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ".concat("actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),children:(0,C.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,s.jsx)(v.Z,{children:(0,s.jsx)(y.Z,{colSpan:I.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"No policies found"})})})})})]})})})},A=a(12514),E=a(10900),F=a(57840),L=a(10353),T=a(76188),z=a(23496),G=a(19250);let{Title:D,Text:M}=F.default;var K=e=>{var l;let{policyId:a,onClose:i,onEdit:r,accessToken:n,isAdmin:o,getPolicy:d}=e,[m,u]=(0,t.useState)(null),[p,g]=(0,t.useState)(!0),[y,j]=(0,t.useState)([]),[f,v]=(0,t.useState)(!1),N=(0,t.useCallback)(async()=>{if(n&&a){g(!0);try{let e=await d(n,a);u(e),v(!0);try{let e=await (0,G.getResolvedGuardrails)(n,a);j(e.resolved_guardrails||[])}catch(e){console.error("Error fetching resolved guardrails:",e)}finally{v(!1)}}catch(e){console.error("Error fetching policy:",e)}finally{g(!1)}}},[a,n,d]);return((0,t.useEffect)(()=>{N()},[N]),p)?(0,s.jsx)("div",{className:"flex justify-center items-center p-12",children:(0,s.jsx)(L.Z,{size:"large"})}):m?(0,s.jsx)(A.Z,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(x.Z,{variant:"secondary",icon:E.Z,onClick:i,children:"Back to Policies"}),o&&(0,s.jsx)(x.Z,{icon:b.Z,onClick:()=>r(m),children:"Edit Policy"})]}),(0,s.jsx)(D,{level:4,children:m.policy_name}),(0,s.jsxs)(T.Z,{bordered:!0,column:1,children:[(0,s.jsx)(T.Z.Item,{label:"Policy ID",children:(0,s.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:m.policy_id})}),(0,s.jsx)(T.Z.Item,{label:"Description",children:m.description||(0,s.jsx)(M,{type:"secondary",children:"No description"})}),(0,s.jsx)(T.Z.Item,{label:"Inherits From",children:m.inherit?(0,s.jsx)(h.Z,{color:"blue",size:"sm",children:m.inherit}):(0,s.jsx)(M,{type:"secondary",children:"None"})}),(0,s.jsx)(T.Z.Item,{label:"Created At",children:m.created_at?new Date(m.created_at).toLocaleString():"-"}),(0,s.jsx)(T.Z.Item,{label:"Updated At",children:m.updated_at?new Date(m.updated_at).toLocaleString():"-"})]}),(0,s.jsx)(z.Z,{orientation:"left",children:(0,s.jsx)(M,{strong:!0,children:"Guardrails Configuration"})}),y.length>0&&(0,s.jsx)(c.Z,{message:"Resolved Guardrails",description:(0,s.jsxs)("div",{children:[(0,s.jsx)(M,{type:"secondary",style:{display:"block",marginBottom:8},children:"Final guardrails that will be applied (including inheritance):"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:y.map(e=>(0,s.jsx)(S.Z,{color:"blue",children:e},e))})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,s.jsxs)(T.Z,{bordered:!0,column:1,children:[(0,s.jsx)(T.Z.Item,{label:"Guardrails to Add",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:m.guardrails_add&&m.guardrails_add.length>0?m.guardrails_add.map(e=>(0,s.jsx)(S.Z,{color:"green",children:e},e)):(0,s.jsx)(M,{type:"secondary",children:"None"})})}),(0,s.jsx)(T.Z.Item,{label:"Guardrails to Remove",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:m.guardrails_remove&&m.guardrails_remove.length>0?m.guardrails_remove.map(e=>(0,s.jsx)(S.Z,{color:"red",children:e},e)):(0,s.jsx)(M,{type:"secondary",children:"None"})})})]}),(0,s.jsx)(z.Z,{orientation:"left",children:(0,s.jsx)(M,{strong:!0,children:"Conditions"})}),(0,s.jsx)(T.Z,{bordered:!0,column:1,children:(0,s.jsx)(T.Z.Item,{label:"Model Condition",children:(null===(l=m.condition)||void 0===l?void 0:l.model)?(0,s.jsx)(S.Z,{color:"purple",children:"string"==typeof m.condition.model?m.condition.model:JSON.stringify(m.condition.model)}):(0,s.jsx)(M,{type:"secondary",children:"No model condition (applies to all models)"})})})]})}):(0,s.jsxs)(A.Z,{children:[(0,s.jsx)(M,{type:"danger",children:"Policy not found"}),(0,s.jsx)("br",{}),(0,s.jsx)(x.Z,{onClick:i,className:"mt-4",children:"Go Back"})]})},V=a(37592),B=a(10032),O=a(29967),R=a(49566),U=a(16853),q=a(9114),H=a(39760);let{Text:W}=F.default,{Option:Y}=V.default;var J=e=>{let{visible:l,onClose:a,onSuccess:i,accessToken:r,editingPolicy:o,existingPolicies:d,availableGuardrails:m,createPolicy:h,updatePolicy:u}=e,[p]=B.Z.useForm(),[g,y]=(0,t.useState)(!1),[j,f]=(0,t.useState)([]),[v,b]=(0,t.useState)(!1),[N,w]=(0,t.useState)("model"),[_,Z]=(0,t.useState)([]),{userId:k,userRole:C}=(0,H.Z)(),P=!!(null==o?void 0:o.policy_id);(0,t.useEffect)(()=>{if(l&&o){var e;let l=null===(e=o.condition)||void 0===e?void 0:e.model;w(l&&/[.*+?^${}()|[\]\\]/.test(l)?"regex":"model"),p.setFieldsValue({policy_name:o.policy_name,description:o.description,inherit:o.inherit,guardrails_add:o.guardrails_add||[],guardrails_remove:o.guardrails_remove||[],model_condition:l}),o.policy_id&&r&&A(o.policy_id)}else l&&(p.resetFields(),f([]),w("model"))},[l,o,p]),(0,t.useEffect)(()=>{l&&r&&I()},[l,r]);let I=async()=>{if(r)try{let e=await (0,G.modelAvailableCall)(r,k,C);if(null==e?void 0:e.data){let l=e.data.map(e=>e.id||e.model_name).filter(Boolean);Z(l)}}catch(e){console.error("Failed to load available models:",e)}},A=async e=>{if(r){b(!0);try{let l=await (0,G.getResolvedGuardrails)(r,e);f(l.resolved_guardrails||[])}catch(e){console.error("Failed to load resolved guardrails:",e)}finally{b(!1)}}},E=()=>{let e=p.getFieldsValue(!0),l=e.inherit,a=e.guardrails_add||[],s=e.guardrails_remove||[],t=new Set;if(l){let e=d.find(e=>e.policy_name===l);e&&F(e).forEach(e=>t.add(e))}return a.forEach(e=>t.add(e)),s.forEach(e=>t.delete(e)),Array.from(t).sort()},F=e=>{let l=new Set;if(e.inherit){let a=d.find(l=>l.policy_name===e.inherit);a&&F(a).forEach(e=>l.add(e))}return e.guardrails_add&&e.guardrails_add.forEach(e=>l.add(e)),e.guardrails_remove&&e.guardrails_remove.forEach(e=>l.delete(e)),Array.from(l)},L=()=>{p.resetFields()},T=()=>{L(),a()},D=async()=>{try{y(!0),await p.validateFields();let e=p.getFieldsValue(!0);if(!r)throw Error("No access token available");let l={policy_name:e.policy_name,description:e.description||void 0,inherit:e.inherit||void 0,guardrails_add:e.guardrails_add||[],guardrails_remove:e.guardrails_remove||[],condition:e.model_condition?{model:e.model_condition}:void 0};P&&o?(await u(r,o.policy_id,l),q.ZP.success("Policy updated successfully")):(await h(r,l),q.ZP.success("Policy created successfully")),L(),i(),a()}catch(e){console.error("Failed to save policy:",e),q.ZP.fromBackend("Failed to save policy: "+(e instanceof Error?e.message:String(e)))}finally{y(!1)}},M=m.map(e=>({label:e.guardrail_name||e.guardrail_id,value:e.guardrail_name||e.guardrail_id})),K=d.filter(e=>!o||e.policy_id!==o.policy_id).map(e=>({label:e.policy_name,value:e.policy_name}));return(0,s.jsx)(n.Z,{title:P?"Edit Policy":"Create New Policy",open:l,onCancel:T,footer:null,width:700,children:(0,s.jsxs)(B.Z,{form:p,layout:"vertical",initialValues:{guardrails_add:[],guardrails_remove:[]},onValuesChange:()=>{f(E())},children:[(0,s.jsx)(B.Z.Item,{name:"policy_name",label:"Policy Name",rules:[{required:!0,message:"Please enter a policy name"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"Policy name can only contain letters, numbers, hyphens, and underscores"}],children:(0,s.jsx)(R.Z,{placeholder:"e.g., global-baseline, healthcare-compliance",disabled:P})}),(0,s.jsx)(B.Z.Item,{name:"description",label:"Description",children:(0,s.jsx)(U.Z,{rows:2,placeholder:"Describe what this policy does..."})}),(0,s.jsx)(z.Z,{orientation:"left",children:(0,s.jsx)(W,{strong:!0,children:"Inheritance"})}),(0,s.jsx)(B.Z.Item,{name:"inherit",label:"Inherit From",tooltip:"Inherit guardrails from another policy. The child policy will include all guardrails from the parent.",children:(0,s.jsx)(V.default,{allowClear:!0,placeholder:"Select a parent policy (optional)",options:K,style:{width:"100%"}})}),(0,s.jsx)(z.Z,{orientation:"left",children:(0,s.jsx)(W,{strong:!0,children:"Guardrails"})}),(0,s.jsx)(B.Z.Item,{name:"guardrails_add",label:"Guardrails to Add",tooltip:"These guardrails will be added to requests matching this policy",children:(0,s.jsx)(V.default,{mode:"multiple",allowClear:!0,placeholder:"Select guardrails to add",options:M,style:{width:"100%"}})}),(0,s.jsx)(B.Z.Item,{name:"guardrails_remove",label:"Guardrails to Remove",tooltip:"These guardrails will be removed from inherited guardrails",children:(0,s.jsx)(V.default,{mode:"multiple",allowClear:!0,placeholder:"Select guardrails to remove (from inherited)",options:M,style:{width:"100%"}})}),j.length>0&&(0,s.jsx)(c.Z,{message:"Resolved Guardrails",description:(0,s.jsxs)("div",{children:[(0,s.jsx)(W,{type:"secondary",style:{display:"block",marginBottom:8},children:"These are the final guardrails that will be applied (including inheritance):"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:j.map(e=>(0,s.jsx)(S.Z,{color:"blue",children:e},e))})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,s.jsx)(z.Z,{orientation:"left",children:(0,s.jsx)(W,{strong:!0,children:"Conditions (Optional)"})}),(0,s.jsx)(c.Z,{message:"Model Scope",description:"By default, this policy will run on all models. You can optionally restrict it to specific models below.",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,s.jsx)(B.Z.Item,{label:"Model Condition Type",children:(0,s.jsxs)(O.ZP.Group,{value:N,onChange:e=>{w(e.target.value),p.setFieldValue("model_condition",void 0)},children:[(0,s.jsx)(O.ZP,{value:"model",children:"Select Model"}),(0,s.jsx)(O.ZP,{value:"regex",children:"Custom Regex Pattern"})]})}),(0,s.jsx)(B.Z.Item,{name:"model_condition",label:"model"===N?"Model (Optional)":"Regex Pattern (Optional)",tooltip:"model"===N?"Select a specific model to apply this policy to. Leave empty to apply to all models.":"Enter a regex pattern to match models (e.g., gpt-4.* or bedrock/.*). Leave empty to apply to all models.",children:"model"===N?(0,s.jsx)(V.default,{showSearch:!0,allowClear:!0,placeholder:"Leave empty to apply to all models",options:_.map(e=>({label:e,value:e})),filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}}):(0,s.jsx)(R.Z,{placeholder:"Leave empty to apply to all models (e.g., gpt-4.* or bedrock/claude-.*)"})}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,s.jsx)(x.Z,{variant:"secondary",onClick:T,children:"Cancel"}),(0,s.jsx)(x.Z,{onClick:D,loading:g,children:P?"Update Policy":"Create Policy"})]})]})})},$=a(58927),Q=a(71437),X=a(79326),ee=e=>{let{attachment:l,accessToken:a}=e,[i,r]=(0,t.useState)(null),[n,c]=(0,t.useState)(!1),[o,d]=(0,t.useState)(!1),m=async()=>{if(!o&&!n&&a){c(!0);try{let e=await (0,G.estimateAttachmentImpactCall)(a,{policy_name:l.policy_name,scope:l.scope,teams:l.teams,keys:l.keys,models:l.models,tags:l.tags});r(e),d(!0)}catch(e){console.error("Failed to load impact:",e)}finally{c(!1)}}},h=n?(0,s.jsxs)("div",{className:"p-2 text-center",children:[(0,s.jsx)(L.Z,{size:"small"})," Loading..."]}):i?(0,s.jsx)("div",{className:"text-xs",style:{maxWidth:280},children:-1===i.affected_keys_count?(0,s.jsx)("p",{className:"font-medium text-amber-600",children:"Global scope — affects all keys and teams"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsx)("strong",{children:i.affected_keys_count})," key",1!==i.affected_keys_count?"s":"",","," ",(0,s.jsx)("strong",{children:i.affected_teams_count})," team",1!==i.affected_teams_count?"s":""," affected"]}),i.sample_keys.length>0&&(0,s.jsxs)("div",{className:"mb-1",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Keys: "}),i.sample_keys.map(e=>(0,s.jsx)(S.Z,{style:{fontSize:10,margin:1},children:e},e))]}),i.sample_teams.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Teams: "}),i.sample_teams.map(e=>(0,s.jsx)(S.Z,{style:{fontSize:10,margin:1},children:e},e))]}),0===i.affected_keys_count&&0===i.affected_teams_count&&(0,s.jsx)("p",{className:"text-gray-400",children:"No keys or teams currently affected"})]})}):(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Click to load"});return(0,s.jsx)(X.Z,{content:h,title:"Blast Radius",trigger:"click",onOpenChange:e=>{e&&m()},children:(0,s.jsx)(k.Z,{title:"View blast radius",children:(0,s.jsx)($.J,{icon:Q.Z,size:"sm",className:"cursor-pointer hover:text-blue-500"})})})},el=e=>{let{attachments:l,isLoading:a,onDeleteClick:i,isAdmin:r,accessToken:n}=e,[c,o]=(0,t.useState)([{id:"created_at",desc:!0}]),d=e=>e?new Date(e).toLocaleString():"-",m=[{header:"Attachment ID",accessorKey:"attachment_id",cell:e=>(0,s.jsx)(k.Z,{title:String(e.getValue()||""),children:(0,s.jsx)("span",{className:"font-mono text-xs text-gray-600",children:e.getValue()?"".concat(String(e.getValue()).slice(0,7),"..."):""})})},{header:"Policy",accessorKey:"policy_name",cell:e=>{let{row:l}=e,a=l.original;return(0,s.jsx)(h.Z,{color:"blue",size:"xs",children:a.policy_name})}},{header:"Scope",accessorKey:"scope",cell:e=>{let{row:l}=e,a=l.original;return"*"===a.scope?(0,s.jsx)(h.Z,{color:"amber",size:"xs",children:"Global (*)"}):a.scope?(0,s.jsx)("span",{className:"text-xs",children:a.scope}):(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Teams",accessorKey:"teams",cell:e=>{let{row:l}=e,a=l.original.teams||[];return 0===a.length?(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,s.jsx)(S.Z,{color:"cyan",className:"text-xs",children:e},l)),a.length>2&&(0,s.jsx)(k.Z,{title:a.slice(2).join(", "),children:(0,s.jsxs)(S.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Keys",accessorKey:"keys",cell:e=>{let{row:l}=e,a=l.original.keys||[];return 0===a.length?(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,s.jsx)(S.Z,{color:"purple",className:"text-xs",children:e},l)),a.length>2&&(0,s.jsx)(k.Z,{title:a.slice(2).join(", "),children:(0,s.jsxs)(S.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Models",accessorKey:"models",cell:e=>{let{row:l}=e,a=l.original.models||[];return 0===a.length?(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,s.jsx)(S.Z,{color:"green",className:"text-xs",children:e},l)),a.length>2&&(0,s.jsx)(k.Z,{title:a.slice(2).join(", "),children:(0,s.jsxs)(S.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Tags",accessorKey:"tags",cell:e=>{let{row:l}=e,a=l.original.tags||[];return 0===a.length?(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,l)=>(0,s.jsx)(S.Z,{color:"orange",className:"text-xs",children:e},l)),a.length>2&&(0,s.jsx)(k.Z,{title:a.slice(2).join(", "),children:(0,s.jsxs)(S.Z,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Created At",accessorKey:"created_at",cell:e=>{let{row:l}=e,a=l.original;return(0,s.jsx)(k.Z,{title:a.created_at,children:(0,s.jsx)("span",{className:"text-xs",children:d(a.created_at)})})}},{id:"actions",header:"Actions",cell:e=>{let{row:l}=e,a=l.original;return(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(ee,{attachment:a,accessToken:n}),r&&(0,s.jsx)(k.Z,{title:"Delete attachment",children:(0,s.jsx)(u.Z,{icon:N.Z,size:"sm",onClick:()=>i(a.attachment_id),className:"cursor-pointer hover:text-red-500"})})]})}}],x=(0,C.b7)({data:l,columns:m,state:{sorting:c},onSortingChange:o,getCoreRowModel:(0,P.sC)(),getSortedRowModel:(0,P.tj)(),enableSorting:!0});return(0,s.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(p.Z,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,s.jsx)(j.Z,{children:x.getHeaderGroups().map(e=>(0,s.jsx)(v.Z,{children:e.headers.map(e=>(0,s.jsx)(f.Z,{className:"py-1 h-8 ".concat("actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),onClick:e.column.getToggleSortingHandler(),children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,C.ie)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,s.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,s.jsx)(w.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,s.jsx)(_.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,s.jsx)(Z.Z,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,s.jsx)(g.Z,{children:a?(0,s.jsx)(v.Z,{children:(0,s.jsx)(y.Z,{colSpan:m.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"Loading..."})})})}):l.length>0?x.getRowModel().rows.map(e=>(0,s.jsx)(v.Z,{className:"h-8",children:e.getVisibleCells().map(e=>(0,s.jsx)(y.Z,{className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ".concat("actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),children:(0,C.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,s.jsx)(v.Z,{children:(0,s.jsx)(y.Z,{colSpan:m.length,className:"h-8 text-center",children:(0,s.jsx)("div",{className:"text-center text-gray-500",children:(0,s.jsx)("p",{children:"No attachments found"})})})})})]})})})},ea=a(16312);let{Text:es}=F.default;var et=e=>{let{impactResult:l}=e;return(0,s.jsx)(c.Z,{type:-1===l.affected_keys_count?"warning":"info",showIcon:!0,className:"mb-4",message:"Impact Preview",description:-1===l.affected_keys_count?(0,s.jsxs)(es,{children:["Global scope — this will affect ",(0,s.jsx)("strong",{children:"all keys and teams"}),"."]}):(0,s.jsxs)("div",{children:[(0,s.jsxs)(es,{children:["This attachment would affect ",(0,s.jsxs)("strong",{children:[l.affected_keys_count," key",1!==l.affected_keys_count?"s":""]})," and ",(0,s.jsxs)("strong",{children:[l.affected_teams_count," team",1!==l.affected_teams_count?"s":""]}),"."]}),l.sample_keys.length>0&&(0,s.jsxs)("div",{className:"mt-1",children:[(0,s.jsx)(es,{type:"secondary",style:{fontSize:12},children:"Keys: "}),l.sample_keys.slice(0,5).map(e=>(0,s.jsx)(S.Z,{style:{fontSize:11},children:e},e)),l.affected_keys_count>5&&(0,s.jsxs)(es,{type:"secondary",style:{fontSize:11},children:["and ",l.affected_keys_count-5," more..."]})]}),l.sample_teams.length>0&&(0,s.jsxs)("div",{className:"mt-1",children:[(0,s.jsx)(es,{type:"secondary",style:{fontSize:12},children:"Teams: "}),l.sample_teams.slice(0,5).map(e=>(0,s.jsx)(S.Z,{style:{fontSize:11},children:e},e)),l.affected_teams_count>5&&(0,s.jsxs)(es,{type:"secondary",style:{fontSize:11},children:["and ",l.affected_teams_count-5," more..."]})]})]})})};let{Text:ei}=F.default;var er=e=>{let{visible:l,onClose:a,onSuccess:i,accessToken:r,policies:c,createAttachment:o}=e,[d]=B.Z.useForm(),[m,h]=(0,t.useState)(!1),[x,u]=(0,t.useState)("global"),[p,g]=(0,t.useState)([]),[y,j]=(0,t.useState)([]),[f,v]=(0,t.useState)([]),[b,N]=(0,t.useState)(!1),[w,_]=(0,t.useState)(!1),[Z,k]=(0,t.useState)(!1),[S,C]=(0,t.useState)(!1),[P,I]=(0,t.useState)(null),{userId:A,userRole:E}=(0,H.Z)();(0,t.useEffect)(()=>{l&&r&&F()},[l,r]);let F=async()=>{if(r){N(!0);try{let e=await (0,G.teamListCall)(r,null,A),l=(Array.isArray(e)?e:(null==e?void 0:e.data)||[]).map(e=>e.team_alias).filter(Boolean);g(l)}catch(e){console.error("Failed to load teams:",e)}finally{N(!1)}_(!0);try{let e=await (0,G.keyListCall)(r,null,null,null,null,null,1,100),l=((null==e?void 0:e.keys)||(null==e?void 0:e.data)||[]).map(e=>e.key_alias).filter(Boolean);j(l)}catch(e){console.error("Failed to load keys:",e)}finally{_(!1)}k(!0);try{let e=await (0,G.modelAvailableCall)(r,A||"",E||""),l=((null==e?void 0:e.data)||(Array.isArray(e)?e:[])).map(e=>e.id||e.model_name).filter(Boolean);v(l)}catch(e){console.error("Failed to load models:",e)}finally{k(!1)}}},L=()=>{d.resetFields(),u("global"),I(null)},T=()=>(function(e,l){let a={policy_name:e.policy_name};return"global"===l?a.scope="*":(e.teams&&e.teams.length>0&&(a.teams=e.teams),e.keys&&e.keys.length>0&&(a.keys=e.keys),e.models&&e.models.length>0&&(a.models=e.models),e.tags&&e.tags.length>0&&(a.tags=e.tags)),a})(d.getFieldsValue(!0),x),D=async()=>{if(r){try{await d.validateFields(["policy_name"])}catch(e){return}C(!0);try{let e=T(),l=await (0,G.estimateAttachmentImpactCall)(r,e);I(l)}catch(e){console.error("Failed to estimate impact:",e)}finally{C(!1)}}},M=()=>{L(),a()},K=async()=>{try{if(h(!0),await d.validateFields(),!r)throw Error("No access token available");let e=T();await o(r,e),q.ZP.success("Attachment created successfully"),L(),i(),a()}catch(e){console.error("Failed to create attachment:",e),q.ZP.fromBackend("Failed to create attachment: "+(e instanceof Error?e.message:String(e)))}finally{h(!1)}},R=c.map(e=>({label:e.policy_name,value:e.policy_name}));return(0,s.jsx)(n.Z,{title:"Create Policy Attachment",open:l,onCancel:M,footer:null,width:600,children:(0,s.jsxs)(B.Z,{form:d,layout:"vertical",initialValues:{scope_type:"global"},children:[(0,s.jsx)(B.Z.Item,{name:"policy_name",label:"Policy",rules:[{required:!0,message:"Please select a policy"}],children:(0,s.jsx)(V.default,{placeholder:"Select a policy to attach",options:R,showSearch:!0,filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}})}),(0,s.jsx)(z.Z,{orientation:"left",children:(0,s.jsx)(ei,{strong:!0,children:"Scope"})}),(0,s.jsx)(B.Z.Item,{label:"Scope Type",children:(0,s.jsxs)(O.ZP.Group,{value:x,onChange:e=>u(e.target.value),children:[(0,s.jsx)(O.ZP,{value:"specific",children:"Specific (teams, keys, models, or tags)"}),(0,s.jsx)(O.ZP,{value:"global",children:"Global (applies to all requests)"})]})}),"specific"===x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.Z.Item,{name:"teams",label:"Teams",tooltip:"Select team aliases or enter custom patterns. Supports wildcards (e.g., healthcare-*)",children:(0,s.jsx)(V.default,{mode:"tags",placeholder:b?"Loading teams...":"Select or enter team aliases",loading:b,options:p.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}})}),(0,s.jsx)(B.Z.Item,{name:"keys",label:"Keys",tooltip:"Select key aliases or enter custom patterns. Supports wildcards (e.g., dev-*)",children:(0,s.jsx)(V.default,{mode:"tags",placeholder:w?"Loading keys...":"Select or enter key aliases",loading:w,options:y.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}})}),(0,s.jsx)(B.Z.Item,{name:"models",label:"Models",tooltip:"Model names this attachment applies to. Supports wildcards (e.g., gpt-4*). Leave empty to apply to all models.",children:(0,s.jsx)(V.default,{mode:"tags",placeholder:Z?"Loading models...":"Select or enter model names (e.g., gpt-4, bedrock/*)",loading:Z,options:f.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},style:{width:"100%"}})}),(0,s.jsx)(B.Z.Item,{name:"tags",label:"Tags",tooltip:"Match against tags set in key or team metadata. Use exact values (e.g., healthcare) or wildcard patterns (e.g., health-*) where * matches any suffix.",extra:(0,s.jsxs)(ei,{type:"secondary",style:{fontSize:12},children:["Matches tags from key/team ",(0,s.jsx)("code",{children:"metadata.tags"})," or tags passed dynamically in the request body. Use ",(0,s.jsx)("code",{children:"*"})," as a suffix wildcard (e.g., ",(0,s.jsx)("code",{children:"prod-*"})," matches ",(0,s.jsx)("code",{children:"prod-us"}),", ",(0,s.jsx)("code",{children:"prod-eu"}),")."]}),children:(0,s.jsx)(V.default,{mode:"tags",placeholder:"Type a tag and press Enter (e.g. healthcare, prod-*)",tokenSeparators:[","," "],notFoundContent:null,suffixIcon:null,open:!1,style:{width:"100%"}})})]}),P&&(0,s.jsx)(et,{impactResult:P}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,s.jsx)(ea.z,{variant:"secondary",onClick:M,children:"Cancel"}),"specific"===x&&(0,s.jsx)(ea.z,{variant:"secondary",onClick:D,loading:S,children:"Estimate Impact"}),(0,s.jsx)(ea.z,{onClick:K,loading:m,children:"Create Attachment"})]})]})})},en=a(85180);let{Text:ec}=F.default;var eo=e=>{let{accessToken:l}=e,[a]=B.Z.useForm(),[i,r]=(0,t.useState)(!1),[n,o]=(0,t.useState)(null),[d,m]=(0,t.useState)(!1),[h,x]=(0,t.useState)([]),[u,p]=(0,t.useState)([]),[g,y]=(0,t.useState)([]),{userId:j,userRole:f}=(0,H.Z)();(0,t.useEffect)(()=>{l&&v()},[l]);let v=async()=>{if(l){try{let e=await (0,G.teamListCall)(l,null,j),a=Array.isArray(e)?e:(null==e?void 0:e.data)||[];x(a.map(e=>e.team_alias).filter(Boolean))}catch(e){console.error("Failed to load teams:",e)}try{let e=await (0,G.keyListCall)(l,null,null,null,null,null,1,100),a=(null==e?void 0:e.keys)||(null==e?void 0:e.data)||[];p(a.map(e=>e.key_alias).filter(Boolean))}catch(e){console.error("Failed to load keys:",e)}try{let e=await (0,G.modelAvailableCall)(l,j||"",f||""),a=(null==e?void 0:e.data)||(Array.isArray(e)?e:[]);y(a.map(e=>e.id||e.model_name).filter(Boolean))}catch(e){console.error("Failed to load models:",e)}}},b=async()=>{if(l){r(!0),m(!0);try{let e=a.getFieldsValue(!0),s={};e.team_alias&&(s.team_alias=e.team_alias),e.key_alias&&(s.key_alias=e.key_alias),e.model&&(s.model=e.model),e.tags&&e.tags.length>0&&(s.tags=e.tags);let t=await (0,G.resolvePoliciesCall)(l,s);o(t)}catch(e){console.error("Error resolving policies:",e),o(null)}finally{r(!1)}}};return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"bg-white border rounded-lg p-6 mb-6",children:[(0,s.jsxs)("div",{className:"mb-5",children:[(0,s.jsx)("h3",{className:"text-base font-semibold mb-1",children:"Policy Simulator"}),(0,s.jsx)(ec,{type:"secondary",children:'Simulate a request to see which policies and guardrails would apply. Select a team, key, model, or tags below and click "Simulate" to see the results.'})]}),(0,s.jsxs)(B.Z,{form:a,layout:"vertical",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(B.Z.Item,{name:"team_alias",label:"Team Alias",className:"mb-3",children:(0,s.jsx)(V.default,{showSearch:!0,allowClear:!0,placeholder:"Select or type a team alias",options:h.map(e=>({label:e,value:e})),filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())}})}),(0,s.jsx)(B.Z.Item,{name:"key_alias",label:"Key Alias",className:"mb-3",children:(0,s.jsx)(V.default,{showSearch:!0,allowClear:!0,placeholder:"Select or type a key alias",options:u.map(e=>({label:e,value:e})),filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())}})}),(0,s.jsx)(B.Z.Item,{name:"model",label:"Model",className:"mb-3",children:(0,s.jsx)(V.default,{showSearch:!0,allowClear:!0,placeholder:"Select or type a model",options:g.map(e=>({label:e,value:e})),filterOption:(e,l)=>{var a;return(null!==(a=null==l?void 0:l.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())}})}),(0,s.jsx)(B.Z.Item,{name:"tags",label:"Tags",className:"mb-3",children:(0,s.jsx)(V.default,{mode:"tags",placeholder:"Type a tag and press Enter",tokenSeparators:[","," "],notFoundContent:null,suffixIcon:null,open:!1})})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(ea.z,{onClick:b,loading:i,disabled:!l,children:"Simulate"}),(0,s.jsx)(ea.z,{variant:"secondary",onClick:()=>{a.resetFields(),o(null),m(!1)},children:"Reset"})]})]})]}),!d&&(0,s.jsxs)("div",{className:"bg-white border rounded-lg p-8 text-center",children:[(0,s.jsx)("div",{className:"text-gray-400 mb-2",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mx-auto mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"No simulation run yet"}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:'Fill in one or more fields above and click "Simulate" to see which policies and guardrails would apply to that request.'})]}),d&&n&&(0,s.jsx)("div",{className:"bg-white border rounded-lg p-6",children:0===n.matched_policies.length?(0,s.jsx)(en.Z,{description:"No policies matched this context"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"text-sm font-semibold mb-2",children:"Effective Guardrails"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:n.effective_guardrails.length>0?n.effective_guardrails.map(e=>(0,s.jsx)(S.Z,{color:"green",children:e},e)):(0,s.jsx)("span",{className:"text-gray-400 text-sm",children:"None"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-semibold mb-2",children:"Matched Policies"}),(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left py-2 pr-4",children:"Policy"}),(0,s.jsx)("th",{className:"text-left py-2 pr-4",children:"Matched Via"}),(0,s.jsx)("th",{className:"text-left py-2",children:"Guardrails Added"})]})}),(0,s.jsx)("tbody",{children:n.matched_policies.map(e=>(0,s.jsxs)("tr",{className:"border-b last:border-0",children:[(0,s.jsx)("td",{className:"py-2 pr-4 font-medium",children:e.policy_name}),(0,s.jsx)("td",{className:"py-2 pr-4",children:(0,s.jsx)(S.Z,{color:"blue",children:e.matched_via})}),(0,s.jsx)("td",{className:"py-2",children:e.guardrails_added.length>0?(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.guardrails_added.map(e=>(0,s.jsx)(S.Z,{color:"green",children:e},e))}):(0,s.jsx)("span",{className:"text-gray-400",children:"None"})})]},e.policy_name))})]})]})]})}),d&&!n&&!i&&(0,s.jsx)(c.Z,{message:"Error",description:"Failed to resolve policies. Check the proxy logs.",type:"error",showIcon:!0})]})},ed=a(5945),em=a(5545),eh=a(75948),ex=a(71521),eu=a(2059),ep=a(91994),eg=a(44643);let ey=e=>{let{title:l,description:a,icon:t,iconColor:i,iconBg:r,guardrails:n,inherits:c,complexity:o,onUseTemplate:d}=e;return(0,s.jsxs)(ed.Z,{className:"h-full hover:shadow-md transition-shadow",bodyStyle:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg ".concat(r),children:(0,s.jsx)(t,{className:"h-6 w-6 ".concat(i)})}),(0,s.jsxs)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat((()=>{switch(o){case"Low":return"bg-gray-50 text-gray-600 border-gray-200";case"Medium":return"bg-blue-50 text-blue-600 border-blue-100";case"High":return"bg-purple-50 text-purple-600 border-purple-100"}})()),children:[o," Complexity"]})]}),(0,s.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-2",children:l}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-6 flex-grow",children:a}),c&&(0,s.jsxs)("div",{className:"mb-4 text-xs",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Inherits from: "}),(0,s.jsx)("span",{className:"font-medium text-gray-700 bg-gray-100 px-2 py-0.5 rounded",children:c})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider block mb-2",children:"Included Guardrails"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:n.map(e=>(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200",children:e},e))})]}),(0,s.jsx)(em.ZP,{type:"primary",block:!0,className:"mt-auto",onClick:d,children:"Use Template"})]})},ej={ShieldCheckIcon:eh.Z,ShieldExclamationIcon:ex.Z,BeakerIcon:eu.Z,CurrencyDollarIcon:ep.Z,CheckCircleIcon:eg.Z};var ef=e=>{let{onUseTemplate:l,accessToken:a}=e,[i,n]=(0,t.useState)([]),[c,o]=(0,t.useState)(!1);return((0,t.useEffect)(()=>{(async()=>{if(a){o(!0);try{let e=await (0,G.getPolicyTemplates)(a);n(e)}catch(e){console.error("Error fetching policy templates:",e),r.ZP.error("Failed to fetch policy templates")}finally{o(!1)}}})()},[a]),c)?(0,s.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,s.jsx)(L.Z,{size:"large",tip:"Loading policy templates..."})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex justify-between items-end",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Policy Templates"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Start with a pre-configured policy template to quickly set up guardrails for your organization."})]})}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:i.map((e,a)=>(0,s.jsx)(ey,{title:e.title,description:e.description,icon:ej[e.icon]||eh.Z,iconColor:e.iconColor,iconBg:e.iconBg,guardrails:e.guardrails,inherits:e.inherits,complexity:e.complexity,onUseTemplate:()=>l(e)},e.id||a))})]})},ev=a(61994),eb=a(83669),eN=e=>{let{visible:l,template:a,existingGuardrails:i,onConfirm:r,onCancel:c,isLoading:o=!1}=e,[m,h]=(0,t.useState)(new Set),x=((null==a?void 0:a.guardrailDefinitions)||[]).map(e=>{var l;return{guardrail_name:e.guardrail_name,description:(null===(l=e.guardrail_info)||void 0===l?void 0:l.description)||"No description available",alreadyExists:i.has(e.guardrail_name),definition:e}});(0,t.useEffect)(()=>{l&&a&&h(new Set(x.filter(e=>!e.alreadyExists).map(e=>e.guardrail_name)))},[l,a]);let u=e=>{h(l=>{let a=new Set(l);return a.has(e)?a.delete(e):a.add(e),a})},p=x.filter(e=>!e.alreadyExists).length,g=x.filter(e=>e.alreadyExists).length,y=m.size;return(0,s.jsx)(n.Z,{title:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-1",children:null==a?void 0:a.title}),(0,s.jsx)("p",{className:"text-sm text-gray-500 font-normal",children:"Review and select guardrails to create for this template"})]}),open:l,onCancel:c,width:700,footer:[(0,s.jsx)(em.ZP,{onClick:c,disabled:o,children:"Cancel"},"cancel"),(0,s.jsx)(em.ZP,{type:"primary",onClick:()=>{r(x.filter(e=>m.has(e.guardrail_name)).map(e=>e.definition))},loading:o,disabled:0===y&&0===g,children:y>0?"Create ".concat(y," Guardrail").concat(y>1?"s":""," & Use Template"):"Use Template"},"confirm")],children:(0,s.jsxs)("div",{className:"py-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-4 p-3 bg-blue-50 rounded-lg border border-blue-100",children:[(0,s.jsx)(d.Z,{className:"text-blue-600 text-lg"}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsxs)("span",{className:"font-medium text-gray-900",children:[x.length," total guardrails"]}),(0,s.jsx)("span",{className:"text-gray-600 mx-2",children:"•"}),(0,s.jsxs)("span",{className:"text-green-600 font-medium",children:[p," new"]}),g>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-gray-600 mx-2",children:"•"}),(0,s.jsxs)("span",{className:"text-gray-600",children:[g," already exist"]})]})]})}),p>0&&(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(em.ZP,{size:"small",onClick:()=>{h(new Set(x.filter(e=>!e.alreadyExists).map(e=>e.guardrail_name)))},children:"Select All New"}),(0,s.jsx)(em.ZP,{size:"small",onClick:()=>{h(new Set)},children:"Deselect All"})]})]}),(0,s.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:x.map(e=>{var l,a,t,i,r,n;return(0,s.jsx)("div",{className:"border rounded-lg p-4 ".concat(e.alreadyExists?"bg-gray-50 border-gray-200":"bg-white border-gray-300 hover:border-blue-400"," transition-colors"),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 pt-0.5",children:e.alreadyExists?(0,s.jsx)(eb.Z,{className:"text-green-600 text-lg"}):(0,s.jsx)(ev.Z,{checked:m.has(e.guardrail_name),onChange:()=>u(e.guardrail_name)})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"font-mono text-sm font-medium text-gray-900",children:e.guardrail_name}),e.alreadyExists&&(0,s.jsx)(S.Z,{color:"green",className:"text-xs",children:"Already exists"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,s.jsx)(S.Z,{className:"text-xs",children:(null===(a=e.definition)||void 0===a?void 0:null===(l=a.litellm_params)||void 0===l?void 0:l.guardrail)||"unknown"}),(0,s.jsx)(S.Z,{className:"text-xs",color:"blue",children:(null===(i=e.definition)||void 0===i?void 0:null===(t=i.litellm_params)||void 0===t?void 0:t.mode)||"unknown"}),(null===(n=e.definition)||void 0===n?void 0:null===(r=n.litellm_params)||void 0===r?void 0:r.patterns)&&(0,s.jsxs)(S.Z,{className:"text-xs",color:"purple",children:[e.definition.litellm_params.patterns.length," pattern(s)"]})]})]})]})},e.guardrail_name)})}),0===x.length&&(0,s.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,s.jsx)("p",{children:"No guardrails defined for this template."}),(0,s.jsx)("p",{className:"text-sm mt-2",children:"This template will use existing guardrails in your system."})]}),(0,s.jsx)(z.Z,{}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:y>0?(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:y})," ","guardrail",y>1?"s":""," will be created"]}):g>0?(0,s.jsx)("p",{className:"text-green-600",children:"All guardrails already exist. You can proceed to use this template."}):(0,s.jsx)("p",{className:"text-orange-600",children:'Select at least one guardrail to create, or click "Use Template" to proceed without creating new guardrails.'})})]})})},ew=a(21609),e_=e=>{let{accessToken:l,userRole:a}=e,[h,x]=(0,t.useState)([]),[u,p]=(0,t.useState)([]),[g,y]=(0,t.useState)([]),[j,f]=(0,t.useState)(!1),[v,b]=(0,t.useState)(!1),[N,w]=(0,t.useState)(!1),[_,Z]=(0,t.useState)(!1),[k,S]=(0,t.useState)(null),[C,P]=(0,t.useState)(null),[A,E]=(0,t.useState)(0),[F,L]=(0,t.useState)(!1),[T,z]=(0,t.useState)(null),[D,M]=(0,t.useState)(!1),[V,B]=(0,t.useState)(!1),[O,R]=(0,t.useState)(null),[U,q]=(0,t.useState)(new Set),[H,W]=(0,t.useState)(!1),Y=!!a&&(0,m.tY)(a),$=(0,t.useCallback)(async()=>{if(l){f(!0);try{let e=await (0,G.getPoliciesList)(l);x(e.policies||[])}catch(e){console.error("Error fetching policies:",e),r.ZP.error("Failed to fetch policies")}finally{f(!1)}}},[l]),Q=(0,t.useCallback)(async()=>{if(l){b(!0);try{let e=await (0,G.getPolicyAttachmentsList)(l);p(e.attachments||[])}catch(e){console.error("Error fetching attachments:",e),r.ZP.error("Failed to fetch attachments")}finally{b(!1)}}},[l]),X=(0,t.useCallback)(async()=>{if(l)try{let e=await (0,G.getGuardrailsList)(l);y(e.guardrails||[])}catch(e){console.error("Error fetching guardrails:",e)}},[l]);(0,t.useEffect)(()=>{$(),Q(),X()},[$,Q,X]);let ee=async()=>{if(T&&l){L(!0);try{await (0,G.deletePolicyCall)(l,T.policy_id),r.ZP.success('Policy "'.concat(T.policy_name,'" deleted successfully')),await $()}catch(e){console.error("Error deleting policy:",e),r.ZP.error("Failed to delete policy")}finally{L(!1),M(!1),z(null)}}},ea=async e=>{if(!l){r.ZP.error("Authentication required");return}try{var a;let s=await (0,G.getGuardrailsList)(l),t=new Set((null===(a=s.guardrails)||void 0===a?void 0:a.map(e=>e.guardrail_name))||[]);q(t),R(e),B(!0)}catch(e){console.error("Error fetching guardrails:",e),r.ZP.error("Failed to load guardrails. Please try again.")}},es=async e=>{if(l&&O){W(!0);try{let a=[],s=[];for(let t of e){let e=t.guardrail_name;try{await (0,G.createGuardrailCall)(l,t),a.push(e),console.log("Successfully created guardrail: ".concat(e))}catch(l){console.error('Failed to create guardrail "'.concat(e,'":'),l),s.push(e)}}await X(),B(!1),W(!1),S(O.templateData),w(!0),E(1),a.length>0?r.ZP.success("Created ".concat(a.length," guardrail").concat(a.length>1?"s":"","! Complete the policy form to save.")):r.ZP.success("Template ready! Complete the policy form to save."),s.length>0&&r.ZP.warning("Failed to create ".concat(s.length," guardrail(s): ").concat(s.join(", "),". You may need to create them manually."))}catch(e){W(!1),console.error("Error creating guardrails:",e),r.ZP.error("Failed to create guardrails. Please try again.")}}};return(0,s.jsx)("div",{className:"w-full mx-auto flex-auto overflow-y-auto m-8 p-2",children:(0,s.jsxs)(i.v0,{index:A,onIndexChange:E,children:[(0,s.jsxs)(i.td,{className:"mb-4",children:[(0,s.jsx)(i.OK,{children:"Templates"}),(0,s.jsx)(i.OK,{children:"Policies"}),(0,s.jsx)(i.OK,{children:"Attachments"}),(0,s.jsx)(i.OK,{children:"Policy Simulator"})]}),(0,s.jsxs)(i.nP,{children:[(0,s.jsxs)(i.x4,{children:[(0,s.jsx)(c.Z,{message:"About Policies",description:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-3",children:"Use policies to group guardrails and control which ones run for specific teams, keys, or models."}),(0,s.jsx)("p",{className:"mb-2 font-semibold",children:"Why use policies?"}),(0,s.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,s.jsx)("li",{children:"Enable/disable specific guardrails for teams, keys, or models"}),(0,s.jsx)("li",{children:"Group guardrails into a single policy"}),(0,s.jsx)("li",{children:"Inherit from existing policies and override what you need"})]}),(0,s.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more in the documentation →"})]}),type:"info",icon:(0,s.jsx)(d.Z,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,s.jsx)(ef,{onUseTemplate:ea,accessToken:l})]}),(0,s.jsxs)(i.x4,{children:[(0,s.jsx)(c.Z,{message:"About Policies",description:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-3",children:"Use policies to group guardrails and control which ones run for specific teams, keys, or models."}),(0,s.jsx)("p",{className:"mb-2 font-semibold",children:"Why use policies?"}),(0,s.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,s.jsx)("li",{children:"Enable/disable specific guardrails for teams, keys, or models"}),(0,s.jsx)("li",{children:"Group guardrails into a single policy"}),(0,s.jsx)("li",{children:"Inherit from existing policies and override what you need"})]}),(0,s.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more in the documentation →"})]}),type:"info",icon:(0,s.jsx)(d.Z,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,s.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,s.jsx)(i.zx,{onClick:()=>{C&&P(null),S(null),w(!0)},disabled:!l,children:"+ Add New Policy"})}),C?(0,s.jsx)(K,{policyId:C,onClose:()=>P(null),onEdit:e=>{S(e),w(!0),P(null)},accessToken:l,isAdmin:Y,getPolicy:G.getPolicyInfo}):(0,s.jsx)(I,{policies:h,isLoading:j,onDeleteClick:(e,l)=>{z(h.find(l=>l.policy_id===e)||null),M(!0)},onEditClick:e=>{S(e),w(!0)},onViewClick:e=>P(e),isAdmin:Y}),(0,s.jsx)(J,{visible:N,onClose:()=>{w(!1),S(null)},onSuccess:()=>{$(),S(null)},accessToken:l,editingPolicy:k,existingPolicies:h,availableGuardrails:g,createPolicy:G.createPolicyCall,updatePolicy:G.updatePolicyCall}),(0,s.jsx)(ew.Z,{isOpen:D,title:"Delete Policy",message:"Are you sure you want to delete policy: ".concat(null==T?void 0:T.policy_name,"? This action cannot be undone."),resourceInformationTitle:"Policy Information",resourceInformation:[{label:"Name",value:null==T?void 0:T.policy_name},{label:"ID",value:null==T?void 0:T.policy_id,code:!0},{label:"Description",value:(null==T?void 0:T.description)||"-"},{label:"Inherits From",value:(null==T?void 0:T.inherit)||"-"}],onCancel:()=>{M(!1),z(null)},onOk:ee,confirmLoading:F}),(0,s.jsx)(eN,{visible:V,template:O,existingGuardrails:U,onConfirm:es,onCancel:()=>{B(!1),R(null)},isLoading:H})]}),(0,s.jsxs)(i.x4,{children:[(0,s.jsx)(c.Z,{message:"About Policy Attachments",description:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-3",children:"Policy attachments control where your policies apply. Policies don't do anything until you attach them to specific teams, keys, models, tags, or globally."}),(0,s.jsx)("p",{className:"mb-2 font-semibold",children:"Attachment Scopes:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Global (*)"})," - Applies to all requests"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Teams"})," - Applies only to specific teams"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Keys"})," - Applies only to specific API keys (supports wildcards like dev-*)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Models"})," - Applies only when specific models are used"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Tags"})," - Matches tags from key/team ",(0,s.jsx)("code",{children:"metadata.tags"})," or tags passed dynamically in the request body (",(0,s.jsx)("code",{children:"metadata.tags"}),'). Use this to enforce policies across groups, e.g. "all keys tagged ',(0,s.jsx)("code",{children:"healthcare"}),' get HIPAA guardrails." Supports wildcards (',(0,s.jsx)("code",{children:"prod-*"}),")."]})]}),(0,s.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies#attachments",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more about attachments →"})]}),type:"info",icon:(0,s.jsx)(d.Z,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,s.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,s.jsx)(i.zx,{onClick:()=>Z(!0),disabled:!l||0===h.length,children:"+ Add New Attachment"})}),(0,s.jsx)(el,{attachments:u,isLoading:v,onDeleteClick:e=>{n.Z.confirm({title:"Delete Attachment",icon:(0,s.jsx)(o.Z,{}),content:"Are you sure you want to delete this attachment? This action cannot be undone.",okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:async()=>{if(l)try{await (0,G.deletePolicyAttachmentCall)(l,e),r.ZP.success("Attachment deleted successfully"),Q()}catch(e){console.error("Error deleting attachment:",e),r.ZP.error("Failed to delete attachment")}}})},isAdmin:Y,accessToken:l}),(0,s.jsx)(er,{visible:_,onClose:()=>Z(!1),onSuccess:()=>{Q()},accessToken:l,policies:h,createAttachment:G.createPolicyAttachmentCall})]}),(0,s.jsx)(i.x4,{children:(0,s.jsx)(eo,{accessToken:l})})]})]})})}}}]);