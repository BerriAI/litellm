(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,487304,e=>{"use strict";var t,l,a=e.i(843476),r=e.i(271645),s=e.i(994388),i=e.i(653824),n=e.i(881073),o=e.i(197647),d=e.i(723731),c=e.i(404206),u=e.i(326373),m=e.i(755151),p=e.i(646563),x=e.i(245094),g=e.i(764205),h=e.i(808613),f=e.i(898586),y=e.i(199133),j=e.i(212931),_=e.i(262218),v=e.i(280898),b=e.i(779241),N=((t={}).PresidioPII="Presidio PII",t.Bedrock="Bedrock Guardrail",t.Lakera="Lakera",t);let w={},C=e=>{let t={};return t.PresidioPII="Presidio PII",t.Bedrock="Bedrock Guardrail",t.Lakera="Lakera",Object.entries(e).forEach(([e,l])=>{l&&"object"==typeof l&&"ui_friendly_name"in l&&(t[e.split("_").map((e,t)=>e.charAt(0).toUpperCase()+e.slice(1)).join("")]=l.ui_friendly_name)}),w=t,t},S=()=>Object.keys(w).length>0?w:N,k={PresidioPII:"presidio",Bedrock:"bedrock",Lakera:"lakera_v2",LitellmContentFilter:"litellm_content_filter",ToolPermission:"tool_permission"},T=e=>{Object.entries(e).forEach(([e,t])=>{t&&"object"==typeof t&&"ui_friendly_name"in t&&(k[e.split("_").map((e,t)=>e.charAt(0).toUpperCase()+e.slice(1)).join("")]=e)})},O=e=>!!e&&"Presidio PII"===S()[e],I=e=>!!e&&"LiteLLM Content Filter"===S()[e],P="../ui/assets/logos/",A={"Presidio PII":`${P}presidio.png`,"Bedrock Guardrail":`${P}bedrock.svg`,Lakera:`${P}lakeraai.jpeg`,"Azure Content Safety Prompt Shield":`${P}presidio.png`,"Azure Content Safety Text Moderation":`${P}presidio.png`,"Aporia AI":`${P}aporia.png`,"PANW Prisma AIRS":`${P}palo_alto_networks.jpeg`,"Noma Security":`${P}noma_security.png`,"Javelin Guardrails":`${P}javelin.png`,"Pillar Guardrail":`${P}pillar.jpeg`,"Google Cloud Model Armor":`${P}google.svg`,"Guardrails AI":`${P}guardrails_ai.jpeg`,"Lasso Guardrail":`${P}lasso.png`,"Pangea Guardrail":`${P}pangea.png`,"AIM Guardrail":`${P}aim_security.jpeg`,"OpenAI Moderation":`${P}openai_small.svg`,EnkryptAI:`${P}enkrypt_ai.avif`,"Prompt Security":`${P}prompt_security.png`,"LiteLLM Content Filter":`${P}litellm_logo.jpg`},B=e=>{if(!e)return{logo:"",displayName:"-"};let t=Object.keys(k).find(t=>k[t].toLowerCase()===e.toLowerCase());if(!t)return{logo:"",displayName:e};let l=S()[t];return{logo:A[l]||"",displayName:l||e}};var L=e.i(464571),F=e.i(536916),E=e.i(592968),M=e.i(149192),R=e.i(741585),R=R,z=e.i(724154);e.i(247167);var G=e.i(931067);let $={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"};var D=e.i(9583),K=r.forwardRef(function(e,t){return r.createElement(D.default,(0,G.default)({},e,{ref:t,icon:$}))});let{Text:J}=f.Typography,{Option:q}=y.Select,U=({categories:e,selectedCategories:t,onChange:l})=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)(K,{className:"text-gray-500 mr-1"}),(0,a.jsx)(J,{className:"text-gray-500 font-medium",children:"Filter by category"})]}),(0,a.jsx)(y.Select,{mode:"multiple",placeholder:"Select categories to filter by",style:{width:"100%"},onChange:l,value:t,allowClear:!0,showSearch:!0,optionFilterProp:"children",className:"mb-4",tagRender:e=>(0,a.jsx)(_.Tag,{color:"blue",closable:e.closable,onClose:e.onClose,className:"mr-2 mb-2",children:e.label}),children:e.map(e=>(0,a.jsx)(q,{value:e.category,children:e.category},e.category))})]}),V=({onSelectAll:e,onUnselectAll:t,hasSelectedEntities:l})=>(0,a.jsxs)("div",{className:"bg-gray-50 p-5 rounded-lg mb-6 border border-gray-200 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(J,{strong:!0,className:"text-gray-700 text-base",children:"Quick Actions"}),(0,a.jsx)(E.Tooltip,{title:"Apply action to all PII types at once",children:(0,a.jsx)("div",{className:"ml-2 text-gray-400 cursor-help text-xs",children:"â“˜"})})]}),(0,a.jsx)(L.Button,{color:"danger",variant:"outlined",onClick:t,disabled:!l,icon:(0,a.jsx)(M.CloseOutlined,{}),children:"Unselect All"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(L.Button,{color:"primary",variant:"outlined",onClick:()=>e("MASK"),className:"h-10",block:!0,icon:(0,a.jsx)(R.default,{}),children:"Select All & Mask"}),(0,a.jsx)(L.Button,{color:"danger",variant:"outlined",onClick:()=>e("BLOCK"),className:"h-10 hover:bg-red-100",block:!0,icon:(0,a.jsx)(z.StopOutlined,{}),children:"Select All & Block"})]})]}),H=({entities:e,selectedEntities:t,selectedActions:l,actions:r,onEntitySelect:s,onActionSelect:i,entityToCategoryMap:n})=>(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden shadow-sm",children:[(0,a.jsxs)("div",{className:"bg-gray-50 px-5 py-3 border-b flex",children:[(0,a.jsx)(J,{strong:!0,className:"flex-1 text-gray-700",children:"PII Type"}),(0,a.jsx)(J,{strong:!0,className:"w-32 text-right text-gray-700",children:"Action"})]}),(0,a.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:0===e.length?(0,a.jsx)("div",{className:"py-10 text-center text-gray-500",children:"No PII types match your filter criteria"}):e.map(e=>(0,a.jsxs)("div",{className:`px-5 py-3 flex items-center justify-between hover:bg-gray-50 border-b ${t.includes(e)?"bg-blue-50":""}`,children:[(0,a.jsxs)("div",{className:"flex items-center flex-1",children:[(0,a.jsx)(F.Checkbox,{checked:t.includes(e),onChange:()=>s(e),className:"mr-3"}),(0,a.jsx)(J,{className:t.includes(e)?"font-medium text-gray-900":"text-gray-700",children:e.replace(/_/g," ")}),n.get(e)&&(0,a.jsx)(_.Tag,{className:"ml-2 text-xs",color:"blue",children:n.get(e)})]}),(0,a.jsx)("div",{className:"w-32",children:(0,a.jsx)(y.Select,{value:t.includes(e)&&l[e]||"MASK",onChange:t=>i(e,t),style:{width:120},disabled:!t.includes(e),className:`${!t.includes(e)?"opacity-50":""}`,dropdownMatchSelectWidth:!1,children:r.map(e=>(0,a.jsx)(q,{value:e,children:(0,a.jsxs)("div",{className:"flex items-center",children:[(e=>{switch(e){case"MASK":return(0,a.jsx)(R.default,{style:{marginRight:4}});case"BLOCK":return(0,a.jsx)(z.StopOutlined,{style:{marginRight:4}});default:return null}})(e),e]})},e))})})]},e))})]}),{Title:Y,Text:W}=f.Typography,Q=({entities:e,actions:t,selectedEntities:l,selectedActions:s,onEntitySelect:i,onActionSelect:n,entityCategories:o=[]})=>{let[d,c]=(0,r.useState)([]),u=new Map;o.forEach(e=>{e.entities.forEach(t=>{u.set(t,e.category)})});let m=e.filter(e=>0===d.length||d.includes(u.get(e)||""));return(0,a.jsxs)("div",{className:"pii-configuration",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-5",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(Y,{level:4,className:"!m-0 font-semibold text-gray-800",children:"Configure PII Protection"})}),(0,a.jsxs)(W,{className:"text-gray-500",children:[l.length," items selected"]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)(U,{categories:o,selectedCategories:d,onChange:c}),(0,a.jsx)(V,{onSelectAll:t=>{e.forEach(e=>{l.includes(e)||i(e),n(e,t)})},onUnselectAll:()=>{l.forEach(e=>{i(e)})},hasSelectedEntities:l.length>0})]}),(0,a.jsx)(H,{entities:m,selectedEntities:l,selectedActions:s,actions:t,onEntitySelect:i,onActionSelect:n,entityToCategoryMap:u})]})};var Z=e.i(482725),X=e.i(435451);let ee=({selectedProvider:e,accessToken:t,providerParams:l=null,value:s=null})=>{let[i,n]=(0,r.useState)(!1),[o,d]=(0,r.useState)(l),[c,u]=(0,r.useState)(null);if((0,r.useEffect)(()=>{if(l)return void d(l);let e=async()=>{if(t){n(!0),u(null);try{let e=await (0,g.getGuardrailProviderSpecificParams)(t);console.log("Provider params API response:",e),d(e),C(e),T(e)}catch(e){console.error("Error fetching provider params:",e),u("Failed to load provider parameters")}finally{n(!1)}}};l||e()},[t,l]),!e)return null;if(i)return(0,a.jsx)(Z.Spin,{tip:"Loading provider parameters..."});if(c)return(0,a.jsx)("div",{className:"text-red-500",children:c});let m=k[e]?.toLowerCase(),p=o&&o[m];if(console.log("Provider key:",m),console.log("Provider fields:",p),!p||0===Object.keys(p).length)return(0,a.jsx)("div",{children:"No configuration fields available for this provider."});console.log("Value:",s);let x=new Set(["patterns","blocked_words","blocked_words_file","categories","severity_threshold","pattern_redaction_format","keyword_redaction_tag"]),f=I(e),j=(e,t="",l)=>Object.entries(e).map(([e,r])=>{let i=t?`${t}.${e}`:e,n=l?l[e]:s?.[e];return(console.log("Field value:",n),"ui_friendly_name"===e||"optional_params"===e&&"nested"===r.type&&r.fields||f&&x.has(e))?null:"nested"===r.type&&r.fields?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-2 font-medium",children:e}),(0,a.jsx)("div",{className:"ml-4 border-l-2 border-gray-200 pl-4",children:j(r.fields,i,n)})]},i):(0,a.jsx)(h.Form.Item,{name:i,label:e,tooltip:r.description,rules:r.required?[{required:!0,message:`${e} is required`}]:void 0,children:"select"===r.type&&r.options?(0,a.jsx)(y.Select,{placeholder:r.description,defaultValue:n||r.default_value,children:r.options.map(e=>(0,a.jsx)(y.Select.Option,{value:e,children:e},e))}):"multiselect"===r.type&&r.options?(0,a.jsx)(y.Select,{mode:"multiple",placeholder:r.description,defaultValue:n||r.default_value,children:r.options.map(e=>(0,a.jsx)(y.Select.Option,{value:e,children:e},e))}):"bool"===r.type||"boolean"===r.type?(0,a.jsxs)(y.Select,{placeholder:r.description,defaultValue:void 0!==n?String(n):r.default_value,children:[(0,a.jsx)(y.Select.Option,{value:"true",children:"True"}),(0,a.jsx)(y.Select.Option,{value:"false",children:"False"})]}):"number"===r.type?(0,a.jsx)(X.default,{step:1,width:400,placeholder:r.description,defaultValue:void 0!==n?Number(n):void 0}):e.includes("password")||e.includes("secret")||e.includes("key")?(0,a.jsx)(b.TextInput,{placeholder:r.description,type:"password",defaultValue:n||""}):(0,a.jsx)(b.TextInput,{placeholder:r.description,type:"text",defaultValue:n||""})},i)});return(0,a.jsx)(a.Fragment,{children:j(p)})},{Title:et}=f.Typography,el=({field:e,fieldKey:t,fullFieldKey:l,value:s})=>{let[i,n]=r.default.useState([]),[o,d]=r.default.useState(e.dict_key_options||[]);return r.default.useEffect(()=>{if(s&&"object"==typeof s){let t=Object.keys(s);n(t.map(e=>({key:e,id:`${e}_${Date.now()}_${Math.random()}`}))),d((e.dict_key_options||[]).filter(e=>!t.includes(e)))}},[s,e.dict_key_options]),(0,a.jsxs)("div",{className:"space-y-3",children:[i.map(t=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[(0,a.jsx)("div",{className:"w-24 font-medium text-sm",children:t.key}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(h.Form.Item,{name:Array.isArray(l)?[...l,t.key]:[l,t.key],style:{marginBottom:0},initialValue:s&&"object"==typeof s?s[t.key]:void 0,normalize:"number"===e.dict_value_type?e=>{if(null==e||""===e)return;let t=Number(e);return isNaN(t)?e:t}:void 0,children:"number"===e.dict_value_type?(0,a.jsx)(X.default,{step:1,width:200,placeholder:`Enter ${t.key} value`}):"boolean"===e.dict_value_type?(0,a.jsxs)(y.Select,{placeholder:`Select ${t.key} value`,children:[(0,a.jsx)(y.Select.Option,{value:!0,children:"True"}),(0,a.jsx)(y.Select.Option,{value:!1,children:"False"})]}):(0,a.jsx)(b.TextInput,{placeholder:`Enter ${t.key} value`,type:"text"})})}),(0,a.jsx)("button",{type:"button",className:"text-red-500 hover:text-red-700 text-sm",onClick:()=>{var e,l;return e=t.id,l=t.key,void(n(i.filter(t=>t.id!==e)),d([...o,l].sort()))},children:"Remove"})]},t.id)),o.length>0&&(0,a.jsxs)("div",{className:"flex items-center space-x-3 mt-2",children:[(0,a.jsx)(y.Select,{placeholder:"Select category to configure",style:{width:200},onSelect:e=>e&&void(!e||(n([...i,{key:e,id:`${e}_${Date.now()}`}]),d(o.filter(t=>t!==e)))),value:void 0,children:o.map(e=>(0,a.jsx)(y.Select.Option,{value:e,children:e},e))}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Select a category to add threshold configuration"})]})]})},ea=({optionalParams:e,parentFieldKey:t,values:l})=>e.fields&&0!==Object.keys(e.fields).length?(0,a.jsxs)("div",{className:"guardrail-optional-params",children:[(0,a.jsxs)("div",{className:"mb-8 pb-4 border-b border-gray-100",children:[(0,a.jsx)(et,{level:3,className:"mb-2 font-semibold text-gray-900",children:"Optional Parameters"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:e.description||"Configure additional settings for this guardrail provider"})]}),(0,a.jsx)("div",{className:"space-y-8",children:Object.entries(e.fields).map(([e,r])=>{let s,i;return s=`${t}.${e}`,(console.log("value",i=l?.[e]),"dict"===r.type&&r.dict_key_options)?(0,a.jsxs)("div",{className:"mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200",children:[(0,a.jsx)("div",{className:"mb-4 font-medium text-gray-900 text-base",children:e}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:r.description}),(0,a.jsx)(el,{field:r,fieldKey:e,fullFieldKey:[t,e],value:i})]},s):(0,a.jsx)("div",{className:"mb-8 p-6 bg-white rounded-lg border border-gray-200 shadow-sm",children:(0,a.jsx)(h.Form.Item,{name:[t,e],label:(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900 text-base",children:e}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:r.description})]}),rules:r.required?[{required:!0,message:`${e} is required`}]:void 0,className:"mb-0",initialValue:void 0!==i?i:r.default_value,normalize:"number"===r.type?e=>{if(null==e||""===e)return;let t=Number(e);return isNaN(t)?e:t}:void 0,children:"select"===r.type&&r.options?(0,a.jsx)(y.Select,{placeholder:r.description,children:r.options.map(e=>(0,a.jsx)(y.Select.Option,{value:e,children:e},e))}):"multiselect"===r.type&&r.options?(0,a.jsx)(y.Select,{mode:"multiple",placeholder:r.description,children:r.options.map(e=>(0,a.jsx)(y.Select.Option,{value:e,children:e},e))}):"bool"===r.type||"boolean"===r.type?(0,a.jsxs)(y.Select,{placeholder:r.description,children:[(0,a.jsx)(y.Select.Option,{value:"true",children:"True"}),(0,a.jsx)(y.Select.Option,{value:"false",children:"False"})]}):"number"===r.type?(0,a.jsx)(X.default,{step:1,width:400,placeholder:r.description}):e.includes("password")||e.includes("secret")||e.includes("key")?(0,a.jsx)(b.TextInput,{placeholder:r.description,type:"password"}):(0,a.jsx)(b.TextInput,{placeholder:r.description,type:"text"})})},s)})})]}):null;var er=e.i(727749),es=e.i(770914),ei=e.i(515831),en=e.i(175712),eo=e.i(519756);let{Text:ed}=f.Typography,{Option:ec}=y.Select,eu=({visible:e,prebuiltPatterns:t,categories:l,selectedPatternName:r,patternAction:i,onPatternNameChange:n,onActionChange:o,onAdd:d,onCancel:c})=>(0,a.jsxs)(j.Modal,{title:"Add prebuilt pattern",open:e,onCancel:c,footer:null,width:800,children:[(0,a.jsxs)(es.Space,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(ed,{strong:!0,children:"Pattern type"}),(0,a.jsx)(y.Select,{placeholder:"Choose pattern type",value:r,onChange:n,style:{width:"100%",marginTop:8},showSearch:!0,filterOption:(e,l)=>{let a=t.find(e=>e.name===l?.value);return!!a&&(a.display_name.toLowerCase().includes(e.toLowerCase())||a.name.toLowerCase().includes(e.toLowerCase()))},children:l.map(e=>{let l=t.filter(t=>t.category===e);return 0===l.length?null:(0,a.jsx)(y.Select.OptGroup,{label:e,children:l.map(e=>(0,a.jsx)(ec,{value:e.name,children:e.display_name},e.name))},e)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(ed,{strong:!0,children:"Action"}),(0,a.jsx)(ed,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this pattern is detected"}),(0,a.jsxs)(y.Select,{value:i,onChange:o,style:{width:"100%"},children:[(0,a.jsx)(ec,{value:"BLOCK",children:"Block"}),(0,a.jsx)(ec,{value:"MASK",children:"Mask"})]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,a.jsx)(s.Button,{variant:"secondary",onClick:c,children:"Cancel"}),(0,a.jsx)(s.Button,{onClick:d,children:"Add"})]})]}),{Text:em}=f.Typography,{Option:ep}=y.Select,ex=({visible:e,patternName:t,patternRegex:l,patternAction:r,onNameChange:i,onRegexChange:n,onActionChange:o,onAdd:d,onCancel:c})=>(0,a.jsxs)(j.Modal,{title:"Add custom regex pattern",open:e,onCancel:c,footer:null,width:800,children:[(0,a.jsxs)(es.Space,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(em,{strong:!0,children:"Pattern name"}),(0,a.jsx)(b.TextInput,{placeholder:"e.g., internal_id, employee_code",value:t,onValueChange:i,style:{marginTop:8}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(em,{strong:!0,children:"Regex pattern"}),(0,a.jsx)(b.TextInput,{placeholder:"e.g., ID-[0-9]{6}",value:l,onValueChange:n,style:{marginTop:8}}),(0,a.jsx)(em,{type:"secondary",style:{fontSize:12},children:"Enter a valid regular expression to match sensitive data"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(em,{strong:!0,children:"Action"}),(0,a.jsx)(em,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this pattern is detected"}),(0,a.jsxs)(y.Select,{value:r,onChange:o,style:{width:"100%"},children:[(0,a.jsx)(ep,{value:"BLOCK",children:"Block"}),(0,a.jsx)(ep,{value:"MASK",children:"Mask"})]})]})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,a.jsx)(s.Button,{variant:"secondary",onClick:c,children:"Cancel"}),(0,a.jsx)(s.Button,{onClick:d,children:"Add"})]})]});var eg=e.i(78085);let{Text:eh}=f.Typography,{Option:ef}=y.Select,ey=({visible:e,keyword:t,action:l,description:r,onKeywordChange:i,onActionChange:n,onDescriptionChange:o,onAdd:d,onCancel:c})=>(0,a.jsxs)(j.Modal,{title:"Add blocked keyword",open:e,onCancel:c,footer:null,width:800,children:[(0,a.jsxs)(es.Space,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eh,{strong:!0,children:"Keyword"}),(0,a.jsx)(b.TextInput,{placeholder:"Enter sensitive keyword or phrase",value:t,onValueChange:i,style:{marginTop:8}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eh,{strong:!0,children:"Action"}),(0,a.jsx)(eh,{type:"secondary",style:{display:"block",marginTop:4,marginBottom:8},children:"Choose what action the guardrail should take when this keyword is detected"}),(0,a.jsxs)(y.Select,{value:l,onChange:n,style:{width:"100%"},children:[(0,a.jsx)(ef,{value:"BLOCK",children:"Block"}),(0,a.jsx)(ef,{value:"MASK",children:"Mask"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eh,{strong:!0,children:"Description (optional)"}),(0,a.jsx)(eg.Textarea,{placeholder:"Explain why this keyword is sensitive",value:r,onValueChange:o,rows:3,style:{marginTop:8}})]})]}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginTop:"24px"},children:[(0,a.jsx)(s.Button,{variant:"secondary",onClick:c,children:"Cancel"}),(0,a.jsx)(s.Button,{onClick:d,children:"Add"})]})]});var ej=e.i(291542),e_=e.i(955135);let{Text:ev}=f.Typography,{Option:eb}=y.Select,eN=({patterns:e,onActionChange:t,onRemove:l})=>{let r=[{title:"Type",dataIndex:"type",key:"type",width:100,render:e=>(0,a.jsx)(_.Tag,{color:"prebuilt"===e?"blue":"green",children:"prebuilt"===e?"Prebuilt":"Custom"})},{title:"Pattern name",dataIndex:"name",key:"name",render:(e,t)=>t.display_name||t.name},{title:"Regex pattern",dataIndex:"pattern",key:"pattern",render:e=>e?(0,a.jsxs)(ev,{code:!0,style:{fontSize:12},children:[e.substring(0,40),"..."]}):"-"},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,l)=>(0,a.jsxs)(y.Select,{value:e,onChange:e=>t(l.id,e),style:{width:120},size:"small",children:[(0,a.jsx)(eb,{value:"BLOCK",children:"Block"}),(0,a.jsx)(eb,{value:"MASK",children:"Mask"})]})},{title:"",key:"actions",width:100,render:(e,t)=>(0,a.jsx)(s.Button,{type:"button",variant:"light",color:"red",size:"xs",icon:e_.DeleteOutlined,onClick:()=>l(t.id),children:"Delete"})}];return 0===e.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"No patterns added."}):(0,a.jsx)(ej.Table,{dataSource:e,columns:r,rowKey:"id",pagination:!1,size:"small"})},{Text:ew}=f.Typography,{Option:eC}=y.Select,eS=({keywords:e,onActionChange:t,onRemove:l})=>{let r=[{title:"Keyword",dataIndex:"keyword",key:"keyword"},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,l)=>(0,a.jsxs)(y.Select,{value:e,onChange:e=>t(l.id,"action",e),style:{width:120},size:"small",children:[(0,a.jsx)(eC,{value:"BLOCK",children:"Block"}),(0,a.jsx)(eC,{value:"MASK",children:"Mask"})]})},{title:"Description",dataIndex:"description",key:"description",render:e=>e||"-"},{title:"",key:"actions",width:100,render:(e,t)=>(0,a.jsx)(s.Button,{type:"button",variant:"light",color:"red",size:"xs",icon:e_.DeleteOutlined,onClick:()=>l(t.id),children:"Delete"})}];return 0===e.length?(0,a.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:"No keywords added."}):(0,a.jsx)(ej.Table,{dataSource:e,columns:r,rowKey:"id",pagination:!1,size:"small"})};var ek=e.i(362024),eT=e.i(993914);let{Title:eO,Text:eI}=f.Typography,{Option:eP}=y.Select,{Panel:eA}=ek.Collapse,eB=({availableCategories:e,selectedCategories:t,onCategoryAdd:l,onCategoryRemove:i,onCategoryUpdate:n,accessToken:o})=>{let[d,c]=r.default.useState(""),[u,m]=r.default.useState({}),[x,h]=r.default.useState({}),[f,j]=r.default.useState([]),[v,b]=r.default.useState(""),[N,w]=r.default.useState(!1),C=async e=>{if(o&&!u[e]){h(t=>({...t,[e]:!0}));try{let t=await (0,g.getCategoryYaml)(o,e);m(l=>({...l,[e]:t.yaml_content}))}catch(t){console.error(`Failed to fetch YAML for category ${e}:`,t)}finally{h(t=>({...t,[e]:!1}))}}};r.default.useEffect(()=>{if(d&&o){let e=u[d];if(e)return void b(e);w(!0),console.log(`Fetching YAML for category: ${d}`,{accessToken:o?"present":"missing"}),(0,g.getCategoryYaml)(o,d).then(e=>{console.log(`Successfully fetched YAML for ${d}:`,e),b(e.yaml_content),m(t=>({...t,[d]:e.yaml_content}))}).catch(e=>{console.error(`Failed to fetch preview YAML for category ${d}:`,e),b("")}).finally(()=>{w(!1)})}else b(""),w(!1)},[d,o]);let S=[{title:"Category",dataIndex:"display_name",key:"display_name",render:(t,l)=>{let r=e.find(e=>e.name===l.category);return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:500},children:t}),r?.description&&(0,a.jsx)("div",{style:{fontSize:"12px",color:"#888",marginTop:"4px"},children:r.description})]})}},{title:"Action",dataIndex:"action",key:"action",width:150,render:(e,t)=>(0,a.jsxs)(y.Select,{value:e,onChange:e=>n(t.id,"action",e),style:{width:"100%"},children:[(0,a.jsx)(eP,{value:"BLOCK",children:(0,a.jsx)(_.Tag,{color:"red",children:"BLOCK"})}),(0,a.jsx)(eP,{value:"MASK",children:(0,a.jsx)(_.Tag,{color:"orange",children:"MASK"})})]})},{title:"Severity Threshold",dataIndex:"severity_threshold",key:"severity_threshold",width:180,render:(e,t)=>(0,a.jsxs)(y.Select,{value:e,onChange:e=>n(t.id,"severity_threshold",e),style:{width:"100%"},children:[(0,a.jsx)(eP,{value:"low",children:"Low"}),(0,a.jsx)(eP,{value:"medium",children:"Medium"}),(0,a.jsx)(eP,{value:"high",children:"High"})]})},{title:"",key:"actions",width:80,render:(e,t)=>(0,a.jsx)(s.Button,{icon:e_.DeleteOutlined,onClick:()=>i(t.id),variant:"secondary",size:"xs",children:"Remove"})}],k=e.filter(e=>!t.some(t=>t.category===e.name));return(0,a.jsxs)(en.Card,{title:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)(eO,{level:5,style:{margin:0},children:"Content Categories"}),(0,a.jsx)(eI,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Detect harmful content, bias, and inappropriate advice using semantic analysis"})]}),size:"small",children:[(0,a.jsxs)("div",{style:{marginBottom:16,display:"flex",gap:8},children:[(0,a.jsx)(y.Select,{placeholder:"Select a content category",value:d||void 0,onChange:c,style:{flex:1},showSearch:!0,optionLabelProp:"label",filterOption:(e,t)=>(t?.label?.toString().toLowerCase()??"").includes(e.toLowerCase()),children:k.map(e=>(0,a.jsx)(eP,{value:e.name,label:e.display_name,children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:500},children:e.display_name}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"#666",marginTop:"2px"},children:e.description})]})},e.name))}),(0,a.jsx)(s.Button,{onClick:()=>{if(!d)return;let a=e.find(e=>e.name===d);!a||t.some(e=>e.category===d)||(l({id:`category-${Date.now()}`,category:a.name,display_name:a.display_name,action:a.default_action,severity_threshold:"medium"}),c(""),b(""))},disabled:!d,icon:p.PlusOutlined,children:"Add"})]}),d&&(0,a.jsxs)("div",{style:{marginBottom:16,padding:"12px",background:"#f9f9f9",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,a.jsxs)("div",{style:{marginBottom:8,fontWeight:500,fontSize:"14px"},children:["Preview: ",e.find(e=>e.name===d)?.display_name]}),N?(0,a.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#888"},children:"Loading YAML..."}):v?(0,a.jsx)("pre",{style:{background:"#fff",padding:"12px",borderRadius:"4px",overflow:"auto",maxHeight:"300px",fontSize:"12px",lineHeight:"1.5",margin:0,border:"1px solid #e0e0e0"},children:(0,a.jsx)("code",{children:v})}):(0,a.jsx)("div",{style:{padding:"8px",textAlign:"center",color:"#888",fontSize:"12px"},children:"Unable to load YAML content"})]}),t.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ej.Table,{dataSource:t,columns:S,pagination:!1,size:"small",rowKey:"id"}),(0,a.jsx)("div",{style:{marginTop:16},children:(0,a.jsx)(ek.Collapse,{activeKey:f,onChange:e=>{let t=Array.isArray(e)?e:e?[e]:[],l=new Set(f);t.forEach(e=>{l.has(e)||u[e]||C(e)}),j(t)},ghost:!0,children:t.map(e=>(0,a.jsx)(eA,{header:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)(eT.FileTextOutlined,{}),(0,a.jsxs)("span",{children:["View YAML for ",e.display_name]})]}),children:x[e.category]?(0,a.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#888"},children:"Loading YAML..."}):u[e.category]?(0,a.jsx)("pre",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"4px",overflow:"auto",maxHeight:"400px",fontSize:"12px",lineHeight:"1.5",margin:0},children:(0,a.jsx)("code",{children:u[e.category]})}):(0,a.jsx)("div",{style:{padding:"16px",textAlign:"center",color:"#888"},children:"YAML will load when expanded"})},e.category))})})]}):(0,a.jsx)("div",{style:{textAlign:"center",padding:"24px",color:"#888",border:"1px dashed #d9d9d9",borderRadius:"4px"},children:"No content categories selected. Add categories to detect harmful content, bias, or inappropriate advice."})]})},{Title:eL,Text:eF}=f.Typography,eE=({prebuiltPatterns:e,categories:t,selectedPatterns:l,blockedWords:i,onPatternAdd:n,onPatternRemove:o,onPatternActionChange:d,onBlockedWordAdd:c,onBlockedWordRemove:u,onBlockedWordUpdate:m,onFileUpload:x,accessToken:h,showStep:f,contentCategories:y=[],selectedContentCategories:j=[],onContentCategoryAdd:_,onContentCategoryRemove:v,onContentCategoryUpdate:b})=>{let[N,w]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),[k,T]=(0,r.useState)(!1),[O,I]=(0,r.useState)(""),[P,A]=(0,r.useState)("BLOCK"),[B,L]=(0,r.useState)(""),[F,E]=(0,r.useState)(""),[M,R]=(0,r.useState)("BLOCK"),[z,G]=(0,r.useState)(""),[$,D]=(0,r.useState)("BLOCK"),[K,J]=(0,r.useState)(""),[q,U]=(0,r.useState)(!1),V=async e=>{U(!0);try{let t=await e.text();if(h){let e=await (0,g.validateBlockedWordsFile)(h,t);if(e.valid)x&&x(t),er.default.success(e.message||"File uploaded successfully");else{let t=e.error||e.errors&&e.errors.join(", ")||"Invalid file";er.default.error(`Validation failed: ${t}`)}}}catch(e){er.default.error(`Failed to upload file: ${e}`)}finally{U(!1)}return!1};return(0,a.jsxs)("div",{className:"space-y-6",children:[!f&&(0,a.jsx)("div",{children:(0,a.jsx)(eF,{type:"secondary",children:"Configure patterns, keywords, and content categories to detect and filter sensitive information in requests and responses."})}),(!f||"patterns"===f)&&(0,a.jsxs)(en.Card,{title:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)(eL,{level:5,style:{margin:0},children:"Pattern Detection"}),(0,a.jsx)(eF,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Detect sensitive information using regex patterns (SSN, credit cards, API keys, etc.)"})]}),size:"small",children:[(0,a.jsx)("div",{style:{marginBottom:16},children:(0,a.jsxs)(es.Space,{children:[(0,a.jsx)(s.Button,{type:"button",onClick:()=>w(!0),icon:p.PlusOutlined,children:"Add prebuilt pattern"}),(0,a.jsx)(s.Button,{type:"button",onClick:()=>T(!0),variant:"secondary",icon:p.PlusOutlined,children:"Add custom regex"})]})}),(0,a.jsx)(eN,{patterns:l,onActionChange:d,onRemove:o})]}),(!f||"keywords"===f)&&(0,a.jsxs)(en.Card,{title:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)(eL,{level:5,style:{margin:0},children:"Blocked Keywords"}),(0,a.jsx)(eF,{type:"secondary",style:{fontSize:14,fontWeight:400},children:"Block or mask specific sensitive terms and phrases"})]}),size:"small",children:[(0,a.jsx)("div",{style:{marginBottom:16},children:(0,a.jsxs)(es.Space,{children:[(0,a.jsx)(s.Button,{type:"button",onClick:()=>S(!0),icon:p.PlusOutlined,children:"Add keyword"}),(0,a.jsx)(ei.Upload,{beforeUpload:V,accept:".yaml,.yml",showUploadList:!1,children:(0,a.jsx)(s.Button,{type:"button",variant:"secondary",icon:eo.UploadOutlined,loading:q,children:"Upload YAML file"})})]})}),(0,a.jsx)(eS,{keywords:i,onActionChange:m,onRemove:u})]}),(!f||"categories"===f)&&y.length>0&&_&&v&&b&&(0,a.jsx)(eB,{availableCategories:y,selectedCategories:j,onCategoryAdd:_,onCategoryRemove:v,onCategoryUpdate:b,accessToken:h}),(0,a.jsx)(eu,{visible:N,prebuiltPatterns:e,categories:t,selectedPatternName:O,patternAction:P,onPatternNameChange:I,onActionChange:e=>A(e),onAdd:()=>{if(!O)return void er.default.error("Please select a pattern");let t=e.find(e=>e.name===O);n({id:`pattern-${Date.now()}`,type:"prebuilt",name:O,display_name:t?.display_name,action:P}),w(!1),I(""),A("BLOCK")},onCancel:()=>{w(!1),I(""),A("BLOCK")}}),(0,a.jsx)(ex,{visible:k,patternName:B,patternRegex:F,patternAction:M,onNameChange:L,onRegexChange:E,onActionChange:e=>R(e),onAdd:()=>{B&&F?(n({id:`custom-${Date.now()}`,type:"custom",name:B,pattern:F,action:M}),T(!1),L(""),E(""),R("BLOCK")):er.default.error("Please provide pattern name and regex")},onCancel:()=>{T(!1),L(""),E(""),R("BLOCK")}}),(0,a.jsx)(ey,{visible:C,keyword:z,action:$,description:K,onKeywordChange:G,onActionChange:e=>D(e),onDescriptionChange:J,onAdd:()=>{z?(c({id:`word-${Date.now()}`,keyword:z,action:$,description:K||void 0}),S(!1),G(""),J(""),D("BLOCK")):er.default.error("Please enter a keyword")},onCancel:()=>{S(!1),G(""),J(""),D("BLOCK")}})]})};var eM=e.i(304967),eR=e.i(599724),ez=e.i(312361),eG=e.i(21548),e$=e.i(311451),eD=e.i(827252);let eK={rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""},eJ=({value:e,onChange:t,disabled:l=!1})=>{let r={...eK,...e||{},rules:e?.rules?[...e.rules]:[]},s=e=>{let l={...r,...e};t?.(l)},i=(e,t)=>{s({rules:r.rules.map((l,a)=>a===e?{...l,...t}:l)})},n=(e,t)=>{let l=r.rules[e];if(!l)return;let a=Object.entries(l.allowed_param_patterns||{});t(a);let s={};a.forEach(([e,t])=>{s[e]=t}),i(e,{allowed_param_patterns:Object.keys(s).length>0?s:void 0})};return(0,a.jsxs)(eM.Card,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"text-lg font-semibold",children:"LiteLLM Tool Permission Guardrail"}),(0,a.jsx)(eR.Text,{className:"text-sm text-gray-500",children:"Provide regex patterns (e.g., ^mcp__github_.*$) for tool names or types and optionally constrain payload fields."})]}),!l&&(0,a.jsx)(L.Button,{icon:(0,a.jsx)(p.PlusOutlined,{}),type:"primary",onClick:()=>{s({rules:[...r.rules,{id:`rule_${Math.random().toString(36).slice(2,8)}`,decision:"allow",allowed_param_patterns:void 0}]})},className:"!bg-blue-600 !text-white hover:!bg-blue-500",children:"Add Rule"})]}),(0,a.jsx)(ez.Divider,{}),0===r.rules.length?(0,a.jsx)(eG.Empty,{description:"No tool rules added yet"}):(0,a.jsx)("div",{className:"space-y-4",children:r.rules.map((e,t)=>{let o;return(0,a.jsxs)(eM.Card,{className:"bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)(eR.Text,{className:"font-semibold",children:["Rule ",t+1]}),(0,a.jsx)(L.Button,{icon:(0,a.jsx)(e_.DeleteOutlined,{}),danger:!0,type:"text",disabled:l,onClick:()=>{s({rules:r.rules.filter((e,l)=>l!==t)})},children:"Remove"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"text-sm font-medium",children:"Rule ID"}),(0,a.jsx)(e$.Input,{disabled:l,placeholder:"unique_rule_id",value:e.id,onChange:e=>i(t,{id:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"text-sm font-medium",children:"Tool Name (optional)"}),(0,a.jsx)(e$.Input,{disabled:l,placeholder:"^mcp__github_.*$",value:e.tool_name??"",onChange:e=>i(t,{tool_name:""===e.target.value.trim()?void 0:e.target.value})})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 mt-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"text-sm font-medium",children:"Tool Type (optional)"}),(0,a.jsx)(e$.Input,{disabled:l,placeholder:"^function$",value:e.tool_type??"",onChange:e=>i(t,{tool_type:""===e.target.value.trim()?void 0:e.target.value})})]})}),(0,a.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,a.jsx)(eR.Text,{className:"text-sm font-medium",children:"Decision"}),(0,a.jsxs)(y.Select,{disabled:l,value:e.decision,style:{width:200},onChange:e=>i(t,{decision:e}),children:[(0,a.jsx)(y.Select.Option,{value:"allow",children:"Allow"}),(0,a.jsx)(y.Select.Option,{value:"deny",children:"Deny"})]})]}),(0,a.jsx)("div",{className:"mt-4",children:0===(o=Object.entries(e.allowed_param_patterns||{})).length?(0,a.jsx)(L.Button,{disabled:l,size:"small",onClick:()=>i(t,{allowed_param_patterns:{"":""}}),children:"+ Restrict tool arguments (optional)"}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eR.Text,{className:"text-sm text-gray-600",children:"Argument constraints (dot or array paths)"}),o.map(([r,s],i)=>(0,a.jsxs)(es.Space,{align:"start",children:[(0,a.jsx)(e$.Input,{disabled:l,placeholder:"messages[0].content",value:r,onChange:e=>{var l;return l=e.target.value,void n(t,e=>{if(!e[i])return;let[,t]=e[i];e[i]=[l,t]})}}),(0,a.jsx)(e$.Input,{disabled:l,placeholder:"^email@.*$",value:s,onChange:e=>{var l;return l=e.target.value,void n(t,e=>{if(!e[i])return;let[t]=e[i];e[i]=[t,l]})}}),(0,a.jsx)(L.Button,{disabled:l,icon:(0,a.jsx)(e_.DeleteOutlined,{}),danger:!0,onClick:()=>n(t,e=>{e.splice(i,1)})})]},`${e.id||t}-${i}`)),(0,a.jsx)(L.Button,{disabled:l,size:"small",onClick:()=>i(t,{allowed_param_patterns:{...e.allowed_param_patterns||{},"":""}}),children:"+ Add another constraint"})]})})]},e.id||t)})}),(0,a.jsx)(ez.Divider,{}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"text-sm font-medium",children:"Default action"}),(0,a.jsxs)(y.Select,{disabled:l,value:r.default_action,onChange:e=>s({default_action:e}),children:[(0,a.jsx)(y.Select.Option,{value:"allow",children:"Allow"}),(0,a.jsx)(y.Select.Option,{value:"deny",children:"Deny"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)(eR.Text,{className:"text-sm font-medium flex items-center gap-1",children:["On disallowed action",(0,a.jsx)(E.Tooltip,{title:"Block returns an error when a forbidden tool is invoked. Rewrite strips the tool call but lets the rest of the response continue.",children:(0,a.jsx)(eD.InfoCircleOutlined,{})})]}),(0,a.jsxs)(y.Select,{disabled:l,value:r.on_disallowed_action,onChange:e=>s({on_disallowed_action:e}),children:[(0,a.jsx)(y.Select.Option,{value:"block",children:"Block"}),(0,a.jsx)(y.Select.Option,{value:"rewrite",children:"Rewrite"})]})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)(eR.Text,{className:"text-sm font-medium",children:"Violation message (optional)"}),(0,a.jsx)(e$.Input.TextArea,{disabled:l,rows:3,placeholder:"This violates our org policy...",value:r.violation_message_template,onChange:e=>s({violation_message_template:e.target.value})})]})]})},{Title:eq,Text:eU,Link:eV}=f.Typography,{Option:eH}=y.Select,{Step:eY}=v.Steps,eW={pre_call:"Before LLM Call - Runs before the LLM call and checks the input (Recommended)",during_call:"During LLM Call - Runs in parallel with the LLM call, with response held until check completes",post_call:"After LLM Call - Runs after the LLM call and checks only the output",logging_only:"Logging Only - Only runs on logging callbacks without affecting the LLM call",pre_mcp_call:"Before MCP Tool Call - Runs before MCP tool execution and validates tool calls",during_mcp_call:"During MCP Tool Call - Runs in parallel with MCP tool execution for monitoring"},eQ=({visible:e,onClose:t,accessToken:l,onSuccess:i})=>{let n,[o]=h.Form.useForm(),[d,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null),[p,x]=(0,r.useState)(null),[f,N]=(0,r.useState)([]),[w,P]=(0,r.useState)({}),[B,L]=(0,r.useState)(0),[F,E]=(0,r.useState)(null),[M,R]=(0,r.useState)([]),[z,G]=(0,r.useState)(2),[$,D]=(0,r.useState)({}),[K,J]=(0,r.useState)([]),[q,U]=(0,r.useState)([]),[V,H]=(0,r.useState)([]),[Y,W]=(0,r.useState)({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""}),Z=(0,r.useMemo)(()=>!!u&&"tool_permission"===(k[u]||"").toLowerCase(),[u]);(0,r.useEffect)(()=>{l&&(async()=>{try{let[e,t]=await Promise.all([(0,g.getGuardrailUISettings)(l),(0,g.getGuardrailProviderSpecificParams)(l)]);x(e),E(t),C(t),T(t)}catch(e){console.error("Error fetching guardrail data:",e),er.default.fromBackend("Failed to load guardrail configuration")}})()},[l]);let X=e=>{m(e),o.setFieldsValue({config:void 0,presidio_analyzer_api_base:void 0,presidio_anonymizer_api_base:void 0}),N([]),P({}),R([]),G(2),D({}),W({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""})},et=e=>{N(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},el=(e,t)=>{P(l=>({...l,[e]:t}))},es=async()=>{try{if(0===B&&(await o.validateFields(["guardrail_name","provider","mode","default_on"]),u)){let e=["guardrail_name","provider","mode","default_on"];"PresidioPII"===u&&e.push("presidio_analyzer_api_base","presidio_anonymizer_api_base"),await o.validateFields(e)}if(1===B&&O(u)&&0===f.length)return void er.default.fromBackend("Please select at least one PII entity to continue");L(B+1)}catch(e){console.error("Form validation failed:",e)}},ei=()=>{o.resetFields(),m(null),N([]),P({}),R([]),G(2),D({}),J([]),U([]),H([]),W({rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""}),L(0)},en=()=>{ei(),t()},eo=async()=>{try{c(!0),await o.validateFields();let e=o.getFieldsValue(!0),a=k[e.provider],r={guardrail_name:e.guardrail_name,litellm_params:{guardrail:a,mode:e.mode,default_on:e.default_on},guardrail_info:{}};if("PresidioPII"===e.provider&&f.length>0){let t={};f.forEach(e=>{t[e]=w[e]||"MASK"}),r.litellm_params.pii_entities_config=t,e.presidio_analyzer_api_base&&(r.litellm_params.presidio_analyzer_api_base=e.presidio_analyzer_api_base),e.presidio_anonymizer_api_base&&(r.litellm_params.presidio_anonymizer_api_base=e.presidio_anonymizer_api_base)}if(I(e.provider))K.length>0&&(r.litellm_params.patterns=K.map(e=>({pattern_type:"prebuilt"===e.type?"prebuilt":"regex",pattern_name:"prebuilt"===e.type?e.name:void 0,pattern:"custom"===e.type?e.pattern:void 0,name:e.name,action:e.action}))),q.length>0&&(r.litellm_params.blocked_words=q.map(e=>({keyword:e.keyword,action:e.action,description:e.description}))),V.length>0&&(r.litellm_params.categories=V.map(e=>({category:e.category,enabled:!0,action:e.action,severity_threshold:e.severity_threshold||"medium"})));else if(e.config)try{r.guardrail_info=JSON.parse(e.config)}catch(e){er.default.fromBackend("Invalid JSON in configuration"),c(!1);return}if("tool_permission"===a){if(0===Y.rules.length){er.default.fromBackend("Add at least one tool permission rule"),c(!1);return}r.litellm_params.rules=Y.rules,r.litellm_params.default_action=Y.default_action,r.litellm_params.on_disallowed_action=Y.on_disallowed_action,Y.violation_message_template&&(r.litellm_params.violation_message_template=Y.violation_message_template)}if(console.log("values: ",JSON.stringify(e)),F&&u){let t=k[u]?.toLowerCase();console.log("providerKey: ",t);let l=F[t]||{},a=new Set;console.log("providerSpecificParams: ",JSON.stringify(l)),Object.keys(l).forEach(e=>{"optional_params"!==e&&a.add(e)}),l.optional_params&&l.optional_params.fields&&Object.keys(l.optional_params.fields).forEach(e=>{a.add(e)}),console.log("allowedParams: ",a),a.forEach(t=>{let l=e[t];(null==l||""===l)&&(l=e.optional_params?.[t]),null!=l&&""!==l&&(r.litellm_params[t]=l)})}if(!l)throw Error("No access token available");console.log("Sending guardrail data:",JSON.stringify(r)),await (0,g.createGuardrailCall)(l,r),er.default.success("Guardrail created successfully"),ei(),i(),t()}catch(e){console.error("Failed to create guardrail:",e),er.default.fromBackend("Failed to create guardrail: "+(e instanceof Error?e.message:String(e)))}finally{c(!1)}},ed=e=>{if(!p||!I(u))return null;let t=p.content_filter_settings;return t?(0,a.jsx)(eE,{prebuiltPatterns:t.prebuilt_patterns||[],categories:t.pattern_categories||[],selectedPatterns:K,blockedWords:q,onPatternAdd:e=>J([...K,e]),onPatternRemove:e=>J(K.filter(t=>t.id!==e)),onPatternActionChange:(e,t)=>{J(K.map(l=>l.id===e?{...l,action:t}:l))},onBlockedWordAdd:e=>U([...q,e]),onBlockedWordRemove:e=>U(q.filter(t=>t.id!==e)),onBlockedWordUpdate:(e,t,l)=>{U(q.map(a=>a.id===e?{...a,[t]:l}:a))},contentCategories:t.content_categories||[],selectedContentCategories:V,onContentCategoryAdd:e=>H([...V,e]),onContentCategoryRemove:e=>H(V.filter(t=>t.id!==e)),onContentCategoryUpdate:(e,t,l)=>{H(V.map(a=>a.id===e?{...a,[t]:l}:a))},accessToken:l,showStep:e}):null};return(0,a.jsx)(j.Modal,{title:"Add Guardrail",open:e,onCancel:en,footer:null,width:800,children:(0,a.jsxs)(h.Form,{form:o,layout:"vertical",initialValues:{mode:"pre_call",default_on:!1},children:[(0,a.jsxs)(v.Steps,{current:B,className:"mb-6",style:{overflow:"visible"},children:[(0,a.jsx)(eY,{title:"Basic Info"}),(0,a.jsx)(eY,{title:O(u)?"PII Configuration":I(u)?"Default Categories":"Provider Configuration"}),I(u)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eY,{title:"Patterns"}),(0,a.jsx)(eY,{title:"Keywords"})]})]}),(()=>{switch(B){case 0:return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Form.Item,{name:"guardrail_name",label:"Guardrail Name",rules:[{required:!0,message:"Please enter a guardrail name"}],children:(0,a.jsx)(b.TextInput,{placeholder:"Enter a name for this guardrail"})}),(0,a.jsx)(h.Form.Item,{name:"provider",label:"Guardrail Provider",rules:[{required:!0,message:"Please select a provider"}],children:(0,a.jsx)(y.Select,{placeholder:"Select a guardrail provider",onChange:X,labelInValue:!1,optionLabelProp:"label",dropdownRender:e=>e,showSearch:!0,children:Object.entries(S()).map(([e,t])=>(0,a.jsx)(eH,{value:e,label:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[A[t]&&(0,a.jsx)("img",{src:A[t],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,a.jsx)("span",{children:t})]}),children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[A[t]&&(0,a.jsx)("img",{src:A[t],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,a.jsx)("span",{children:t})]})},e))})}),(0,a.jsx)(h.Form.Item,{name:"mode",label:"Mode",tooltip:"How the guardrail should be applied",rules:[{required:!0,message:"Please select a mode"}],children:(0,a.jsx)(y.Select,{optionLabelProp:"label",mode:"multiple",children:p?.supported_modes?.map(e=>(0,a.jsx)(eH,{value:e,label:e,children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:e}),"pre_call"===e&&(0,a.jsx)(_.Tag,{color:"green",style:{marginLeft:"8px"},children:"Recommended"})]}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eW[e]})]})},e))||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eH,{value:"pre_call",label:"pre_call",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"pre_call"})," ",(0,a.jsx)(_.Tag,{color:"green",children:"Recommended"})]}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eW.pre_call})]})}),(0,a.jsx)(eH,{value:"during_call",label:"during_call",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:(0,a.jsx)("strong",{children:"during_call"})}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eW.during_call})]})}),(0,a.jsx)(eH,{value:"post_call",label:"post_call",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:(0,a.jsx)("strong",{children:"post_call"})}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eW.post_call})]})}),(0,a.jsx)(eH,{value:"logging_only",label:"logging_only",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:(0,a.jsx)("strong",{children:"logging_only"})}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:eW.logging_only})]})})]})})}),(0,a.jsx)(h.Form.Item,{name:"default_on",label:"Always On",tooltip:"If enabled, this guardrail will be applied to all requests by default.",children:(0,a.jsxs)(y.Select,{children:[(0,a.jsx)(y.Select.Option,{value:!0,children:"Yes"}),(0,a.jsx)(y.Select.Option,{value:!1,children:"No"})]})}),!Z&&!I(u)&&(0,a.jsx)(ee,{selectedProvider:u,accessToken:l,providerParams:F})]});case 1:if(O(u))return p&&"PresidioPII"===u?(0,a.jsx)(Q,{entities:p.supported_entities,actions:p.supported_actions,selectedEntities:f,selectedActions:w,onEntitySelect:et,onActionSelect:el,entityCategories:p.pii_entity_categories}):null;if(I(u))return ed("categories");if(!u)return null;if(Z)return(0,a.jsx)(eJ,{value:Y,onChange:W});if(!F)return null;console.log("guardrail_provider_map: ",k),console.log("selectedProvider: ",u);let e=k[u]?.toLowerCase(),t=F&&F[e];return t&&t.optional_params?(0,a.jsx)(ea,{optionalParams:t.optional_params,parentFieldKey:"optional_params"}):null;case 2:if(I(u))return ed("patterns");return null;case 3:if(I(u))return ed("keywords");return null;default:return null}})(),(n=B===(I(u)?4:2)-1,(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[B>0&&(0,a.jsx)(s.Button,{variant:"secondary",onClick:()=>{L(B-1)},children:"Previous"}),!n&&(0,a.jsx)(s.Button,{onClick:es,children:"Next"}),n&&(0,a.jsx)(s.Button,{onClick:eo,loading:d,children:"Create Guardrail"}),(0,a.jsx)(s.Button,{variant:"secondary",onClick:en,children:"Cancel"})]}))]})})};var eZ=e.i(269200),eX=e.i(942232),e0=e.i(977572),e1=e.i(427612),e2=e.i(64848),e4=e.i(496020),e5=e.i(752978),e8=e.i(68155),e6=e.i(94629),e3=e.i(360820),e7=e.i(871943),e9=e.i(389083),te=e.i(152990),tt=e.i(682830),tl=e.i(790848);let{Title:ta,Text:tr}=f.Typography,{Option:ts}=y.Select,ti=({visible:e,onClose:t,accessToken:l,onSuccess:i,guardrailId:n,initialValues:o})=>{let[d]=h.Form.useForm(),[c,u]=(0,r.useState)(!1),[m,p]=(0,r.useState)(o?.provider||null),[x,f]=(0,r.useState)(null),[_,v]=(0,r.useState)([]),[N,w]=(0,r.useState)({});(0,r.useEffect)(()=>{(async()=>{try{if(!l)return;let e=await (0,g.getGuardrailUISettings)(l);f(e)}catch(e){console.error("Error fetching guardrail settings:",e),er.default.fromBackend("Failed to load guardrail settings")}})()},[l]),(0,r.useEffect)(()=>{o?.pii_entities_config&&Object.keys(o.pii_entities_config).length>0&&(v(Object.keys(o.pii_entities_config)),w(o.pii_entities_config))},[o]);let C=e=>{v(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},T=(e,t)=>{w(l=>({...l,[e]:t}))},O=async()=>{try{u(!0);let e=await d.validateFields(),a=k[e.provider],r={guardrail_id:n,guardrail:{guardrail_name:e.guardrail_name,litellm_params:{guardrail:a,mode:e.mode,default_on:e.default_on},guardrail_info:{}}};if("PresidioPII"===e.provider&&_.length>0){let e={};_.forEach(t=>{e[t]=N[t]||"MASK"}),r.guardrail.litellm_params.pii_entities_config=e}else if(e.config)try{let t=JSON.parse(e.config);"Bedrock"===e.provider&&t?(t.guardrail_id&&(r.guardrail.litellm_params.guardrailIdentifier=t.guardrail_id),t.guardrail_version&&(r.guardrail.litellm_params.guardrailVersion=t.guardrail_version)):r.guardrail.guardrail_info=t}catch(e){er.default.fromBackend("Invalid JSON in configuration"),u(!1);return}if(!l)throw Error("No access token available");console.log("Sending guardrail update data:",JSON.stringify(r));let s=`/guardrails/${n}`,o=await fetch(s,{method:"PUT",headers:{[(0,g.getGlobalLitellmHeaderName)()]:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok){let e=await o.text();throw Error(e||"Failed to update guardrail")}er.default.success("Guardrail updated successfully"),i(),t()}catch(e){console.error("Failed to update guardrail:",e),er.default.fromBackend("Failed to update guardrail: "+(e instanceof Error?e.message:String(e)))}finally{u(!1)}};return(0,a.jsx)(j.Modal,{title:"Edit Guardrail",open:e,onCancel:t,footer:null,width:700,children:(0,a.jsxs)(h.Form,{form:d,layout:"vertical",initialValues:o,children:[(0,a.jsx)(h.Form.Item,{name:"guardrail_name",label:"Guardrail Name",rules:[{required:!0,message:"Please enter a guardrail name"}],children:(0,a.jsx)(b.TextInput,{placeholder:"Enter a name for this guardrail"})}),(0,a.jsx)(h.Form.Item,{name:"provider",label:"Guardrail Provider",rules:[{required:!0,message:"Please select a provider"}],children:(0,a.jsx)(y.Select,{placeholder:"Select a guardrail provider",onChange:e=>{p(e),d.setFieldsValue({config:void 0}),v([]),w({})},disabled:!0,optionLabelProp:"label",children:Object.entries(S()).map(([e,t])=>(0,a.jsx)(ts,{value:e,label:t,children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[A[t]&&(0,a.jsx)("img",{src:A[t],alt:"",style:{height:"20px",width:"20px",marginRight:"8px",objectFit:"contain"},onError:e=>{e.currentTarget.style.display="none"}}),(0,a.jsx)("span",{children:t})]})},e))})}),(0,a.jsx)(h.Form.Item,{name:"mode",label:"Mode",tooltip:"How the guardrail should be applied",rules:[{required:!0,message:"Please select a mode"}],children:(0,a.jsx)(y.Select,{children:x?.supported_modes?.map(e=>(0,a.jsx)(ts,{value:e,children:e},e))||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ts,{value:"pre_call",children:"pre_call"}),(0,a.jsx)(ts,{value:"post_call",children:"post_call"})]})})}),(0,a.jsx)(h.Form.Item,{name:"default_on",label:"Always On",tooltip:"If enabled, this guardrail will be applied to all requests by default",valuePropName:"checked",children:(0,a.jsx)(tl.Switch,{})}),(()=>{if(!m)return null;if("PresidioPII"===m)return x&&m&&"PresidioPII"===m?(0,a.jsx)(Q,{entities:x.supported_entities,actions:x.supported_actions,selectedEntities:_,selectedActions:N,onEntitySelect:C,onActionSelect:T,entityCategories:x.pii_entity_categories}):null;switch(m){case"Aporia":return(0,a.jsx)(h.Form.Item,{label:"Aporia Configuration",name:"config",tooltip:"JSON configuration for Aporia",children:(0,a.jsx)(e$.Input.TextArea,{rows:4,placeholder:`{
  "api_key": "your_aporia_api_key",
  "project_name": "your_project_name"
}`})});case"AimSecurity":return(0,a.jsx)(h.Form.Item,{label:"Aim Security Configuration",name:"config",tooltip:"JSON configuration for Aim Security",children:(0,a.jsx)(e$.Input.TextArea,{rows:4,placeholder:`{
  "api_key": "your_aim_api_key"
}`})});case"Bedrock":return(0,a.jsx)(h.Form.Item,{label:"Amazon Bedrock Configuration",name:"config",tooltip:"JSON configuration for Amazon Bedrock guardrails",children:(0,a.jsx)(e$.Input.TextArea,{rows:4,placeholder:`{
  "guardrail_id": "your_guardrail_id",
  "guardrail_version": "your_guardrail_version"
}`})});case"GuardrailsAI":return(0,a.jsx)(h.Form.Item,{label:"Guardrails.ai Configuration",name:"config",tooltip:"JSON configuration for Guardrails.ai",children:(0,a.jsx)(e$.Input.TextArea,{rows:4,placeholder:`{
  "api_key": "your_guardrails_api_key",
  "guardrail_id": "your_guardrail_id"
}`})});case"LakeraAI":return(0,a.jsx)(h.Form.Item,{label:"Lakera AI Configuration",name:"config",tooltip:"JSON configuration for Lakera AI",children:(0,a.jsx)(e$.Input.TextArea,{rows:4,placeholder:`{
  "api_key": "your_lakera_api_key"
}`})});case"PromptInjection":return(0,a.jsx)(h.Form.Item,{label:"Prompt Injection Configuration",name:"config",tooltip:"JSON configuration for prompt injection detection",children:(0,a.jsx)(e$.Input.TextArea,{rows:4,placeholder:`{
  "threshold": 0.8
}`})});default:return(0,a.jsx)(h.Form.Item,{label:"Custom Configuration",name:"config",tooltip:"JSON configuration for your custom guardrail",children:(0,a.jsx)(e$.Input.TextArea,{rows:4,placeholder:`{
  "key1": "value1",
  "key2": "value2"
}`})})}})(),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,a.jsx)(s.Button,{variant:"secondary",onClick:t,children:"Cancel"}),(0,a.jsx)(s.Button,{onClick:O,loading:c,children:"Update Guardrail"})]})]})})};var tn=((l={}).DB="db",l.CONFIG="config",l);let to=({guardrailsList:e,isLoading:t,onDeleteClick:l,accessToken:i,onGuardrailUpdated:n,isAdmin:o=!1,onGuardrailClick:d})=>{let[c,u]=(0,r.useState)([{id:"created_at",desc:!0}]),[m,p]=(0,r.useState)(!1),[x,g]=(0,r.useState)(null),h=e=>e?new Date(e).toLocaleString():"-",f=[{header:"Guardrail ID",accessorKey:"guardrail_id",cell:e=>(0,a.jsx)(E.Tooltip,{title:String(e.getValue()||""),children:(0,a.jsx)(s.Button,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>e.getValue()&&d(e.getValue()),children:e.getValue()?`${String(e.getValue()).slice(0,7)}...`:""})})},{header:"Name",accessorKey:"guardrail_name",cell:({row:e})=>{let t=e.original;return(0,a.jsx)(E.Tooltip,{title:t.guardrail_name,children:(0,a.jsx)("span",{className:"text-xs font-medium",children:t.guardrail_name||"-"})})}},{header:"Provider",accessorKey:"litellm_params.guardrail",cell:({row:e})=>{let{logo:t,displayName:l}=B(e.original.litellm_params.guardrail);return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[t&&(0,a.jsx)("img",{src:t,alt:`${l} logo`,className:"w-4 h-4",onError:e=>{e.target.style.display="none"}}),(0,a.jsx)("span",{className:"text-xs",children:l})]})}},{header:"Mode",accessorKey:"litellm_params.mode",cell:({row:e})=>{let t=e.original;return(0,a.jsx)("span",{className:"text-xs",children:t.litellm_params.mode})}},{header:"Default On",accessorKey:"litellm_params.default_on",cell:({row:e})=>{let t=e.original;return(0,a.jsx)(e9.Badge,{color:t.litellm_params?.default_on?"green":"gray",className:"text-xs font-normal",size:"xs",children:t.litellm_params?.default_on?"Default On":"Default Off"})}},{header:"Created At",accessorKey:"created_at",cell:({row:e})=>{let t=e.original;return(0,a.jsx)(E.Tooltip,{title:t.created_at,children:(0,a.jsx)("span",{className:"text-xs",children:h(t.created_at)})})}},{header:"Updated At",accessorKey:"updated_at",cell:({row:e})=>{let t=e.original;return(0,a.jsx)(E.Tooltip,{title:t.updated_at,children:(0,a.jsx)("span",{className:"text-xs",children:h(t.updated_at)})})}},{id:"actions",header:"Actions",cell:({row:e})=>{let t=e.original,r=t.guardrail_definition_location===tn.CONFIG;return(0,a.jsx)("div",{className:"flex space-x-2",children:r?(0,a.jsx)(E.Tooltip,{title:"Config guardrail cannot be deleted on the dashboard. Please delete it from the config file.",children:(0,a.jsx)(e5.Icon,{"data-testid":"config-delete-icon",icon:e8.TrashIcon,size:"sm",className:"cursor-not-allowed text-gray-400",title:"Config guardrail cannot be deleted on the dashboard. Please delete it from the config file.","aria-label":"Delete guardrail (config)"})}):(0,a.jsx)(E.Tooltip,{title:"Delete guardrail",children:(0,a.jsx)(e5.Icon,{icon:e8.TrashIcon,size:"sm",onClick:()=>t.guardrail_id&&l(t.guardrail_id,t.guardrail_name||"Unnamed Guardrail"),className:"cursor-pointer hover:text-red-500"})})})}}],y=(0,te.useReactTable)({data:e,columns:f,state:{sorting:c},onSortingChange:u,getCoreRowModel:(0,tt.getCoreRowModel)(),getSortedRowModel:(0,tt.getSortedRowModel)(),enableSorting:!0});return(0,a.jsxs)("div",{className:"rounded-lg custom-border relative",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(eZ.Table,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,a.jsx)(e1.TableHead,{children:y.getHeaderGroups().map(e=>(0,a.jsx)(e4.TableRow,{children:e.headers.map(e=>(0,a.jsx)(e2.TableHeaderCell,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,te.flexRender)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,a.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,a.jsx)(e3.ChevronUpIcon,{className:"h-4 w-4 text-blue-500"}),desc:(0,a.jsx)(e7.ChevronDownIcon,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,a.jsx)(e6.SwitchVerticalIcon,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,a.jsx)(eX.TableBody,{children:t?(0,a.jsx)(e4.TableRow,{children:(0,a.jsx)(e0.TableCell,{colSpan:f.length,className:"h-8 text-center",children:(0,a.jsx)("div",{className:"text-center text-gray-500",children:(0,a.jsx)("p",{children:"Loading..."})})})}):e.length>0?y.getRowModel().rows.map(e=>(0,a.jsx)(e4.TableRow,{className:"h-8",children:e.getVisibleCells().map(e=>(0,a.jsx)(e0.TableCell,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,children:(0,te.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,a.jsx)(e4.TableRow,{children:(0,a.jsx)(e0.TableCell,{colSpan:f.length,className:"h-8 text-center",children:(0,a.jsx)("div",{className:"text-center text-gray-500",children:(0,a.jsx)("p",{children:"No guardrails found"})})})})})]})}),x&&(0,a.jsx)(ti,{visible:m,onClose:()=>p(!1),accessToken:i,onSuccess:()=>{p(!1),g(null),n()},guardrailId:x.guardrail_id||"",initialValues:{guardrail_name:x.guardrail_name||"",provider:Object.keys(k).find(e=>k[e]===x?.litellm_params.guardrail)||"",mode:x.litellm_params.mode,default_on:x.litellm_params.default_on,pii_entities_config:x.litellm_params.pii_entities_config,...x.guardrail_info}})]})};var td=e.i(708347),tc=e.i(629569),tu=e.i(350967),R=R;let tm=({patterns:e,blockedWords:t,readOnly:l=!0,onPatternActionChange:r,onPatternRemove:s,onBlockedWordUpdate:i,onBlockedWordRemove:n})=>{if(0===e.length&&0===t.length)return null;let o=()=>{};return(0,a.jsxs)(a.Fragment,{children:[e.length>0&&(0,a.jsxs)(eM.Card,{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)(eR.Text,{className:"text-lg font-semibold",children:"Pattern Detection"}),(0,a.jsxs)(e9.Badge,{color:"blue",children:[e.length," patterns configured"]})]}),(0,a.jsx)(eN,{patterns:e,onActionChange:l?o:r||o,onRemove:l?o:s||o})]}),t.length>0&&(0,a.jsxs)(eM.Card,{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)(eR.Text,{className:"text-lg font-semibold",children:"Blocked Keywords"}),(0,a.jsxs)(e9.Badge,{color:"blue",children:[t.length," keywords configured"]})]}),(0,a.jsx)(eS,{keywords:t,onActionChange:l?o:i||o,onRemove:l?o:n||o})]})]})},tp=({guardrailData:e,guardrailSettings:t,isEditing:l,accessToken:s,onDataChange:i,onUnsavedChanges:n})=>{let[o,d]=(0,r.useState)([]),[c,u]=(0,r.useState)([]),[m,p]=(0,r.useState)([]),[x,g]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(e?.litellm_params?.patterns){let t=e.litellm_params.patterns.map((e,t)=>({id:`pattern-${t}`,type:"prebuilt"===e.pattern_type?"prebuilt":"custom",name:e.pattern_name||e.name,display_name:e.display_name,pattern:e.pattern,action:e.action||"BLOCK"}));d(t),p(t)}else d([]),p([]);if(e?.litellm_params?.blocked_words){let t=e.litellm_params.blocked_words.map((e,t)=>({id:`word-${t}`,keyword:e.keyword,action:e.action||"BLOCK",description:e.description}));u(t),g(t)}else u([]),g([])},[e]),(0,r.useEffect)(()=>{i&&i(o,c)},[o,c,i]);let h=r.default.useMemo(()=>{let e=JSON.stringify(o)!==JSON.stringify(m),t=JSON.stringify(c)!==JSON.stringify(x);return e||t},[o,c,m,x]);return((0,r.useEffect)(()=>{l&&n&&n(h)},[h,l,n]),e?.litellm_params?.guardrail!=="litellm_content_filter")?null:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ez.Divider,{orientation:"left",children:"Content Filter Configuration"}),h&&(0,a.jsx)("div",{className:"mb-4 px-4 py-3 bg-yellow-50 border border-yellow-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-yellow-800 font-medium",children:'âš ï¸ You have unsaved changes to patterns or keywords. Remember to click "Save Changes" at the bottom.'})}),(0,a.jsx)("div",{className:"mb-6",children:t&&t.content_filter_settings&&(0,a.jsx)(eE,{prebuiltPatterns:t.content_filter_settings.prebuilt_patterns||[],categories:t.content_filter_settings.pattern_categories||[],selectedPatterns:o,blockedWords:c,onPatternAdd:e=>d([...o,e]),onPatternRemove:e=>d(o.filter(t=>t.id!==e)),onPatternActionChange:(e,t)=>d(o.map(l=>l.id===e?{...l,action:t}:l)),onBlockedWordAdd:e=>u([...c,e]),onBlockedWordRemove:e=>u(c.filter(t=>t.id!==e)),onBlockedWordUpdate:(e,t,l)=>u(c.map(a=>a.id===e?{...a,[t]:l}:a)),onFileUpload:e=>{console.log("File uploaded:",e)},accessToken:s})})]}):(0,a.jsx)(tm,{patterns:o,blockedWords:c,readOnly:!0})};var tx=e.i(788191),tg=e.i(245704);let th={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"};var tf=r.forwardRef(function(e,t){return r.createElement(D.default,(0,G.default)({},e,{ref:t,icon:th}))});let ty={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};var tj=r.forwardRef(function(e,t){return r.createElement(D.default,(0,G.default)({},e,{ref:t,icon:ty}))}),t_=e.i(987432);let{Panel:tv}=ek.Collapse,{TextArea:tb}=e$.Input,tN={empty:{name:"Empty Template",code:`async def apply_guardrail(inputs, request_data, input_type):
    # inputs: {texts, images, tools, tool_calls, structured_messages, model}
    # request_data: {model, user_id, team_id, end_user_id, metadata}
    # input_type: "request" or "response"
    return allow()`},blockSSN:{name:"Block SSN",code:`def apply_guardrail(inputs, request_data, input_type):
    for text in inputs["texts"]:
        if regex_match(text, r"\\d{3}-\\d{2}-\\d{4}"):
            return block("SSN detected")
    return allow()`},redactEmail:{name:"Redact Emails",code:`def apply_guardrail(inputs, request_data, input_type):
    pattern = r"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}"
    modified = []
    for text in inputs["texts"]:
        modified.append(regex_replace(text, pattern, "[EMAIL REDACTED]"))
    return modify(texts=modified)`},blockSQL:{name:"Block SQL Injection",code:`def apply_guardrail(inputs, request_data, input_type):
    if input_type != "request":
        return allow()
    for text in inputs["texts"]:
        if contains_code_language(text, ["sql"]):
            return block("SQL code not allowed")
    return allow()`},validateJSON:{name:"Validate JSON",code:`def apply_guardrail(inputs, request_data, input_type):
    if input_type != "response":
        return allow()
    
    schema = {"type": "object", "required": ["name", "value"]}
    
    for text in inputs["texts"]:
        obj = json_parse(text)
        if obj is None:
            return block("Invalid JSON response")
        if not json_schema_valid(obj, schema):
            return block("Response missing required fields")
    return allow()`},externalAPI:{name:"External API Check (async)",code:`async def apply_guardrail(inputs, request_data, input_type):
    # Call an external moderation API (async for non-blocking)
    for text in inputs["texts"]:
        response = await http_post(
            "https://api.example.com/moderate",
            body={"text": text, "user_id": request_data["user_id"]},
            headers={"Authorization": "Bearer YOUR_API_KEY"},
            timeout=10
        )
        
        if not response["success"]:
            # API call failed, allow by default or block
            return allow()
        
        if response["body"].get("flagged"):
            return block(response["body"].get("reason", "Content flagged"))
    
    return allow()`}},tw={"Return Values":[{name:"allow()",desc:"Let request/response through"},{name:"block(reason)",desc:"Reject with message"},{name:"modify(texts=[], images=[], tool_calls=[])",desc:"Transform content"}],"HTTP Requests (async)":[{name:"await http_request(url, method, headers, body)",desc:"Make async HTTP request"},{name:"await http_get(url, headers)",desc:"Async GET request"},{name:"await http_post(url, body, headers)",desc:"Async POST request"}],"Regex Functions":[{name:"regex_match(text, pattern)",desc:"Returns True if pattern found"},{name:"regex_replace(text, pattern, replacement)",desc:"Replace all matches"},{name:"regex_find_all(text, pattern)",desc:"Return list of matches"}],"JSON Functions":[{name:"json_parse(text)",desc:"Parse JSON string, returns None on error"},{name:"json_stringify(obj)",desc:"Convert to JSON string"},{name:"json_schema_valid(obj, schema)",desc:"Validate against JSON schema"}],"URL Functions":[{name:"extract_urls(text)",desc:"Extract all URLs from text"},{name:"is_valid_url(url)",desc:"Check if URL is valid"},{name:"all_urls_valid(text)",desc:"Check all URLs in text are valid"}],"Code Detection":[{name:"detect_code(text)",desc:"Returns True if code detected"},{name:"detect_code_languages(text)",desc:"Returns list of detected languages"},{name:'contains_code_language(text, ["sql"])',desc:"Check for specific languages"}],"Text Utilities":[{name:"contains(text, substring)",desc:"Check if substring exists"},{name:"contains_any(text, [substr1, substr2])",desc:"Check if any substring exists"},{name:"word_count(text)",desc:"Count words"},{name:"char_count(text)",desc:"Count characters"},{name:"lower(text) / upper(text) / trim(text)",desc:"String transforms"}]},tC=[{value:"pre_call",label:"pre_call (Request)"},{value:"post_call",label:"post_call (Response)"},{value:"during_call",label:"during_call (Parallel)"},{value:"logging_only",label:"logging_only"},{value:"pre_mcp_call",label:"pre_mcp_call (Before MCP Tool Call)"},{value:"post_mcp_call",label:"post_mcp_call (After MCP Tool Call)"},{value:"during_mcp_call",label:"during_mcp_call (During MCP Tool Call)"}],tS=({visible:e,onClose:t,onSuccess:l,accessToken:i,editData:n})=>{let o=!!n,[d,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(["pre_call"]),[p,h]=(0,r.useState)(!1),[f,_]=(0,r.useState)("empty"),[v,N]=(0,r.useState)(tN.empty.code),[w,C]=(0,r.useState)(!1),[S,k]=(0,r.useState)(!1),[T,O]=(0,r.useState)(!1),I={texts:["Hello, my SSN is 123-45-6789"],images:[],tools:[{type:"function",function:{name:"get_weather",description:"Get the current weather in a location",parameters:{type:"object",properties:{location:{type:"string",description:"City name"}},required:["location"]}}}],tool_calls:[],structured_messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:"Hello, my SSN is 123-45-6789"}],model:"gpt-4"},P={texts:["The weather in San Francisco is 72Â°F and sunny."],images:[],tools:[],tool_calls:[{id:"call_abc123",type:"function",function:{name:"get_weather",arguments:'{"location": "San Francisco"}'}}],structured_messages:[],model:"gpt-4"},[A,B]=(0,r.useState)(JSON.stringify(I,null,2)),[L,F]=(0,r.useState)(null),[E,M]=(0,r.useState)(null),R=(0,r.useRef)(null),z=e=>null==e?["pre_call"]:Array.isArray(e)?e.length?e:["pre_call"]:[e];(0,r.useEffect)(()=>{e&&(n?(c(n.guardrail_name||""),m(z(n.litellm_params?.mode)),h(n.litellm_params?.default_on||!1),N(n.litellm_params?.custom_code||tN.empty.code),_("")):(c(""),m(["pre_call"]),h(!1),_("empty"),N(tN.empty.code)),F(null),O(!1))},[e,n]);let G=async e=>{try{await navigator.clipboard.writeText(e),M(e),setTimeout(()=>M(null),2e3)}catch(e){console.error("Failed to copy:",e)}},$=async()=>{if(!d.trim())return void er.default.fromBackend("Please enter a guardrail name");if(!v.trim())return void er.default.fromBackend("Please enter custom code");if(!i)return void er.default.fromBackend("No access token available");C(!0);try{if(o&&n){let e={litellm_params:{custom_code:v}};d!==n.guardrail_name&&(e.guardrail_name=d);let t=z(n.litellm_params?.mode);(u.length!==t.length||u.some((e,l)=>e!==t[l]))&&(e.litellm_params.mode=u),p!==n.litellm_params?.default_on&&(e.litellm_params.default_on=p),await (0,g.updateGuardrailCall)(i,n.guardrail_id,e),er.default.success("Custom code guardrail updated successfully")}else await (0,g.createGuardrailCall)(i,{guardrail_name:d,litellm_params:{guardrail:"custom_code",mode:u,default_on:p,custom_code:v},guardrail_info:{}}),er.default.success("Custom code guardrail created successfully");l(),t()}catch(e){console.error("Failed to save guardrail:",e),er.default.fromBackend(`Failed to ${o?"update":"create"} guardrail: `+(e instanceof Error?e.message:String(e)))}finally{C(!1)}},D=async()=>{if(!i)return void F({error:"No access token available"});k(!0),F(null);try{let e;try{e=JSON.parse(A)}catch(e){F({error:"Invalid test input JSON"}),k(!1);return}e.texts||(e.texts=[]);let t=["pre_call","pre_mcp_call"],l=["post_call","post_mcp_call"],a=u.some(e=>t.includes(e))?"request":u.some(e=>l.includes(e))?"response":"request",r=await (0,g.testCustomCodeGuardrail)(i,{custom_code:v,test_input:e,input_type:a,request_data:{model:"test-model",metadata:{}}});r.success&&r.result?F(r.result):r.error?F({error:r.error,error_type:r.error_type}):F({error:"Unknown error occurred"})}catch(e){console.error("Failed to test custom code:",e),F({error:e instanceof Error?e.message:"Failed to test custom code"})}finally{k(!1)}},K=v.split("\n").length;return(0,a.jsxs)(j.Modal,{open:e,onCancel:t,footer:null,width:1400,className:"custom-code-modal",closable:!0,destroyOnClose:!0,children:[(0,a.jsxs)("div",{className:"flex flex-col h-[80vh]",children:[(0,a.jsxs)("div",{className:"pb-4 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:o?"Edit Custom Guardrail":"Create Custom Guardrail"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Define custom logic using Python-like syntax"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 py-4 border-b border-gray-100",children:[(0,a.jsxs)("div",{className:"flex-1 max-w-[200px]",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Guardrail Name"}),(0,a.jsx)(b.TextInput,{value:d,onValueChange:c,placeholder:"e.g., block-pii-custom"})]}),(0,a.jsxs)("div",{className:"w-[280px]",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Mode (can select multiple)"}),(0,a.jsx)(y.Select,{mode:"multiple",value:u,onChange:m,options:tC,className:"w-full",size:"middle",placeholder:"Select modes"})]}),(0,a.jsxs)("div",{className:"w-[180px]",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Template"}),(0,a.jsx)(y.Select,{value:f,onChange:e=>{_(e),N(tN[e].code)},className:"w-full",size:"middle",children:Object.entries(tN).map(([e,t])=>(0,a.jsx)(y.Select.Option,{value:e,children:t.name},e))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-5",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Default On"}),(0,a.jsx)(tl.Switch,{checked:p,onChange:h})]})]}),(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden mt-4 gap-6",children:[(0,a.jsxs)("div",{className:"flex-[2] flex flex-col min-w-0 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2 flex-shrink-0",children:[(0,a.jsx)("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Python Logic"}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Restricted environment (no imports)"})]}),(0,a.jsxs)("div",{className:"relative rounded-lg overflow-hidden border border-gray-700 bg-[#1e1e1e] flex-shrink-0",style:{minHeight:"300px",maxHeight:"400px"},children:[(0,a.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-12 bg-[#1e1e1e] border-r border-gray-700 text-right pr-3 pt-3 select-none overflow-hidden",style:{fontFamily:"'Fira Code', 'Monaco', 'Consolas', monospace",fontSize:"14px",lineHeight:"1.6"},children:Array.from({length:Math.max(K,20)},(e,t)=>(0,a.jsx)("div",{className:"text-gray-500 h-[22.4px]",children:t+1},t+1))}),(0,a.jsx)("textarea",{ref:R,value:v,onChange:e=>N(e.target.value),onKeyDown:e=>{if("Tab"===e.key){e.preventDefault();let t=e.currentTarget,l=t.selectionStart,a=t.selectionEnd;N(v.substring(0,l)+"    "+v.substring(a)),setTimeout(()=>{t.selectionStart=t.selectionEnd=l+4},0)}},spellCheck:!1,className:"w-full h-full pl-14 pr-4 pt-3 pb-3 resize-none focus:outline-none bg-transparent text-gray-200",style:{fontFamily:"'Fira Code', 'Monaco', 'Consolas', monospace",fontSize:"14px",lineHeight:"1.6",tabSize:4}})]}),(0,a.jsx)(ek.Collapse,{activeKey:T?["test"]:[],onChange:e=>O(e.includes("test")),className:"mt-3 bg-white border border-gray-200 rounded-lg flex-shrink-0",expandIcon:({isActive:e})=>(0,a.jsx)(tj,{rotate:90*!!e}),children:(0,a.jsx)(tv,{header:(0,a.jsxs)("span",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,a.jsx)(tx.PlayCircleOutlined,{className:"text-blue-500"}),"Test Your Guardrail"]}),children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-600",children:"Test Input (JSON)"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Load example:"}),(0,a.jsx)("button",{type:"button",onClick:()=>B(JSON.stringify(I,null,2)),className:"px-2 py-1 text-xs rounded border border-orange-200 bg-orange-50 text-orange-700 hover:bg-orange-100 transition-colors",children:"Pre-call"}),(0,a.jsx)("button",{type:"button",onClick:()=>B(JSON.stringify(P,null,2)),className:"px-2 py-1 text-xs rounded border border-green-200 bg-green-50 text-green-700 hover:bg-green-100 transition-colors",children:"Post-call"})]})]}),(0,a.jsx)("div",{className:"mb-2 p-2 bg-gray-50 rounded text-xs text-gray-600 border border-gray-200",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"texts"}),": Message content (always)"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"images"}),": Base64 images (vision)"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"tools"}),": Tool definitions ",(0,a.jsx)("span",{className:"text-orange-600",children:"(pre_call)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"tool_calls"}),": LLM tool calls ",(0,a.jsx)("span",{className:"text-green-600",children:"(post_call)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"structured_messages"}),": Full messages ",(0,a.jsx)("span",{className:"text-orange-600",children:"(pre_call)"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"model"}),": Model name (always)"]})]})}),(0,a.jsx)(tb,{value:A,onChange:e=>B(e.target.value),rows:8,className:"font-mono text-xs",placeholder:'{"texts": ["test message"], ...}'})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(s.Button,{size:"xs",onClick:D,disabled:S,icon:tx.PlayCircleOutlined,children:S?"Running...":"Run Test"}),L&&(0,a.jsx)("div",{className:`flex items-center gap-2 text-sm ${L.error?"text-red-600":"allow"===L.action?"text-green-600":"block"===L.action?"text-orange-600":"text-blue-600"}`,children:L.error?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tf,{}),(0,a.jsxs)("span",{children:[L.error_type&&(0,a.jsxs)("span",{className:"font-medium",children:["[",L.error_type,"] "]}),L.error]})]}):"allow"===L.action?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tg.CheckCircleOutlined,{})," Allowed"]}):"block"===L.action?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tf,{})," Blocked: ",L.reason]}):"modify"===L.action?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tg.CheckCircleOutlined,{})," Modified",L.texts&&L.texts.length>0&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-1",children:["â†’ ",L.texts[0].substring(0,50),L.texts[0].length>50?"...":""]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tg.CheckCircleOutlined,{})," ",L.action||"Unknown"]})})]})]})},"test")})]}),(0,a.jsxs)("div",{className:"w-[300px] flex-shrink-0 overflow-auto border-l border-gray-200 pl-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(x.CodeOutlined,{className:"text-blue-500"}),(0,a.jsx)("span",{className:"font-semibold text-gray-700",children:"Available Primitives"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"Click to copy functions to clipboard"}),(0,a.jsx)(ek.Collapse,{defaultActiveKey:["Return Values"],className:"primitives-collapse bg-transparent border-0",expandIconPosition:"end",children:Object.entries(tw).map(([e,t])=>(0,a.jsx)(tv,{header:(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e}),className:"bg-white mb-2 rounded-lg border border-gray-200",children:(0,a.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,a.jsx)("button",{onClick:()=>G(e.name),className:`w-full text-left px-2 py-2 rounded transition-colors ${E===e.name?"bg-green-100":"bg-gray-50 hover:bg-blue-50"}`,children:E===e.name?(0,a.jsxs)("span",{className:"flex items-center gap-1 text-xs font-mono text-green-700",children:[(0,a.jsx)(tg.CheckCircleOutlined,{})," Copied!"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-xs font-mono text-gray-800",children:e.name}),(0,a.jsx)("div",{className:"text-[10px] text-gray-500 mt-0.5",children:e.desc})]})},e.name))})},e))})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-4 mt-4 border-t border-gray-200",children:[(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Changes are auto-saved to local draft"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(s.Button,{variant:"secondary",onClick:t,children:"Cancel"}),(0,a.jsx)(s.Button,{onClick:$,loading:w,disabled:w||!d.trim(),icon:t_.SaveOutlined,children:o?"Update Guardrail":"Save Guardrail"})]})]})]}),(0,a.jsx)("style",{children:`
        .custom-code-modal .ant-modal-content {
          padding: 24px;
        }
        .custom-code-modal .ant-modal-close {
          top: 20px;
          right: 20px;
        }
        .primitives-collapse .ant-collapse-item {
          border: none !important;
        }
        .primitives-collapse .ant-collapse-header {
          padding: 8px 12px !important;
        }
        .primitives-collapse .ant-collapse-content-box {
          padding: 8px 12px !important;
        }
      `})]})};var tk=e.i(530212),tT=e.i(500330),tO=e.i(678784),tI=e.i(118366);let tP=({guardrailId:e,onClose:t,accessToken:l,isAdmin:u})=>{let[m,p]=(0,r.useState)(null),[f,j]=(0,r.useState)(null),[_,v]=(0,r.useState)(!0),[N,w]=(0,r.useState)(!1),[C]=h.Form.useForm(),[S,T]=(0,r.useState)([]),[O,I]=(0,r.useState)({}),[P,A]=(0,r.useState)(null),[F,M]=(0,r.useState)({}),[G,$]=(0,r.useState)(!1),D={rules:[],default_action:"deny",on_disallowed_action:"block",violation_message_template:""},[K,J]=(0,r.useState)(D),[q,U]=(0,r.useState)(!1),[V,H]=(0,r.useState)(!1),Y=r.default.useRef({patterns:[],blockedWords:[]}),W=(0,r.useCallback)((e,t)=>{Y.current={patterns:e,blockedWords:t}},[]),Z=async()=>{try{if(v(!0),!l)return;let t=await (0,g.getGuardrailInfo)(l,e);if(p(t),t.litellm_params?.pii_entities_config){let e=t.litellm_params.pii_entities_config;if(T([]),I({}),Object.keys(e).length>0){let t=[],l={};Object.entries(e).forEach(([e,a])=>{t.push(e),l[e]="string"==typeof a?a:"MASK"}),T(t),I(l)}}else T([]),I({})}catch(e){er.default.fromBackend("Failed to load guardrail information"),console.error("Error fetching guardrail info:",e)}finally{v(!1)}},X=async()=>{try{if(!l)return;let e=await (0,g.getGuardrailProviderSpecificParams)(l);j(e)}catch(e){console.error("Error fetching guardrail provider specific params:",e)}},et=async()=>{try{if(!l)return;let e=await (0,g.getGuardrailUISettings)(l);A(e)}catch(e){console.error("Error fetching guardrail UI settings:",e)}};(0,r.useEffect)(()=>{X()},[l]),(0,r.useEffect)(()=>{Z(),et()},[e,l]),(0,r.useEffect)(()=>{m&&C&&C.setFieldsValue({guardrail_name:m.guardrail_name,...m.litellm_params,guardrail_info:m.guardrail_info?JSON.stringify(m.guardrail_info,null,2):"",...m.litellm_params?.optional_params&&{optional_params:m.litellm_params.optional_params}})},[m,f,C]);let el=(0,r.useCallback)(()=>{m?.litellm_params?.guardrail==="tool_permission"?J({rules:m.litellm_params?.rules||[],default_action:(m.litellm_params?.default_action||"deny").toLowerCase(),on_disallowed_action:(m.litellm_params?.on_disallowed_action||"block").toLowerCase(),violation_message_template:m.litellm_params?.violation_message_template||""}):J(D),U(!1)},[m]);(0,r.useEffect)(()=>{el()},[el]);let es=async t=>{try{if(!l)return;let a={litellm_params:{}};t.guardrail_name!==m.guardrail_name&&(a.guardrail_name=t.guardrail_name),t.default_on!==m.litellm_params?.default_on&&(a.litellm_params.default_on=t.default_on);let r=m.guardrail_info,s=t.guardrail_info?JSON.parse(t.guardrail_info):void 0;JSON.stringify(r)!==JSON.stringify(s)&&(a.guardrail_info=s);let i=m.litellm_params?.pii_entities_config||{},n={};if(S.forEach(e=>{n[e]=O[e]||"MASK"}),JSON.stringify(i)!==JSON.stringify(n)&&(a.litellm_params.pii_entities_config=n),m.litellm_params?.guardrail==="litellm_content_filter"&&G){let e,t;m.litellm_params?.patterns,m.litellm_params?.blocked_words;let l=(e=Y.current.patterns||[],t=Y.current.blockedWords||[],{patterns:e.map(e=>({pattern_type:"prebuilt"===e.type?"prebuilt":"regex",pattern_name:"prebuilt"===e.type?e.name:void 0,pattern:"custom"===e.type?e.pattern:void 0,name:e.name,action:e.action})),blocked_words:t.map(e=>({keyword:e.keyword,action:e.action,description:e.description}))});a.litellm_params.patterns=l.patterns,a.litellm_params.blocked_words=l.blocked_words}if(m.litellm_params?.guardrail==="tool_permission"){let e=m.litellm_params?.rules||[],t=K.rules||[],l=JSON.stringify(e)!==JSON.stringify(t),r=(m.litellm_params?.default_action||"deny").toLowerCase(),s=(K.default_action||"deny").toLowerCase(),i=r!==s,n=(m.litellm_params?.on_disallowed_action||"block").toLowerCase(),o=(K.on_disallowed_action||"block").toLowerCase(),d=n!==o,c=m.litellm_params?.violation_message_template||"",u=K.violation_message_template||"",p=c!==u;(q||l||i||d||p)&&(a.litellm_params.rules=t,a.litellm_params.default_action=s,a.litellm_params.on_disallowed_action=o,a.litellm_params.violation_message_template=u||null)}let o=Object.keys(k).find(e=>k[e]===m.litellm_params?.guardrail);console.log("values: ",JSON.stringify(t)),console.log("currentProvider: ",o);let d=m.litellm_params?.guardrail==="tool_permission";if(f&&o&&!d){let e=f[k[o]?.toLowerCase()]||{},l=new Set;console.log("providerSpecificParams: ",JSON.stringify(e)),Object.keys(e).forEach(e=>{"optional_params"!==e&&l.add(e)}),e.optional_params&&e.optional_params.fields&&Object.keys(e.optional_params.fields).forEach(e=>{l.add(e)}),console.log("allowedParams: ",l),l.forEach(e=>{if("patterns"===e||"blocked_words"===e)return;let l=t[e];(null==l||""===l)&&(l=t.optional_params?.[e]);let r=m.litellm_params?.[e];JSON.stringify(l)!==JSON.stringify(r)&&(null!=l&&""!==l?a.litellm_params[e]=l:null!=r&&""!==r&&(a.litellm_params[e]=null))})}if(0===Object.keys(a.litellm_params).length&&delete a.litellm_params,0===Object.keys(a).length){er.default.info("No changes detected"),w(!1);return}await (0,g.updateGuardrailCall)(l,e,a),er.default.success("Guardrail updated successfully"),$(!1),Z(),w(!1)}catch(e){console.error("Error updating guardrail:",e),er.default.fromBackend("Failed to update guardrail")}};if(_)return(0,a.jsx)("div",{className:"p-4",children:"Loading..."});if(!m)return(0,a.jsx)("div",{className:"p-4",children:"Guardrail not found"});let ei=e=>e?new Date(e).toLocaleString():"-",{logo:en,displayName:eo}=B(m.litellm_params?.guardrail||""),ed=async(e,t)=>{await (0,tT.copyToClipboard)(e)&&(M(e=>({...e,[t]:!0})),setTimeout(()=>{M(e=>({...e,[t]:!1}))},2e3))},ec="config"===m.guardrail_definition_location;return(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(s.Button,{icon:tk.ArrowLeftIcon,variant:"light",onClick:t,className:"mb-4",children:"Back to Guardrails"}),(0,a.jsx)(tc.Title,{children:m.guardrail_name||"Unnamed Guardrail"}),(0,a.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,a.jsx)(eR.Text,{className:"text-gray-500 font-mono",children:m.guardrail_id}),(0,a.jsx)(L.Button,{type:"text",size:"small",icon:F["guardrail-id"]?(0,a.jsx)(tO.CheckIcon,{size:12}):(0,a.jsx)(tI.CopyIcon,{size:12}),onClick:()=>ed(m.guardrail_id,"guardrail-id"),className:`left-2 z-10 transition-all duration-200 ${F["guardrail-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),(0,a.jsxs)(i.TabGroup,{children:[(0,a.jsxs)(n.TabList,{className:"mb-4",children:[(0,a.jsx)(o.Tab,{children:"Overview"},"overview"),u?(0,a.jsx)(o.Tab,{children:"Settings"},"settings"):(0,a.jsx)(a.Fragment,{})]}),(0,a.jsxs)(d.TabPanels,{children:[(0,a.jsxs)(c.TabPanel,{children:[(0,a.jsxs)(tu.Grid,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,a.jsxs)(eM.Card,{children:[(0,a.jsx)(eR.Text,{children:"Provider"}),(0,a.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[en&&(0,a.jsx)("img",{src:en,alt:`${eo} logo`,className:"w-6 h-6",onError:e=>{e.target.style.display="none"}}),(0,a.jsx)(tc.Title,{children:eo})]})]}),(0,a.jsxs)(eM.Card,{children:[(0,a.jsx)(eR.Text,{children:"Mode"}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)(tc.Title,{children:m.litellm_params?.mode||"-"}),(0,a.jsx)(e9.Badge,{color:m.litellm_params?.default_on?"green":"gray",children:m.litellm_params?.default_on?"Default On":"Default Off"})]})]}),(0,a.jsxs)(eM.Card,{children:[(0,a.jsx)(eR.Text,{children:"Created At"}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)(tc.Title,{children:ei(m.created_at)}),(0,a.jsxs)(eR.Text,{children:["Last Updated: ",ei(m.updated_at)]})]})]})]}),m.litellm_params?.pii_entities_config&&Object.keys(m.litellm_params.pii_entities_config).length>0&&(0,a.jsx)(eM.Card,{className:"mt-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(eR.Text,{className:"font-medium",children:"PII Protection"}),(0,a.jsxs)(e9.Badge,{color:"blue",children:[Object.keys(m.litellm_params.pii_entities_config).length," PII entities configured"]})]})}),m.litellm_params?.pii_entities_config&&Object.keys(m.litellm_params.pii_entities_config).length>0&&(0,a.jsxs)(eM.Card,{className:"mt-6",children:[(0,a.jsx)(eR.Text,{className:"mb-4 text-lg font-semibold",children:"PII Entity Configuration"}),(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden shadow-sm",children:[(0,a.jsxs)("div",{className:"bg-gray-50 px-5 py-3 border-b flex",children:[(0,a.jsx)(eR.Text,{className:"flex-1 font-semibold text-gray-700",children:"Entity Type"}),(0,a.jsx)(eR.Text,{className:"flex-1 font-semibold text-gray-700",children:"Configuration"})]}),(0,a.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:Object.entries(m.litellm_params?.pii_entities_config).map(([e,t])=>(0,a.jsxs)("div",{className:"px-5 py-3 flex border-b hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(eR.Text,{className:"flex-1 font-medium text-gray-900",children:e}),(0,a.jsx)(eR.Text,{className:"flex-1",children:(0,a.jsxs)("span",{className:`inline-flex items-center gap-1.5 ${"MASK"===t?"text-blue-600":"text-red-600"}`,children:["MASK"===t?(0,a.jsx)(R.default,{}):(0,a.jsx)(z.StopOutlined,{}),String(t)]})})]},e))})]})]}),m.litellm_params?.guardrail==="tool_permission"&&(0,a.jsx)(eM.Card,{className:"mt-6",children:(0,a.jsx)(eJ,{value:K,disabled:!0})}),m.litellm_params?.guardrail==="custom_code"&&m.litellm_params?.custom_code&&(0,a.jsxs)(eM.Card,{className:"mt-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.CodeOutlined,{className:"text-blue-500"}),(0,a.jsx)(eR.Text,{className:"font-medium text-lg",children:"Custom Code"})]}),u&&!ec&&(0,a.jsx)(s.Button,{size:"xs",variant:"secondary",icon:x.CodeOutlined,onClick:()=>H(!0),children:"Edit Code"})]}),(0,a.jsx)("div",{className:"relative rounded-lg overflow-hidden border border-gray-700 bg-[#1e1e1e]",children:(0,a.jsx)("pre",{className:"p-4 text-sm text-gray-200 overflow-x-auto",style:{fontFamily:"'Fira Code', 'Monaco', 'Consolas', monospace"},children:(0,a.jsx)("code",{children:m.litellm_params.custom_code})})})]}),(0,a.jsx)(tp,{guardrailData:m,guardrailSettings:P,isEditing:!1,accessToken:l})]}),u&&(0,a.jsx)(c.TabPanel,{children:(0,a.jsxs)(eM.Card,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)(tc.Title,{children:"Guardrail Settings"}),ec&&(0,a.jsx)(E.Tooltip,{title:"Guardrail is defined in the config file and cannot be edited.",children:(0,a.jsx)(eD.InfoCircleOutlined,{})}),!N&&!ec&&(m.litellm_params?.guardrail==="custom_code"?(0,a.jsx)(s.Button,{icon:x.CodeOutlined,onClick:()=>H(!0),children:"Edit Code"}):(0,a.jsx)(s.Button,{onClick:()=>w(!0),children:"Edit Settings"}))]}),N?(0,a.jsxs)(h.Form,{form:C,onFinish:es,initialValues:{guardrail_name:m.guardrail_name,...m.litellm_params,guardrail_info:m.guardrail_info?JSON.stringify(m.guardrail_info,null,2):"",...m.litellm_params?.optional_params&&{optional_params:m.litellm_params.optional_params}},layout:"vertical",children:[(0,a.jsx)(h.Form.Item,{label:"Guardrail Name",name:"guardrail_name",rules:[{required:!0,message:"Please input a guardrail name"}],children:(0,a.jsx)(b.TextInput,{})}),(0,a.jsx)(h.Form.Item,{label:"Default On",name:"default_on",children:(0,a.jsxs)(y.Select,{children:[(0,a.jsx)(y.Select.Option,{value:!0,children:"Yes"}),(0,a.jsx)(y.Select.Option,{value:!1,children:"No"})]})}),m.litellm_params?.guardrail==="presidio"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ez.Divider,{orientation:"left",children:"PII Protection"}),(0,a.jsx)("div",{className:"mb-6",children:P&&(0,a.jsx)(Q,{entities:P.supported_entities,actions:P.supported_actions,selectedEntities:S,selectedActions:O,onEntitySelect:e=>{T(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},onActionSelect:(e,t)=>{I(l=>({...l,[e]:t}))},entityCategories:P.pii_entity_categories})})]}),(0,a.jsx)(tp,{guardrailData:m,guardrailSettings:P,isEditing:!0,accessToken:l,onDataChange:W,onUnsavedChanges:$}),(0,a.jsx)(ez.Divider,{orientation:"left",children:"Provider Settings"}),m.litellm_params?.guardrail==="tool_permission"?(0,a.jsx)(eJ,{value:K,onChange:J}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ee,{selectedProvider:Object.keys(k).find(e=>k[e]===m.litellm_params?.guardrail)||null,accessToken:l,providerParams:f,value:m.litellm_params}),f&&(()=>{let e=Object.keys(k).find(e=>k[e]===m.litellm_params?.guardrail);if(!e)return null;let t=f[k[e]?.toLowerCase()];return t&&t.optional_params?(0,a.jsx)(ea,{optionalParams:t.optional_params,parentFieldKey:"optional_params",values:m.litellm_params}):null})()]}),(0,a.jsx)(ez.Divider,{orientation:"left",children:"Advanced Settings"}),(0,a.jsx)(h.Form.Item,{label:"Guardrail Information",name:"guardrail_info",children:(0,a.jsx)(e$.Input.TextArea,{rows:5})}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,a.jsx)(L.Button,{onClick:()=>{w(!1),$(!1),el()},children:"Cancel"}),(0,a.jsx)(s.Button,{children:"Save Changes"})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"font-medium",children:"Guardrail ID"}),(0,a.jsx)("div",{className:"font-mono",children:m.guardrail_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"font-medium",children:"Guardrail Name"}),(0,a.jsx)("div",{children:m.guardrail_name||"Unnamed Guardrail"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"font-medium",children:"Provider"}),(0,a.jsx)("div",{children:eo})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"font-medium",children:"Mode"}),(0,a.jsx)("div",{children:m.litellm_params?.mode||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"font-medium",children:"Default On"}),(0,a.jsx)(e9.Badge,{color:m.litellm_params?.default_on?"green":"gray",children:m.litellm_params?.default_on?"Yes":"No"})]}),m.litellm_params?.pii_entities_config&&Object.keys(m.litellm_params.pii_entities_config).length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"font-medium",children:"PII Protection"}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsxs)(e9.Badge,{color:"blue",children:[Object.keys(m.litellm_params.pii_entities_config).length," PII entities configured"]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"font-medium",children:"Created At"}),(0,a.jsx)("div",{children:ei(m.created_at)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(eR.Text,{className:"font-medium",children:"Last Updated"}),(0,a.jsx)("div",{children:ei(m.updated_at)})]}),m.litellm_params?.guardrail==="tool_permission"&&(0,a.jsx)(eJ,{value:K,disabled:!0})]})]})})]})]}),(0,a.jsx)(tS,{visible:V,onClose:()=>H(!1),onSuccess:()=>{H(!1),Z()},accessToken:l,editData:m?{guardrail_id:m.guardrail_id,guardrail_name:m.guardrail_name,litellm_params:m.litellm_params}:null})]})};var tA=e.i(573421),tB=e.i(19732),tL=e.i(928685),tF=e.i(166406),tE=e.i(637235),tM=e.i(240647);let{Text:tR}=f.Typography,tz=function({results:e,errors:t}){let[l,i]=(0,r.useState)(new Set),n=e=>{let t=new Set(l);t.has(e)?t.delete(e):t.add(e),i(t)},o=async e=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();let l=document.execCommand("copy");if(document.body.removeChild(t),!l)throw Error("execCommand failed");return!0}}catch(e){return console.error("Copy failed:",e),!1}};return e||t?(0,a.jsxs)("div",{className:"space-y-3 pt-4 border-t border-gray-200",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Results"}),e&&e.map(e=>{let t=l.has(e.guardrailName);return(0,a.jsx)(eM.Card,{className:"bg-green-50 border-green-200",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer flex-1",onClick:()=>n(e.guardrailName),children:[t?(0,a.jsx)(tM.RightOutlined,{className:"text-gray-500 text-xs"}):(0,a.jsx)(m.DownOutlined,{className:"text-gray-500 text-xs"}),(0,a.jsx)(tg.CheckCircleOutlined,{className:"text-green-600 text-lg"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-800",children:e.guardrailName})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-600",children:[(0,a.jsx)(tE.ClockCircleOutlined,{}),(0,a.jsxs)("span",{className:"font-medium",children:[e.latency,"ms"]})]}),!t&&(0,a.jsx)(s.Button,{size:"xs",variant:"secondary",icon:tF.CopyOutlined,onClick:async()=>{await o(e.response_text)?er.default.success("Result copied to clipboard"):er.default.fromBackend("Failed to copy result")},children:"Copy"})]})]}),!t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-white border border-green-200 rounded p-3",children:[(0,a.jsx)("label",{className:"text-xs font-medium text-gray-600 mb-2 block",children:"Output Text"}),(0,a.jsx)("div",{className:"font-mono text-sm text-gray-900 whitespace-pre-wrap break-words",children:e.response_text})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"Characters:"})," ",e.response_text.length]})]})]})},e.guardrailName)}),t&&t.map(e=>{let t=l.has(e.guardrailName);return(0,a.jsx)(eM.Card,{className:"bg-red-50 border-red-200",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)("div",{className:"cursor-pointer mt-0.5",onClick:()=>n(e.guardrailName),children:t?(0,a.jsx)(tM.RightOutlined,{className:"text-gray-500 text-xs"}):(0,a.jsx)(m.DownOutlined,{className:"text-gray-500 text-xs"})}),(0,a.jsx)("div",{className:"text-red-600 mt-0.5",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-red-800 cursor-pointer",onClick:()=>n(e.guardrailName),children:[e.guardrailName," - Error"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-600",children:[(0,a.jsx)(tE.ClockCircleOutlined,{}),(0,a.jsxs)("span",{className:"font-medium",children:[e.latency,"ms"]})]})]}),!t&&(0,a.jsx)("p",{className:"text-sm text-red-700 mt-1",children:e.error.message})]})]})},e.guardrailName)})]}):null},{TextArea:tG}=e$.Input,{Text:t$}=f.Typography,tD=function({guardrailNames:e,onSubmit:t,isLoading:l,results:i,errors:n,onClose:o}){let[d,c]=(0,r.useState)(""),u=()=>{d.trim()?t(d):er.default.fromBackend("Please enter text to test")},m=async e=>{try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();let l=document.execCommand("copy");if(document.body.removeChild(t),!l)throw Error("execCommand failed");return!0}}catch(e){return console.error("Copy failed:",e),!1}},p=async()=>{await m(d)?er.default.success("Input copied to clipboard"):er.default.fromBackend("Failed to copy input")};return(0,a.jsxs)("div",{className:"space-y-4 h-full flex flex-col",children:[(0,a.jsx)("div",{className:"flex items-center justify-between pb-3 border-b border-gray-200",children:(0,a.jsx)("div",{className:"flex items-center space-x-3",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Test Guardrails:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,a.jsx)("div",{className:"inline-flex items-center space-x-1 bg-blue-50 px-3 py-1 rounded-md border border-blue-200",children:(0,a.jsx)("span",{className:"font-mono text-blue-700 font-medium text-sm",children:e})},e))})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Test ",e.length>1?"guardrails":"guardrail"," and compare results"]})]})})}),(0,a.jsxs)("div",{className:"flex-1 overflow-auto space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Input Text"}),(0,a.jsx)(E.Tooltip,{title:"Press Enter to submit. Use Shift+Enter for new line.",children:(0,a.jsx)(eD.InfoCircleOutlined,{className:"text-gray-400 cursor-help"})})]}),d&&(0,a.jsx)(s.Button,{size:"xs",variant:"secondary",icon:tF.CopyOutlined,onClick:p,children:"Copy Input"})]}),(0,a.jsx)(tG,{value:d,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||e.ctrlKey||e.metaKey||(e.preventDefault(),u())},placeholder:"Enter text to test with guardrails...",rows:8,className:"font-mono text-sm"}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,a.jsxs)(t$,{className:"text-xs text-gray-500",children:["Press ",(0,a.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs",children:"Enter"})," to submit â€¢ ",(0,a.jsx)("kbd",{className:"px-1 py-0.5 bg-gray-100 border border-gray-300 rounded text-xs",children:"Shift+Enter"})," for new line"]}),(0,a.jsxs)(t$,{className:"text-xs text-gray-500",children:["Characters: ",d.length]})]})]}),(0,a.jsx)("div",{className:"pt-2",children:(0,a.jsx)(s.Button,{onClick:u,loading:l,disabled:!d.trim(),className:"w-full",children:l?`Testing ${e.length} guardrail${e.length>1?"s":""}...`:`Test ${e.length} guardrail${e.length>1?"s":""}`})})]}),(0,a.jsx)(tz,{results:i,errors:n})]})]})},tK=({guardrailsList:e,isLoading:t,accessToken:l,onClose:s})=>{let[i,n]=(0,r.useState)(new Set),[o,d]=(0,r.useState)(""),[c,u]=(0,r.useState)([]),[m,p]=(0,r.useState)([]),[x,h]=(0,r.useState)(!1),f=e.filter(e=>e.guardrail_name?.toLowerCase().includes(o.toLowerCase())),y=e=>{let t=new Set(i);t.has(e)?t.delete(e):t.add(e),n(t)},j=async e=>{if(0===i.size||!l)return;h(!0),u([]),p([]);let t=[],a=[];await Promise.all(Array.from(i).map(async r=>{let s=Date.now();try{let a=await (0,g.applyGuardrail)(l,r,e,null,null),i=Date.now()-s;t.push({guardrailName:r,response_text:a.response_text,latency:i})}catch(t){let e=Date.now()-s;console.error(`Error testing guardrail ${r}:`,t),a.push({guardrailName:r,error:t,latency:e})}})),u(t),p(a),h(!1),t.length>0&&er.default.success(`${t.length} guardrail${t.length>1?"s":""} applied successfully`),a.length>0&&er.default.fromBackend(`${a.length} guardrail${a.length>1?"s":""} failed`)};return(0,a.jsx)("div",{className:"w-full h-[calc(100vh-200px)]",children:(0,a.jsx)(eM.Card,{className:"h-full",children:(0,a.jsxs)("div",{className:"flex h-full",children:[(0,a.jsxs)("div",{className:"w-1/4 border-r border-gray-200 flex flex-col overflow-hidden",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)(tc.Title,{className:"text-lg font-semibold mb-3",children:"Guardrails"}),(0,a.jsx)(b.TextInput,{icon:tL.SearchOutlined,placeholder:"Search guardrails...",value:o,onValueChange:d})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:t?(0,a.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,a.jsx)(Z.Spin,{})}):0===f.length?(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(eG.Empty,{description:o?"No guardrails match your search":"No guardrails available"})}):(0,a.jsx)(tA.List,{dataSource:f,renderItem:e=>(0,a.jsx)(tA.List.Item,{onClick:()=>{e.guardrail_name&&y(e.guardrail_name)},className:`cursor-pointer hover:bg-gray-50 transition-colors px-4 ${i.has(e.guardrail_name||"")?"bg-blue-50 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"}`,children:(0,a.jsx)(tA.List.Item.Meta,{avatar:(0,a.jsx)(F.Checkbox,{checked:i.has(e.guardrail_name||""),onClick:t=>{t.stopPropagation(),e.guardrail_name&&y(e.guardrail_name)}}),title:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(tB.ExperimentOutlined,{className:"text-gray-400"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.guardrail_name})]}),description:(0,a.jsxs)("div",{className:"text-xs space-y-1 mt-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Type: "}),(0,a.jsx)("span",{className:"text-gray-600",children:e.litellm_params.guardrail})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Mode: "}),(0,a.jsx)("span",{className:"text-gray-600",children:e.litellm_params.mode})]})]})})})})}),(0,a.jsx)("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:(0,a.jsxs)(eR.Text,{className:"text-xs text-gray-600",children:[i.size," of ",f.length," selected"]})})]}),(0,a.jsxs)("div",{className:"w-3/4 flex flex-col bg-white",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 flex justify-between items-center",children:(0,a.jsx)(tc.Title,{className:"text-xl font-semibold mb-0",children:"Guardrail Testing Playground"})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-4",children:0===i.size?(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[(0,a.jsx)(tB.ExperimentOutlined,{style:{fontSize:"48px",marginBottom:"16px"}}),(0,a.jsx)(eR.Text,{className:"text-lg font-medium text-gray-600 mb-2",children:"Select Guardrails to Test"}),(0,a.jsx)(eR.Text,{className:"text-center text-gray-500 max-w-md",children:"Choose one or more guardrails from the left sidebar to start testing and comparing results."})]}):(0,a.jsx)("div",{className:"h-full",children:(0,a.jsx)(tD,{guardrailNames:Array.from(i),onSubmit:j,results:c.length>0?c:null,errors:m.length>0?m:null,isLoading:x,onClose:()=>n(new Set)})})})]})]})})})};var tJ=e.i(127952);e.s(["default",0,({accessToken:e,userRole:t})=>{let[l,h]=(0,r.useState)([]),[f,y]=(0,r.useState)(!1),[j,_]=(0,r.useState)(!1),[v,b]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!1),[C,S]=(0,r.useState)(null),[k,T]=(0,r.useState)(!1),[O,I]=(0,r.useState)(null),[P,A]=(0,r.useState)(0),L=!!t&&(0,td.isAdminRole)(t),F=async()=>{if(e){b(!0);try{let t=await (0,g.getGuardrailsList)(e);console.log(`guardrails: ${JSON.stringify(t)}`),h(t.guardrails)}catch(e){console.error("Error fetching guardrails:",e)}finally{b(!1)}}};(0,r.useEffect)(()=>{F()},[e]);let E=()=>{F()},M=async()=>{if(C&&e){w(!0);try{await (0,g.deleteGuardrailCall)(e,C.guardrail_id),er.default.success(`Guardrail "${C.guardrail_name}" deleted successfully`),await F()}catch(e){console.error("Error deleting guardrail:",e),er.default.fromBackend("Failed to delete guardrail")}finally{w(!1),T(!1),S(null)}}},R=C&&C.litellm_params?B(C.litellm_params.guardrail).displayName:void 0;return(0,a.jsx)("div",{className:"w-full mx-auto flex-auto overflow-y-auto m-8 p-2",children:(0,a.jsxs)(i.TabGroup,{index:P,onIndexChange:A,children:[(0,a.jsxs)(n.TabList,{className:"mb-4",children:[(0,a.jsx)(o.Tab,{children:"Guardrails"}),(0,a.jsx)(o.Tab,{disabled:!e||0===l.length,children:"Test Playground"})]}),(0,a.jsxs)(d.TabPanels,{children:[(0,a.jsxs)(c.TabPanel,{children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,a.jsx)(u.Dropdown,{menu:{items:[{key:"provider",icon:(0,a.jsx)(p.PlusOutlined,{}),label:"Add Provider Guardrail",onClick:()=>{O&&I(null),y(!0)}},{key:"custom_code",icon:(0,a.jsx)(x.CodeOutlined,{}),label:"Create Custom Code Guardrail",onClick:()=>{O&&I(null),_(!0)}}]},trigger:["click"],disabled:!e,children:(0,a.jsxs)(s.Button,{disabled:!e,children:["+ Add New Guardrail ",(0,a.jsx)(m.DownOutlined,{className:"ml-2"})]})})}),O?(0,a.jsx)(tP,{guardrailId:O,onClose:()=>I(null),accessToken:e,isAdmin:L}):(0,a.jsx)(to,{guardrailsList:l,isLoading:v,onDeleteClick:(e,t)=>{S(l.find(t=>t.guardrail_id===e)||null),T(!0)},accessToken:e,onGuardrailUpdated:F,isAdmin:L,onGuardrailClick:e=>I(e)}),(0,a.jsx)(eQ,{visible:f,onClose:()=>{y(!1)},accessToken:e,onSuccess:E}),(0,a.jsx)(tS,{visible:j,onClose:()=>{_(!1)},accessToken:e,onSuccess:E}),(0,a.jsx)(tJ.default,{isOpen:k,title:"Delete Guardrail",message:`Are you sure you want to delete guardrail: ${C?.guardrail_name}? This action cannot be undone.`,resourceInformationTitle:"Guardrail Information",resourceInformation:[{label:"Name",value:C?.guardrail_name},{label:"ID",value:C?.guardrail_id,code:!0},{label:"Provider",value:R},{label:"Mode",value:C?.litellm_params.mode},{label:"Default On",value:C?.litellm_params.default_on?"Yes":"No"}],onCancel:()=>{T(!1),S(null)},onOk:M,confirmLoading:N})]}),(0,a.jsx)(c.TabPanel,{children:(0,a.jsx)(tK,{guardrailsList:l,isLoading:v,accessToken:e,onClose:()=>A(0)})})]})]})})}],487304)}]);