(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,760221,e=>{"use strict";var l=e.i(843476),a=e.i(271645),t=e.i(994388),i=e.i(653824),s=e.i(881073),r=e.i(197647),o=e.i(723731),c=e.i(404206),n=e.i(212931),d=e.i(998573),h=e.i(560445),m=e.i(270377),x=e.i(827252),p=e.i(708347),u=e.i(269200),g=e.i(942232),y=e.i(977572),j=e.i(427612),f=e.i(64848),b=e.i(496020),w=e.i(752978),v=e.i(389083),_=e.i(68155),N=e.i(797672),S=e.i(94629),C=e.i(360820),T=e.i(871943),k=e.i(592968),I=e.i(262218),P=e.i(152990),A=e.i(682830);let F=({policies:e,isLoading:i,onDeleteClick:s,onEditClick:r,onViewClick:o,isAdmin:c=!1})=>{let[n,d]=(0,a.useState)([{id:"created_at",desc:!0}]),h=[{header:"Policy ID",accessorKey:"policy_id",cell:e=>(0,l.jsx)(k.Tooltip,{title:String(e.getValue()||""),children:(0,l.jsx)(t.Button,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>e.getValue()&&o(e.getValue()),children:e.getValue()?`${String(e.getValue()).slice(0,7)}...`:""})})},{header:"Name",accessorKey:"policy_name",cell:({row:e})=>{let a=e.original;return(0,l.jsx)(k.Tooltip,{title:a.policy_name,children:(0,l.jsx)("span",{className:"text-xs font-medium",children:a.policy_name||"-"})})}},{header:"Description",accessorKey:"description",cell:({row:e})=>{let a=e.original;return(0,l.jsx)(k.Tooltip,{title:a.description,children:(0,l.jsx)("span",{className:"text-xs truncate max-w-[200px] block",children:a.description||"-"})})}},{header:"Inherits From",accessorKey:"inherit",cell:({row:e})=>{let a=e.original;return a.inherit?(0,l.jsx)(v.Badge,{color:"blue",size:"xs",children:a.inherit}):(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Guardrails (Add)",accessorKey:"guardrails_add",cell:({row:e})=>{let a=e.original.guardrails_add||[];return 0===a.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,a)=>(0,l.jsx)(I.Tag,{color:"green",className:"text-xs",children:e},a)),a.length>2&&(0,l.jsx)(k.Tooltip,{title:a.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Guardrails (Remove)",accessorKey:"guardrails_remove",cell:({row:e})=>{let a=e.original.guardrails_remove||[];return 0===a.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,a)=>(0,l.jsx)(I.Tag,{color:"red",className:"text-xs",children:e},a)),a.length>2&&(0,l.jsx)(k.Tooltip,{title:a.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Model Condition",accessorKey:"condition",cell:({row:e})=>{let a=e.original,t=a.condition?.model;return t?(0,l.jsx)(k.Tooltip,{title:"string"==typeof t?t:JSON.stringify(t),children:(0,l.jsx)("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"string"==typeof t?t.length>20?t.slice(0,20)+"...":t:"Multiple"})}):(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Created At",accessorKey:"created_at",cell:({row:e})=>{var a;let t=e.original;return(0,l.jsx)(k.Tooltip,{title:t.created_at,children:(0,l.jsx)("span",{className:"text-xs",children:(a=t.created_at)?new Date(a).toLocaleString():"-"})})}},{id:"actions",header:"Actions",cell:({row:e})=>{let a=e.original;return(0,l.jsx)("div",{className:"flex space-x-2",children:c&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(k.Tooltip,{title:"Edit policy",children:(0,l.jsx)(w.Icon,{icon:N.PencilIcon,size:"sm",onClick:()=>r(a),className:"cursor-pointer hover:text-blue-500"})}),(0,l.jsx)(k.Tooltip,{title:"Delete policy",children:(0,l.jsx)(w.Icon,{icon:_.TrashIcon,size:"sm",onClick:()=>a.policy_id&&s(a.policy_id,a.policy_name||"Unnamed Policy"),className:"cursor-pointer hover:text-red-500"})})]})})}}],m=(0,P.useReactTable)({data:e,columns:h,state:{sorting:n},onSortingChange:d,getCoreRowModel:(0,A.getCoreRowModel)(),getSortedRowModel:(0,A.getSortedRowModel)(),enableSorting:!0});return(0,l.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(u.Table,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,l.jsx)(j.TableHead,{children:m.getHeaderGroups().map(e=>(0,l.jsx)(b.TableRow,{children:e.headers.map(e=>(0,l.jsx)(f.TableHeaderCell,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,P.flexRender)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,l.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,l.jsx)(C.ChevronUpIcon,{className:"h-4 w-4 text-blue-500"}),desc:(0,l.jsx)(T.ChevronDownIcon,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,l.jsx)(S.SwitchVerticalIcon,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,l.jsx)(g.TableBody,{children:i?(0,l.jsx)(b.TableRow,{children:(0,l.jsx)(y.TableCell,{colSpan:h.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"Loading..."})})})}):e.length>0?m.getRowModel().rows.map(e=>(0,l.jsx)(b.TableRow,{className:"h-8",children:e.getVisibleCells().map(e=>(0,l.jsx)(y.TableCell,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,children:(0,P.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,l.jsx)(b.TableRow,{children:(0,l.jsx)(y.TableCell,{colSpan:h.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"No policies found"})})})})})]})})})};var D=e.i(304967),R=e.i(530212),L=e.i(869216),B=e.i(482725),E=e.i(312361),G=e.i(898586),M=e.i(764205);let{Title:V,Text:K}=G.Typography,O=({policyId:e,onClose:i,onEdit:s,accessToken:r,isAdmin:o,getPolicy:c})=>{let[n,d]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0),[p,u]=(0,a.useState)([]),[g,y]=(0,a.useState)(!1),j=(0,a.useCallback)(async()=>{if(r&&e){x(!0);try{let l=await c(r,e);d(l),y(!0);try{let l=await (0,M.getResolvedGuardrails)(r,e);u(l.resolved_guardrails||[])}catch(e){console.error("Error fetching resolved guardrails:",e)}finally{y(!1)}}catch(e){console.error("Error fetching policy:",e)}finally{x(!1)}}},[e,r,c]);return((0,a.useEffect)(()=>{j()},[j]),m)?(0,l.jsx)("div",{className:"flex justify-center items-center p-12",children:(0,l.jsx)(B.Spin,{size:"large"})}):n?(0,l.jsx)(D.Card,{children:(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)(t.Button,{variant:"secondary",icon:R.ArrowLeftIcon,onClick:i,children:"Back to Policies"}),o&&(0,l.jsx)(t.Button,{icon:N.PencilIcon,onClick:()=>s(n),children:"Edit Policy"})]}),(0,l.jsx)(V,{level:4,children:n.policy_name}),(0,l.jsxs)(L.Descriptions,{bordered:!0,column:1,children:[(0,l.jsx)(L.Descriptions.Item,{label:"Policy ID",children:(0,l.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:n.policy_id})}),(0,l.jsx)(L.Descriptions.Item,{label:"Description",children:n.description||(0,l.jsx)(K,{type:"secondary",children:"No description"})}),(0,l.jsx)(L.Descriptions.Item,{label:"Inherits From",children:n.inherit?(0,l.jsx)(v.Badge,{color:"blue",size:"sm",children:n.inherit}):(0,l.jsx)(K,{type:"secondary",children:"None"})}),(0,l.jsx)(L.Descriptions.Item,{label:"Created At",children:n.created_at?new Date(n.created_at).toLocaleString():"-"}),(0,l.jsx)(L.Descriptions.Item,{label:"Updated At",children:n.updated_at?new Date(n.updated_at).toLocaleString():"-"})]}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(K,{strong:!0,children:"Guardrails Configuration"})}),p.length>0&&(0,l.jsx)(h.Alert,{message:"Resolved Guardrails",description:(0,l.jsxs)("div",{children:[(0,l.jsx)(K,{type:"secondary",style:{display:"block",marginBottom:8},children:"Final guardrails that will be applied (including inheritance):"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:p.map(e=>(0,l.jsx)(I.Tag,{color:"blue",children:e},e))})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,l.jsxs)(L.Descriptions,{bordered:!0,column:1,children:[(0,l.jsx)(L.Descriptions.Item,{label:"Guardrails to Add",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:n.guardrails_add&&n.guardrails_add.length>0?n.guardrails_add.map(e=>(0,l.jsx)(I.Tag,{color:"green",children:e},e)):(0,l.jsx)(K,{type:"secondary",children:"None"})})}),(0,l.jsx)(L.Descriptions.Item,{label:"Guardrails to Remove",children:(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:n.guardrails_remove&&n.guardrails_remove.length>0?n.guardrails_remove.map(e=>(0,l.jsx)(I.Tag,{color:"red",children:e},e)):(0,l.jsx)(K,{type:"secondary",children:"None"})})})]}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(K,{strong:!0,children:"Conditions"})}),(0,l.jsx)(L.Descriptions,{bordered:!0,column:1,children:(0,l.jsx)(L.Descriptions.Item,{label:"Model Condition",children:n.condition?.model?(0,l.jsx)(I.Tag,{color:"purple",children:"string"==typeof n.condition.model?n.condition.model:JSON.stringify(n.condition.model)}):(0,l.jsx)(K,{type:"secondary",children:"No model condition (applies to all models)"})})})]})}):(0,l.jsxs)(D.Card,{children:[(0,l.jsx)(K,{type:"danger",children:"Policy not found"}),(0,l.jsx)("br",{}),(0,l.jsx)(t.Button,{onClick:i,className:"mt-4",children:"Go Back"})]})};var z=e.i(808613),$=e.i(199133),H=e.i(91739),U=e.i(779241),q=e.i(78085),J=e.i(727749),W=e.i(135214);let{Text:Y}=G.Typography,{Option:Z}=$.Select,Q=({visible:e,onClose:i,onSuccess:s,accessToken:r,editingPolicy:o,existingPolicies:c,availableGuardrails:d,createPolicy:m,updatePolicy:x})=>{let[p]=z.Form.useForm(),[u,g]=(0,a.useState)(!1),[y,j]=(0,a.useState)([]),[f,b]=(0,a.useState)(!1),[w,v]=(0,a.useState)("model"),[_,N]=(0,a.useState)([]),{userId:S,userRole:C}=(0,W.default)(),T=!!o;(0,a.useEffect)(()=>{if(e&&o){let e=o.condition?.model;v(e&&/[.*+?^${}()|[\]\\]/.test(e)?"regex":"model"),p.setFieldsValue({policy_name:o.policy_name,description:o.description,inherit:o.inherit,guardrails_add:o.guardrails_add||[],guardrails_remove:o.guardrails_remove||[],model_condition:e}),o.policy_id&&r&&P(o.policy_id)}else e&&(p.resetFields(),j([]),v("model"))},[e,o,p]),(0,a.useEffect)(()=>{e&&r&&k()},[e,r]);let k=async()=>{if(r)try{let e=await (0,M.modelAvailableCall)(r,S,C);if(e?.data){let l=e.data.map(e=>e.id||e.model_name).filter(Boolean);N(l)}}catch(e){console.error("Failed to load available models:",e)}},P=async e=>{if(r){b(!0);try{let l=await (0,M.getResolvedGuardrails)(r,e);j(l.resolved_guardrails||[])}catch(e){console.error("Failed to load resolved guardrails:",e)}finally{b(!1)}}},A=e=>{let l=new Set;if(e.inherit){let a=c.find(l=>l.policy_name===e.inherit);a&&A(a).forEach(e=>l.add(e))}return e.guardrails_add&&e.guardrails_add.forEach(e=>l.add(e)),e.guardrails_remove&&e.guardrails_remove.forEach(e=>l.delete(e)),Array.from(l)},F=()=>{p.resetFields()},D=()=>{F(),i()},R=async()=>{try{g(!0),await p.validateFields();let e=p.getFieldsValue(!0);if(!r)throw Error("No access token available");let l={policy_name:e.policy_name,description:e.description||void 0,inherit:e.inherit||void 0,guardrails_add:e.guardrails_add||[],guardrails_remove:e.guardrails_remove||[],condition:e.model_condition?{model:e.model_condition}:void 0};T&&o?(await x(r,o.policy_id,l),J.default.success("Policy updated successfully")):(await m(r,l),J.default.success("Policy created successfully")),F(),s(),i()}catch(e){console.error("Failed to save policy:",e),J.default.fromBackend("Failed to save policy: "+(e instanceof Error?e.message:String(e)))}finally{g(!1)}},L=d.map(e=>({label:e.guardrail_name||e.guardrail_id,value:e.guardrail_name||e.guardrail_id})),B=c.filter(e=>!o||e.policy_id!==o.policy_id).map(e=>({label:e.policy_name,value:e.policy_name}));return(0,l.jsx)(n.Modal,{title:T?"Edit Policy":"Create New Policy",open:e,onCancel:D,footer:null,width:700,children:(0,l.jsxs)(z.Form,{form:p,layout:"vertical",initialValues:{guardrails_add:[],guardrails_remove:[]},onValuesChange:()=>{j((()=>{let e=p.getFieldsValue(!0),l=e.inherit,a=e.guardrails_add||[],t=e.guardrails_remove||[],i=new Set;if(l){let e=c.find(e=>e.policy_name===l);e&&A(e).forEach(e=>i.add(e))}return a.forEach(e=>i.add(e)),t.forEach(e=>i.delete(e)),Array.from(i).sort()})())},children:[(0,l.jsx)(z.Form.Item,{name:"policy_name",label:"Policy Name",rules:[{required:!0,message:"Please enter a policy name"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"Policy name can only contain letters, numbers, hyphens, and underscores"}],children:(0,l.jsx)(U.TextInput,{placeholder:"e.g., global-baseline, healthcare-compliance",disabled:T})}),(0,l.jsx)(z.Form.Item,{name:"description",label:"Description",children:(0,l.jsx)(q.Textarea,{rows:2,placeholder:"Describe what this policy does..."})}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(Y,{strong:!0,children:"Inheritance"})}),(0,l.jsx)(z.Form.Item,{name:"inherit",label:"Inherit From",tooltip:"Inherit guardrails from another policy. The child policy will include all guardrails from the parent.",children:(0,l.jsx)($.Select,{allowClear:!0,placeholder:"Select a parent policy (optional)",options:B,style:{width:"100%"}})}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(Y,{strong:!0,children:"Guardrails"})}),(0,l.jsx)(z.Form.Item,{name:"guardrails_add",label:"Guardrails to Add",tooltip:"These guardrails will be added to requests matching this policy",children:(0,l.jsx)($.Select,{mode:"multiple",allowClear:!0,placeholder:"Select guardrails to add",options:L,style:{width:"100%"}})}),(0,l.jsx)(z.Form.Item,{name:"guardrails_remove",label:"Guardrails to Remove",tooltip:"These guardrails will be removed from inherited guardrails",children:(0,l.jsx)($.Select,{mode:"multiple",allowClear:!0,placeholder:"Select guardrails to remove (from inherited)",options:L,style:{width:"100%"}})}),y.length>0&&(0,l.jsx)(h.Alert,{message:"Resolved Guardrails",description:(0,l.jsxs)("div",{children:[(0,l.jsx)(Y,{type:"secondary",style:{display:"block",marginBottom:8},children:"These are the final guardrails that will be applied (including inheritance):"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:y.map(e=>(0,l.jsx)(I.Tag,{color:"blue",children:e},e))})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(Y,{strong:!0,children:"Conditions (Optional)"})}),(0,l.jsx)(h.Alert,{message:"Model Scope",description:"By default, this policy will run on all models. You can optionally restrict it to specific models below.",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,l.jsx)(z.Form.Item,{label:"Model Condition Type",children:(0,l.jsxs)(H.Radio.Group,{value:w,onChange:e=>{v(e.target.value),p.setFieldValue("model_condition",void 0)},children:[(0,l.jsx)(H.Radio,{value:"model",children:"Select Model"}),(0,l.jsx)(H.Radio,{value:"regex",children:"Custom Regex Pattern"})]})}),(0,l.jsx)(z.Form.Item,{name:"model_condition",label:"model"===w?"Model (Optional)":"Regex Pattern (Optional)",tooltip:"model"===w?"Select a specific model to apply this policy to. Leave empty to apply to all models.":"Enter a regex pattern to match models (e.g., gpt-4.* or bedrock/.*). Leave empty to apply to all models.",children:"model"===w?(0,l.jsx)($.Select,{showSearch:!0,allowClear:!0,placeholder:"Leave empty to apply to all models",options:_.map(e=>({label:e,value:e})),filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}}):(0,l.jsx)(U.TextInput,{placeholder:"Leave empty to apply to all models (e.g., gpt-4.* or bedrock/claude-.*)"})}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,l.jsx)(t.Button,{variant:"secondary",onClick:D,children:"Cancel"}),(0,l.jsx)(t.Button,{onClick:R,loading:u,children:T?"Update Policy":"Create Policy"})]})]})})},X=({attachments:e,isLoading:t,onDeleteClick:i,isAdmin:s})=>{let[r,o]=(0,a.useState)([{id:"created_at",desc:!0}]),c=[{header:"Attachment ID",accessorKey:"attachment_id",cell:e=>(0,l.jsx)(k.Tooltip,{title:String(e.getValue()||""),children:(0,l.jsx)("span",{className:"font-mono text-xs text-gray-600",children:e.getValue()?`${String(e.getValue()).slice(0,7)}...`:""})})},{header:"Policy",accessorKey:"policy_name",cell:({row:e})=>{let a=e.original;return(0,l.jsx)(v.Badge,{color:"blue",size:"xs",children:a.policy_name})}},{header:"Scope",accessorKey:"scope",cell:({row:e})=>{let a=e.original;return"*"===a.scope?(0,l.jsx)(v.Badge,{color:"amber",size:"xs",children:"Global (*)"}):a.scope?(0,l.jsx)("span",{className:"text-xs",children:a.scope}):(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"})}},{header:"Teams",accessorKey:"teams",cell:({row:e})=>{let a=e.original.teams||[];return 0===a.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,a)=>(0,l.jsx)(I.Tag,{color:"cyan",className:"text-xs",children:e},a)),a.length>2&&(0,l.jsx)(k.Tooltip,{title:a.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Keys",accessorKey:"keys",cell:({row:e})=>{let a=e.original.keys||[];return 0===a.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,a)=>(0,l.jsx)(I.Tag,{color:"purple",className:"text-xs",children:e},a)),a.length>2&&(0,l.jsx)(k.Tooltip,{title:a.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Models",accessorKey:"models",cell:({row:e})=>{let a=e.original.models||[];return 0===a.length?(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"-"}):(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,2).map((e,a)=>(0,l.jsx)(I.Tag,{color:"green",className:"text-xs",children:e},a)),a.length>2&&(0,l.jsx)(k.Tooltip,{title:a.slice(2).join(", "),children:(0,l.jsxs)(I.Tag,{className:"text-xs",children:["+",a.length-2]})})]})}},{header:"Created At",accessorKey:"created_at",cell:({row:e})=>{var a;let t=e.original;return(0,l.jsx)(k.Tooltip,{title:t.created_at,children:(0,l.jsx)("span",{className:"text-xs",children:(a=t.created_at)?new Date(a).toLocaleString():"-"})})}},{id:"actions",header:"Actions",cell:({row:e})=>{let a=e.original;return(0,l.jsx)("div",{className:"flex space-x-2",children:s&&(0,l.jsx)(k.Tooltip,{title:"Delete attachment",children:(0,l.jsx)(w.Icon,{icon:_.TrashIcon,size:"sm",onClick:()=>i(a.attachment_id),className:"cursor-pointer hover:text-red-500"})})})}}],n=(0,P.useReactTable)({data:e,columns:c,state:{sorting:r},onSortingChange:o,getCoreRowModel:(0,A.getCoreRowModel)(),getSortedRowModel:(0,A.getSortedRowModel)(),enableSorting:!0});return(0,l.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(u.Table,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,l.jsx)(j.TableHead,{children:n.getHeaderGroups().map(e=>(0,l.jsx)(b.TableRow,{children:e.headers.map(e=>(0,l.jsx)(f.TableHeaderCell,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,P.flexRender)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&(0,l.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,l.jsx)(C.ChevronUpIcon,{className:"h-4 w-4 text-blue-500"}),desc:(0,l.jsx)(T.ChevronDownIcon,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,l.jsx)(S.SwitchVerticalIcon,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,l.jsx)(g.TableBody,{children:t?(0,l.jsx)(b.TableRow,{children:(0,l.jsx)(y.TableCell,{colSpan:c.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"Loading..."})})})}):e.length>0?n.getRowModel().rows.map(e=>(0,l.jsx)(b.TableRow,{className:"h-8",children:e.getVisibleCells().map(e=>(0,l.jsx)(y.TableCell,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,children:(0,P.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,l.jsx)(b.TableRow,{children:(0,l.jsx)(y.TableCell,{colSpan:c.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"No attachments found"})})})})})]})})})},{Text:ee}=G.Typography,el=({visible:e,onClose:i,onSuccess:s,accessToken:r,policies:o,createAttachment:c})=>{let[d]=z.Form.useForm(),[h,m]=(0,a.useState)(!1),[x,p]=(0,a.useState)("global"),[u,g]=(0,a.useState)([]),[y,j]=(0,a.useState)([]),[f,b]=(0,a.useState)([]),[w,v]=(0,a.useState)(!1),[_,N]=(0,a.useState)(!1),[S,C]=(0,a.useState)(!1),{userId:T,userRole:k}=(0,W.default)();(0,a.useEffect)(()=>{e&&r&&I()},[e,r]);let I=async()=>{if(r){v(!0);try{let e=await (0,M.teamListCall)(r,null,T);if(e?.data){let l=e.data.map(e=>e.team_alias).filter(Boolean);g(l)}}catch(e){console.error("Failed to load teams:",e)}finally{v(!1)}N(!0);try{let e=await (0,M.keyInfoCall)(r,[]);if(e?.data){let l=e.data.map(e=>e.key_alias).filter(Boolean);j(l)}}catch(e){console.error("Failed to load keys:",e)}finally{N(!1)}C(!0);try{let e=await (0,M.modelAvailableCall)(r,T||"",k||"");if(e?.data){let l=e.data.map(e=>e.id||e.model_name).filter(Boolean);b(l)}}catch(e){console.error("Failed to load models:",e)}finally{C(!1)}}},P=()=>{d.resetFields(),p("global")},A=()=>{P(),i()},F=async()=>{try{m(!0),await d.validateFields();let e=d.getFieldsValue(!0);if(!r)throw Error("No access token available");let l={policy_name:e.policy_name};"global"===x?l.scope="*":(e.teams&&e.teams.length>0&&(l.teams=e.teams),e.keys&&e.keys.length>0&&(l.keys=e.keys),e.models&&e.models.length>0&&(l.models=e.models)),await c(r,l),J.default.success("Attachment created successfully"),P(),s(),i()}catch(e){console.error("Failed to create attachment:",e),J.default.fromBackend("Failed to create attachment: "+(e instanceof Error?e.message:String(e)))}finally{m(!1)}},D=o.map(e=>({label:e.policy_name,value:e.policy_name}));return(0,l.jsx)(n.Modal,{title:"Create Policy Attachment",open:e,onCancel:A,footer:null,width:600,children:(0,l.jsxs)(z.Form,{form:d,layout:"vertical",initialValues:{scope_type:"global"},children:[(0,l.jsx)(z.Form.Item,{name:"policy_name",label:"Policy",rules:[{required:!0,message:"Please select a policy"}],children:(0,l.jsx)($.Select,{placeholder:"Select a policy to attach",options:D,showSearch:!0,filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}})}),(0,l.jsx)(E.Divider,{orientation:"left",children:(0,l.jsx)(ee,{strong:!0,children:"Scope"})}),(0,l.jsx)(z.Form.Item,{label:"Scope Type",children:(0,l.jsxs)(H.Radio.Group,{value:x,onChange:e=>p(e.target.value),children:[(0,l.jsx)(H.Radio,{value:"global",children:"Global (applies to all requests)"}),(0,l.jsx)(H.Radio,{value:"specific",children:"Specific (teams, keys, or models)"})]})}),"specific"===x&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(z.Form.Item,{name:"teams",label:"Teams",tooltip:"Select team aliases or enter custom patterns. Supports wildcards (e.g., healthcare-*)",children:(0,l.jsx)($.Select,{mode:"tags",placeholder:w?"Loading teams...":"Select or enter team aliases",loading:w,options:u.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}})}),(0,l.jsx)(z.Form.Item,{name:"keys",label:"Keys",tooltip:"Select key aliases or enter custom patterns. Supports wildcards (e.g., dev-*)",children:(0,l.jsx)($.Select,{mode:"tags",placeholder:_?"Loading keys...":"Select or enter key aliases",loading:_,options:y.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}})}),(0,l.jsx)(z.Form.Item,{name:"models",label:"Models",tooltip:"Model names this attachment applies to. Supports wildcards (e.g., gpt-4*). Leave empty to apply to all models.",children:(0,l.jsx)($.Select,{mode:"tags",placeholder:S?"Loading models...":"Select or enter model names (e.g., gpt-4, bedrock/*)",loading:S,options:f.map(e=>({label:e,value:e})),tokenSeparators:[","],showSearch:!0,filterOption:(e,l)=>(l?.label??"").toLowerCase().includes(e.toLowerCase()),style:{width:"100%"}})})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2 mt-4",children:[(0,l.jsx)(t.Button,{variant:"secondary",onClick:A,children:"Cancel"}),(0,l.jsx)(t.Button,{onClick:F,loading:h,children:"Create Attachment"})]})]})})};var ea=e.i(127952);e.s(["default",0,({accessToken:e,userRole:u})=>{let[g,y]=(0,a.useState)([]),[j,f]=(0,a.useState)([]),[b,w]=(0,a.useState)([]),[v,_]=(0,a.useState)(!1),[N,S]=(0,a.useState)(!1),[C,T]=(0,a.useState)(!1),[k,I]=(0,a.useState)(!1),[P,A]=(0,a.useState)(null),[D,R]=(0,a.useState)(null),[L,B]=(0,a.useState)(0),[E,G]=(0,a.useState)(!1),[V,K]=(0,a.useState)(null),[z,$]=(0,a.useState)(!1),H=!!u&&(0,p.isAdminRole)(u),U=(0,a.useCallback)(async()=>{if(e){_(!0);try{let l=await (0,M.getPoliciesList)(e);y(l.policies||[])}catch(e){console.error("Error fetching policies:",e),d.message.error("Failed to fetch policies")}finally{_(!1)}}},[e]),q=(0,a.useCallback)(async()=>{if(e){S(!0);try{let l=await (0,M.getPolicyAttachmentsList)(e);f(l.attachments||[])}catch(e){console.error("Error fetching attachments:",e),d.message.error("Failed to fetch attachments")}finally{S(!1)}}},[e]),J=(0,a.useCallback)(async()=>{if(e)try{let l=await (0,M.getGuardrailsList)(e);w(l.guardrails||[])}catch(e){console.error("Error fetching guardrails:",e)}},[e]);(0,a.useEffect)(()=>{U(),q(),J()},[U,q,J]);let W=async()=>{if(V&&e){G(!0);try{await (0,M.deletePolicyCall)(e,V.policy_id),d.message.success(`Policy "${V.policy_name}" deleted successfully`),await U()}catch(e){console.error("Error deleting policy:",e),d.message.error("Failed to delete policy")}finally{G(!1),$(!1),K(null)}}};return(0,l.jsx)("div",{className:"w-full mx-auto flex-auto overflow-y-auto m-8 p-2",children:(0,l.jsxs)(i.TabGroup,{index:L,onIndexChange:B,children:[(0,l.jsxs)(s.TabList,{className:"mb-4",children:[(0,l.jsx)(r.Tab,{children:"Policies"}),(0,l.jsx)(r.Tab,{children:"Attachments"})]}),(0,l.jsxs)(o.TabPanels,{children:[(0,l.jsxs)(c.TabPanel,{children:[(0,l.jsx)(h.Alert,{message:"About Policies",description:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"mb-3",children:"Use policies to group guardrails and control which ones run for specific teams, keys, or models."}),(0,l.jsx)("p",{className:"mb-2 font-semibold",children:"Why use policies?"}),(0,l.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,l.jsx)("li",{children:"Enable/disable specific guardrails for teams, keys, or models"}),(0,l.jsx)("li",{children:"Group guardrails into a single policy"}),(0,l.jsx)("li",{children:"Inherit from existing policies and override what you need"})]}),(0,l.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more in the documentation →"})]}),type:"info",icon:(0,l.jsx)(x.InfoCircleOutlined,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,l.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,l.jsx)(t.Button,{onClick:()=>{D&&R(null),A(null),T(!0)},disabled:!e,children:"+ Add New Policy"})}),D?(0,l.jsx)(O,{policyId:D,onClose:()=>R(null),onEdit:e=>{A(e),T(!0),R(null)},accessToken:e,isAdmin:H,getPolicy:M.getPolicyInfo}):(0,l.jsx)(F,{policies:g,isLoading:v,onDeleteClick:(e,l)=>{K(g.find(l=>l.policy_id===e)||null),$(!0)},onEditClick:e=>{A(e),T(!0)},onViewClick:e=>R(e),isAdmin:H}),(0,l.jsx)(Q,{visible:C,onClose:()=>{T(!1),A(null)},onSuccess:()=>{U(),A(null)},accessToken:e,editingPolicy:P,existingPolicies:g,availableGuardrails:b,createPolicy:M.createPolicyCall,updatePolicy:M.updatePolicyCall}),(0,l.jsx)(ea.default,{isOpen:z,title:"Delete Policy",message:`Are you sure you want to delete policy: ${V?.policy_name}? This action cannot be undone.`,resourceInformationTitle:"Policy Information",resourceInformation:[{label:"Name",value:V?.policy_name},{label:"ID",value:V?.policy_id,code:!0},{label:"Description",value:V?.description||"-"},{label:"Inherits From",value:V?.inherit||"-"}],onCancel:()=>{$(!1),K(null)},onOk:W,confirmLoading:E})]}),(0,l.jsxs)(c.TabPanel,{children:[(0,l.jsx)(h.Alert,{message:"About Policy Attachments",description:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"mb-3",children:"Policy attachments control where your policies apply. Policies don't do anything until you attach them to specific teams, keys, models, or globally."}),(0,l.jsx)("p",{className:"mb-2 font-semibold",children:"Attachment Scopes:"}),(0,l.jsxs)("ul",{className:"list-disc list-inside mb-3 space-y-1 ml-2",children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Global (*)"})," - Applies to all requests"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Teams"})," - Applies only to specific teams"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Keys"})," - Applies only to specific API keys (supports wildcards like dev-*)"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Models"})," - Applies only when specific models are used"]})]}),(0,l.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/guardrails/guardrail_policies#attachments",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline inline-block mt-1",children:"Learn more about attachments →"})]}),type:"info",icon:(0,l.jsx)(x.InfoCircleOutlined,{}),showIcon:!0,closable:!0,className:"mb-6"}),(0,l.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,l.jsx)(t.Button,{onClick:()=>I(!0),disabled:!e||0===g.length,children:"+ Add New Attachment"})}),(0,l.jsx)(X,{attachments:j,isLoading:N,onDeleteClick:a=>{n.Modal.confirm({title:"Delete Attachment",icon:(0,l.jsx)(m.ExclamationCircleOutlined,{}),content:"Are you sure you want to delete this attachment? This action cannot be undone.",okText:"Delete",okType:"danger",cancelText:"Cancel",onOk:async()=>{if(e)try{await (0,M.deletePolicyAttachmentCall)(e,a),d.message.success("Attachment deleted successfully"),q()}catch(e){console.error("Error deleting attachment:",e),d.message.error("Failed to delete attachment")}}})},isAdmin:H}),(0,l.jsx)(el,{visible:k,onClose:()=>I(!1),onSuccess:()=>{q()},accessToken:e,policies:g,createAttachment:M.createPolicyAttachmentCall})]})]})]})})}],760221)}]);