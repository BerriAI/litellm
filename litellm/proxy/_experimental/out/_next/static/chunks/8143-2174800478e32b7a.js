"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8143],{18143:function(e,s,a){a.d(s,{Z:function(){return L}});var t=a(57437),l=a(40278),n=a(96889),r=a(12514),o=a(97765),i=a(21626),c=a(97214),d=a(28241),h=a(58834),u=a(69552),x=a(71876),m=a(96761),g=a(2265),p=a(47375),j=a(39789),Z=a(75105),y=a(20831),S=a(49804),_=a(14042),w=a(67101),f=a(92414),v=a(46030),k=a(27281),D=a(57365),E=a(12485),N=a(18135),C=a(35242),I=a(29706),F=a(77991),b=a(84264),T=a(19250),M=a(83438),A=a(59872);console.log("process.env.NODE_ENV","production");let P=e=>null!==e&&("Admin"===e||"Admin Viewer"===e);var L=e=>{let{accessToken:s,token:a,userRole:L,userID:U,keys:V,premiumUser:Y}=e,B=new Date,[O,q]=(0,g.useState)([]),[R,W]=(0,g.useState)([]),[G,K]=(0,g.useState)([]),[z,Q]=(0,g.useState)([]),[X,$]=(0,g.useState)([]),[H,J]=(0,g.useState)([]),[ee,es]=(0,g.useState)([]),[ea,et]=(0,g.useState)([]),[el,en]=(0,g.useState)([]),[er,eo]=(0,g.useState)([]),[ei,ec]=(0,g.useState)({}),[ed,eh]=(0,g.useState)([]),[eu,ex]=(0,g.useState)(""),[em,eg]=(0,g.useState)(["all-tags"]),[ep,ej]=(0,g.useState)({from:new Date(Date.now()-6048e5),to:new Date}),[eZ,ey]=(0,g.useState)(null),[eS,e_]=(0,g.useState)(0),ew=new Date(B.getFullYear(),B.getMonth(),1),ef=new Date(B.getFullYear(),B.getMonth()+1,0),ev=eI(ew),ek=eI(ef);function eD(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0,notation:"compact",compactDisplay:"short"}).format(e)}console.log("keys in usage",V),console.log("premium user in usage",Y);let eE=async()=>{if(s)try{let e=await (0,T.getProxyUISettings)(s);return console.log("usage tab: proxy_settings",e),e}catch(e){console.error("Error fetching proxy settings:",e)}};(0,g.useEffect)(()=>{eC(ep.from,ep.to)},[ep,em]);let eN=async(e,a,t)=>{if(!e||!a||!s)return;console.log("uiSelectedKey",t);let l=await (0,T.adminTopEndUsersCall)(s,t,e.toISOString(),a.toISOString());console.log("End user data updated successfully",l),Q(l)},eC=async(e,a)=>{if(!e||!a||!s)return;let t=await eE();null!=t&&t.DISABLE_EXPENSIVE_DB_QUERIES||(J((await (0,T.tagsSpendLogsCall)(s,e.toISOString(),a.toISOString(),0===em.length?void 0:em)).spend_per_tag),console.log("Tag spend data updated successfully"))};function eI(e){let s=e.getFullYear(),a=e.getMonth()+1,t=e.getDate();return"".concat(s,"-").concat(a<10?"0"+a:a,"-").concat(t<10?"0"+t:t)}console.log("Start date is ".concat(ev)),console.log("End date is ".concat(ek));let eF=async(e,s,a)=>{try{let a=await e();s(a)}catch(e){console.error(a,e)}},eb=(e,s,a,t)=>{let l=[],n=new Date(s),r=e=>{if(e.includes("-"))return e;{let[s,a]=e.split(" ");return new Date(new Date().getFullYear(),new Date("".concat(s," 01 2024")).getMonth(),parseInt(a)).toISOString().split("T")[0]}},o=new Map(e.map(e=>{let s=r(e.date);return[s,{...e,date:s}]}));for(;n<=a;){let e=n.toISOString().split("T")[0];if(o.has(e))l.push(o.get(e));else{let s={date:e,api_requests:0,total_tokens:0};t.forEach(e=>{s[e]||(s[e]=0)}),l.push(s)}n.setDate(n.getDate()+1)}return l},eT=async()=>{if(s)try{let e=await (0,T.adminSpendLogsCall)(s),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),n=eb(e,t,l,[]),r=Number(n.reduce((e,s)=>e+(s.spend||0),0).toFixed(2));e_(r),q(n)}catch(e){console.error("Error fetching overall spend:",e)}},eM=()=>eF(()=>s&&a?(0,T.adminspendByProvider)(s,a,ev,ek):Promise.reject("No access token or token"),eo,"Error fetching provider spend"),eA=async()=>{s&&await eF(async()=>(await (0,T.adminTopKeysCall)(s)).map(e=>({key:e.api_key.substring(0,10),api_key:e.api_key,key_alias:e.key_alias,spend:Number(e.total_spend.toFixed(2))})),W,"Error fetching top keys")},eP=async()=>{s&&await eF(async()=>(await (0,T.adminTopModelsCall)(s)).map(e=>({key:e.model,spend:(0,A.pw)(e.total_spend,2)})),K,"Error fetching top models")},eL=async()=>{s&&await eF(async()=>{let e=await (0,T.teamSpendLogsCall)(s),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0);return $(eb(e.daily_spend,t,l,e.teams)),et(e.teams),e.total_spend_per_team.map(e=>({name:e.team_id||"",value:(0,A.pw)(e.total_spend||0,2)}))},en,"Error fetching team spend")},eU=()=>{s&&eF(async()=>(await (0,T.allTagNamesCall)(s)).tag_names,es,"Error fetching tag names")},eV=()=>{s&&eF(()=>{var e,a;return(0,T.tagsSpendLogsCall)(s,null===(e=ep.from)||void 0===e?void 0:e.toISOString(),null===(a=ep.to)||void 0===a?void 0:a.toISOString(),void 0)},e=>J(e.spend_per_tag),"Error fetching top tags")},eY=()=>{s&&eF(()=>(0,T.adminTopEndUsersCall)(s,null,void 0,void 0),Q,"Error fetching top end users")},eB=async()=>{if(s)try{let e=await (0,T.adminGlobalActivity)(s,ev,ek),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),n=eb(e.daily_data||[],t,l,["api_requests","total_tokens"]);ec({...e,daily_data:n})}catch(e){console.error("Error fetching global activity:",e)}},eO=async()=>{if(s)try{let e=await (0,T.adminGlobalActivityPerModel)(s,ev,ek),a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),n=e.map(e=>({...e,daily_data:eb(e.daily_data||[],t,l,["api_requests","total_tokens"])}));eh(n)}catch(e){console.error("Error fetching global activity per model:",e)}};return((0,g.useEffect)(()=>{(async()=>{if(s&&a&&L&&U){let e=await eE();e&&(ey(e),null!=e&&e.DISABLE_EXPENSIVE_DB_QUERIES)||(console.log("fetching data - valiue of proxySettings",eZ),eT(),eM(),eA(),eP(),eB(),eO(),P(L)&&(eL(),eU(),eV(),eY()))}})()},[s,a,L,U,ev,ek]),null==eZ?void 0:eZ.DISABLE_EXPENSIVE_DB_QUERIES)?(0,t.jsx)("div",{style:{width:"100%"},className:"p-8",children:(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"Database Query Limit Reached"}),(0,t.jsxs)(b.Z,{className:"mt-4",children:["SpendLogs in DB has ",eZ.NUM_SPEND_LOGS_ROWS," rows.",(0,t.jsx)("br",{}),"Please follow our guide to view usage when SpendLogs has more than 1M rows."]}),(0,t.jsx)(y.Z,{className:"mt-4",children:(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/spending_monitoring",target:"_blank",children:"View Usage Guide"})})]})}):(0,t.jsx)("div",{style:{width:"100%"},className:"p-8",children:(0,t.jsxs)(N.Z,{children:[(0,t.jsxs)(C.Z,{className:"mt-2",children:[(0,t.jsx)(E.Z,{children:"All Up"}),P(L)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.Z,{children:"Team Based Usage"}),(0,t.jsx)(E.Z,{children:"Customer Usage"}),(0,t.jsx)(E.Z,{children:"Tag Based Usage"})]}):(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{})})]}),(0,t.jsxs)(F.Z,{children:[(0,t.jsx)(I.Z,{children:(0,t.jsxs)(N.Z,{children:[(0,t.jsxs)(C.Z,{variant:"solid",className:"mt-1",children:[(0,t.jsx)(E.Z,{children:"Cost"}),(0,t.jsx)(E.Z,{children:"Activity"})]}),(0,t.jsxs)(F.Z,{children:[(0,t.jsx)(I.Z,{children:(0,t.jsxs)(w.Z,{numItems:2,className:"gap-2 h-[100vh] w-full",children:[(0,t.jsxs)(S.Z,{numColSpan:2,children:[(0,t.jsxs)(b.Z,{className:"text-tremor-default text-tremor-content dark:text-dark-tremor-content mb-2 mt-2 text-lg",children:["Project Spend ",new Date().toLocaleString("default",{month:"long"})," 1 -"," ",new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate()]}),(0,t.jsx)(p.Z,{userID:U,userRole:L,accessToken:s,userSpend:eS,selectedTeam:null,userMaxBudget:null})]}),(0,t.jsx)(S.Z,{numColSpan:2,children:(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"Monthly Spend"}),(0,t.jsx)(l.Z,{data:O,index:"date",categories:["spend"],colors:["cyan"],valueFormatter:e=>"$ ".concat((0,A.pw)(e,2)),yAxisWidth:100,tickGap:5})]})}),(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsxs)(r.Z,{className:"h-full",children:[(0,t.jsx)(m.Z,{children:"Top API Keys"}),(0,t.jsx)(M.Z,{topKeys:R,accessToken:s,userID:U,userRole:L,teams:null,premiumUser:Y})]})}),(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsxs)(r.Z,{className:"h-full",children:[(0,t.jsx)(m.Z,{children:"Top Models"}),(0,t.jsx)(l.Z,{className:"mt-4 h-40",data:G,index:"key",categories:["spend"],colors:["cyan"],yAxisWidth:200,layout:"vertical",showXAxis:!1,showLegend:!1,valueFormatter:e=>"$".concat((0,A.pw)(e,2))})]})}),(0,t.jsx)(S.Z,{numColSpan:1}),(0,t.jsx)(S.Z,{numColSpan:2,children:(0,t.jsxs)(r.Z,{className:"mb-2",children:[(0,t.jsx)(m.Z,{children:"Spend by Provider"}),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsx)(_.Z,{className:"mt-4 h-40",variant:"pie",data:er,index:"provider",category:"spend",colors:["cyan"],valueFormatter:e=>"$".concat((0,A.pw)(e,2))})}),(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsxs)(i.Z,{children:[(0,t.jsx)(h.Z,{children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(u.Z,{children:"Provider"}),(0,t.jsx)(u.Z,{children:"Spend"})]})}),(0,t.jsx)(c.Z,{children:er.map(e=>(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(d.Z,{children:e.provider}),(0,t.jsx)(d.Z,{children:1e-5>parseFloat(e.spend.toFixed(2))?"less than 0.00":(0,A.pw)(e.spend,2)})]},e.provider))})]})})]})})]})})]})}),(0,t.jsx)(I.Z,{children:(0,t.jsxs)(w.Z,{numItems:1,className:"gap-2 h-[75vh] w-full",children:[(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"All Up"}),(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsxs)(S.Z,{children:[(0,t.jsxs)(o.Z,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["API Requests ",eD(ei.sum_api_requests)]}),(0,t.jsx)(Z.Z,{className:"h-40",data:ei.daily_data,valueFormatter:eD,index:"date",colors:["cyan"],categories:["api_requests"],onValueChange:e=>console.log(e)})]}),(0,t.jsxs)(S.Z,{children:[(0,t.jsxs)(o.Z,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["Tokens ",eD(ei.sum_total_tokens)]}),(0,t.jsx)(l.Z,{className:"h-40",data:ei.daily_data,valueFormatter:eD,index:"date",colors:["cyan"],categories:["total_tokens"],onValueChange:e=>console.log(e)})]})]})]}),(0,t.jsx)(t.Fragment,{children:ed.map((e,s)=>(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:e.model}),(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsxs)(S.Z,{children:[(0,t.jsxs)(o.Z,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["API Requests ",eD(e.sum_api_requests)]}),(0,t.jsx)(Z.Z,{className:"h-40",data:e.daily_data,index:"date",colors:["cyan"],categories:["api_requests"],valueFormatter:eD,onValueChange:e=>console.log(e)})]}),(0,t.jsxs)(S.Z,{children:[(0,t.jsxs)(o.Z,{style:{fontSize:"15px",fontWeight:"normal",color:"#535452"},children:["Tokens ",eD(e.sum_total_tokens)]}),(0,t.jsx)(l.Z,{className:"h-40",data:e.daily_data,index:"date",colors:["cyan"],categories:["total_tokens"],valueFormatter:eD,onValueChange:e=>console.log(e)})]})]})]},s))})]})})]})]})}),(0,t.jsx)(I.Z,{children:(0,t.jsxs)(w.Z,{numItems:2,className:"gap-2 h-[75vh] w-full",children:[(0,t.jsxs)(S.Z,{numColSpan:2,children:[(0,t.jsxs)(r.Z,{className:"mb-2",children:[(0,t.jsx)(m.Z,{children:"Total Spend Per Team"}),(0,t.jsx)(n.Z,{data:el})]}),(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"Daily Spend Per Team"}),(0,t.jsx)(l.Z,{className:"h-72",data:X,showLegend:!0,index:"date",categories:ea,yAxisWidth:80,stack:!0})]})]}),(0,t.jsx)(S.Z,{numColSpan:2})]})}),(0,t.jsxs)(I.Z,{children:[(0,t.jsxs)("p",{className:"mb-2 text-gray-500 italic text-[12px]",children:["Customers of your LLM API calls. Tracked when a `user` param is passed in your LLM calls"," ",(0,t.jsx)("a",{className:"text-blue-500",href:"https://docs.litellm.ai/docs/proxy/users",target:"_blank",children:"docs here"})]}),(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsx)(S.Z,{children:(0,t.jsx)(j.Z,{value:ep,onValueChange:e=>{ej(e),eN(e.from,e.to,null)}})}),(0,t.jsxs)(S.Z,{children:[(0,t.jsx)(b.Z,{children:"Select Key"}),(0,t.jsxs)(k.Z,{defaultValue:"all-keys",children:[(0,t.jsx)(D.Z,{value:"all-keys",onClick:()=>{eN(ep.from,ep.to,null)},children:"All Keys"},"all-keys"),null==V?void 0:V.map((e,s)=>e&&null!==e.key_alias&&e.key_alias.length>0?(0,t.jsx)(D.Z,{value:String(s),onClick:()=>{eN(ep.from,ep.to,e.token)},children:e.key_alias},s):null)]})]})]}),(0,t.jsx)(r.Z,{className:"mt-4",children:(0,t.jsxs)(i.Z,{className:"max-h-[70vh] min-h-[500px]",children:[(0,t.jsx)(h.Z,{children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(u.Z,{children:"Customer"}),(0,t.jsx)(u.Z,{children:"Spend"}),(0,t.jsx)(u.Z,{children:"Total Events"})]})}),(0,t.jsx)(c.Z,{children:null==z?void 0:z.map((e,s)=>(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(d.Z,{children:e.end_user}),(0,t.jsx)(d.Z,{children:(0,A.pw)(e.total_spend,2)}),(0,t.jsx)(d.Z,{children:e.total_count})]},s))})]})})]}),(0,t.jsxs)(I.Z,{children:[(0,t.jsxs)(w.Z,{numItems:2,children:[(0,t.jsx)(S.Z,{numColSpan:1,children:(0,t.jsx)(j.Z,{className:"mb-4",value:ep,onValueChange:e=>{ej(e),eC(e.from,e.to)}})}),(0,t.jsx)(S.Z,{children:Y?(0,t.jsx)("div",{children:(0,t.jsxs)(f.Z,{value:em,onValueChange:e=>eg(e),children:[(0,t.jsx)(v.Z,{value:"all-tags",onClick:()=>eg(["all-tags"]),children:"All Tags"},"all-tags"),ee&&ee.filter(e=>"all-tags"!==e).map((e,s)=>(0,t.jsx)(v.Z,{value:String(e),children:e},e))]})}):(0,t.jsx)("div",{children:(0,t.jsxs)(f.Z,{value:em,onValueChange:e=>eg(e),children:[(0,t.jsx)(v.Z,{value:"all-tags",onClick:()=>eg(["all-tags"]),children:"All Tags"},"all-tags"),ee&&ee.filter(e=>"all-tags"!==e).map((e,s)=>(0,t.jsxs)(D.Z,{value:String(e),disabled:!0,children:["✨ ",e," (Enterprise only Feature)"]},e))]})})})]}),(0,t.jsxs)(w.Z,{numItems:2,className:"gap-2 h-[75vh] w-full mb-4",children:[(0,t.jsx)(S.Z,{numColSpan:2,children:(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(m.Z,{children:"Spend Per Tag"}),(0,t.jsxs)(b.Z,{children:["Get Started by Tracking cost per tag"," ",(0,t.jsx)("a",{className:"text-blue-500",href:"https://docs.litellm.ai/docs/proxy/cost_tracking",target:"_blank",children:"here"})]}),(0,t.jsx)(l.Z,{className:"h-72",data:H,index:"name",categories:["spend"],colors:["cyan"]})]})}),(0,t.jsx)(S.Z,{numColSpan:2})]})]})]})]})})}}}]);