(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,757440,e=>{"use strict";var t=e.i(290571),s=e.i(271645);let r=e=>{var r=(0,t.__rest)(e,[]);return s.default.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},r),s.default.createElement("path",{d:"M11.9999 13.1714L16.9497 8.22168L18.3639 9.63589L11.9999 15.9999L5.63599 9.63589L7.0502 8.22168L11.9999 13.1714Z"}))};e.s(["default",()=>r])},446428,854056,e=>{"use strict";let t;var s=e.i(290571),r=e.i(271645);let l=e=>{var t=(0,s.__rest)(e,[]);return r.default.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},t),r.default.createElement("path",{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 10.5858L9.17157 7.75736L7.75736 9.17157L10.5858 12L7.75736 14.8284L9.17157 16.2426L12 13.4142L14.8284 16.2426L16.2426 14.8284L13.4142 12L16.2426 9.17157L14.8284 7.75736L12 10.5858Z"}))};e.s(["default",()=>l],446428);var a=e.i(746725),n=e.i(914189),i=e.i(553521),o=e.i(835696),d=e.i(941444),c=e.i(178677),u=e.i(294316),m=e.i(83733),h=e.i(233137),x=e.i(732607),g=e.i(397701),f=e.i(700020);function p(e){var t;return!!(e.enter||e.enterFrom||e.enterTo||e.leave||e.leaveFrom||e.leaveTo)||(null!=(t=e.as)?t:N)!==r.Fragment||1===r.default.Children.count(e.children)}let b=(0,r.createContext)(null);b.displayName="TransitionContext";var j=((t=j||{}).Visible="visible",t.Hidden="hidden",t);let y=(0,r.createContext)(null);function v(e){return"children"in e?v(e.children):e.current.filter(({el:e})=>null!==e.current).filter(({state:e})=>"visible"===e).length>0}function _(e,t){let s=(0,d.useLatestValue)(e),l=(0,r.useRef)([]),o=(0,i.useIsMounted)(),c=(0,a.useDisposables)(),u=(0,n.useEvent)((e,t=f.RenderStrategy.Hidden)=>{let r=l.current.findIndex(({el:t})=>t===e);-1!==r&&((0,g.match)(t,{[f.RenderStrategy.Unmount](){l.current.splice(r,1)},[f.RenderStrategy.Hidden](){l.current[r].state="hidden"}}),c.microTask(()=>{var e;!v(l)&&o.current&&(null==(e=s.current)||e.call(s))}))}),m=(0,n.useEvent)(e=>{let t=l.current.find(({el:t})=>t===e);return t?"visible"!==t.state&&(t.state="visible"):l.current.push({el:e,state:"visible"}),()=>u(e,f.RenderStrategy.Unmount)}),h=(0,r.useRef)([]),x=(0,r.useRef)(Promise.resolve()),p=(0,r.useRef)({enter:[],leave:[]}),b=(0,n.useEvent)((e,s,r)=>{h.current.splice(0),t&&(t.chains.current[s]=t.chains.current[s].filter(([t])=>t!==e)),null==t||t.chains.current[s].push([e,new Promise(e=>{h.current.push(e)})]),null==t||t.chains.current[s].push([e,new Promise(e=>{Promise.all(p.current[s].map(([e,t])=>t)).then(()=>e())})]),"enter"===s?x.current=x.current.then(()=>null==t?void 0:t.wait.current).then(()=>r(s)):r(s)}),j=(0,n.useEvent)((e,t,s)=>{Promise.all(p.current[t].splice(0).map(([e,t])=>t)).then(()=>{var e;null==(e=h.current.shift())||e()}).then(()=>s(t))});return(0,r.useMemo)(()=>({children:l,register:m,unregister:u,onStart:b,onStop:j,wait:x,chains:p}),[m,u,l,b,j,p,x])}y.displayName="NestingContext";let N=r.Fragment,S=f.RenderFeatures.RenderStrategy,w=(0,f.forwardRefWithAs)(function(e,t){let{show:s,appear:l=!1,unmount:a=!0,...i}=e,d=(0,r.useRef)(null),m=p(e),x=(0,u.useSyncRefs)(...m?[d,t]:null===t?[]:[t]);(0,c.useServerHandoffComplete)();let g=(0,h.useOpenClosed)();if(void 0===s&&null!==g&&(s=(g&h.State.Open)===h.State.Open),void 0===s)throw Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[j,N]=(0,r.useState)(s?"visible":"hidden"),w=_(()=>{s||N("hidden")}),[T,k]=(0,r.useState)(!0),I=(0,r.useRef)([s]);(0,o.useIsoMorphicEffect)(()=>{!1!==T&&I.current[I.current.length-1]!==s&&(I.current.push(s),k(!1))},[I,s]);let E=(0,r.useMemo)(()=>({show:s,appear:l,initial:T}),[s,l,T]);(0,o.useIsoMorphicEffect)(()=>{s?N("visible"):v(w)||null===d.current||N("hidden")},[s,w]);let U={unmount:a},B=(0,n.useEvent)(()=>{var t;T&&k(!1),null==(t=e.beforeEnter)||t.call(e)}),R=(0,n.useEvent)(()=>{var t;T&&k(!1),null==(t=e.beforeLeave)||t.call(e)}),F=(0,f.useRender)();return r.default.createElement(y.Provider,{value:w},r.default.createElement(b.Provider,{value:E},F({ourProps:{...U,as:r.Fragment,children:r.default.createElement(C,{ref:x,...U,...i,beforeEnter:B,beforeLeave:R})},theirProps:{},defaultTag:r.Fragment,features:S,visible:"visible"===j,name:"Transition"})))}),C=(0,f.forwardRefWithAs)(function(e,t){var s,l;let{transition:a=!0,beforeEnter:i,afterEnter:d,beforeLeave:j,afterLeave:w,enter:C,enterFrom:T,enterTo:k,entered:I,leave:E,leaveFrom:U,leaveTo:B,...R}=e,[F,L]=(0,r.useState)(null),M=(0,r.useRef)(null),D=p(e),A=(0,u.useSyncRefs)(...D?[M,t,L]:null===t?[]:[t]),O=null==(s=R.unmount)||s?f.RenderStrategy.Unmount:f.RenderStrategy.Hidden,{show:P,appear:z,initial:V}=function(){let e=(0,r.useContext)(b);if(null===e)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),[$,K]=(0,r.useState)(P?"visible":"hidden"),q=function(){let e=(0,r.useContext)(y);if(null===e)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),{register:H,unregister:W}=q;(0,o.useIsoMorphicEffect)(()=>H(M),[H,M]),(0,o.useIsoMorphicEffect)(()=>{if(O===f.RenderStrategy.Hidden&&M.current)return P&&"visible"!==$?void K("visible"):(0,g.match)($,{hidden:()=>W(M),visible:()=>H(M)})},[$,M,H,W,P,O]);let G=(0,c.useServerHandoffComplete)();(0,o.useIsoMorphicEffect)(()=>{if(D&&G&&"visible"===$&&null===M.current)throw Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[M,$,G,D]);let J=V&&!z,Q=z&&P&&V,Z=(0,r.useRef)(!1),Y=_(()=>{Z.current||(K("hidden"),W(M))},q),X=(0,n.useEvent)(e=>{Z.current=!0,Y.onStart(M,e?"enter":"leave",e=>{"enter"===e?null==i||i():"leave"===e&&(null==j||j())})}),ee=(0,n.useEvent)(e=>{let t=e?"enter":"leave";Z.current=!1,Y.onStop(M,t,e=>{"enter"===e?null==d||d():"leave"===e&&(null==w||w())}),"leave"!==t||v(Y)||(K("hidden"),W(M))});(0,r.useEffect)(()=>{D&&a||(X(P),ee(P))},[P,D,a]);let et=!(!a||!D||!G||J),[,es]=(0,m.useTransition)(et,F,P,{start:X,end:ee}),er=(0,f.compact)({ref:A,className:(null==(l=(0,x.classNames)(R.className,Q&&C,Q&&T,es.enter&&C,es.enter&&es.closed&&T,es.enter&&!es.closed&&k,es.leave&&E,es.leave&&!es.closed&&U,es.leave&&es.closed&&B,!es.transition&&P&&I))?void 0:l.trim())||void 0,...(0,m.transitionDataAttributes)(es)}),el=0;"visible"===$&&(el|=h.State.Open),"hidden"===$&&(el|=h.State.Closed),es.enter&&(el|=h.State.Opening),es.leave&&(el|=h.State.Closing);let ea=(0,f.useRender)();return r.default.createElement(y.Provider,{value:Y},r.default.createElement(h.OpenClosedProvider,{value:el},ea({ourProps:er,theirProps:R,defaultTag:N,features:S,visible:"visible"===$,name:"Transition.Child"})))}),T=(0,f.forwardRefWithAs)(function(e,t){let s=null!==(0,r.useContext)(b),l=null!==(0,h.useOpenClosed)();return r.default.createElement(r.default.Fragment,null,!s&&l?r.default.createElement(w,{ref:t,...e}):r.default.createElement(C,{ref:t,...e}))}),k=Object.assign(w,{Child:T,Root:w});e.s(["Transition",()=>k],854056)},206929,e=>{"use strict";var t=e.i(290571),s=e.i(757440),r=e.i(271645),l=e.i(446428),a=e.i(444755),n=e.i(673706),i=e.i(103471),o=e.i(495470),d=e.i(854056),c=e.i(888288);let u=(0,n.makeClassName)("Select"),m=r.default.forwardRef((e,n)=>{let{defaultValue:m="",value:h,onValueChange:x,placeholder:g="Select...",disabled:f=!1,icon:p,enableClear:b=!1,required:j,children:y,name:v,error:_=!1,errorMessage:N,className:S,id:w}=e,C=(0,t.__rest)(e,["defaultValue","value","onValueChange","placeholder","disabled","icon","enableClear","required","children","name","error","errorMessage","className","id"]),T=(0,r.useRef)(null),k=r.Children.toArray(y),[I,E]=(0,c.default)(m,h),U=(0,r.useMemo)(()=>{let e=r.default.Children.toArray(y).filter(r.isValidElement);return(0,i.constructValueToNameMapping)(e)},[y]);return r.default.createElement("div",{className:(0,a.tremorTwMerge)("w-full min-w-[10rem] text-tremor-default",S)},r.default.createElement("div",{className:"relative"},r.default.createElement("select",{title:"select-hidden",required:j,className:(0,a.tremorTwMerge)("h-full w-full absolute left-0 top-0 -z-10 opacity-0"),value:I,onChange:e=>{e.preventDefault()},name:v,disabled:f,id:w,onFocus:()=>{let e=T.current;e&&e.focus()}},r.default.createElement("option",{className:"hidden",value:"",disabled:!0,hidden:!0},g),k.map(e=>{let t=e.props.value,s=e.props.children;return r.default.createElement("option",{className:"hidden",key:t,value:t},s)})),r.default.createElement(o.Listbox,Object.assign({as:"div",ref:n,defaultValue:I,value:I,onChange:e=>{null==x||x(e),E(e)},disabled:f,id:w},C),({value:e})=>{var t;return r.default.createElement(r.default.Fragment,null,r.default.createElement(o.ListboxButton,{ref:T,className:(0,a.tremorTwMerge)("w-full outline-none text-left whitespace-nowrap truncate rounded-tremor-default focus:ring-2 transition duration-100 border pr-8 py-2","border-tremor-border shadow-tremor-input focus:border-tremor-brand-subtle focus:ring-tremor-brand-muted","dark:border-dark-tremor-border dark:shadow-dark-tremor-input dark:focus:border-dark-tremor-brand-subtle dark:focus:ring-dark-tremor-brand-muted",p?"pl-10":"pl-3",(0,i.getSelectButtonColors)((0,i.hasValue)(e),f,_))},p&&r.default.createElement("span",{className:(0,a.tremorTwMerge)("absolute inset-y-0 left-0 flex items-center ml-px pl-2.5")},r.default.createElement(p,{className:(0,a.tremorTwMerge)(u("Icon"),"flex-none h-5 w-5","text-tremor-content-subtle","dark:text-dark-tremor-content-subtle")})),r.default.createElement("span",{className:"w-[90%] block truncate"},e&&null!=(t=U.get(e))?t:g),r.default.createElement("span",{className:(0,a.tremorTwMerge)("absolute inset-y-0 right-0 flex items-center mr-3")},r.default.createElement(s.default,{className:(0,a.tremorTwMerge)(u("arrowDownIcon"),"flex-none h-5 w-5","text-tremor-content-subtle","dark:text-dark-tremor-content-subtle")}))),b&&I?r.default.createElement("button",{type:"button",className:(0,a.tremorTwMerge)("absolute inset-y-0 right-0 flex items-center mr-8"),onClick:e=>{e.preventDefault(),E(""),null==x||x("")}},r.default.createElement(l.default,{className:(0,a.tremorTwMerge)(u("clearIcon"),"flex-none h-4 w-4","text-tremor-content-subtle","dark:text-dark-tremor-content-subtle")})):null,r.default.createElement(d.Transition,{enter:"transition ease duration-100 transform",enterFrom:"opacity-0 -translate-y-4",enterTo:"opacity-100 translate-y-0",leave:"transition ease duration-100 transform",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 -translate-y-4"},r.default.createElement(o.ListboxOptions,{anchor:"bottom start",className:(0,a.tremorTwMerge)("z-10 w-[var(--button-width)] divide-y overflow-y-auto outline-none rounded-tremor-default max-h-[228px]  border [--anchor-gap:4px]","bg-tremor-background border-tremor-border divide-tremor-border shadow-tremor-dropdown","dark:bg-dark-tremor-background dark:border-dark-tremor-border dark:divide-dark-tremor-border dark:shadow-dark-tremor-dropdown")},y)))})),_&&N?r.default.createElement("p",{className:(0,a.tremorTwMerge)("errorMessage","text-sm text-rose-500 mt-1")},N):null)});m.displayName="Select",e.s(["Select",()=>m],206929)},502275,e=>{"use strict";var t=e.i(271645);let s=t.forwardRef(function(e,s){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:s},e),t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}))});e.s(["InformationCircleIcon",0,s],502275)},78085,e=>{"use strict";var t=e.i(290571),s=e.i(103471),r=e.i(888288),l=e.i(271645),a=e.i(444755),n=e.i(673706);let i=(0,n.makeClassName)("Textarea"),o=l.default.forwardRef((e,o)=>{let{value:d,defaultValue:c="",placeholder:u="Type...",error:m=!1,errorMessage:h,disabled:x=!1,className:g,onChange:f,onValueChange:p,autoHeight:b=!1}=e,j=(0,t.__rest)(e,["value","defaultValue","placeholder","error","errorMessage","disabled","className","onChange","onValueChange","autoHeight"]),[y,v]=(0,r.default)(c,d),_=(0,l.useRef)(null),N=(0,s.hasValue)(y);return(0,l.useEffect)(()=>{let e=_.current;if(b&&e){e.style.height="60px";let t=e.scrollHeight;e.style.height=t+"px"}},[b,_,y]),l.default.createElement(l.default.Fragment,null,l.default.createElement("textarea",Object.assign({ref:(0,n.mergeRefs)([_,o]),value:y,placeholder:u,disabled:x,className:(0,a.tremorTwMerge)(i("Textarea"),"w-full flex items-center outline-none rounded-tremor-default px-3 py-2 text-tremor-default focus:ring-2 transition duration-100 border","shadow-tremor-input focus:border-tremor-brand-subtle focus:ring-tremor-brand-muted","dark:shadow-dark-tremor-input focus:dark:border-dark-tremor-brand-subtle focus:dark:ring-dark-tremor-brand-muted",(0,s.getSelectButtonColors)(N,x,m),x?"placeholder:text-tremor-content-subtle dark:placeholder:text-dark-tremor-content-subtle":"placeholder:text-tremor-content dark:placeholder:text-dark-tremor-content",g),"data-testid":"text-area",onChange:e=>{null==f||f(e),v(e.target.value),null==p||p(e.target.value)}},j)),m&&h?l.default.createElement("p",{className:(0,a.tremorTwMerge)(i("errorMessage"),"text-sm text-red-500 mt-1")},h):null)});o.displayName="Textarea",e.s(["Textarea",()=>o],78085)},152473,e=>{"use strict";var t=e.i(271645);let s={enabled:!0,leading:!1,trailing:!0,wait:0,onExecute:()=>{}};class r{constructor(e,t){this.fn=e,this._canLeadingExecute=!0,this._isPending=!1,this._executionCount=0,this._options={...s,...t}}setOptions(e){return this._options={...this._options,...e},this._options.enabled||(this._isPending=!1),this._options}getOptions(){return this._options}maybeExecute(...e){this._options.leading&&this._canLeadingExecute&&(this.executeFunction(...e),this._canLeadingExecute=!1),(this._options.leading||this._options.trailing)&&(this._isPending=!0),this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=setTimeout(()=>{this._canLeadingExecute=!0,this._isPending=!1,this._options.trailing&&this.executeFunction(...e)},this._options.wait)}executeFunction(...e){this._options.enabled&&(this.fn(...e),this._executionCount++,this._options.onExecute(this))}cancel(){this._timeoutId&&(clearTimeout(this._timeoutId),this._canLeadingExecute=!0,this._isPending=!1)}getExecutionCount(){return this._executionCount}getIsPending(){return this._options.enabled&&this._isPending}}function l(e,s){let[l,a]=(0,t.useState)(e),n=function(e,s){let[l]=(0,t.useState)(()=>{var t;return Object.getOwnPropertyNames(Object.getPrototypeOf(t=new r(e,s))).filter(e=>"function"==typeof t[e]).reduce((e,s)=>{let r=t[s];return"function"==typeof r&&(e[s]=r.bind(t)),e},{})});return l.setOptions(s),l}(a,s);return[l,n.maybeExecute,n]}e.s(["useDebouncedState",()=>l],152473)},910119,e=>{"use strict";var t=e.i(843476),s=e.i(197647),r=e.i(653824),l=e.i(881073),a=e.i(404206),n=e.i(723731),i=e.i(271645),o=e.i(994388),d=e.i(212931),c=e.i(898586),u=e.i(312361),m=e.i(998573),h=e.i(291542),x=e.i(199133),g=e.i(28651),f=e.i(175712),p=e.i(770914),b=e.i(536916),j=e.i(764205),y=e.i(827252),v=e.i(35983),_=e.i(779241),N=e.i(78085),S=e.i(808613),w=e.i(592968),C=e.i(708347),T=e.i(860585),k=e.i(355619),I=e.i(435451);function E({userData:e,onCancel:s,onSubmit:r,teams:l,accessToken:a,userID:n,userRole:d,userModels:c,possibleUIRoles:u,isBulkEdit:m=!1}){let[h]=S.Form.useForm(),[g,f]=(0,i.useState)(!1);return i.default.useEffect(()=>{let t=e.user_info?.max_budget,s=null==t;f(s),h.setFieldsValue({user_id:e.user_id,user_email:e.user_info?.user_email,user_alias:e.user_info?.user_alias,user_role:e.user_info?.user_role,models:e.user_info?.models||[],max_budget:s?"":t,budget_duration:e.user_info?.budget_duration,metadata:e.user_info?.metadata?JSON.stringify(e.user_info.metadata,null,2):void 0})},[e,h]),(0,t.jsxs)(S.Form,{form:h,onFinish:e=>{if(e.metadata&&"string"==typeof e.metadata)try{e.metadata=JSON.parse(e.metadata)}catch(e){console.error("Error parsing metadata JSON:",e);return}(g||""===e.max_budget||void 0===e.max_budget)&&(e.max_budget=null),r(e)},layout:"vertical",children:[!m&&(0,t.jsx)(S.Form.Item,{label:"User ID",name:"user_id",children:(0,t.jsx)(_.TextInput,{disabled:!0})}),!m&&(0,t.jsx)(S.Form.Item,{label:"Email",name:"user_email",children:(0,t.jsx)(_.TextInput,{})}),(0,t.jsx)(S.Form.Item,{label:"User Alias",name:"user_alias",children:(0,t.jsx)(_.TextInput,{})}),(0,t.jsx)(S.Form.Item,{label:(0,t.jsxs)("span",{children:["Global Proxy Role"," ",(0,t.jsx)(w.Tooltip,{title:"This is the role that the user will globally on the proxy. This role is independent of any team/org specific roles.",children:(0,t.jsx)(y.InfoCircleOutlined,{})})]}),name:"user_role",children:(0,t.jsx)(x.Select,{children:u&&Object.entries(u).map(([e,{ui_label:s,description:r}])=>(0,t.jsx)(v.SelectItem,{value:e,title:s,children:(0,t.jsxs)("div",{className:"flex",children:[s," ",(0,t.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:r})]})},e))})}),(0,t.jsx)(S.Form.Item,{label:(0,t.jsxs)("span",{children:["Personal Models"," ",(0,t.jsx)(w.Tooltip,{title:"Select which models this user can access outside of team-scope. Choose 'All Proxy Models' to grant access to all models available on the proxy.",children:(0,t.jsx)(y.InfoCircleOutlined,{style:{marginLeft:"4px"}})})]}),name:"models",children:(0,t.jsxs)(x.Select,{mode:"multiple",placeholder:"Select models",style:{width:"100%"},disabled:!C.all_admin_roles.includes(d||""),children:[(0,t.jsx)(x.Select.Option,{value:"all-proxy-models",children:"All Proxy Models"},"all-proxy-models"),(0,t.jsx)(x.Select.Option,{value:"no-default-models",children:"No Default Models"},"no-default-models"),c.map(e=>(0,t.jsx)(x.Select.Option,{value:e,children:(0,k.getModelDisplayName)(e)},e))]})}),(0,t.jsx)(S.Form.Item,{label:(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,t.jsx)("span",{children:"Max Budget (USD)"}),(0,t.jsx)(b.Checkbox,{checked:g,onChange:e=>{let t=e.target.checked;f(t),t&&h.setFieldsValue({max_budget:""})},children:"Unlimited Budget"})]}),name:"max_budget",rules:[{validator:(e,t)=>g||""!==t&&null!=t?Promise.resolve():Promise.reject(Error("Please enter a budget or select Unlimited Budget"))}],children:(0,t.jsx)(I.default,{step:.01,precision:2,style:{width:"100%"},disabled:g})}),(0,t.jsx)(S.Form.Item,{label:"Reset Budget",name:"budget_duration",children:(0,t.jsx)(T.default,{})}),(0,t.jsx)(S.Form.Item,{label:"Metadata",name:"metadata",children:(0,t.jsx)(N.Textarea,{rows:4,placeholder:"Enter metadata as JSON"})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(o.Button,{variant:"secondary",type:"button",onClick:s,children:"Cancel"}),(0,t.jsx)(o.Button,{type:"submit",children:"Save Changes"})]})]})}var U=e.i(727749);let{Text:B,Title:R}=c.Typography,F=({open:e,onCancel:s,selectedUsers:r,possibleUIRoles:l,accessToken:a,onSuccess:n,teams:o,userRole:c,userModels:y,allowAllUsers:v=!1})=>{let[_,N]=(0,i.useState)(!1),[S,w]=(0,i.useState)([]),[C,T]=(0,i.useState)(null),[k,I]=(0,i.useState)(!1),[F,L]=(0,i.useState)(!1),M=()=>{w([]),T(null),I(!1),L(!1),s()},D=i.default.useMemo(()=>({user_id:"bulk_edit",user_info:{user_email:"",user_role:"",teams:[],models:[],max_budget:null,spend:0,metadata:{},created_at:null,updated_at:null},keys:[],teams:o||[]}),[o,e]),A=async e=>{if(console.log("formValues",e),!a)return void U.default.fromBackend("Access token not found");N(!0);try{let t=r.map(e=>e.user_id),l={};e.user_role&&""!==e.user_role&&(l.user_role=e.user_role),null!==e.max_budget&&void 0!==e.max_budget&&(l.max_budget=e.max_budget),e.models&&e.models.length>0&&(l.models=e.models),e.budget_duration&&""!==e.budget_duration&&(l.budget_duration=e.budget_duration),e.metadata&&Object.keys(e.metadata).length>0&&(l.metadata=e.metadata);let i=Object.keys(l).length>0,o=k&&S.length>0;if(!i&&!o)return void U.default.fromBackend("Please modify at least one field or select teams to add users to");let d=[];if(i)if(F){let e=await (0,j.userBulkUpdateUserCall)(a,l,void 0,!0);d.push(`Updated all users (${e.total_requested} total)`)}else await (0,j.userBulkUpdateUserCall)(a,l,t),d.push(`Updated ${t.length} user(s)`);if(o){let e=[];for(let t of S)try{let s=null;s=F?null:r.map(e=>({user_id:e.user_id,role:"user",user_email:e.user_email||null}));let l=await (0,j.teamBulkMemberAddCall)(a,t,s||null,C||void 0,F);console.log("result",l),e.push({teamId:t,success:!0,successfulAdditions:l.successful_additions,failedAdditions:l.failed_additions})}catch(s){console.error(`Failed to add users to team ${t}:`,s),e.push({teamId:t,success:!1,error:s})}let t=e.filter(e=>e.success),s=e.filter(e=>!e.success);if(t.length>0){let e=t.reduce((e,t)=>e+t.successfulAdditions,0);d.push(`Added users to ${t.length} team(s) (${e} total additions)`)}s.length>0&&m.message.warning(`Failed to add users to ${s.length} team(s)`)}d.length>0&&U.default.success(d.join(". ")),w([]),T(null),I(!1),L(!1),n(),s()}catch(e){console.error("Bulk operation failed:",e),U.default.fromBackend("Failed to perform bulk operations")}finally{N(!1)}};return(0,t.jsxs)(d.Modal,{open:e,onCancel:M,footer:null,title:F?"Bulk Edit All Users":`Bulk Edit ${r.length} User(s)`,width:800,children:[v&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)(b.Checkbox,{checked:F,onChange:e=>L(e.target.checked),children:(0,t.jsx)(B,{strong:!0,children:"Update ALL users in the system"})}),F&&(0,t.jsx)("div",{style:{marginTop:8},children:(0,t.jsx)(B,{type:"warning",style:{fontSize:"12px"},children:"⚠️ This will apply changes to ALL users in the system, not just the selected ones."})})]}),!F&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)(R,{level:5,children:["Selected Users (",r.length,"):"]}),(0,t.jsx)(h.Table,{size:"small",bordered:!0,dataSource:r,pagination:!1,scroll:{y:200},rowKey:"user_id",columns:[{title:"User ID",dataIndex:"user_id",key:"user_id",width:"30%",render:e=>(0,t.jsx)(B,{strong:!0,style:{fontSize:"12px"},children:e.length>20?`${e.slice(0,20)}...`:e})},{title:"Email",dataIndex:"user_email",key:"user_email",width:"25%",render:e=>(0,t.jsx)(B,{type:"secondary",style:{fontSize:"12px"},children:e||"No email"})},{title:"Current Role",dataIndex:"user_role",key:"user_role",width:"25%",render:e=>(0,t.jsx)(B,{style:{fontSize:"12px"},children:l?.[e]?.ui_label||e})},{title:"Budget",dataIndex:"max_budget",key:"max_budget",width:"20%",render:e=>(0,t.jsx)(B,{style:{fontSize:"12px"},children:null!==e?`$${e}`:"Unlimited"})}]})]}),(0,t.jsx)(u.Divider,{}),(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)(B,{children:[(0,t.jsx)("strong",{children:"Instructions:"})," Fill in the fields below with the values you want to apply to all selected users. You can bulk edit: role, budget, models, and metadata. You can also add users to teams."]})}),(0,t.jsx)(f.Card,{title:"Team Management",size:"small",className:"mb-4",style:{backgroundColor:"#fafafa"},children:(0,t.jsxs)(p.Space,{direction:"vertical",style:{width:"100%"},children:[(0,t.jsx)(b.Checkbox,{checked:k,onChange:e=>I(e.target.checked),children:"Add selected users to teams"}),k&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(B,{strong:!0,children:"Select Teams:"}),(0,t.jsx)(x.Select,{mode:"multiple",placeholder:"Select teams to add users to",value:S,onChange:w,style:{width:"100%",marginTop:8},options:o?.map(e=>({label:e.team_alias||e.team_id,value:e.team_id}))||[]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(B,{strong:!0,children:"Team Budget (Optional):"}),(0,t.jsx)(g.InputNumber,{placeholder:"Max budget per user in team",value:C,onChange:e=>T(e),style:{width:"100%",marginTop:8},min:0,step:.01,precision:2}),(0,t.jsx)(B,{type:"secondary",style:{fontSize:"12px"},children:"Leave empty for unlimited budget within team limits"})]}),(0,t.jsx)(B,{type:"secondary",style:{fontSize:"12px"},children:'Users will be added with "user" role by default. All users will be added to each selected team.'})]})]})}),(0,t.jsx)(E,{userData:D,onCancel:M,onSubmit:A,teams:o,accessToken:a,userID:"bulk_edit",userRole:c,userModels:y,possibleUIRoles:l,isBulkEdit:!0}),_&&(0,t.jsx)("div",{style:{textAlign:"center",marginTop:"10px"},children:(0,t.jsxs)(B,{children:["Updating ",F?"all users":r.length," user(s)..."]})})]})};var L=e.i(371455),M=e.i(464571);let D=({visible:e,possibleUIRoles:s,onCancel:r,user:l,onSubmit:a})=>{let[n,o]=(0,i.useState)(l),[c]=S.Form.useForm();(0,i.useEffect)(()=>{c.resetFields()},[l]);let u=async()=>{c.resetFields(),r()},m=async e=>{a(e),c.resetFields(),r()};return l?(0,t.jsx)(d.Modal,{open:e,onCancel:u,footer:null,title:"Edit User "+l.user_id,width:1e3,children:(0,t.jsx)(S.Form,{form:c,onFinish:m,initialValues:l,labelCol:{span:8},wrapperCol:{span:16},labelAlign:"left",children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.Form.Item,{className:"mt-8",label:"User Email",tooltip:"Email of the User",name:"user_email",children:(0,t.jsx)(_.TextInput,{})}),(0,t.jsx)(S.Form.Item,{label:"user_id",name:"user_id",hidden:!0,children:(0,t.jsx)(_.TextInput,{})}),(0,t.jsx)(S.Form.Item,{label:"User Role",name:"user_role",children:(0,t.jsx)(x.Select,{children:s&&Object.entries(s).map(([e,{ui_label:s,description:r}])=>(0,t.jsx)(v.SelectItem,{value:e,title:s,children:(0,t.jsxs)("div",{className:"flex",children:[s," ",(0,t.jsx)("p",{className:"ml-2",style:{color:"gray",fontSize:"12px"},children:r})]})},e))})}),(0,t.jsx)(S.Form.Item,{label:"Spend (USD)",name:"spend",tooltip:"(float) - Spend of all LLM calls completed by this user",help:"Across all keys (including keys with team_id).",children:(0,t.jsx)(g.InputNumber,{min:0,step:.01})}),(0,t.jsx)(S.Form.Item,{label:"User Budget (USD)",name:"max_budget",tooltip:"(float) - Maximum budget of this user",help:"Maximum budget of this user.",children:(0,t.jsx)(I.default,{min:0,step:.01})}),(0,t.jsx)(S.Form.Item,{label:"Reset Budget",name:"budget_duration",children:(0,t.jsx)(T.default,{})}),(0,t.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,t.jsx)(M.Button,{htmlType:"submit",children:"Save"})}),(0,t.jsx)("div",{style:{textAlign:"right",marginTop:"10px"},children:(0,t.jsx)(M.Button,{htmlType:"submit",children:"Save"})})]})})}):null};var A=e.i(172372),O=e.i(500330),P=e.i(152473),z=e.i(266027),V=e.i(912598),$=e.i(127952),K=e.i(304967),q=e.i(629569),H=e.i(599724),W=e.i(114600),G=e.i(482725),J=e.i(790848),Q=e.i(646563),Z=e.i(955135);let Y=({accessToken:e,possibleUIRoles:s,userID:r,userRole:l})=>{let[a,n]=(0,i.useState)(!0),[d,u]=(0,i.useState)(null),[m,h]=(0,i.useState)(!1),[f,p]=(0,i.useState)({}),[b,y]=(0,i.useState)(!1),[v,N]=(0,i.useState)([]),{Paragraph:S}=c.Typography,{Option:w}=x.Select;(0,i.useEffect)(()=>{(async()=>{if(!e)return n(!1);try{let t=await (0,j.getInternalUserSettings)(e);if(u(t),p(t.values||{}),e)try{let t=await (0,j.modelAvailableCall)(e,r,l);if(t&&t.data){let e=t.data.map(e=>e.id);N(e)}}catch(e){console.error("Error fetching available models:",e)}}catch(e){console.error("Error fetching SSO settings:",e),U.default.fromBackend("Failed to fetch SSO settings")}finally{n(!1)}})()},[e]);let C=async()=>{if(e){y(!0);try{let t=Object.entries(f).reduce((e,[t,s])=>(e[t]=""===s?null:s,e),{}),s=await (0,j.updateInternalUserSettings)(e,t);u({...d,values:s.settings}),h(!1)}catch(e){console.error("Error updating SSO settings:",e),U.default.fromBackend("Failed to update settings: "+e)}finally{y(!1)}}},I=(e,t)=>{p(s=>({...s,[e]:t}))},E=e=>e&&Array.isArray(e)?e.map(e=>"string"==typeof e?{team_id:e,user_role:"user"}:"object"==typeof e&&e.team_id?{team_id:e.team_id,max_budget_in_team:e.max_budget_in_team,user_role:e.user_role||"user"}:{team_id:"",user_role:"user"}):[];return a?(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)(G.Spin,{size:"large"})}):d?(0,t.jsxs)(K.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(q.Title,{children:"Default User Settings"}),!a&&d&&(m?(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(o.Button,{variant:"secondary",onClick:()=>{h(!1),p(d.values||{})},disabled:b,children:"Cancel"}),(0,t.jsx)(o.Button,{onClick:C,loading:b,children:"Save Changes"})]}):(0,t.jsx)(o.Button,{onClick:()=>h(!0),children:"Edit Settings"}))]}),d?.field_schema?.description&&(0,t.jsx)(S,{className:"mb-4",children:d.field_schema.description}),(0,t.jsx)(W.Divider,{}),(0,t.jsx)("div",{className:"mt-4 space-y-4",children:(()=>{let{values:e,field_schema:r}=d;return r&&r.properties?Object.entries(r.properties).map(([r,l])=>{let a=e[r],n=r.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());return(0,t.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200 last:border-0",children:[(0,t.jsx)(H.Text,{className:"font-medium text-lg",children:n}),(0,t.jsx)(S,{className:"text-sm text-gray-500 mt-1",children:l.description||"No description available"}),m?(0,t.jsx)("div",{className:"mt-2",children:((e,r,l)=>{let a=r.type;if("teams"===e){let s,r;return(0,t.jsx)("div",{className:"mt-2",children:(s=E(f[e]||[]),r=(e,t,r)=>{let l=[...s];l[e]={...l[e],[t]:r},I("teams",l)},(0,t.jsxs)("div",{className:"space-y-3",children:[s.map((e,l)=>(0,t.jsxs)("div",{className:"border rounded-lg p-4 bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)(H.Text,{className:"font-medium",children:["Team ",l+1]}),(0,t.jsx)(o.Button,{size:"sm",variant:"secondary",icon:Z.DeleteOutlined,onClick:()=>{I("teams",s.filter((e,t)=>t!==l))},className:"text-red-500 hover:text-red-700",children:"Remove"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"text-sm font-medium mb-1",children:"Team ID"}),(0,t.jsx)(_.TextInput,{value:e.team_id,onChange:e=>r(l,"team_id",e.target.value),placeholder:"Enter team ID"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"text-sm font-medium mb-1",children:"Max Budget in Team"}),(0,t.jsx)(g.InputNumber,{style:{width:"100%"},value:e.max_budget_in_team,onChange:e=>r(l,"max_budget_in_team",e),placeholder:"Optional",min:0,step:.01,precision:2})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"text-sm font-medium mb-1",children:"User Role"}),(0,t.jsxs)(x.Select,{style:{width:"100%"},value:e.user_role,onChange:e=>r(l,"user_role",e),children:[(0,t.jsx)(w,{value:"user",children:"User"}),(0,t.jsx)(w,{value:"admin",children:"Admin"})]})]})]})]},l)),(0,t.jsx)(o.Button,{variant:"secondary",icon:Q.PlusOutlined,onClick:()=>{I("teams",[...s,{team_id:"",user_role:"user"}])},className:"w-full",children:"Add Team"})]}))})}if("user_role"===e&&s)return(0,t.jsx)(x.Select,{style:{width:"100%"},value:f[e]||"",onChange:t=>I(e,t),className:"mt-2",children:Object.entries(s).filter(([e])=>e.includes("internal_user")).map(([e,{ui_label:s,description:r}])=>(0,t.jsx)(w,{value:e,children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{children:s}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:r})]})},e))});if("budget_duration"===e)return(0,t.jsx)(T.default,{value:f[e]||null,onChange:t=>I(e,t),className:"mt-2"});if("boolean"===a)return(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(J.Switch,{checked:!!f[e],onChange:t=>I(e,t)})});if("array"===a&&r.items?.enum)return(0,t.jsx)(x.Select,{mode:"multiple",style:{width:"100%"},value:f[e]||[],onChange:t=>I(e,t),className:"mt-2",children:r.items.enum.map(e=>(0,t.jsx)(w,{value:e,children:e},e))});else if("models"===e)return(0,t.jsxs)(x.Select,{mode:"multiple",style:{width:"100%"},value:f[e]||[],onChange:t=>I(e,t),className:"mt-2",children:[(0,t.jsx)(w,{value:"no-default-models",children:"No Default Models"},"no-default-models"),(0,t.jsx)(w,{value:"all-proxy-models",children:"All Proxy Models"},"all-proxy-models"),v.map(e=>(0,t.jsx)(w,{value:e,children:(0,k.getModelDisplayName)(e)},e))]});else if("string"===a&&r.enum)return(0,t.jsx)(x.Select,{style:{width:"100%"},value:f[e]||"",onChange:t=>I(e,t),className:"mt-2",children:r.enum.map(e=>(0,t.jsx)(w,{value:e,children:e},e))});else return(0,t.jsx)(_.TextInput,{value:void 0!==f[e]?String(f[e]):"",onChange:t=>I(e,t.target.value),placeholder:r.description||"",className:"mt-2"})})(r,l,0)}):(0,t.jsx)("div",{className:"mt-1 p-2 bg-gray-50 rounded",children:((e,r)=>{if(null==r)return(0,t.jsx)("span",{className:"text-gray-400",children:"Not set"});if("teams"===e&&Array.isArray(r)){if(0===r.length)return(0,t.jsx)("span",{className:"text-gray-400",children:"No teams assigned"});let e=E(r);return(0,t.jsx)("div",{className:"space-y-2 mt-1",children:e.map((e,s)=>(0,t.jsx)("div",{className:"border rounded-lg p-3 bg-white",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Team ID:"}),(0,t.jsx)("p",{className:"text-gray-900",children:e.team_id||"Not specified"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Max Budget:"}),(0,t.jsx)("p",{className:"text-gray-900",children:void 0!==e.max_budget_in_team?`$${(0,O.formatNumberWithCommas)(e.max_budget_in_team,4)}`:"No limit"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-600",children:"Role:"}),(0,t.jsx)("p",{className:"text-gray-900 capitalize",children:e.user_role})]})]})},s))})}if("user_role"===e&&s&&s[r]){let{ui_label:e,description:l}=s[r];return(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:e}),l&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:l})]})}if("budget_duration"===e)return(0,t.jsx)("span",{children:(0,T.getBudgetDurationLabel)(r)});if("boolean"==typeof r)return(0,t.jsx)("span",{children:r?"Enabled":"Disabled"});if("models"===e&&Array.isArray(r))return 0===r.length?(0,t.jsx)("span",{className:"text-gray-400",children:"None"}):(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:r.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:(0,k.getModelDisplayName)(e)},s))});if("object"==typeof r)return Array.isArray(r)?0===r.length?(0,t.jsx)("span",{className:"text-gray-400",children:"None"}):(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:r.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:"object"==typeof e?JSON.stringify(e):String(e)},s))}):(0,t.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(r,null,2)});return(0,t.jsx)("span",{children:String(r)})})(r,a)})]},r)}):(0,t.jsx)(H.Text,{children:"No schema information available"})})()})]}):(0,t.jsx)(K.Card,{children:(0,t.jsx)(H.Text,{children:"No settings available or you do not have permission to view them."})})};var X=e.i(389083),ee=e.i(350967),et=e.i(752978),es=e.i(591935),er=e.i(68155),el=e.i(502275),ea=e.i(278587);let en=(e,s,r,l,a,n)=>{let i=[{header:"User ID",accessorKey:"user_id",enableSorting:!0,cell:({row:e})=>(0,t.jsx)(w.Tooltip,{title:e.original.user_id,children:(0,t.jsx)("span",{className:"text-xs",children:e.original.user_id?`${e.original.user_id.slice(0,7)}...`:"-"})})},{header:"Email",accessorKey:"user_email",enableSorting:!0,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:e.original.user_email||"-"})},{header:"Global Proxy Role",accessorKey:"user_role",enableSorting:!0,cell:({row:s})=>(0,t.jsx)("span",{className:"text-xs",children:e?.[s.original.user_role]?.ui_label||"-"})},{header:"User Alias",accessorKey:"user_alias",enableSorting:!1,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:e.original.user_alias||"-"})},{header:"Spend (USD)",accessorKey:"spend",enableSorting:!0,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:e.original.spend?(0,O.formatNumberWithCommas)(e.original.spend,4):"-"})},{header:"Budget (USD)",accessorKey:"max_budget",enableSorting:!1,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:null!==e.original.max_budget?e.original.max_budget:"Unlimited"})},{header:()=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:"SSO ID"}),(0,t.jsx)(w.Tooltip,{title:"SSO ID is the ID of the user in the SSO provider. If the user is not using SSO, this will be null.",children:(0,t.jsx)(el.InformationCircleIcon,{className:"w-4 h-4"})})]}),accessorKey:"sso_user_id",enableSorting:!1,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:null!==e.original.sso_user_id?e.original.sso_user_id:"-"})},{header:"Virtual Keys",accessorKey:"key_count",enableSorting:!1,cell:({row:e})=>(0,t.jsx)(ee.Grid,{numItems:2,children:e.original.key_count>0?(0,t.jsxs)(X.Badge,{size:"xs",color:"indigo",children:[e.original.key_count," ",1===e.original.key_count?"Key":"Keys"]}):(0,t.jsx)(X.Badge,{size:"xs",color:"gray",children:"No Keys"})})},{header:"Created At",accessorKey:"created_at",enableSorting:!0,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:e.original.created_at?new Date(e.original.created_at).toLocaleDateString():"-"})},{header:"Updated At",accessorKey:"updated_at",enableSorting:!1,cell:({row:e})=>(0,t.jsx)("span",{className:"text-xs",children:e.original.updated_at?new Date(e.original.updated_at).toLocaleDateString():"-"})},{id:"actions",header:"Actions",enableSorting:!1,cell:({row:e})=>(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(w.Tooltip,{title:"Edit user details",children:(0,t.jsx)(et.Icon,{icon:es.PencilAltIcon,size:"sm",onClick:()=>a(e.original.user_id,!0),className:"cursor-pointer hover:text-blue-600"})}),(0,t.jsx)(w.Tooltip,{title:"Delete user",children:(0,t.jsx)(et.Icon,{icon:er.TrashIcon,size:"sm",onClick:()=>r(e.original),className:"cursor-pointer hover:text-red-600"})}),(0,t.jsx)(w.Tooltip,{title:"Reset Password",children:(0,t.jsx)(et.Icon,{icon:ea.RefreshIcon,size:"sm",onClick:()=>l(e.original.user_id),className:"cursor-pointer hover:text-green-600"})})]})}];if(n){let{onSelectUser:e,onSelectAll:s,isUserSelected:r,isAllSelected:l,isIndeterminate:a}=n;return[{id:"select",enableSorting:!1,header:()=>(0,t.jsx)(b.Checkbox,{indeterminate:a,checked:l,onChange:e=>s(e.target.checked),onClick:e=>e.stopPropagation()}),cell:({row:s})=>(0,t.jsx)(b.Checkbox,{checked:r(s.original),onChange:t=>e(s.original,t.target.checked),onClick:e=>e.stopPropagation()})},...i]}return i};var ei=e.i(152990),eo=e.i(682830),ed=e.i(269200),ec=e.i(427612),eu=e.i(64848),em=e.i(942232),eh=e.i(496020),ex=e.i(977572),eg=e.i(206929),ef=e.i(94629),ep=e.i(360820),eb=e.i(871943),ej=e.i(981339),ey=e.i(530212),ev=e.i(118366),e_=e.i(678784);function eN({userId:e,onClose:d,accessToken:c,userRole:u,onDelete:m,possibleUIRoles:h,initialTab:x=0,startInEditMode:g=!1}){let[f,p]=(0,i.useState)(null),[b,y]=(0,i.useState)(!1),[v,_]=(0,i.useState)(!1),[N,S]=(0,i.useState)(!0),[w,k]=(0,i.useState)(g),[I,B]=(0,i.useState)([]),[R,F]=(0,i.useState)(!1),[L,D]=(0,i.useState)(null),[P,z]=(0,i.useState)(null),[V,W]=(0,i.useState)(x),[G,J]=(0,i.useState)({}),[Q,Z]=(0,i.useState)(!1);i.default.useEffect(()=>{z((0,j.getProxyBaseUrl)())},[]),i.default.useEffect(()=>{console.log(`userId: ${e}, userRole: ${u}, accessToken: ${c}`),(async()=>{try{if(!c)return;let t=await (0,j.userInfoCall)(c,e,u||"",!1,null,null,!0);p(t);let s=(await (0,j.modelAvailableCall)(c,e,u||"")).data.map(e=>e.id);B(s)}catch(e){console.error("Error fetching user data:",e),U.default.fromBackend("Failed to fetch user data")}finally{S(!1)}})()},[c,e,u]);let Y=async()=>{if(!c)return void U.default.fromBackend("Access token not found");try{U.default.success("Generating password reset link...");let t=await (0,j.invitationCreateCall)(c,e);D(t),F(!0)}catch(e){U.default.fromBackend("Failed to generate password reset link")}},et=async()=>{try{if(!c)return;_(!0),await (0,j.userDeleteCall)(c,[e]),U.default.success("User deleted successfully"),m&&m(),d()}catch(e){console.error("Error deleting user:",e),U.default.fromBackend("Failed to delete user")}finally{y(!1),_(!1)}},es=async e=>{try{if(!c||!f)return;await (0,j.userUpdateUserCall)(c,e,null),p({...f,user_info:{...f.user_info,user_email:e.user_email,user_alias:e.user_alias,models:e.models,max_budget:e.max_budget,budget_duration:e.budget_duration,metadata:e.metadata}}),U.default.success("User updated successfully"),k(!1)}catch(e){console.error("Error updating user:",e),U.default.fromBackend("Failed to update user")}};if(N)return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)(o.Button,{icon:ey.ArrowLeftIcon,variant:"light",onClick:d,className:"mb-4",children:"Back to Users"}),(0,t.jsx)(H.Text,{children:"Loading user data..."})]});if(!f)return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)(o.Button,{icon:ey.ArrowLeftIcon,variant:"light",onClick:d,className:"mb-4",children:"Back to Users"}),(0,t.jsx)(H.Text,{children:"User not found"})]});let el=async(e,t)=>{await (0,O.copyToClipboard)(e)&&(J(e=>({...e,[t]:!0})),setTimeout(()=>{J(e=>({...e,[t]:!1}))},2e3))};return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Button,{icon:ey.ArrowLeftIcon,variant:"light",onClick:d,className:"mb-4",children:"Back to Users"}),(0,t.jsx)(q.Title,{children:f.user_info?.user_email||"User"}),(0,t.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,t.jsx)(H.Text,{className:"text-gray-500 font-mono",children:f.user_id}),(0,t.jsx)(M.Button,{type:"text",size:"small",icon:G["user-id"]?(0,t.jsx)(e_.CheckIcon,{size:12}):(0,t.jsx)(ev.CopyIcon,{size:12}),onClick:()=>el(f.user_id,"user-id"),className:`left-2 z-10 transition-all duration-200 ${G["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),u&&C.rolesWithWriteAccess.includes(u)&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(o.Button,{icon:ea.RefreshIcon,variant:"secondary",onClick:Y,className:"flex items-center",children:"Reset Password"}),(0,t.jsx)(o.Button,{icon:er.TrashIcon,variant:"secondary",onClick:()=>y(!0),className:"flex items-center text-red-500 border-red-500 hover:text-red-600 hover:border-red-600",children:"Delete User"})]})]}),(0,t.jsx)($.default,{isOpen:b,title:"Delete User?",message:"Are you sure you want to delete this user? This action cannot be undone.",resourceInformationTitle:"User Information",resourceInformation:[{label:"Email",value:f.user_info?.user_email},{label:"User ID",value:f.user_id,code:!0},{label:"Global Proxy Role",value:f.user_info?.user_role&&h?.[f.user_info.user_role]?.ui_label||f.user_info?.user_role||"-"},{label:"Total Spend (USD)",value:f.user_info?.spend!==null&&f.user_info?.spend!==void 0?f.user_info.spend.toFixed(2):void 0}],onCancel:()=>{y(!1)},onOk:et,confirmLoading:v}),(0,t.jsxs)(r.TabGroup,{defaultIndex:V,onIndexChange:W,children:[(0,t.jsxs)(l.TabList,{className:"mb-4",children:[(0,t.jsx)(s.Tab,{children:"Overview"}),(0,t.jsx)(s.Tab,{children:"Details"})]}),(0,t.jsxs)(n.TabPanels,{children:[(0,t.jsx)(a.TabPanel,{children:(0,t.jsxs)(ee.Grid,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,t.jsxs)(K.Card,{children:[(0,t.jsx)(H.Text,{children:"Spend"}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsxs)(q.Title,{children:["$",(0,O.formatNumberWithCommas)(f.user_info?.spend||0,4)]}),(0,t.jsxs)(H.Text,{children:["of"," ",f.user_info?.max_budget!==null?`$${(0,O.formatNumberWithCommas)(f.user_info.max_budget,4)}`:"Unlimited"]})]})]}),(0,t.jsxs)(K.Card,{children:[(0,t.jsx)(H.Text,{children:"Teams"}),(0,t.jsx)("div",{className:"mt-2",children:f.teams?.length&&f.teams?.length>0?(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[f.teams?.slice(0,Q?f.teams.length:20).map((e,s)=>(0,t.jsx)(X.Badge,{color:"blue",title:e.team_alias,children:e.team_alias},s)),!Q&&f.teams?.length>20&&(0,t.jsxs)(X.Badge,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Z(!0),children:["+",f.teams.length-20," more"]}),Q&&f.teams?.length>20&&(0,t.jsx)(X.Badge,{color:"gray",className:"cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Z(!1),children:"Show Less"})]}):(0,t.jsx)(H.Text,{children:"No teams"})})]}),(0,t.jsxs)(K.Card,{children:[(0,t.jsx)(H.Text,{children:"Virtual Keys"}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsxs)(H.Text,{children:[f.keys?.length||0," ",f.keys?.length===1?"Key":"Keys"]})})]}),(0,t.jsxs)(K.Card,{children:[(0,t.jsx)(H.Text,{children:"Personal Models"}),(0,t.jsx)("div",{className:"mt-2",children:f.user_info?.models?.length&&f.user_info?.models?.length>0?f.user_info?.models?.map((e,s)=>(0,t.jsx)(H.Text,{children:e},s)):(0,t.jsx)(H.Text,{children:"All proxy models"})})]})]})}),(0,t.jsx)(a.TabPanel,{children:(0,t.jsxs)(K.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(q.Title,{children:"User Settings"}),!w&&u&&C.rolesWithWriteAccess.includes(u)&&(0,t.jsx)(o.Button,{onClick:()=>k(!0),children:"Edit Settings"})]}),w&&f?(0,t.jsx)(E,{userData:f,onCancel:()=>k(!1),onSubmit:es,teams:f.teams,accessToken:c,userID:e,userRole:u,userModels:I,possibleUIRoles:h}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"User ID"}),(0,t.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,t.jsx)(H.Text,{className:"font-mono",children:f.user_id}),(0,t.jsx)(M.Button,{type:"text",size:"small",icon:G["user-id"]?(0,t.jsx)(e_.CheckIcon,{size:12}):(0,t.jsx)(ev.CopyIcon,{size:12}),onClick:()=>el(f.user_id,"user-id"),className:`left-2 z-10 transition-all duration-200 ${G["user-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Email"}),(0,t.jsx)(H.Text,{children:f.user_info?.user_email||"Not Set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"User Alias"}),(0,t.jsx)(H.Text,{children:f.user_info?.user_alias||"Not Set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Global Proxy Role"}),(0,t.jsx)(H.Text,{children:f.user_info?.user_role||"Not Set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Created"}),(0,t.jsx)(H.Text,{children:f.user_info?.created_at?new Date(f.user_info.created_at).toLocaleString():"Unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Last Updated"}),(0,t.jsx)(H.Text,{children:f.user_info?.updated_at?new Date(f.user_info.updated_at).toLocaleString():"Unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Teams"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:f.teams?.length&&f.teams?.length>0?(0,t.jsxs)(t.Fragment,{children:[f.teams?.slice(0,Q?f.teams.length:20).map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",title:e.team_alias||e.team_id,children:e.team_alias||e.team_id},s)),!Q&&f.teams?.length>20&&(0,t.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Z(!0),children:["+",f.teams.length-20," more"]}),Q&&f.teams?.length>20&&(0,t.jsx)("span",{className:"px-2 py-1 bg-gray-100 rounded text-xs cursor-pointer hover:bg-gray-200 transition-colors",onClick:()=>Z(!1),children:"Show Less"})]}):(0,t.jsx)(H.Text,{children:"No teams"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Personal Models"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:f.user_info?.models?.length&&f.user_info?.models?.length>0?f.user_info?.models?.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-blue-100 rounded text-xs",children:e},s)):(0,t.jsx)(H.Text,{children:"All proxy models"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Virtual Keys"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-1",children:f.keys?.length&&f.keys?.length>0?f.keys.map((e,s)=>(0,t.jsx)("span",{className:"px-2 py-1 bg-green-100 rounded text-xs",children:e.key_alias||e.token},s)):(0,t.jsx)(H.Text,{children:"No Virtual Keys"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Max Budget"}),(0,t.jsx)(H.Text,{children:f.user_info?.max_budget!==null&&f.user_info?.max_budget!==void 0?`$${(0,O.formatNumberWithCommas)(f.user_info.max_budget,4)}`:"Unlimited"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Budget Reset"}),(0,t.jsx)(H.Text,{children:(0,T.getBudgetDurationLabel)(f.user_info?.budget_duration??null)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Text,{className:"font-medium",children:"Metadata"}),(0,t.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-auto mt-1",children:JSON.stringify(f.user_info?.metadata||{},null,2)})]})]})]})})]})]}),(0,t.jsx)(A.default,{isInvitationLinkModalVisible:R,setIsInvitationLinkModalVisible:F,baseUrl:P||"",invitationLinkData:L,modalType:"resetPassword"})]})}var eS=e.i(655913),ew=e.i(38419),eC=e.i(78334),eT=e.i(555436),ek=e.i(284614);let eI=(0,e.i(475254).default)("circle-user-round",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);function eE({data:e=[],columns:s,isLoading:r=!1,onSortChange:l,currentSort:a,accessToken:n,userRole:o,possibleUIRoles:d,handleEdit:c,handleDelete:u,handleResetPassword:m,selectedUsers:h=[],onSelectionChange:x,enableSelection:g=!1,filters:f,updateFilters:p,initialFilters:b,teams:j,userListResponse:y,currentPage:_,handlePageChange:N}){let[S,w]=i.default.useState([{id:a?.sortBy||"created_at",desc:a?.sortOrder==="desc"}]),[C,T]=i.default.useState(null),[k,I]=i.default.useState(!1),[E,U]=i.default.useState(!1),B=(e,t=!1)=>{T(e),I(t)},R=(e,t)=>{x&&(t?x([...h,e]):x(h.filter(t=>t.user_id!==e.user_id)))},F=t=>{x&&(t?x(e):x([]))},L=e=>h.some(t=>t.user_id===e.user_id),M=e.length>0&&h.length===e.length,D=h.length>0&&h.length<e.length,A=i.default.useMemo(()=>d?en(d,c,u,m,B,g?{selectedUsers:h,onSelectUser:R,onSelectAll:F,isUserSelected:L,isAllSelected:M,isIndeterminate:D}:void 0):s,[d,c,u,m,B,s,g,h,M,D]),O=(0,ei.useReactTable)({data:e,columns:A,state:{sorting:S},onSortingChange:e=>{let t="function"==typeof e?e(S):e;if(w(t),t&&Array.isArray(t)&&t.length>0&&t[0]){let e=t[0];if(e.id){let t=e.id,s=e.desc?"desc":"asc";l?.(t,s)}}else l?.("created_at","desc")},getCoreRowModel:(0,eo.getCoreRowModel)(),manualSorting:!0,enableSorting:!0});return(i.default.useEffect(()=>{a&&w([{id:a.sortBy,desc:"desc"===a.sortOrder}])},[a]),C)?(0,t.jsx)(eN,{userId:C,onClose:()=>{T(null),I(!1)},accessToken:n,userRole:o,possibleUIRoles:d,initialTab:+!!k,startInEditMode:k}):(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,t.jsx)("div",{className:"border-b px-6 py-4",children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsx)(eS.FilterInput,{placeholder:"Search by email...",value:f.email,onChange:e=>p({email:e}),icon:eT.Search}),(0,t.jsx)(ew.FiltersButton,{onClick:()=>U(!E),active:E,hasActiveFilters:!!(f.user_id||f.user_role||f.team)}),(0,t.jsx)(eC.ResetFiltersButton,{onClick:()=>{p(b)}})]}),E&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[(0,t.jsx)(eS.FilterInput,{placeholder:"Filter by User ID",value:f.user_id,onChange:e=>p({user_id:e}),icon:ek.User}),(0,t.jsx)(eS.FilterInput,{placeholder:"Filter by SSO ID",value:f.sso_user_id,onChange:e=>p({sso_user_id:e}),icon:eI}),(0,t.jsx)("div",{className:"w-64",children:(0,t.jsx)(eg.Select,{value:f.user_role,onValueChange:e=>p({user_role:e}),placeholder:"Select Role",children:d&&Object.entries(d).map(([e,s])=>(0,t.jsx)(v.SelectItem,{value:e,children:s.ui_label},e))})}),(0,t.jsx)("div",{className:"w-64",children:(0,t.jsx)(eg.Select,{value:f.team,onValueChange:e=>p({team:e}),placeholder:"Select Team",children:j?.map(e=>(0,t.jsx)(v.SelectItem,{value:e.team_id,children:e.team_alias||e.team_id},e.team_id))})})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[r?(0,t.jsx)(ej.Skeleton.Input,{active:!0,style:{width:192,height:20}}):(0,t.jsxs)("span",{className:"text-sm text-gray-700",children:["Showing"," ",y&&y.users&&y.users.length>0?(y.page-1)*y.page_size+1:0," ","-"," ",y&&y.users?Math.min(y.page*y.page_size,y.total):0," ","of ",y?y.total:0," results"]}),(0,t.jsx)("div",{className:"flex space-x-2",children:r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ej.Skeleton.Button,{active:!0,size:"small",style:{width:80,height:30}}),(0,t.jsx)(ej.Skeleton.Button,{active:!0,size:"small",style:{width:60,height:30}})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>N(_-1),disabled:1===_,className:`px-3 py-1 text-sm border rounded-md ${1===_?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Previous"}),(0,t.jsx)("button",{onClick:()=>N(_+1),disabled:!y||_>=y.total_pages,className:`px-3 py-1 text-sm border rounded-md ${!y||_>=y.total_pages?"bg-gray-100 text-gray-400 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Next"})]})})]})]})}),(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(ed.Table,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,t.jsx)(ec.TableHead,{children:O.getHeaderGroups().map(e=>(0,t.jsx)(eh.TableRow,{children:e.headers.map(e=>(0,t.jsx)(eu.TableHeaderCell,{className:`py-1 h-8 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""} ${e.column.getCanSort()?"cursor-pointer hover:bg-gray-50":""}`,onClick:e.column.getToggleSortingHandler(),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,ei.flexRender)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&e.column.getCanSort()&&(0,t.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,t.jsx)(ep.ChevronUpIcon,{className:"h-4 w-4 text-blue-500"}),desc:(0,t.jsx)(eb.ChevronDownIcon,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,t.jsx)(ef.SwitchVerticalIcon,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,t.jsx)(em.TableBody,{children:r?(0,t.jsx)(eh.TableRow,{children:(0,t.jsx)(ex.TableCell,{colSpan:A.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"🚅 Loading users..."})})})}):e.length>0?O.getRowModel().rows.map(e=>(0,t.jsx)(eh.TableRow,{className:"h-8",children:e.getVisibleCells().map(e=>(0,t.jsx)(ex.TableCell,{className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"actions"===e.column.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,onClick:()=>{"user_id"===e.column.id&&B(e.getValue(),!1)},style:{cursor:"user_id"===e.column.id?"pointer":"default",color:"user_id"===e.column.id?"#3b82f6":"inherit"},children:(0,ei.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,t.jsx)(eh.TableRow,{children:(0,t.jsx)(ex.TableCell,{colSpan:A.length,className:"h-8 text-center",children:(0,t.jsx)("div",{className:"text-center text-gray-500",children:(0,t.jsx)("p",{children:"No users found"})})})})})]})})})})]})}let{Text:eU,Title:eB}=c.Typography,eR={email:"",user_id:"",user_role:"",sso_user_id:"",team:"",model:"",min_spend:null,max_spend:null,sort_by:"created_at",sort_order:"desc"};e.s(["default",0,({accessToken:e,token:d,userRole:c,userID:u,teams:m})=>{let h=(0,V.useQueryClient)(),[x,g]=(0,i.useState)(1),[f,p]=(0,i.useState)(!1),[b,y]=(0,i.useState)(null),[v,_]=(0,i.useState)(!1),[N,S]=(0,i.useState)(!1),[w,T]=(0,i.useState)(null),[k,I]=(0,i.useState)("users"),[E,B]=(0,i.useState)(eR),[R,M,K]=(0,P.useDebouncedState)(E,{wait:300}),[q,H]=(0,i.useState)(!1),[W,G]=(0,i.useState)(null),[J,Q]=(0,i.useState)(null),[Z,X]=(0,i.useState)([]),[ee,et]=(0,i.useState)(!1),[es,er]=(0,i.useState)(!1),[el,ea]=(0,i.useState)([]),ei=e=>{T(e),_(!0)};(0,i.useEffect)(()=>()=>{K.cancel()},[K]),(0,i.useEffect)(()=>{Q((0,j.getProxyBaseUrl)())},[]),(0,i.useEffect)(()=>{(async()=>{try{if(!u||!c||!e)return;let t=(await (0,j.modelAvailableCall)(e,u,c)).data.map(e=>e.id);console.log("available_model_names:",t),ea(t)}catch(e){console.error("Error fetching user models:",e)}})()},[e,u,c]);let eo=e=>{B(t=>{let s={...t,...e};return M(s),s})},ed=async t=>{if(!e)return void U.default.fromBackend("Access token not found");try{U.default.success("Generating password reset link...");let s=await (0,j.invitationCreateCall)(e,t);G(s),H(!0)}catch(e){U.default.fromBackend("Failed to generate password reset link")}},ec=async()=>{if(w&&e)try{S(!0),await (0,j.userDeleteCall)(e,[w.user_id]),h.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let t=e.users.filter(e=>e.user_id!==w.user_id);return{...e,users:t}}),U.default.success("User deleted successfully")}catch(e){console.error("Error deleting user:",e),U.default.fromBackend("Failed to delete user")}finally{_(!1),T(null),S(!1)}},eu=async()=>{y(null),p(!1)},em=async t=>{if(console.log("inside handleEditSubmit:",t),e&&d&&c&&u){try{let s=await (0,j.userUpdateUserCall)(e,t,null);h.setQueriesData({queryKey:["userList"]},e=>{if(void 0===e)return e;let t=e.users.map(e=>e.user_id===s.data.user_id?(0,O.updateExistingKeys)(e,s.data):e);return{...e,users:t}}),U.default.success(`User ${t.user_id} updated successfully`)}catch(e){console.error("There was an error updating the user",e)}y(null),p(!1)}},eh=async e=>{g(e)},ex=(0,z.useQuery)({queryKey:["userList",{debouncedFilter:R,currentPage:x}],queryFn:async()=>{if(!e)throw Error("Access token required");return await (0,j.userListCall)(e,R.user_id?[R.user_id]:null,x,25,R.email||null,R.user_role||null,R.team||null,R.sso_user_id||null,R.sort_by,R.sort_order)},enabled:!!(e&&d&&c&&u),placeholderData:e=>e}),eg=ex.data,ef=(0,z.useQuery)({queryKey:["userRoles"],initialData:()=>({}),queryFn:async()=>{if(!e)throw Error("Access token required");return await (0,j.getPossibleUserRoles)(e)},enabled:!!(e&&d&&c&&u)}).data,ep=en(ef,e=>{y(e),p(!0)},ei,ed,()=>{});return(0,t.jsxs)("div",{className:"w-full p-8 overflow-hidden",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsx)("div",{className:"flex space-x-3",children:ex.isLoading?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ej.Skeleton.Button,{active:!0,size:"default",shape:"default",style:{width:110,height:36}}),(0,t.jsx)(ej.Skeleton.Button,{active:!0,size:"default",shape:"default",style:{width:145,height:36}}),(0,t.jsx)(ej.Skeleton.Button,{active:!0,size:"default",shape:"default",style:{width:110,height:36}})]}):u&&e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.CreateUserButton,{userID:u,accessToken:e,teams:m,possibleUIRoles:ef}),(0,t.jsx)(o.Button,{onClick:()=>{er(!es),X([])},variant:es?"primary":"secondary",className:"flex items-center",children:es?"Cancel Selection":"Select Users"}),es&&(0,t.jsxs)(o.Button,{onClick:()=>{0===Z.length?U.default.fromBackend("Please select users to edit"):et(!0)},disabled:0===Z.length,className:"flex items-center",children:["Bulk Edit (",Z.length," selected)"]})]}):null})}),(0,t.jsxs)(r.TabGroup,{defaultIndex:0,onIndexChange:e=>I(0===e?"users":"settings"),children:[(0,t.jsxs)(l.TabList,{className:"mb-4",children:[(0,t.jsx)(s.Tab,{children:"Users"}),(0,t.jsx)(s.Tab,{children:"Default User Settings"})]}),(0,t.jsxs)(n.TabPanels,{children:[(0,t.jsx)(a.TabPanel,{children:(0,t.jsx)(eE,{data:ex.data?.users||[],columns:ep,isLoading:ex.isLoading,accessToken:e,userRole:c,onSortChange:(e,t)=>{eo({sort_by:e,sort_order:t})},currentSort:{sortBy:E.sort_by,sortOrder:E.sort_order},possibleUIRoles:ef,handleEdit:e=>{y(e),p(!0)},handleDelete:ei,handleResetPassword:ed,enableSelection:es,selectedUsers:Z,onSelectionChange:e=>{X(e)},filters:E,updateFilters:eo,initialFilters:eR,teams:m,userListResponse:eg,currentPage:x,handlePageChange:eh})}),(0,t.jsx)(a.TabPanel,{children:u&&c&&e?(0,t.jsx)(Y,{accessToken:e,possibleUIRoles:ef,userID:u,userRole:c}):(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)(ej.Skeleton,{active:!0,paragraph:{rows:4}})})})]})]}),(0,t.jsx)(D,{visible:f,possibleUIRoles:ef,onCancel:eu,user:b,onSubmit:em}),(0,t.jsx)($.default,{isOpen:v,title:"Delete User?",message:"Are you sure you want to delete this user? This action cannot be undone.",resourceInformationTitle:"User Information",resourceInformation:[{label:"Email",value:w?.user_email},{label:"User ID",value:w?.user_id,code:!0},{label:"Global Proxy Role",value:w&&ef?.[w.user_role]?.ui_label||w?.user_role||"-"},{label:"Total Spend (USD)",value:w?.spend?.toFixed(2)}],onCancel:()=>{_(!1),T(null)},onOk:ec,confirmLoading:N}),(0,t.jsx)(A.default,{isInvitationLinkModalVisible:q,setIsInvitationLinkModalVisible:H,baseUrl:J||"",invitationLinkData:W,modalType:"resetPassword"}),(0,t.jsx)(F,{open:ee,onCancel:()=>et(!1),selectedUsers:Z,possibleUIRoles:ef,accessToken:e,onSuccess:()=>{h.invalidateQueries({queryKey:["userList"]}),X([]),er(!1)},teams:m,userRole:c,userModels:el,allowAllUsers:!!c&&(0,C.isAdminRole)(c)})]})}],910119)}]);