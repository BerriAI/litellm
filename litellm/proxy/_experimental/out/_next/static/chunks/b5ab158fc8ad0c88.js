(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,891547,e=>{"use strict";var l=e.i(843476),t=e.i(271645),a=e.i(199133),s=e.i(764205);e.s(["default",0,({onChange:e,value:r,className:i,accessToken:n,disabled:o})=>{let[c,d]=(0,t.useState)([]),[u,g]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{(async()=>{if(n){g(!0);try{let e=await (0,s.getGuardrailsList)(n);console.log("Guardrails response:",e),e.guardrails&&(console.log("Guardrails data:",e.guardrails),d(e.guardrails))}catch(e){console.error("Error fetching guardrails:",e)}finally{g(!1)}}})()},[n]),(0,l.jsx)("div",{children:(0,l.jsx)(a.Select,{mode:"multiple",disabled:o,placeholder:o?"Setting guardrails is a premium feature.":"Select guardrails",onChange:l=>{console.log("Selected guardrails:",l),e(l)},value:r,loading:u,className:i,allowClear:!0,options:c.map(e=>(console.log("Mapping guardrail:",e),{label:`${e.guardrail_name}`,value:e.guardrail_name})),optionFilterProp:"label",showSearch:!0,style:{width:"100%"}})})}])},921511,e=>{"use strict";var l=e.i(843476),t=e.i(271645),a=e.i(199133),s=e.i(764205);e.s(["default",0,({onChange:e,value:r,className:i,accessToken:n,disabled:o})=>{let[c,d]=(0,t.useState)([]),[u,g]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{(async()=>{if(n){g(!0);try{let e=await (0,s.getPoliciesList)(n);console.log("Policies response:",e),e.policies&&(console.log("Policies data:",e.policies),d(e.policies))}catch(e){console.error("Error fetching policies:",e)}finally{g(!1)}}})()},[n]),(0,l.jsx)("div",{children:(0,l.jsx)(a.Select,{mode:"multiple",disabled:o,placeholder:o?"Setting policies is a premium feature.":"Select policies",onChange:l=>{console.log("Selected policies:",l),e(l)},value:r,loading:u,className:i,allowClear:!0,options:c.map(e=>(console.log("Mapping policy:",e),{label:`${e.policy_name}${e.description?` - ${e.description}`:""}`,value:e.policy_name})),optionFilterProp:"label",showSearch:!0,style:{width:"100%"}})})}])},439189,435684,96226,497245,e=>{"use strict";function l(e){let l=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===l?new e.constructor(+e):new Date("number"==typeof e||"[object Number]"===l||"string"==typeof e||"[object String]"===l?e:NaN)}function t(e,l){return e instanceof Date?new e.constructor(l):new Date(l)}function a(e,a){let s=l(e);return isNaN(a)?t(e,NaN):(a&&s.setDate(s.getDate()+a),s)}function s(e,a){let s=l(e);if(isNaN(a))return t(e,NaN);if(!a)return s;let r=s.getDate(),i=t(e,s.getTime());return(i.setMonth(s.getMonth()+a+1,0),r>=i.getDate())?i:(s.setFullYear(i.getFullYear(),i.getMonth(),r),s)}e.s(["toDate",()=>l],435684),e.s(["constructFrom",()=>t],96226),e.s(["addDays",()=>a],439189),e.s(["addMonths",()=>s],497245)},214541,e=>{"use strict";var l=e.i(271645),t=e.i(135214),a=e.i(270345);e.s(["default",0,()=>{let[e,s]=(0,l.useState)([]),{accessToken:r,userId:i,userRole:n}=(0,t.default)();return(0,l.useEffect)(()=>{(async()=>{s(await (0,a.fetchTeams)(r,i,n,null))})()},[r,i,n]),{teams:e,setTeams:s}}])},270345,e=>{"use strict";var l=e.i(764205);let t=async(e,t,a,s)=>"Admin"!=a&&"Admin Viewer"!=a?await (0,l.teamListCall)(e,s?.organization_id||null,t):await (0,l.teamListCall)(e,s?.organization_id||null);e.s(["fetchTeams",0,t])},860585,e=>{"use strict";var l=e.i(843476),t=e.i(199133);let{Option:a}=t.Select;e.s(["default",0,({value:e,onChange:s,className:r="",style:i={}})=>(0,l.jsxs)(t.Select,{style:{width:"100%",...i},value:e||void 0,onChange:s,className:r,placeholder:"n/a",allowClear:!0,children:[(0,l.jsx)(a,{value:"24h",children:"daily"}),(0,l.jsx)(a,{value:"7d",children:"weekly"}),(0,l.jsx)(a,{value:"30d",children:"monthly"})]}),"getBudgetDurationLabel",0,e=>e?({"24h":"daily","7d":"weekly","30d":"monthly"})[e]||e:"Not set"])},11751,643449,183588,e=>{"use strict";function l(e){return""===e?null:e}e.s(["mapEmptyStringToNull",()=>l],11751);var t=e.i(843476),a=e.i(599724),s=e.i(389083),r=e.i(810757),i=e.i(477386),n=e.i(557662);e.s(["default",0,function({loggingConfigs:e=[],disabledCallbacks:l=[],variant:o="card",className:c=""}){let d=(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r.CogIcon,{className:"h-4 w-4 text-blue-600"}),(0,t.jsx)(a.Text,{className:"font-semibold text-gray-900",children:"Logging Integrations"}),(0,t.jsx)(s.Badge,{color:"blue",size:"xs",children:e.length})]}),e.length>0?(0,t.jsx)("div",{className:"space-y-3",children:e.map((e,l)=>{var i;let o=(i=e.callback_name,Object.entries(n.callback_map).find(([e,l])=>l===i)?.[0]||i),c=n.callbackInfo[o]?.logo;return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-blue-50 border border-blue-200",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[c?(0,t.jsx)("img",{src:c,alt:o,className:"w-5 h-5 object-contain"}):(0,t.jsx)(r.CogIcon,{className:"h-5 w-5 text-gray-400"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(a.Text,{className:"font-medium text-blue-800",children:o}),(0,t.jsxs)(a.Text,{className:"text-xs text-blue-600",children:[Object.keys(e.callback_vars).length," parameters configured"]})]})]}),(0,t.jsx)(s.Badge,{color:(e=>{switch(e){case"success":return"green";case"failure":return"red";case"success_and_failure":return"blue";default:return"gray"}})(e.callback_type),size:"sm",children:(e=>{switch(e){case"success":return"Success Only";case"failure":return"Failure Only";case"success_and_failure":return"Success & Failure";default:return e}})(e.callback_type)})]},l)})}):(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-50 border border-gray-200",children:[(0,t.jsx)(r.CogIcon,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)(a.Text,{className:"text-gray-500 text-sm",children:"No logging integrations configured"})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i.BanIcon,{className:"h-4 w-4 text-red-600"}),(0,t.jsx)(a.Text,{className:"font-semibold text-gray-900",children:"Disabled Callbacks"}),(0,t.jsx)(s.Badge,{color:"red",size:"xs",children:l.length})]}),l.length>0?(0,t.jsx)("div",{className:"space-y-3",children:l.map((e,l)=>{let r=n.reverse_callback_map[e]||e,o=n.callbackInfo[r]?.logo;return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-red-50 border border-red-200",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[o?(0,t.jsx)("img",{src:o,alt:r,className:"w-5 h-5 object-contain"}):(0,t.jsx)(i.BanIcon,{className:"h-5 w-5 text-gray-400"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(a.Text,{className:"font-medium text-red-800",children:r}),(0,t.jsx)(a.Text,{className:"text-xs text-red-600",children:"Disabled for this key"})]})]}),(0,t.jsx)(s.Badge,{color:"red",size:"sm",children:"Disabled"})]},l)})}):(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-50 border border-gray-200",children:[(0,t.jsx)(i.BanIcon,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)(a.Text,{className:"text-gray-500 text-sm",children:"No callbacks disabled"})]})]})]});return"card"===o?(0,t.jsxs)("div",{className:`bg-white border border-gray-200 rounded-lg p-6 ${c}`,children:[(0,t.jsx)("div",{className:"flex items-center gap-2 mb-6",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(a.Text,{className:"font-semibold text-gray-900",children:"Logging Settings"}),(0,t.jsx)(a.Text,{className:"text-xs text-gray-500",children:"Active logging integrations and disabled callbacks for this key"})]})}),d]}):(0,t.jsxs)("div",{className:`${c}`,children:[(0,t.jsx)(a.Text,{className:"font-medium text-gray-900 mb-3",children:"Logging Settings"}),d]})}],643449);var o=e.i(266484);e.s(["default",0,({value:e,onChange:l,disabledCallbacks:a=[],onDisabledCallbacksChange:s})=>(0,t.jsx)(o.default,{value:e,onChange:l,disabledCallbacks:a,onDisabledCallbacksChange:s})],183588)},700514,e=>{"use strict";var l=e.i(271645);e.s(["defaultPageSize",0,25,"useBaseUrl",0,()=>{let[e,t]=(0,l.useState)("http://localhost:4000");return(0,l.useEffect)(()=>{{let{protocol:e,host:l}=window.location;t(`${e}//${l}`)}},[]),e}])},633627,969550,e=>{"use strict";var l=e.i(764205);let t=async e=>{if(!e)return[];try{let{aliases:t}=await (0,l.keyAliasesCall)(e);return Array.from(new Set((t||[]).filter(Boolean)))}catch(e){return console.error("Error fetching all key aliases:",e),[]}},a=async(e,t)=>{if(!e)return[];try{let a=[],s=1,r=!0;for(;r;){let i=await (0,l.teamListCall)(e,t||null,null);a=[...a,...i],s<i.total_pages?s++:r=!1}return a}catch(e){return console.error("Error fetching all teams:",e),[]}},s=async e=>{if(!e)return[];try{let t=[],a=1,s=!0;for(;s;){let r=await (0,l.organizationListCall)(e);t=[...t,...r],a<r.total_pages?a++:s=!1}return t}catch(e){return console.error("Error fetching all organizations:",e),[]}};e.s(["fetchAllKeyAliases",0,t,"fetchAllOrganizations",0,s,"fetchAllTeams",0,a],633627);var r=e.i(843476),i=e.i(271645);let n=i.forwardRef(function(e,l){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:l},e),i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"}))});var o=e.i(464571),c=e.i(311451),d=e.i(199133),u=e.i(374009);e.s(["default",0,({options:e,onApplyFilters:l,onResetFilters:t,initialValues:a={},buttonLabel:s="Filters"})=>{let[g,m]=(0,i.useState)(!1),[h,x]=(0,i.useState)(a),[f,y]=(0,i.useState)({}),[p,b]=(0,i.useState)({}),[w,j]=(0,i.useState)({}),[S,v]=(0,i.useState)({}),N=(0,i.useCallback)((0,u.default)(async(e,l)=>{if(l.isSearchable&&l.searchFn){b(e=>({...e,[l.name]:!0}));try{let t=await l.searchFn(e);y(e=>({...e,[l.name]:t}))}catch(e){console.error("Error searching:",e),y(e=>({...e,[l.name]:[]}))}finally{b(e=>({...e,[l.name]:!1}))}}},300),[]),_=(0,i.useCallback)(async e=>{if(e.isSearchable&&e.searchFn&&!S[e.name]){b(l=>({...l,[e.name]:!0})),v(l=>({...l,[e.name]:!0}));try{let l=await e.searchFn("");y(t=>({...t,[e.name]:l}))}catch(l){console.error("Error loading initial options:",l),y(l=>({...l,[e.name]:[]}))}finally{b(l=>({...l,[e.name]:!1}))}}},[S]);(0,i.useEffect)(()=>{g&&e.forEach(e=>{e.isSearchable&&!S[e.name]&&_(e)})},[g,e,_,S]);let k=(e,t)=>{let a={...h,[e]:t};x(a),l(a)};return(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,r.jsx)(o.Button,{icon:(0,r.jsx)(n,{className:"h-4 w-4"}),onClick:()=>m(!g),className:"flex items-center gap-2",children:s}),(0,r.jsx)(o.Button,{onClick:()=>{let l={};e.forEach(e=>{l[e.name]=""}),x(l),t()},children:"Reset Filters"})]}),g&&(0,r.jsx)("div",{className:"grid grid-cols-3 gap-x-6 gap-y-4 mb-6",children:["Team ID","Status","Organization ID","Key Alias","User ID","End User","Error Code","Error Message","Key Hash","Model"].map(l=>{let t,a=e.find(e=>e.label===l||e.name===l);return a?(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("label",{className:"text-sm text-gray-600",children:a.label||a.name}),a.isSearchable?(0,r.jsx)(d.Select,{showSearch:!0,className:"w-full",placeholder:`Search ${a.label||a.name}...`,value:h[a.name]||void 0,onChange:e=>k(a.name,e),onOpenChange:e=>{e&&a.isSearchable&&!S[a.name]&&_(a)},onSearch:e=>{j(l=>({...l,[a.name]:e})),a.searchFn&&N(e,a)},filterOption:!1,loading:p[a.name],options:f[a.name]||[],allowClear:!0,notFoundContent:p[a.name]?"Loading...":"No results found"}):a.options?(0,r.jsx)(d.Select,{className:"w-full",placeholder:`Select ${a.label||a.name}...`,value:h[a.name]||void 0,onChange:e=>k(a.name,e),allowClear:!0,children:a.options.map(e=>(0,r.jsx)(d.Select.Option,{value:e.value,children:e.label},e.value))}):a.customComponent?(t=a.customComponent,(0,r.jsx)(t,{value:h[a.name]||void 0,onChange:e=>k(a.name,e??""),placeholder:`Select ${a.label||a.name}...`})):(0,r.jsx)(c.Input,{className:"w-full",placeholder:`Enter ${a.label||a.name}...`,value:h[a.name]||"",onChange:e=>k(a.name,e.target.value),allowClear:!0})]},a.name):null})})]})}],969550)},584578,e=>{"use strict";var l=e.i(764205);let t=async(e,t,a,s,r)=>{let i;i="Admin"!=a&&"Admin Viewer"!=a?await (0,l.teamListCall)(e,s?.organization_id||null,t):await (0,l.teamListCall)(e,s?.organization_id||null),console.log(`givenTeams: ${i}`),r(i)};e.s(["fetchTeams",0,t])},693569,e=>{"use strict";var l=e.i(843476),t=e.i(268004),a=e.i(309426),s=e.i(350967),r=e.i(898586),i=e.i(947293),n=e.i(618566),o=e.i(271645),c=e.i(566606),d=e.i(584578),u=e.i(764205),g=e.i(702597),m=e.i(207082),h=e.i(500330),x=e.i(871943),f=e.i(502547),y=e.i(360820),p=e.i(94629),b=e.i(152990),w=e.i(682830),j=e.i(389083),S=e.i(994388),v=e.i(752978),N=e.i(269200),_=e.i(942232),k=e.i(977572),C=e.i(427612),z=e.i(64848),D=e.i(496020),I=e.i(599724),T=e.i(827252),A=e.i(282786),O=e.i(981339),E=e.i(592968),$=e.i(355619),K=e.i(266027),L=e.i(633627),R=e.i(374009),B=e.i(700514),M=e.i(135214),P=e.i(969550),U=e.i(20147);function V({teams:e,organizations:t,onSortChange:a,currentSort:s}){let[r,i]=(0,o.useState)(null),[n,c]=o.default.useState(()=>s?[{id:s.sortBy,desc:"desc"===s.sortOrder}]:[{id:"created_at",desc:!0}]),[d,g]=o.default.useState({pageIndex:0,pageSize:50}),V=n.length>0?n[0].id:null,F=n.length>0?n[0].desc?"desc":"asc":null,{data:J,isPending:H,isFetching:W,refetch:q}=(0,m.useKeys)(d.pageIndex+1,d.pageSize,{sortBy:V||void 0,sortOrder:F||void 0}),G=J?.total_count||0,[Y,Q]=(0,o.useState)({}),{filters:X,filteredKeys:Z,allKeyAliases:ee,allTeams:el,allOrganizations:et,handleFilterChange:ea,handleFilterReset:es}=function({keys:e,teams:l,organizations:t}){let a={"Team ID":"","Organization ID":"","Key Alias":"","User ID":"","Sort By":"created_at","Sort Order":"desc"},{accessToken:s}=(0,M.default)(),[r,i]=(0,o.useState)(a),[n,c]=(0,o.useState)(l||[]),[d,g]=(0,o.useState)(t||[]),[m,h]=(0,o.useState)(e),x=(0,o.useRef)(0),f=(0,o.useCallback)((0,R.default)(async e=>{if(!s)return;let l=Date.now();x.current=l;try{let t=await (0,u.keyListCall)(s,e["Organization ID"]||null,e["Team ID"]||null,e["Key Alias"]||null,e["User ID"]||null,e["Key Hash"]||null,1,B.defaultPageSize,e["Sort By"]||null,e["Sort Order"]||null);l===x.current&&t&&(h(t.keys),console.log("called from debouncedSearch filters:",JSON.stringify(e)),console.log("called from debouncedSearch data:",JSON.stringify(t)))}catch(e){console.error("Error searching users:",e)}},300),[s]);(0,o.useEffect)(()=>{if(!e)return void h([]);let l=[...e];r["Team ID"]&&(l=l.filter(e=>e.team_id===r["Team ID"])),r["Organization ID"]&&(l=l.filter(e=>e.organization_id===r["Organization ID"])),h(l)},[e,r]),(0,o.useEffect)(()=>{let e=async()=>{let e=await (0,L.fetchAllTeams)(s);e.length>0&&c(e);let l=await (0,L.fetchAllOrganizations)(s);l.length>0&&g(l)};s&&e()},[s]);let y=(0,K.useQuery)({queryKey:["allKeys"],queryFn:async()=>{if(!s)throw Error("Access token required");return await (0,L.fetchAllKeyAliases)(s)},enabled:!!s}).data||[];return(0,o.useEffect)(()=>{l&&l.length>0&&c(e=>e.length<l.length?l:e)},[l]),(0,o.useEffect)(()=>{t&&t.length>0&&g(e=>e.length<t.length?t:e)},[t]),{filters:r,filteredKeys:m,allKeyAliases:y,allTeams:n,allOrganizations:d,handleFilterChange:(e,l=!1)=>{i({"Team ID":e["Team ID"]||"","Organization ID":e["Organization ID"]||"","Key Alias":e["Key Alias"]||"","User ID":e["User ID"]||"","Sort By":e["Sort By"]||"created_at","Sort Order":e["Sort Order"]||"desc"}),l||f({...r,...e})},handleFilterReset:()=>{i(a),f(a)}}}({keys:J?.keys||[],teams:e,organizations:t});(0,o.useEffect)(()=>{if(q){let e=()=>{q()};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}},[q]);let er=(0,o.useMemo)(()=>[{id:"expander",header:()=>null,size:40,enableSorting:!1,cell:({row:e})=>e.getCanExpand()?(0,l.jsx)("button",{onClick:e.getToggleExpandedHandler(),style:{cursor:"pointer"},children:e.getIsExpanded()?"â–¼":"â–¶"}):null},{id:"token",accessorKey:"token",header:"Key ID",size:100,enableSorting:!0,cell:e=>{let t=e.getValue(),a=e.cell.column.getSize();return(0,l.jsx)(E.Tooltip,{title:t,children:(0,l.jsx)(S.Button,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate block",style:{maxWidth:a,overflow:"hidden"},onClick:()=>i(e.row.original),children:t??"-"})})}},{id:"key_alias",accessorKey:"key_alias",header:"Key Alias",size:150,enableSorting:!0,cell:e=>{let t=e.getValue(),a=e.cell.column.getSize();return(0,l.jsx)(E.Tooltip,{title:t,children:(0,l.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:a,overflow:"hidden"},children:t??"-"})})}},{id:"key_name",accessorKey:"key_name",header:"Secret Key",size:120,enableSorting:!1,cell:e=>(0,l.jsx)("span",{className:"font-mono text-xs",children:e.getValue()})},{id:"team_alias",accessorKey:"team_id",header:"Team Alias",size:120,enableSorting:!1,cell:({row:l,getValue:t})=>{let a=t(),s=e?.find(e=>e.team_id===a);return s?.team_alias||"Unknown"}},{id:"team_id",accessorKey:"team_id",header:"Team ID",size:80,enableSorting:!1,cell:e=>{let t=e.getValue(),a=e.cell.column.getSize();return(0,l.jsx)(E.Tooltip,{title:t,children:(0,l.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:a,overflow:"hidden"},children:t??"-"})})}},{id:"organization_id",accessorKey:"organization_id",header:"Organization ID",size:140,enableSorting:!1,cell:e=>e.getValue()?e.renderValue():"-"},{id:"user_email",accessorKey:"user",header:"User Email",size:160,enableSorting:!1,cell:e=>{let t=e.getValue(),a=t?.user_email,s=e.cell.column.getSize();return(0,l.jsx)(E.Tooltip,{title:a,children:(0,l.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:s,overflow:"hidden"},children:a??"-"})})}},{id:"user_id",accessorKey:"user_id",header:"User ID",size:70,enableSorting:!1,cell:e=>{let t=e.getValue(),a="default_user_id"===t?"Default Proxy Admin":t,s=e.cell.column.getSize();return(0,l.jsx)(E.Tooltip,{title:a,children:(0,l.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:s,overflow:"hidden"},children:a??"-"})})}},{id:"created_at",accessorKey:"created_at",header:"Created At",size:120,enableSorting:!0,cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleDateString():"-"}},{id:"created_by",accessorKey:"created_by",header:"Created By",size:70,enableSorting:!1,cell:e=>{let t=e.getValue(),a="default_user_id"===t?"Default Proxy Admin":t,s=e.cell.column.getSize();return(0,l.jsx)(E.Tooltip,{title:a,children:(0,l.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:s,overflow:"hidden"},children:a??"-"})})}},{id:"updated_at",accessorKey:"updated_at",header:"Updated At",size:120,enableSorting:!0,cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleDateString():"Never"}},{id:"last_active",accessorKey:"last_active",header:()=>(0,l.jsxs)("span",{className:"flex items-center gap-1",children:["Last Active",(0,l.jsx)(A.Popover,{content:"This is a new field and is not backfilled. Only new key usage will update this value.",trigger:"hover",children:(0,l.jsx)(T.InfoCircleOutlined,{className:"text-gray-400 text-xs cursor-help"})})]}),size:130,enableSorting:!1,cell:e=>{let t=e.getValue();if(!t)return"Unknown";let a=new Date(t);return(0,l.jsx)(E.Tooltip,{title:a.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"long"}),children:(0,l.jsx)("span",{children:a.toLocaleDateString()})})}},{id:"expires",accessorKey:"expires",header:"Expires",size:120,enableSorting:!1,cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleDateString():"Never"}},{id:"spend",accessorKey:"spend",header:"Spend (USD)",size:100,enableSorting:!0,cell:e=>(0,h.formatNumberWithCommas)(e.getValue(),4)},{id:"max_budget",accessorKey:"max_budget",header:"Budget (USD)",size:110,enableSorting:!0,cell:e=>{let l=e.getValue();return null===l?"Unlimited":`$${(0,h.formatNumberWithCommas)(l)}`}},{id:"budget_reset_at",accessorKey:"budget_reset_at",header:"Budget Reset",size:130,enableSorting:!1,cell:e=>{let l=e.getValue();return l?new Date(l).toLocaleString():"Never"}},{id:"models",accessorKey:"models",header:"Models",size:200,enableSorting:!1,cell:e=>{let t=e.getValue();return(0,l.jsx)("div",{className:"flex flex-col py-2",children:Array.isArray(t)?(0,l.jsx)("div",{className:"flex flex-col",children:0===t.length?(0,l.jsx)(j.Badge,{size:"xs",className:"mb-1",color:"red",children:(0,l.jsx)(I.Text,{children:"All Proxy Models"})}):(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"flex items-start",children:[t.length>3&&(0,l.jsx)("div",{children:(0,l.jsx)(v.Icon,{icon:Y[e.row.id]?x.ChevronDownIcon:f.ChevronRightIcon,className:"cursor-pointer",size:"xs",onClick:()=>{Q(l=>({...l,[e.row.id]:!l[e.row.id]}))}})}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-1",children:[t.slice(0,3).map((e,t)=>"all-proxy-models"===e?(0,l.jsx)(j.Badge,{size:"xs",color:"red",children:(0,l.jsx)(I.Text,{children:"All Proxy Models"})},t):(0,l.jsx)(j.Badge,{size:"xs",color:"blue",children:(0,l.jsx)(I.Text,{children:e.length>30?`${(0,$.getModelDisplayName)(e).slice(0,30)}...`:(0,$.getModelDisplayName)(e)})},t)),t.length>3&&!Y[e.row.id]&&(0,l.jsx)(j.Badge,{size:"xs",color:"gray",className:"cursor-pointer",children:(0,l.jsxs)(I.Text,{children:["+",t.length-3," ",t.length-3==1?"more model":"more models"]})}),Y[e.row.id]&&(0,l.jsx)("div",{className:"flex flex-wrap gap-1",children:t.slice(3).map((e,t)=>"all-proxy-models"===e?(0,l.jsx)(j.Badge,{size:"xs",color:"red",children:(0,l.jsx)(I.Text,{children:"All Proxy Models"})},t+3):(0,l.jsx)(j.Badge,{size:"xs",color:"blue",children:(0,l.jsx)(I.Text,{children:e.length>30?`${(0,$.getModelDisplayName)(e).slice(0,30)}...`:(0,$.getModelDisplayName)(e)})},t+3))})]})]})})}):null})}},{id:"rate_limits",header:"Rate Limits",size:140,enableSorting:!1,cell:({row:e})=>{let t=e.original;return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{children:["TPM: ",null!==t.tpm_limit?t.tpm_limit:"Unlimited"]}),(0,l.jsxs)("div",{children:["RPM: ",null!==t.rpm_limit?t.rpm_limit:"Unlimited"]})]})}}],[]),ei=[{name:"Team ID",label:"Team ID",isSearchable:!0,searchFn:async e=>el&&0!==el.length?el.filter(l=>l.team_id.toLowerCase().includes(e.toLowerCase())||l.team_alias&&l.team_alias.toLowerCase().includes(e.toLowerCase())).map(e=>({label:`${e.team_alias||e.team_id} (${e.team_id})`,value:e.team_id})):[]},{name:"Organization ID",label:"Organization ID",isSearchable:!0,searchFn:async e=>et&&0!==et.length?et.filter(l=>l.organization_id?.toLowerCase().includes(e.toLowerCase())??!1).filter(e=>null!==e.organization_id&&void 0!==e.organization_id).map(e=>({label:`${e.organization_id||"Unknown"} (${e.organization_id})`,value:e.organization_id})):[]},{name:"Key Alias",label:"Key Alias",isSearchable:!0,searchFn:async e=>ee.filter(l=>l.toLowerCase().includes(e.toLowerCase())).map(e=>({label:e,value:e}))},{name:"User ID",label:"User ID",isSearchable:!1},{name:"Key Hash",label:"Key Hash",isSearchable:!1}];console.log(`keys: ${JSON.stringify(J)}`);let en=(0,b.useReactTable)({data:Z,columns:er.filter(e=>"expander"!==e.id),columnResizeMode:"onChange",columnResizeDirection:"ltr",state:{sorting:n,pagination:d},onSortingChange:e=>{let l="function"==typeof e?e(n):e;if(console.log(`newSorting: ${JSON.stringify(l)}`),c(l),l&&l.length>0){let e=l[0],t=e.id,s=e.desc?"desc":"asc";console.log(`sortBy: ${t}, sortOrder: ${s}`),ea({...X,"Sort By":t,"Sort Order":s},!0),a?.(t,s)}},onPaginationChange:g,getCoreRowModel:(0,w.getCoreRowModel)(),getSortedRowModel:(0,w.getSortedRowModel)(),getPaginationRowModel:(0,w.getPaginationRowModel)(),enableSorting:!0,manualSorting:!1,manualPagination:!0,pageCount:Math.ceil(G/d.pageSize)});o.default.useEffect(()=>{s&&c([{id:s.sortBy,desc:"desc"===s.sortOrder}])},[s]);let{pageIndex:eo,pageSize:ec}=en.getState().pagination,ed=Math.min((eo+1)*ec,G),eu=`${eo*ec+1} - ${ed}`;return(0,l.jsx)("div",{className:"w-full h-full overflow-hidden",children:r?(0,l.jsx)(U.default,{keyId:r.token,onClose:()=>i(null),keyData:r,teams:el,onDelete:q}):(0,l.jsxs)("div",{className:"border-b py-4 flex-1 overflow-hidden",children:[(0,l.jsx)("div",{className:"w-full mb-6",children:(0,l.jsx)(P.default,{options:ei,onApplyFilters:ea,initialValues:X,onResetFilters:es})}),(0,l.jsxs)("div",{className:"flex items-center justify-between w-full mb-4",children:[H||W?(0,l.jsx)(O.Skeleton.Node,{active:!0,style:{width:200,height:20}}):(0,l.jsxs)("span",{className:"inline-flex text-sm text-gray-700",children:["Showing ",eu," of ",G," results"]}),(0,l.jsxs)("div",{className:"inline-flex items-center gap-2",children:[H||W?(0,l.jsx)(O.Skeleton.Node,{active:!0,style:{width:74,height:20}}):(0,l.jsxs)("span",{className:"text-sm text-gray-700",children:["Page ",eo+1," of ",en.getPageCount()]}),H||W?(0,l.jsx)(O.Skeleton.Button,{active:!0,size:"small",style:{width:84,height:30}}):(0,l.jsx)("button",{onClick:()=>en.previousPage(),disabled:H||W||!en.getCanPreviousPage(),className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),H||W?(0,l.jsx)(O.Skeleton.Button,{active:!0,size:"small",style:{width:58,height:30}}):(0,l.jsx)("button",{onClick:()=>en.nextPage(),disabled:H||W||!en.getCanNextPage(),className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]}),(0,l.jsx)("div",{className:"h-[75vh] overflow-auto",children:(0,l.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)(N.Table,{className:"[&_td]:py-0.5 [&_th]:py-1",style:{width:en.getCenterTotalSize()},children:[(0,l.jsx)(C.TableHead,{children:en.getHeaderGroups().map(e=>(0,l.jsx)(D.TableRow,{children:e.headers.map(e=>(0,l.jsx)(z.TableHeaderCell,{"data-header-id":e.id,className:`py-1 h-8 relative hover:bg-gray-50 ${"actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""}`,style:{width:e.getSize(),position:"relative",cursor:e.column.getCanSort()?"pointer":"default"},onMouseEnter:()=>{let l=document.querySelector(`[data-header-id="${e.id}"] .resizer`);l&&(l.style.opacity="0.5")},onMouseLeave:()=>{let l=document.querySelector(`[data-header-id="${e.id}"] .resizer`);l&&!e.column.getIsResizing()&&(l.style.opacity="0")},onClick:e.column.getCanSort()?e.column.getToggleSortingHandler():void 0,children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,b.flexRender)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&e.column.getCanSort()&&(0,l.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,l.jsx)(y.ChevronUpIcon,{className:"h-4 w-4 text-blue-500"}),desc:(0,l.jsx)(x.ChevronDownIcon,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,l.jsx)(p.SwitchVerticalIcon,{className:"h-4 w-4 text-gray-400"})}),(0,l.jsx)("div",{onDoubleClick:()=>e.column.resetSize(),onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler(),className:`resizer ${en.options.columnResizeDirection} ${e.column.getIsResizing()?"isResizing":""}`,style:{position:"absolute",right:0,top:0,height:"100%",width:"5px",background:e.column.getIsResizing()?"#3b82f6":"transparent",cursor:"col-resize",userSelect:"none",touchAction:"none",opacity:+!!e.column.getIsResizing()}})]})},e.id))},e.id))}),(0,l.jsx)(_.TableBody,{children:H||W?(0,l.jsx)(D.TableRow,{children:(0,l.jsx)(k.TableCell,{colSpan:er.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"ðŸš… Loading keys..."})})})}):Z.length>0?en.getRowModel().rows.map(e=>(0,l.jsx)(D.TableRow,{className:"h-8",children:e.getVisibleCells().map(e=>(0,l.jsx)(k.TableCell,{style:{width:e.column.getSize(),maxWidth:"8-x",whiteSpace:"pre-wrap",overflow:"hidden"},className:`py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ${"models"===e.column.id&&Array.isArray(e.getValue())&&e.getValue().length>3?"px-0":""}`,children:(0,b.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,l.jsx)(D.TableRow,{children:(0,l.jsx)(k.TableCell,{colSpan:er.length,className:"h-8 text-center",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:(0,l.jsx)("p",{children:"No keys found"})})})})})]})})})})]})})}e.s(["default",0,({userID:e,userRole:m,teams:h,keys:x,setUserRole:f,userEmail:y,setUserEmail:p,setTeams:b,setKeys:w,premiumUser:j,organizations:S,addKey:v,createClicked:N})=>{let _,[k,C]=(0,o.useState)(null),[z,D]=(0,o.useState)(null),I=(0,n.useSearchParams)(),T=(console.log("COOKIES",document.cookie),(_=document.cookie.split("; ").find(e=>e.startsWith("token=")))?_.split("=")[1]:null),A=I.get("invitation_id"),[O,E]=(0,o.useState)(null),[$,K]=(0,o.useState)(null),[L,R]=(0,o.useState)([]),[B,M]=(0,o.useState)(null),[P,U]=(0,o.useState)(null);if(window.addEventListener("beforeunload",function(){sessionStorage.clear()}),(0,o.useEffect)(()=>{if(T){let e=(0,i.jwtDecode)(T);if(e){if(console.log("Decoded token:",e),console.log("Decoded key:",e.key),E(e.key),e.user_role){let l=function(e){if(!e)return"Undefined Role";switch(console.log(`Received user role: ${e}`),e.toLowerCase()){case"app_owner":case"demo_app_owner":return"App Owner";case"app_admin":case"proxy_admin":return"Admin";case"proxy_admin_viewer":return"Admin Viewer";case"app_user":return"App User";case"internal_user":return"Internal User";case"internal_user_viewer":return"Internal Viewer";default:return"Unknown Role"}}(e.user_role);console.log("Decoded user_role:",l),f(l)}else console.log("User role not defined");e.user_email?p(e.user_email):console.log(`User Email is not set ${e}`)}}if(e&&O&&m&&!x&&!k){let l=sessionStorage.getItem("userModels"+e);l?R(JSON.parse(l)):(console.log(`currentOrg: ${JSON.stringify(z)}`),(async()=>{try{let l=await (0,u.getProxyUISettings)(O);M(l);let t=await (0,u.userInfoCall)(O,e,m,!1,null,null);C(t.user_info),console.log(`userSpendData: ${JSON.stringify(k)}`),t?.teams[0].keys?w(t.keys.concat(t.teams.filter(l=>"Admin"===m||l.user_id===e).flatMap(e=>e.keys))):w(t.keys),sessionStorage.setItem("userData"+e,JSON.stringify(t.keys)),sessionStorage.setItem("userSpendData"+e,JSON.stringify(t.user_info));let a=(await (0,u.modelAvailableCall)(O,e,m)).data.map(e=>e.id);console.log("available_model_names:",a),R(a),console.log("userModels:",L),sessionStorage.setItem("userModels"+e,JSON.stringify(a))}catch(e){console.error("There was an error fetching the data",e),e.message.includes("Invalid proxy server token passed")&&F()}})(),(0,d.fetchTeams)(O,e,m,z,b))}},[e,T,O,x,m]),(0,o.useEffect)(()=>{O&&(async()=>{try{let e=await (0,u.keyInfoCall)(O,[O]);console.log("keyInfo: ",e)}catch(e){e.message.includes("Invalid proxy server token passed")&&F()}})()},[O]),(0,o.useEffect)(()=>{console.log(`currentOrg: ${JSON.stringify(z)}, accessToken: ${O}, userID: ${e}, userRole: ${m}`),O&&(console.log("fetching teams"),(0,d.fetchTeams)(O,e,m,z,b))},[z]),(0,o.useEffect)(()=>{if(null!==x&&null!=P&&null!==P.team_id){let e=0;for(let l of(console.log(`keys: ${JSON.stringify(x)}`),x))P.hasOwnProperty("team_id")&&null!==l.team_id&&l.team_id===P.team_id&&(e+=l.spend);console.log(`sum: ${e}`),K(e)}else if(null!==x){let e=0;for(let l of x)e+=l.spend;K(e)}},[P]),null!=A)return(0,l.jsx)(c.default,{});function F(){(0,t.clearTokenCookies)();let e=(0,u.getProxyBaseUrl)();console.log("proxyBaseUrl:",e);let l=e?`${e}/sso/key/generate`:"/sso/key/generate";return console.log("Full URL:",l),window.location.href=l,null}if(null==T)return console.log("All cookies before redirect:",document.cookie),F(),null;try{let e=(0,i.jwtDecode)(T);console.log("Decoded token:",e);let l=e.exp,t=Math.floor(Date.now()/1e3);if(l&&t>=l)return console.log("Token expired, redirecting to login"),F(),null}catch(e){return console.error("Error decoding token:",e),(0,t.clearTokenCookies)(),F(),null}if(null==O)return null;if(null==e)return(0,l.jsx)("h1",{children:"User ID is not set"});if(null==m&&f("App Owner"),m&&"Admin Viewer"==m){let{Title:e,Paragraph:t}=r.Typography;return(0,l.jsxs)("div",{children:[(0,l.jsx)(e,{level:1,children:"Access Denied"}),(0,l.jsx)(t,{children:"Ask your proxy admin for access to create keys"})]})}return console.log("inside user dashboard, selected team",P),console.log("All cookies after redirect:",document.cookie),(0,l.jsx)("div",{className:"w-full mx-4 h-[75vh]",children:(0,l.jsx)(s.Grid,{numItems:1,className:"gap-2 p-8 w-full mt-2",children:(0,l.jsxs)(a.Col,{numColSpan:1,className:"flex flex-col gap-2",children:[(0,l.jsx)(g.default,{team:P,teams:h,data:x,addKey:v},P?P.team_id:null),(0,l.jsx)(V,{teams:h,organizations:S})]})})})}],693569)}]);