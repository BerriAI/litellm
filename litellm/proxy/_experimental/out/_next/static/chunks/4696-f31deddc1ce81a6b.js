"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4696],{44696:function(e,t,s){s.d(t,{Z:function(){return D}});var l=s(57437),n=s(2265),r=s(40278),a=s(12514),o=s(49804),i=s(67101),c=s(47323),d=s(92414),h=s(46030),m=s(97765),u=s(12485),x=s(18135),p=s(35242),v=s(29706),g=s(77991),_=s(84264),j=s(39789),N=s(9114),k=s(23628),f=s(19250),y=s(20831),w=s(51853),b=s(44643),C=s(71157);let S=e=>{let{responseTimeMs:t}=e;return null==t?null:(0,l.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-500 font-mono",children:[(0,l.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M12 6V12L16 14M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,l.jsxs)("span",{children:[t.toFixed(0),"ms"]})]})},Z=e=>{let t=e;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){}return t},A=e=>{let{label:t,value:s}=e,[r,a]=n.useState(!1),[o,i]=n.useState(!1),c=(null==s?void 0:s.toString())||"N/A",d=c.length>50?c.substring(0,50)+"...":c;return(0,l.jsx)("tr",{className:"hover:bg-gray-50",children:(0,l.jsx)("td",{className:"px-4 py-2 align-top",colSpan:2,children:(0,l.jsxs)("div",{className:"flex items-center justify-between group",children:[(0,l.jsxs)("div",{className:"flex items-center flex-1",children:[(0,l.jsx)("button",{onClick:()=>a(!r),className:"text-gray-400 hover:text-gray-600 mr-2",children:r?"▼":"▶"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm text-gray-600",children:t}),(0,l.jsx)("pre",{className:"mt-1 text-sm font-mono text-gray-800 whitespace-pre-wrap",children:r?c:d})]})]}),(0,l.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(c),i(!0),setTimeout(()=>i(!1),2e3)},className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-gray-600",children:(0,l.jsx)(w.Z,{className:"h-4 w-4"})})]})})})},R=e=>{var t,s,n,r,a,o,i,c,d,h,m,j,N,k;let{response:f}=e,y=null,w={},S={};try{if(null==f?void 0:f.error)try{let e="string"==typeof f.error.message?JSON.parse(f.error.message):f.error.message;y={message:(null==e?void 0:e.message)||"Unknown error",traceback:(null==e?void 0:e.traceback)||"No traceback available",litellm_params:(null==e?void 0:e.litellm_cache_params)||{},health_check_cache_params:(null==e?void 0:e.health_check_cache_params)||{}},w=Z(y.litellm_params)||{},S=Z(y.health_check_cache_params)||{}}catch(e){console.warn("Error parsing error details:",e),y={message:String(f.error.message||"Unknown error"),traceback:"Error parsing details",litellm_params:{},health_check_cache_params:{}}}else w=Z(null==f?void 0:f.litellm_cache_params)||{},S=Z(null==f?void 0:f.health_check_cache_params)||{}}catch(e){console.warn("Error in response parsing:",e),w={},S={}}let R={redis_host:(null==S?void 0:null===(n=S.redis_client)||void 0===n?void 0:null===(s=n.connection_pool)||void 0===s?void 0:null===(t=s.connection_kwargs)||void 0===t?void 0:t.host)||(null==S?void 0:null===(o=S.redis_async_client)||void 0===o?void 0:null===(a=o.connection_pool)||void 0===a?void 0:null===(r=a.connection_kwargs)||void 0===r?void 0:r.host)||(null==S?void 0:null===(i=S.connection_kwargs)||void 0===i?void 0:i.host)||(null==S?void 0:S.host)||"N/A",redis_port:(null==S?void 0:null===(h=S.redis_client)||void 0===h?void 0:null===(d=h.connection_pool)||void 0===d?void 0:null===(c=d.connection_kwargs)||void 0===c?void 0:c.port)||(null==S?void 0:null===(N=S.redis_async_client)||void 0===N?void 0:null===(j=N.connection_pool)||void 0===j?void 0:null===(m=j.connection_kwargs)||void 0===m?void 0:m.port)||(null==S?void 0:null===(k=S.connection_kwargs)||void 0===k?void 0:k.port)||(null==S?void 0:S.port)||"N/A",redis_version:(null==S?void 0:S.redis_version)||"N/A",startup_nodes:(()=>{try{var e,t,s,l,n,r,a,o,i,c,d,h,m;if(null==S?void 0:null===(e=S.redis_kwargs)||void 0===e?void 0:e.startup_nodes)return JSON.stringify(S.redis_kwargs.startup_nodes);let u=(null==S?void 0:null===(l=S.redis_client)||void 0===l?void 0:null===(s=l.connection_pool)||void 0===s?void 0:null===(t=s.connection_kwargs)||void 0===t?void 0:t.host)||(null==S?void 0:null===(a=S.redis_async_client)||void 0===a?void 0:null===(r=a.connection_pool)||void 0===r?void 0:null===(n=r.connection_kwargs)||void 0===n?void 0:n.host),x=(null==S?void 0:null===(c=S.redis_client)||void 0===c?void 0:null===(i=c.connection_pool)||void 0===i?void 0:null===(o=i.connection_kwargs)||void 0===o?void 0:o.port)||(null==S?void 0:null===(m=S.redis_async_client)||void 0===m?void 0:null===(h=m.connection_pool)||void 0===h?void 0:null===(d=h.connection_kwargs)||void 0===d?void 0:d.port);return u&&x?JSON.stringify([{host:u,port:x}]):"N/A"}catch(e){return"N/A"}})(),namespace:(null==S?void 0:S.namespace)||"N/A"};return(0,l.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,l.jsxs)(x.Z,{children:[(0,l.jsxs)(p.Z,{className:"border-b border-gray-200 px-4",children:[(0,l.jsx)(u.Z,{className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Summary"}),(0,l.jsx)(u.Z,{className:"px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800",children:"Raw Response"})]}),(0,l.jsxs)(g.Z,{children:[(0,l.jsx)(v.Z,{className:"p-4",children:(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center mb-6",children:[(null==f?void 0:f.status)==="healthy"?(0,l.jsx)(b.Z,{className:"h-5 w-5 text-green-500 mr-2"}):(0,l.jsx)(C.Z,{className:"h-5 w-5 text-red-500 mr-2"}),(0,l.jsxs)(_.Z,{className:"text-sm font-medium ".concat((null==f?void 0:f.status)==="healthy"?"text-green-500":"text-red-500"),children:["Cache Status: ",(null==f?void 0:f.status)||"unhealthy"]})]}),(0,l.jsx)("table",{className:"w-full border-collapse",children:(0,l.jsxs)("tbody",{children:[y&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:2,className:"pt-4 pb-2 font-semibold text-red-600",children:"Error Details"})}),(0,l.jsx)(A,{label:"Error Message",value:y.message}),(0,l.jsx)(A,{label:"Traceback",value:y.traceback})]}),(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:2,className:"pt-4 pb-2 font-semibold",children:"Cache Details"})}),(0,l.jsx)(A,{label:"Cache Configuration",value:String(null==w?void 0:w.type)}),(0,l.jsx)(A,{label:"Ping Response",value:String(f.ping_response)}),(0,l.jsx)(A,{label:"Set Cache Response",value:f.set_cache_response||"N/A"}),(0,l.jsx)(A,{label:"litellm_settings.cache_params",value:JSON.stringify(w,null,2)}),(null==w?void 0:w.type)==="redis"&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:2,className:"pt-4 pb-2 font-semibold",children:"Redis Details"})}),(0,l.jsx)(A,{label:"Redis Host",value:R.redis_host||"N/A"}),(0,l.jsx)(A,{label:"Redis Port",value:R.redis_port||"N/A"}),(0,l.jsx)(A,{label:"Redis Version",value:R.redis_version||"N/A"}),(0,l.jsx)(A,{label:"Startup Nodes",value:R.startup_nodes||"N/A"}),(0,l.jsx)(A,{label:"Namespace",value:R.namespace||"N/A"})]})]})})]})}),(0,l.jsx)(v.Z,{className:"p-4",children:(0,l.jsx)("div",{className:"bg-gray-50 rounded-md p-4 font-mono text-sm",children:(0,l.jsx)("pre",{className:"whitespace-pre-wrap break-words overflow-auto max-h-[500px]",children:(()=>{try{let e={...f,litellm_cache_params:w,health_check_cache_params:S},t=JSON.parse(JSON.stringify(e,(e,t)=>{if("string"==typeof t)try{return JSON.parse(t)}catch(e){}return t}));return JSON.stringify(t,null,2)}catch(e){return"Error formatting JSON: "+e.message}})()})})})]})]})})},E=e=>{let{accessToken:t,healthCheckResponse:s,runCachingHealthCheck:r,responseTimeMs:a}=e,[o,i]=n.useState(null),[c,d]=n.useState(!1),h=async()=>{d(!0);let e=performance.now();await r(),i(performance.now()-e),d(!1)};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(y.Z,{onClick:h,disabled:c,className:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 text-white text-sm px-4 py-2 rounded-md",children:c?"Running Health Check...":"Run Health Check"}),(0,l.jsx)(S,{responseTimeMs:o})]}),s&&(0,l.jsx)(R,{response:s})]})},H=e=>{if(e)return e.toISOString().split("T")[0]};function T(e){return new Intl.NumberFormat("en-US",{maximumFractionDigits:0,notation:"compact",compactDisplay:"short"}).format(e)}var D=e=>{let{accessToken:t,token:s,userRole:y,userID:w,premiumUser:b}=e,[C,S]=(0,n.useState)([]),[Z,A]=(0,n.useState)([]),[R,D]=(0,n.useState)([]),[O,I]=(0,n.useState)([]),[L,J]=(0,n.useState)("0"),[P,F]=(0,n.useState)("0"),[M,G]=(0,n.useState)("0"),[q,U]=(0,n.useState)({from:new Date(Date.now()-6048e5),to:new Date}),[V,B]=(0,n.useState)(""),[W,K]=(0,n.useState)("");(0,n.useEffect)(()=>{t&&q&&((async()=>{I(await (0,f.adminGlobalCacheActivity)(t,H(q.from),H(q.to)))})(),B(new Date().toLocaleString()))},[t]);let z=Array.from(new Set(O.map(e=>{var t;return null!==(t=null==e?void 0:e.api_key)&&void 0!==t?t:""}))),Q=Array.from(new Set(O.map(e=>{var t;return null!==(t=null==e?void 0:e.model)&&void 0!==t?t:""})));Array.from(new Set(O.map(e=>{var t;return null!==(t=null==e?void 0:e.call_type)&&void 0!==t?t:""})));let X=async(e,s)=>{e&&s&&t&&I(await (0,f.adminGlobalCacheActivity)(t,H(e),H(s)))};(0,n.useEffect)(()=>{console.log("DATA IN CACHE DASHBOARD",O);let e=O;Z.length>0&&(e=e.filter(e=>Z.includes(e.api_key))),R.length>0&&(e=e.filter(e=>R.includes(e.model))),console.log("before processed data in cache dashboard",e);let t=0,s=0,l=0,n=e.reduce((e,n)=>{console.log("Processing item:",n),n.call_type||(console.log("Item has no call_type:",n),n.call_type="Unknown"),t+=(n.total_rows||0)-(n.cache_hit_true_rows||0),s+=n.cache_hit_true_rows||0,l+=n.cached_completion_tokens||0;let r=e.find(e=>e.name===n.call_type);return r?(r["LLM API requests"]+=(n.total_rows||0)-(n.cache_hit_true_rows||0),r["Cache hit"]+=n.cache_hit_true_rows||0,r["Cached Completion Tokens"]+=n.cached_completion_tokens||0,r["Generated Completion Tokens"]+=n.generated_completion_tokens||0):e.push({name:n.call_type,"LLM API requests":(n.total_rows||0)-(n.cache_hit_true_rows||0),"Cache hit":n.cache_hit_true_rows||0,"Cached Completion Tokens":n.cached_completion_tokens||0,"Generated Completion Tokens":n.generated_completion_tokens||0}),e},[]);J(T(s)),F(T(l));let r=s+t;r>0?G((s/r*100).toFixed(2)):G("0"),S(n),console.log("PROCESSED DATA IN CACHE DASHBOARD",n)},[Z,R,q,O]);let Y=async()=>{try{N.Z.info("Running cache health check..."),K("");let e=await (0,f.cachingHealthCheckCall)(null!==t?t:"");console.log("CACHING HEALTH CHECK RESPONSE",e),K(e)}catch(t){let e;if(console.error("Error running health check:",t),t&&t.message)try{let s=JSON.parse(t.message);s.error&&(s=s.error),e=s}catch(s){e={message:t.message}}else e={message:"Unknown error occurred"};K({error:e})}};return(0,l.jsxs)(x.Z,{className:"gap-2 p-8 h-full w-full mt-2 mb-8",children:[(0,l.jsxs)(p.Z,{className:"flex justify-between mt-2 w-full items-center",children:[(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)(u.Z,{children:"Cache Analytics"}),(0,l.jsx)(u.Z,{children:(0,l.jsx)("pre",{children:"Cache Health"})})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[V&&(0,l.jsxs)(_.Z,{children:["Last Refreshed: ",V]}),(0,l.jsx)(c.Z,{icon:k.Z,variant:"shadow",size:"xs",className:"self-center",onClick:()=>{B(new Date().toLocaleString())}})]})]}),(0,l.jsxs)(g.Z,{children:[(0,l.jsx)(v.Z,{children:(0,l.jsxs)(a.Z,{children:[(0,l.jsxs)(i.Z,{numItems:3,className:"gap-4 mt-4",children:[(0,l.jsx)(o.Z,{children:(0,l.jsx)(d.Z,{placeholder:"Select API Keys",value:Z,onValueChange:A,children:z.map(e=>(0,l.jsx)(h.Z,{value:e,children:e},e))})}),(0,l.jsx)(o.Z,{children:(0,l.jsx)(d.Z,{placeholder:"Select Models",value:R,onValueChange:D,children:Q.map(e=>(0,l.jsx)(h.Z,{value:e,children:e},e))})}),(0,l.jsx)(o.Z,{children:(0,l.jsx)(j.Z,{value:q,onValueChange:e=>{U(e),X(e.from,e.to)}})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 mt-4",children:[(0,l.jsxs)(a.Z,{children:[(0,l.jsx)("p",{className:"text-tremor-default font-medium text-tremor-content dark:text-dark-tremor-content",children:"Cache Hit Ratio"}),(0,l.jsx)("div",{className:"mt-2 flex items-baseline space-x-2.5",children:(0,l.jsxs)("p",{className:"text-tremor-metric font-semibold text-tremor-content-strong dark:text-dark-tremor-content-strong",children:[M,"%"]})})]}),(0,l.jsxs)(a.Z,{children:[(0,l.jsx)("p",{className:"text-tremor-default font-medium text-tremor-content dark:text-dark-tremor-content",children:"Cache Hits"}),(0,l.jsx)("div",{className:"mt-2 flex items-baseline space-x-2.5",children:(0,l.jsx)("p",{className:"text-tremor-metric font-semibold text-tremor-content-strong dark:text-dark-tremor-content-strong",children:L})})]}),(0,l.jsxs)(a.Z,{children:[(0,l.jsx)("p",{className:"text-tremor-default font-medium text-tremor-content dark:text-dark-tremor-content",children:"Cached Tokens"}),(0,l.jsx)("div",{className:"mt-2 flex items-baseline space-x-2.5",children:(0,l.jsx)("p",{className:"text-tremor-metric font-semibold text-tremor-content-strong dark:text-dark-tremor-content-strong",children:P})})]})]}),(0,l.jsx)(m.Z,{className:"mt-4",children:"Cache Hits vs API Requests"}),(0,l.jsx)(r.Z,{title:"Cache Hits vs API Requests",data:C,stack:!0,index:"name",valueFormatter:T,categories:["LLM API requests","Cache hit"],colors:["sky","teal"],yAxisWidth:48}),(0,l.jsx)(m.Z,{className:"mt-4",children:"Cached Completion Tokens vs Generated Completion Tokens"}),(0,l.jsx)(r.Z,{className:"mt-6",data:C,stack:!0,index:"name",valueFormatter:T,categories:["Generated Completion Tokens","Cached Completion Tokens"],colors:["sky","teal"],yAxisWidth:48})]})}),(0,l.jsx)(v.Z,{children:(0,l.jsx)(E,{accessToken:t,healthCheckResponse:W,runCachingHealthCheck:Y})})]})]})}}}]);