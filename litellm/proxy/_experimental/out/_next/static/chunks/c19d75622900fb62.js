(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,797305,289793,497650,e=>{"use strict";var t=e.i(843476),s=e.i(827252),a=e.i(584935),r=e.i(304967),l=e.i(309426),i=e.i(350967),n=e.i(197647),o=e.i(653824),c=e.i(881073),d=e.i(404206),m=e.i(723731),u=e.i(599724),x=e.i(629569),h=e.i(560445),p=e.i(560025),f=e.i(592968),g=e.i(271645),_=e.i(764205),j=e.i(266027),y=e.i(243652),b=e.i(708347),k=e.i(135214);let v=(0,y.createQueryKeys)("agents"),N=()=>{let{accessToken:e,userRole:t}=(0,k.default)();return(0,j.useQuery)({queryKey:v.list({}),queryFn:async()=>await (0,_.getAgentsList)(e),enabled:!!e&&b.all_admin_roles.includes(t||"")})};e.s(["useAgents",0,N],289793);let T=(0,y.createQueryKeys)("customers");var C=e.i(738014),w=e.i(500330),q=e.i(994388),S=e.i(980187),L=e.i(476961),D=e.i(362024);let A={blue:"#3b82f6",cyan:"#06b6d4",indigo:"#6366f1",green:"#22c55e",red:"#ef4444",purple:"#8b5cf6",emerald:"#37bc7d"},E=({active:e,payload:s,label:a})=>e&&s&&s.length?(0,t.jsxs)("div",{className:"w-56 rounded-tremor-default border border-tremor-border bg-tremor-background p-2 text-tremor-default shadow-tremor-dropdown",children:[(0,t.jsx)("p",{className:"text-tremor-content-strong",children:a}),s.map(e=>{let s=e.dataKey?.toString();if(!s||!e.payload)return null;let a=((e,t)=>{let s=t.substring(t.indexOf(".")+1);if(e.metrics&&s in e.metrics)return e.metrics[s]})(e.payload,s),r=s.includes("spend"),l=void 0!==a?r?`$${a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`:a.toLocaleString():"N/A",i=A[e.color]||e.color;return(0,t.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"h-2 w-2 shrink-0 rounded-full ring-2 ring-white drop-shadow-md",style:{backgroundColor:i}}),(0,t.jsx)("p",{className:"font-medium text-tremor-content dark:text-dark-tremor-content",children:s.replace("metrics.","").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]}),(0,t.jsx)("p",{className:"font-medium text-tremor-content-emphasis dark:text-dark-tremor-content-emphasis",children:l})]},s)})]}):null,O=({categories:e,colors:s})=>(0,t.jsx)("div",{className:"flex items-center justify-end space-x-4",children:e.map((e,a)=>{let r=A[s[a]]||s[a];return(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"h-2 w-2 shrink-0 rounded-full ring-4 ring-white",style:{backgroundColor:r}}),(0,t.jsx)("p",{className:"text-sm text-tremor-content dark:text-dark-tremor-content",children:e.replace("metrics.","").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]},e)})});var F=e.i(291542);let M=[{title:"Model",dataIndex:"model",key:"model",render:e=>e||"-"},{title:"Spend (USD)",dataIndex:"spend",key:"spend",render:e=>`$${(0,w.formatNumberWithCommas)(e,2)}`},{title:"Successful",dataIndex:"successful_requests",key:"successful_requests",render:e=>(0,t.jsx)("span",{className:"text-green-600",children:e?.toLocaleString()||0})},{title:"Failed",dataIndex:"failed_requests",key:"failed_requests",render:e=>(0,t.jsx)("span",{className:"text-red-600",children:e?.toLocaleString()||0})},{title:"Tokens",dataIndex:"tokens",key:"tokens",render:e=>e?.toLocaleString()||0}],$=({topModels:e})=>{let[s,l]=(0,g.useState)("table");return 0===e.length?null:(0,t.jsxs)(r.Card,{className:"mt-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsx)(x.Title,{children:"Model Usage"}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>l("table"),className:`px-3 py-1 text-sm rounded-md ${"table"===s?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Table"}),(0,t.jsx)("button",{onClick:()=>l("chart"),className:`px-3 py-1 text-sm rounded-md ${"chart"===s?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Chart"})]})]}),"chart"===s?(0,t.jsx)("div",{className:"max-h-[234px] overflow-y-auto",children:(0,t.jsx)(a.BarChart,{style:{height:40*e.length},data:e.map(e=>({key:e.model,spend:e.spend})),index:"key",categories:["spend"],colors:["cyan"],valueFormatter:e=>`$${(0,w.formatNumberWithCommas)(e,2)}`,layout:"vertical",yAxisWidth:180,tickGap:5,showLegend:!1})}):(0,t.jsx)(F.Table,{columns:M,dataSource:e,rowKey:"model",size:"small",pagination:!1,scroll:e.length>5?{y:195}:void 0})]})};function U(e){return e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?e/1e3+"k":e.toString()}function V(e){return 0===e?"$0":e>=1e6?"$"+e/1e6+"M":e>=1e3?"$"+e/1e3+"k":"$"+e}let R=({modelName:e,metrics:s,hidePromptCachingMetrics:l=!1})=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Grid,{numItems:4,className:"gap-4",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(u.Text,{children:"Total Requests"}),(0,t.jsx)(x.Title,{children:s.total_requests.toLocaleString()})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(u.Text,{children:"Total Successful Requests"}),(0,t.jsx)(x.Title,{children:s.total_successful_requests.toLocaleString()})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(u.Text,{children:"Total Tokens"}),(0,t.jsx)(x.Title,{children:s.total_tokens.toLocaleString()}),(0,t.jsxs)(u.Text,{children:[Math.round(s.total_tokens/s.total_successful_requests)," avg per successful request"]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(u.Text,{children:"Total Spend"}),(0,t.jsxs)(x.Title,{children:["$",(0,w.formatNumberWithCommas)(s.total_spend,2)]}),(0,t.jsxs)(u.Text,{children:["$",(0,w.formatNumberWithCommas)(s.total_spend/s.total_successful_requests,3)," per successful request"]})]})]}),s.top_api_keys&&s.top_api_keys.length>0&&(0,t.jsxs)(r.Card,{className:"mt-4",children:[(0,t.jsx)(x.Title,{children:"Top Virtual Keys by Spend"}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)("div",{className:"grid grid-cols-1 gap-2",children:s.top_api_keys.map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Text,{className:"font-medium",children:e.key_alias||`${e.api_key.substring(0,10)}...`}),e.team_id&&(0,t.jsxs)(u.Text,{className:"text-xs text-gray-500",children:["Team: ",e.team_id]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)(u.Text,{className:"font-medium",children:["$",(0,w.formatNumberWithCommas)(e.spend,2)]}),(0,t.jsxs)(u.Text,{className:"text-xs text-gray-500",children:[e.requests.toLocaleString()," requests | ",e.tokens.toLocaleString()," tokens"]})]})]},e.api_key))})})]}),s.top_models&&s.top_models.length>0&&(0,t.jsx)($,{topModels:s.top_models}),(0,t.jsxs)(r.Card,{className:"mt-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(x.Title,{children:"Spend per day"}),(0,t.jsx)(O,{categories:["metrics.spend"],colors:["green"]})]}),(0,t.jsx)(a.BarChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.spend"],colors:["green"],valueFormatter:e=>`$${(0,w.formatNumberWithCommas)(e,2,!0)}`,yAxisWidth:72})]}),(0,t.jsxs)(i.Grid,{numItems:2,className:"gap-4 mt-4",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(x.Title,{children:"Total Tokens"}),(0,t.jsx)(O,{categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"]})]}),(0,t.jsx)(L.AreaChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"],valueFormatter:U,customTooltip:E,showLegend:!1})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(x.Title,{children:"Requests per day"}),(0,t.jsx)(O,{categories:["metrics.api_requests"],colors:["blue"]})]}),(0,t.jsx)(a.BarChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.api_requests"],colors:["blue"],valueFormatter:U,customTooltip:E,showLegend:!1})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(x.Title,{children:"Success vs Failed Requests"}),(0,t.jsx)(O,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"]})]}),(0,t.jsx)(L.AreaChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"],valueFormatter:U,customTooltip:E,showLegend:!1})]}),!l&&(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(x.Title,{children:"Prompt Caching Metrics"}),(0,t.jsx)(O,{categories:["metrics.cache_read_input_tokens","metrics.cache_creation_input_tokens"],colors:["cyan","purple"]})]}),(0,t.jsxs)("div",{className:"mb-2",children:[(0,t.jsxs)(u.Text,{children:["Cache Read: ",s.total_cache_read_input_tokens?.toLocaleString()||0," tokens"]}),(0,t.jsxs)(u.Text,{children:["Cache Creation: ",s.total_cache_creation_input_tokens?.toLocaleString()||0," tokens"]})]}),(0,t.jsx)(L.AreaChart,{className:"mt-4",data:s.daily_data,index:"date",categories:["metrics.cache_read_input_tokens","metrics.cache_creation_input_tokens"],colors:["cyan","purple"],valueFormatter:U,customTooltip:E,showLegend:!1})]})]})]}),z=({modelMetrics:e,hidePromptCachingMetrics:s=!1})=>{let a=Object.keys(e).sort((t,s)=>""===t?1:""===s?-1:e[s].total_spend-e[t].total_spend),l={total_requests:0,total_successful_requests:0,total_tokens:0,total_spend:0,total_cache_read_input_tokens:0,total_cache_creation_input_tokens:0,daily_data:{}};Object.values(e).forEach(e=>{l.total_requests+=e.total_requests,l.total_successful_requests+=e.total_successful_requests,l.total_tokens+=e.total_tokens,l.total_spend+=e.total_spend,l.total_cache_read_input_tokens+=e.total_cache_read_input_tokens||0,l.total_cache_creation_input_tokens+=e.total_cache_creation_input_tokens||0,e.daily_data.forEach(e=>{l.daily_data[e.date]||(l.daily_data[e.date]={prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,spend:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0}),l.daily_data[e.date].prompt_tokens+=e.metrics.prompt_tokens,l.daily_data[e.date].completion_tokens+=e.metrics.completion_tokens,l.daily_data[e.date].total_tokens+=e.metrics.total_tokens,l.daily_data[e.date].api_requests+=e.metrics.api_requests,l.daily_data[e.date].spend+=e.metrics.spend,l.daily_data[e.date].successful_requests+=e.metrics.successful_requests,l.daily_data[e.date].failed_requests+=e.metrics.failed_requests,l.daily_data[e.date].cache_read_input_tokens+=e.metrics.cache_read_input_tokens||0,l.daily_data[e.date].cache_creation_input_tokens+=e.metrics.cache_creation_input_tokens||0})});let n=Object.entries(l.daily_data).map(([e,t])=>({date:e,metrics:t})).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)(x.Title,{children:"Overall Usage"}),(0,t.jsxs)(i.Grid,{numItems:4,className:"gap-4 mb-4",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(u.Text,{children:"Total Requests"}),(0,t.jsx)(x.Title,{children:l.total_requests.toLocaleString()})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(u.Text,{children:"Total Successful Requests"}),(0,t.jsx)(x.Title,{children:l.total_successful_requests.toLocaleString()})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(u.Text,{children:"Total Tokens"}),(0,t.jsx)(x.Title,{children:l.total_tokens.toLocaleString()})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(u.Text,{children:"Total Spend"}),(0,t.jsxs)(x.Title,{children:["$",(0,w.formatNumberWithCommas)(l.total_spend,2)]})]})]}),(0,t.jsxs)(i.Grid,{numItems:2,className:"gap-4",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(x.Title,{children:"Total Tokens Over Time"}),(0,t.jsx)(O,{categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"]})]}),(0,t.jsx)(L.AreaChart,{className:"mt-4",data:n,index:"date",categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"],valueFormatter:U,customTooltip:E,showLegend:!1})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(x.Title,{children:"Total Requests Over Time"}),(0,t.jsx)(O,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["emerald","red"]})]}),(0,t.jsx)(L.AreaChart,{className:"mt-4",data:n,index:"date",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["emerald","red"],valueFormatter:e=>e.toLocaleString(),customTooltip:E,showLegend:!1})]})]})]}),(0,t.jsx)(D.Collapse,{defaultActiveKey:a[0],children:a.map(a=>(0,t.jsx)(D.Collapse.Panel,{header:(0,t.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,t.jsx)(x.Title,{children:e[a].label||"Unknown Item"}),(0,t.jsxs)("div",{className:"flex space-x-4 text-sm text-gray-500",children:[(0,t.jsxs)("span",{children:["$",(0,w.formatNumberWithCommas)(e[a].total_spend,2)]}),(0,t.jsxs)("span",{children:[e[a].total_requests.toLocaleString()," requests"]})]})]}),children:(0,t.jsx)(R,{modelName:a||"Unknown Model",metrics:e[a],hidePromptCachingMetrics:s})},a))})]})},B=(e,t,s=[])=>{let a={};return e.results.forEach(e=>{Object.entries(e.breakdown[t]||{}).forEach(([r,l])=>{a[r]||(a[r]={label:"api_keys"===t?((e,t,s)=>{let a=e.metadata.key_alias||`key-hash-${t}`,r=e.metadata.team_id;if(r){let e=(0,S.resolveTeamAliasFromTeamID)(r,s);return e?`${a} (team: ${e})`:`${a} (team_id: ${r})`}return a})(l,r,s):r,total_requests:0,total_successful_requests:0,total_failed_requests:0,total_tokens:0,prompt_tokens:0,completion_tokens:0,total_spend:0,total_cache_read_input_tokens:0,total_cache_creation_input_tokens:0,top_api_keys:[],top_models:[],daily_data:[]}),a[r].total_requests+=l.metrics.api_requests,a[r].prompt_tokens+=l.metrics.prompt_tokens,a[r].completion_tokens+=l.metrics.completion_tokens,a[r].total_tokens+=l.metrics.total_tokens,a[r].total_spend+=l.metrics.spend,a[r].total_successful_requests+=l.metrics.successful_requests,a[r].total_failed_requests+=l.metrics.failed_requests,a[r].total_cache_read_input_tokens+=l.metrics.cache_read_input_tokens||0,a[r].total_cache_creation_input_tokens+=l.metrics.cache_creation_input_tokens||0,a[r].daily_data.push({date:e.date,metrics:{prompt_tokens:l.metrics.prompt_tokens,completion_tokens:l.metrics.completion_tokens,total_tokens:l.metrics.total_tokens,api_requests:l.metrics.api_requests,spend:l.metrics.spend,successful_requests:l.metrics.successful_requests,failed_requests:l.metrics.failed_requests,cache_read_input_tokens:l.metrics.cache_read_input_tokens||0,cache_creation_input_tokens:l.metrics.cache_creation_input_tokens||0}})})}),"api_keys"!==t&&Object.entries(a).forEach(([s,r])=>{let l={};e.results.forEach(e=>{let a=e.breakdown[t]?.[s];a&&"api_key_breakdown"in a&&Object.entries(a.api_key_breakdown||{}).forEach(([e,t])=>{l[e]||(l[e]={api_key:e,key_alias:t.metadata.key_alias,team_id:t.metadata.team_id,spend:0,requests:0,tokens:0}),l[e].spend+=t.metrics.spend,l[e].requests+=t.metrics.api_requests,l[e].tokens+=t.metrics.total_tokens})}),a[s].top_api_keys=Object.values(l).sort((e,t)=>t.spend-e.spend).slice(0,5)}),"api_keys"===t&&Object.entries(a).forEach(([t,s])=>{let r={};e.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(([e,s])=>{if(s&&"api_key_breakdown"in s){let a=s.api_key_breakdown?.[t];a&&(r[e]||(r[e]={model:e,spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0}),r[e].spend+=a.metrics.spend,r[e].requests+=a.metrics.api_requests,r[e].successful_requests+=a.metrics.successful_requests||0,r[e].failed_requests+=a.metrics.failed_requests||0,r[e].tokens+=a.metrics.total_tokens)}})}),a[t].top_models=Object.values(r).sort((e,t)=>t.spend-e.spend)}),Object.values(a).forEach(e=>{e.daily_data.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())}),a};var I=e.i(366283),P=e.i(779241),W=e.i(212931),Y=e.i(808613),H=e.i(482725),K=e.i(199133),G=e.i(727749);let Z=({isOpen:e,onClose:s,accessToken:a})=>{let[r]=Y.Form.useForm(),[l,i]=(0,g.useState)(!1),[n,o]=(0,g.useState)(null),[c,d]=(0,g.useState)(!1),[m,x]=(0,g.useState)("cloudzero"),[h,p]=(0,g.useState)(!1);(0,g.useEffect)(()=>{e&&a&&f()},[e,a]);let f=async()=>{d(!0);try{let e=await fetch("/cloudzero/settings",{method:"GET",headers:{[(0,_.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"}});if(e.ok){let t=await e.json();o(t),r.setFieldsValue({connection_id:t.connection_id})}else if(404!==e.status){let t=await e.json();G.default.fromBackend(`Failed to load existing settings: ${t.error||"Unknown error"}`)}}catch(e){console.error("Error loading CloudZero settings:",e),G.default.fromBackend("Failed to load existing settings")}finally{d(!1)}},j=async e=>{if(!a)return void G.default.fromBackend("No access token available");i(!0);try{let t=n?"/cloudzero/settings":"/cloudzero/init",s=n?"PUT":"POST",r={...e,timezone:"UTC"},l=await fetch(t,{method:s,headers:{[(0,_.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(r)}),i=await l.json();if(l.ok)return G.default.success(i.message||"CloudZero settings saved successfully"),o({api_key_masked:e.api_key.substring(0,4)+"****"+e.api_key.slice(-4),connection_id:e.connection_id,status:"configured"}),!0;return G.default.fromBackend(i.error||"Failed to save CloudZero settings"),!1}catch(e){return console.error("Error saving CloudZero settings:",e),G.default.fromBackend("Failed to save CloudZero settings"),!1}finally{i(!1)}},y=async()=>{if(!a)return void G.default.fromBackend("No access token available");p(!0);try{let e=await fetch("/cloudzero/export",{method:"POST",headers:{[(0,_.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({limit:1e5,operation:"replace_hourly"})}),t=await e.json();e.ok?(G.default.success(t.message||"Export to CloudZero completed successfully"),s()):G.default.fromBackend(t.error||"Failed to export to CloudZero")}catch(e){console.error("Error exporting to CloudZero:",e),G.default.fromBackend("Failed to export to CloudZero")}finally{p(!1)}},b=async()=>{p(!0);try{G.default.info("CSV export functionality coming soon!"),s()}catch(e){console.error("Error exporting CSV:",e),G.default.fromBackend("Failed to export CSV")}finally{p(!1)}},k=async()=>{if("cloudzero"===m){if(!n){let e=await r.validateFields();if(!await j(e))return}await y()}else await b()},v=()=>{r.resetFields(),x("cloudzero"),o(null),s()},N=[{value:"cloudzero",label:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("img",{src:"/cloudzero.png",alt:"CloudZero",className:"w-5 h-5",onError:e=>{e.target.style.display="none"}}),(0,t.jsx)("span",{children:"Export to CloudZero"})]})},{value:"csv",label:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsx)("span",{children:"Export to CSV"})]})}];return(0,t.jsx)(W.Modal,{title:"Export Data",open:e,onCancel:v,footer:null,width:600,destroyOnHidden:!0,children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Text,{className:"font-medium mb-2 block",children:"Export Destination"}),(0,t.jsx)(K.Select,{value:m,onChange:x,options:N,className:"w-full",size:"large"})]}),"cloudzero"===m&&(0,t.jsx)("div",{children:c?(0,t.jsx)("div",{className:"flex justify-center py-8",children:(0,t.jsx)(H.Spin,{size:"large"})}):(0,t.jsxs)(t.Fragment,{children:[n&&(0,t.jsx)(I.Callout,{title:"Existing CloudZero Configuration",icon:()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"green",className:"mb-4",children:(0,t.jsxs)(u.Text,{children:["API Key: ",n.api_key_masked,(0,t.jsx)("br",{}),"Connection ID: ",n.connection_id]})}),!n&&(0,t.jsxs)(Y.Form,{form:r,layout:"vertical",children:[(0,t.jsx)(Y.Form.Item,{label:"CloudZero API Key",name:"api_key",rules:[{required:!0,message:"Please enter your CloudZero API key"}],children:(0,t.jsx)(P.TextInput,{type:"password",placeholder:"Enter your CloudZero API key"})}),(0,t.jsx)(Y.Form.Item,{label:"Connection ID",name:"connection_id",rules:[{required:!0,message:"Please enter the CloudZero connection ID"}],children:(0,t.jsx)(P.TextInput,{placeholder:"Enter CloudZero connection ID"})})]})]})}),"csv"===m&&(0,t.jsx)(I.Callout,{title:"CSV Export",icon:()=>(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),color:"blue",children:(0,t.jsx)(u.Text,{children:"Export your usage data as a CSV file for analysis in spreadsheet applications."})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,t.jsx)(q.Button,{variant:"secondary",onClick:v,children:"Cancel"}),(0,t.jsx)(q.Button,{onClick:k,loading:l||h,disabled:l||h,children:"cloudzero"===m?"Export to CloudZero":"Export CSV"})]})]})})};var J=e.i(785242),X=e.i(464571),Q=e.i(981339);let ee=({value:e,onChange:s})=>(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Format"}),(0,t.jsx)(K.Select,{value:e,onChange:s,className:"w-full",options:[{value:"csv",label:"CSV (Excel, Google Sheets)"},{value:"json",label:"JSON (includes metadata)"}]})]}),et=({dateRange:e,selectedFilters:s})=>(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:[e.from?.toLocaleDateString()," - ",e.to?.toLocaleDateString(),s.length>0&&` \xb7 ${s.length} filter${s.length>1?"s":""}`]});var es=e.i(91739);let ea=({value:e,onChange:s,entityType:a})=>(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Export type"}),(0,t.jsx)(es.Radio.Group,{value:e,onChange:e=>s(e.target.value),className:"w-full",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,t.jsx)(es.Radio,{value:"daily",className:"mt-0.5"}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[(0,t.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day breakdown by ",a]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Daily metrics for each ",a]})]})]}),(0,t.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,t.jsx)(es.Radio,{value:"daily_with_keys",className:"mt-0.5"}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[(0,t.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day breakdown by ",a," and key"]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Daily metrics for each ",a,", split by API key"]})]})]}),(0,t.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,t.jsx)(es.Radio,{value:"daily_with_models",className:"mt-0.5"}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[(0,t.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day by ",a," and model"]}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:"Daily metrics split by model"})]})]})]})})]});var er=e.i(59935);let el=e=>{if(!e)return null;for(let t of Object.values(e)){let e=t?.metadata?.team_id;if(e)return e}return null},ei=(e,t,s,a={})=>{switch(t){case"daily":default:return((e,t,s={})=>{let a=[];return e.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(([r,l])=>{let i=el(l.api_key_breakdown),n=i&&s[i]||null;a.push({Date:e.date,[t]:n||"-",[`${t} ID`]:i||"-","Spend ($)":(0,w.formatNumberWithCommas)(l.metrics.spend,4),Requests:l.metrics.api_requests,"Successful Requests":l.metrics.successful_requests,"Failed Requests":l.metrics.failed_requests,"Total Tokens":l.metrics.total_tokens,"Prompt Tokens":l.metrics.prompt_tokens||0,"Completion Tokens":l.metrics.completion_tokens||0})})}),a.sort((e,t)=>new Date(e.Date).getTime()-new Date(t.Date).getTime())})(e,s,a);case"daily_with_keys":return((e,t,s={})=>{let a={};return e.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(([t,r])=>{Object.entries(r.api_key_breakdown||{}).forEach(([r,l])=>{let i=l?.metadata?.key_alias||null,n=l?.metadata?.team_id||t,o=n&&s[n]||null,c=`${e.date}_${n}_${r}`;a[c]?(a[c].metrics.spend+=l.metrics?.spend||0,a[c].metrics.api_requests+=l.metrics?.api_requests||0,a[c].metrics.successful_requests+=l.metrics?.successful_requests||0,a[c].metrics.failed_requests+=l.metrics?.failed_requests||0,a[c].metrics.total_tokens+=l.metrics?.total_tokens||0,a[c].metrics.prompt_tokens+=l.metrics?.prompt_tokens||0,a[c].metrics.completion_tokens+=l.metrics?.completion_tokens||0):a[c]={Date:e.date,teamId:n,teamAlias:o,keyId:r,keyAlias:i,metrics:{spend:l.metrics?.spend||0,api_requests:l.metrics?.api_requests||0,successful_requests:l.metrics?.successful_requests||0,failed_requests:l.metrics?.failed_requests||0,total_tokens:l.metrics?.total_tokens||0,prompt_tokens:l.metrics?.prompt_tokens||0,completion_tokens:l.metrics?.completion_tokens||0}}})})}),Object.values(a).map(e=>({Date:e.Date,[t]:e.teamAlias||"-",[`${t} ID`]:e.teamId||"-","Key Alias":e.keyAlias||"-","Key ID":e.keyId,"Spend ($)":(0,w.formatNumberWithCommas)(e.metrics.spend,4),Requests:e.metrics.api_requests,"Successful Requests":e.metrics.successful_requests,"Failed Requests":e.metrics.failed_requests,"Total Tokens":e.metrics.total_tokens,"Prompt Tokens":e.metrics.prompt_tokens,"Completion Tokens":e.metrics.completion_tokens})).sort((e,t)=>new Date(e.Date).getTime()-new Date(t.Date).getTime())})(e,s,a);case"daily_with_models":return((e,t,s={})=>{let a=[];return e.results.forEach(e=>{let r={};Object.entries(e.breakdown.entities||{}).forEach(([t,s])=>{r[t]||(r[t]={}),Object.entries(e.breakdown.models||{}).forEach(([e,a])=>{Object.entries(s.api_key_breakdown||{}).forEach(([s,a])=>{r[t][e]||(r[t][e]={spend:0,requests:0,successful:0,failed:0,tokens:0}),r[t][e].spend+=a.metrics.spend||0,r[t][e].requests+=a.metrics.api_requests||0,r[t][e].successful+=a.metrics.successful_requests||0,r[t][e].failed+=a.metrics.failed_requests||0,r[t][e].tokens+=a.metrics.total_tokens||0})})}),Object.entries(r).forEach(([r,l])=>{let i=e.breakdown.entities?.[r],n=el(i?.api_key_breakdown),o=n&&s[n]||null;Object.entries(l).forEach(([s,r])=>{a.push({Date:e.date,[t]:o||"-",[`${t} ID`]:n||"-",Model:s,"Spend ($)":(0,w.formatNumberWithCommas)(r.spend,4),Requests:r.requests,Successful:r.successful,Failed:r.failed,"Total Tokens":r.tokens})})})}),a.sort((e,t)=>new Date(e.Date).getTime()-new Date(t.Date).getTime())})(e,s,a)}},en=({isOpen:e,onClose:s,entityType:a,spendData:r,dateRange:l,selectedFilters:i,customTitle:n})=>{let[o,c]=(0,g.useState)("csv"),[d,m]=(0,g.useState)("daily"),[u,x]=(0,g.useState)(!1),{data:h,isLoading:p}=(0,J.useTeams)(),f=a.charAt(0).toUpperCase()+a.slice(1),_=n||`Export ${f} Usage`,j=(0,g.useMemo)(()=>(0,S.createTeamAliasMap)(h),[h]),y=async e=>{let t=e||o;x(!0);try{"csv"===t?(((e,t,s,a,r={})=>{let l=ei(e,t,s,r),i=new Blob([er.default.unparse(l)],{type:"text/csv;charset=utf-8;"}),n=window.URL.createObjectURL(i),o=document.createElement("a");o.href=n,o.download=`${a}_usage_${t}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)})(r,d,f,a,j),G.default.success(`${f} usage data exported successfully as CSV`)):(((e,t,s,a,r,l,i={})=>{let n=ei(e,t,s,i),o={export_date:new Date().toISOString(),entity_type:a,date_range:{from:r.from?.toISOString(),to:r.to?.toISOString()},filters_applied:l.length>0?l:"None",export_scope:t,summary:{total_spend:e.metadata.total_spend,total_requests:e.metadata.total_api_requests,successful_requests:e.metadata.total_successful_requests,failed_requests:e.metadata.total_failed_requests,total_tokens:e.metadata.total_tokens}},c=new Blob([JSON.stringify({metadata:o,data:n},null,2)],{type:"application/json"}),d=window.URL.createObjectURL(c),m=document.createElement("a");m.href=d,m.download=`${a}_usage_${t}_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(d)})(r,d,f,a,l,i,j),G.default.success(`${f} usage data exported successfully as JSON`)),s()}catch(e){console.error("Error exporting data:",e),G.default.fromBackend("Failed to export data")}finally{x(!1)}};return(0,t.jsx)(W.Modal,{title:(0,t.jsx)("span",{className:"text-base font-semibold",children:_}),open:e,onCancel:s,footer:null,width:480,children:(0,t.jsxs)("div",{className:"space-y-5 py-2",children:[p?(0,t.jsx)(Q.Skeleton,{active:!0}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(et,{dateRange:l,selectedFilters:i}),(0,t.jsx)(ea,{value:d,onChange:m,entityType:a}),(0,t.jsx)(ee,{value:o,onChange:c})]}),p?(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-4 border-t",children:[(0,t.jsx)(Q.Skeleton.Button,{active:!0}),(0,t.jsx)(Q.Skeleton.Button,{active:!0})]}):(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-4 border-t",children:[(0,t.jsx)(X.Button,{variant:"outlined",onClick:s,disabled:u,children:"Cancel"}),(0,t.jsx)(X.Button,{onClick:()=>y(),loading:u||p,disabled:u||p,type:"primary",children:u?"Exporting...":`Export ${o.toUpperCase()}`})]})]})})},eo=({dateValue:e,entityType:s,spendData:a,showFilters:r=!1,filterLabel:l,filterPlaceholder:i,selectedFilters:n=[],onFiltersChange:o,filterOptions:c=[],customTitle:d,compactLayout:m=!1,teams:x=[]})=>{let[h,p]=(0,g.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)("div",{className:`grid ${r&&c.length>0?"grid-cols-[1fr_auto]":"grid-cols-[auto]"} items-end gap-4`,children:[r&&c.length>0&&(0,t.jsxs)("div",{children:[l&&(0,t.jsx)(u.Text,{className:"mb-2",children:l}),(0,t.jsx)(K.Select,{mode:"multiple",style:{width:"100%"},placeholder:i,value:n,onChange:o,options:c,allowClear:!0})]}),(0,t.jsx)("div",{className:"justify-self-end",children:(0,t.jsx)(q.Button,{onClick:()=>p(!0),icon:()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),children:"Export Data"})})]})}),(0,t.jsx)(en,{isOpen:h,onClose:()=>p(!1),entityType:s,spendData:a,dateRange:e,selectedFilters:n,customTitle:d,teams:x})]})};e.i(247167);var ec=e.i(931067);let ed={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"}}]},name:"calendar",theme:"outlined"};var em=e.i(9583),eu=g.forwardRef(function(e,t){return g.createElement(em.default,(0,ec.default)({},e,{ref:t,icon:ed}))}),ex=e.i(637235),eh=e.i(166540);let ep=[{label:"Today",shortLabel:"today",getValue:()=>({from:(0,eh.default)().startOf("day").toDate(),to:(0,eh.default)().endOf("day").toDate()})},{label:"Last 7 days",shortLabel:"7d",getValue:()=>({from:(0,eh.default)().subtract(7,"days").startOf("day").toDate(),to:(0,eh.default)().endOf("day").toDate()})},{label:"Last 30 days",shortLabel:"30d",getValue:()=>({from:(0,eh.default)().subtract(30,"days").startOf("day").toDate(),to:(0,eh.default)().endOf("day").toDate()})},{label:"Month to date",shortLabel:"MTD",getValue:()=>({from:(0,eh.default)().startOf("month").toDate(),to:(0,eh.default)().endOf("day").toDate()})},{label:"Year to date",shortLabel:"YTD",getValue:()=>({from:(0,eh.default)().startOf("year").toDate(),to:(0,eh.default)().endOf("day").toDate()})}],ef=({value:e,onValueChange:s,label:a="Select Time Range",showTimeRange:r=!0})=>{let[l,i]=(0,g.useState)(!1),[n,o]=(0,g.useState)(e),[c,d]=(0,g.useState)(null),[m,x]=(0,g.useState)(""),[h,p]=(0,g.useState)(""),f=(0,g.useRef)(null),_=(0,g.useCallback)(e=>{if(!e.from||!e.to)return null;for(let t of ep){let s=t.getValue(),a=(0,eh.default)(e.from).isSame((0,eh.default)(s.from),"day"),r=(0,eh.default)(e.to).isSame((0,eh.default)(s.to),"day");if(a&&r)return t.shortLabel}return null},[]);(0,g.useEffect)(()=>{d(_(e))},[e,_]);let j=(0,g.useCallback)(()=>{if(!m||!h)return{isValid:!0,error:""};let e=(0,eh.default)(m,"YYYY-MM-DD"),t=(0,eh.default)(h,"YYYY-MM-DD");return e.isValid()&&t.isValid()?t.isBefore(e)?{isValid:!1,error:"End date cannot be before start date"}:{isValid:!0,error:""}:{isValid:!1,error:"Invalid date format"}},[m,h])();(0,g.useEffect)(()=>{e.from&&x((0,eh.default)(e.from).format("YYYY-MM-DD")),e.to&&p((0,eh.default)(e.to).format("YYYY-MM-DD")),o(e)},[e]),(0,g.useEffect)(()=>{let e=e=>{f.current&&!f.current.contains(e.target)&&i(!1)};return l&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[l]);let y=(0,g.useCallback)((e,t)=>{if(!e||!t)return"Select date range";let s=e=>(0,eh.default)(e).format("D MMM, HH:mm");return`${s(e)} - ${s(t)}`},[]),b=(0,g.useCallback)(e=>{let t;if(!e.from)return e;let s={...e},a=new Date(e.from);return t=new Date(e.to?e.to:e.from),a.toDateString()===t.toDateString(),a.setHours(0,0,0,0),t.setHours(23,59,59,999),s.from=a,s.to=t,s},[]),k=(0,g.useCallback)(()=>{try{if(m&&h&&j.isValid){let e=(0,eh.default)(m,"YYYY-MM-DD").startOf("day"),t=(0,eh.default)(h,"YYYY-MM-DD").endOf("day");if(e.isValid()&&t.isValid()){let s={from:e.toDate(),to:t.toDate()};o(s);let a=_(s);d(a)}}}catch(e){console.warn("Invalid date format:",e)}},[m,h,j.isValid,_]);return(0,g.useEffect)(()=>{k()},[k]),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[a&&(0,t.jsx)(u.Text,{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:a}),(0,t.jsxs)("div",{className:"relative",ref:f,children:[(0,t.jsx)("div",{className:"w-[300px] px-3 py-2 text-sm border border-gray-300 rounded-md bg-white cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",onClick:()=>i(!l),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ex.ClockCircleOutlined,{className:"text-gray-600"}),(0,t.jsx)("span",{className:"text-gray-900",children:y(e.from,e.to)})]}),(0,t.jsx)("svg",{className:`w-4 h-4 text-gray-400 transition-transform ${l?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),l&&(0,t.jsx)("div",{className:"absolute top-full right-0 z-[9999] min-w-[600px] mt-1 bg-white border border-gray-200 rounded-lg shadow-xl",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("div",{className:"w-1/2 border-r border-gray-200",children:[(0,t.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Relative time"})}),(0,t.jsx)("div",{className:"h-[350px] overflow-y-auto",children:ep.map(e=>{let s=c===e.shortLabel;return(0,t.jsxs)("div",{className:`flex items-center justify-between px-5 py-4 cursor-pointer border-b border-gray-100 transition-colors ${s?"bg-blue-50 hover:bg-blue-100 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>(e=>{let{from:t,to:s}=e.getValue();o({from:t,to:s}),d(e.shortLabel),x((0,eh.default)(t).format("YYYY-MM-DD")),p((0,eh.default)(s).format("YYYY-MM-DD"))})(e),children:[(0,t.jsx)("span",{className:`text-sm ${s?"text-blue-700 font-medium":"text-gray-700"}`,children:e.label}),(0,t.jsx)("span",{className:`text-xs px-2 py-1 rounded capitalize ${s?"text-blue-700 bg-blue-100":"text-gray-500 bg-gray-100"}`,children:e.shortLabel})]},e.label)})})]}),(0,t.jsxs)("div",{className:"w-1/2 relative",children:[(0,t.jsx)("div",{className:"p-3.5 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eu,{className:"text-gray-600"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Start and end dates"})]})}),(0,t.jsxs)("div",{className:"p-6 space-y-6 pb-20",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-700 mb-1 block",children:"Start date"}),(0,t.jsx)("input",{type:"date",value:m,onChange:e=>x(e.target.value),className:`w-65 px-3 py-2 text-sm border rounded-md cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 ${!j.isValid?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300"}`})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-700 mb-1 block",children:"End date"}),(0,t.jsx)("input",{type:"date",value:h,onChange:e=>p(e.target.value),className:`w-65 px-3 py-2 text-sm border rounded-md cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 ${!j.isValid?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300"}`})]}),!j.isValid&&j.error&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,t.jsx)("span",{className:"text-sm text-red-700 font-medium",children:j.error})]})}),n.from&&n.to&&j.isValid&&(0,t.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md space-y-1",children:[(0,t.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,t.jsx)("span",{className:"font-medium",children:"From:"})," ",(0,eh.default)(n.from).format("MMM D, YYYY [at] HH:mm:ss")]}),(0,t.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,t.jsx)("span",{className:"font-medium",children:"To:"})," ",(0,eh.default)(n.to).format("MMM D, YYYY [at] HH:mm:ss")]})]})]}),(0,t.jsx)("div",{className:"absolute bottom-4 right-4",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(q.Button,{variant:"secondary",onClick:()=>{o(e),e.from&&x((0,eh.default)(e.from).format("YYYY-MM-DD")),e.to&&p((0,eh.default)(e.to).format("YYYY-MM-DD")),d(_(e)),i(!1)},children:"Cancel"}),(0,t.jsx)(q.Button,{onClick:()=>{n.from&&n.to&&j.isValid&&(s(n),requestIdleCallback(()=>{s(b(n))},{timeout:100}),i(!1))},disabled:!n.from||!n.to||!j.isValid,children:"Apply"})]})})]})]})})]})]})};var eg=e.i(571303);let e_=({isDateChanging:e=!1})=>(0,t.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)(eg.UiLoadingSpinner,{className:"size-5"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-gray-600 text-sm font-medium",children:e?"Processing date selection...":"Loading chart data..."}),(0,t.jsx)("span",{className:"text-gray-400 text-xs mt-1",children:e?"This will only take a moment":"Fetching your data"})]})]})});var ej=e.i(290571),ey=e.i(95779),eb=e.i(444755),ek=e.i(673706);let ev=g.default.forwardRef((e,t)=>{let{color:s,children:a,className:r}=e,l=(0,ej.__rest)(e,["color","children","className"]);return g.default.createElement("p",Object.assign({ref:t,className:(0,eb.tremorTwMerge)("font-semibold text-tremor-metric",s?(0,ek.getColorClassNames)(s,ey.colorPalette.darkText).textColor:"text-tremor-content-strong dark:text-dark-tremor-content-strong",r)},l),a)});ev.displayName="Metric";var eN=e.i(37091),eT=e.i(269200),eC=e.i(427612),ew=e.i(496020),eq=e.i(64848),eS=e.i(942232),eL=e.i(977572);let eD=({accessToken:e,selectedTags:s,formatAbbreviatedNumber:r})=>{let l,i,h,p,[f,j]=(0,g.useState)({results:[],total_count:0,page:1,page_size:50,total_pages:0}),[y,b]=(0,g.useState)(!1),[k,v]=(0,g.useState)(1),N=async()=>{if(e){b(!0);try{let t=await (0,_.perUserAnalyticsCall)(e,k,50,s.length>0?s:void 0);j(t)}catch(e){console.error("Failed to fetch per-user data:",e)}finally{b(!1)}}};return(0,g.useEffect)(()=>{N()},[e,s,k]),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)(x.Title,{children:"Per User Usage"}),(0,t.jsx)(eN.Subtitle,{children:"Individual developer usage metrics"}),(0,t.jsxs)(o.TabGroup,{children:[(0,t.jsxs)(c.TabList,{className:"mb-6",children:[(0,t.jsx)(n.Tab,{children:"User Details"}),(0,t.jsx)(n.Tab,{children:"Usage Distribution"})]}),(0,t.jsxs)(m.TabPanels,{children:[(0,t.jsxs)(d.TabPanel,{children:[(0,t.jsxs)(eT.Table,{children:[(0,t.jsx)(eC.TableHead,{children:(0,t.jsxs)(ew.TableRow,{children:[(0,t.jsx)(eq.TableHeaderCell,{children:"User ID"}),(0,t.jsx)(eq.TableHeaderCell,{children:"User Email"}),(0,t.jsx)(eq.TableHeaderCell,{children:"User Agent"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-right",children:"Success Generations"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-right",children:"Total Tokens"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-right",children:"Failed Requests"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-right",children:"Total Cost"})]})}),(0,t.jsx)(eS.TableBody,{children:f.results.slice(0,10).map((e,s)=>(0,t.jsxs)(ew.TableRow,{children:[(0,t.jsx)(eL.TableCell,{children:(0,t.jsx)(u.Text,{className:"font-medium",children:e.user_id})}),(0,t.jsx)(eL.TableCell,{children:(0,t.jsx)(u.Text,{children:e.user_email||"N/A"})}),(0,t.jsx)(eL.TableCell,{children:(0,t.jsx)(u.Text,{children:e.user_agent||"Unknown"})}),(0,t.jsx)(eL.TableCell,{className:"text-right",children:(0,t.jsx)(u.Text,{children:r(e.successful_requests)})}),(0,t.jsx)(eL.TableCell,{className:"text-right",children:(0,t.jsx)(u.Text,{children:r(e.total_tokens)})}),(0,t.jsx)(eL.TableCell,{className:"text-right",children:(0,t.jsx)(u.Text,{children:r(e.failed_requests)})}),(0,t.jsx)(eL.TableCell,{className:"text-right",children:(0,t.jsxs)(u.Text,{children:["$",r(e.spend,4)]})})]},s))})]}),f.results.length>10&&(0,t.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,t.jsxs)(u.Text,{className:"text-sm text-gray-500",children:["Showing 10 of ",f.total_count," results"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(q.Button,{size:"sm",variant:"secondary",onClick:()=>{k>1&&v(k-1)},disabled:1===k,children:"Previous"}),(0,t.jsx)(q.Button,{size:"sm",variant:"secondary",onClick:()=>{k<f.total_pages&&v(k+1)},disabled:k>=f.total_pages,children:"Next"})]})]})]}),(0,t.jsxs)(d.TabPanel,{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)(x.Title,{className:"text-lg",children:"User Usage Distribution"}),(0,t.jsx)(eN.Subtitle,{children:"Number of users by successful request frequency"})]}),(0,t.jsx)(a.BarChart,{data:(l=new Map,f.results.forEach(e=>{let t=e.user_agent||"Unknown";l.set(t,(l.get(t)||0)+1)}),i=Array.from(l.entries()).sort(([,e],[,t])=>t-e).slice(0,8).map(([e])=>e),h={"1-9 requests":{range:[1,9],agents:{}},"10-99 requests":{range:[10,99],agents:{}},"100-999 requests":{range:[100,999],agents:{}},"1K-9.9K requests":{range:[1e3,9999],agents:{}},"10K-99.9K requests":{range:[1e4,99999],agents:{}},"100K+ requests":{range:[1e5,1/0],agents:{}}},f.results.forEach(e=>{let t=e.successful_requests,s=e.user_agent||"Unknown";i.includes(s)&&Object.entries(h).forEach(([e,a])=>{t>=a.range[0]&&t<=a.range[1]&&(a.agents[s]||(a.agents[s]=0),a.agents[s]++)})}),Object.entries(h).map(([e,t])=>{let s={category:e};return i.forEach(e=>{s[e]=t.agents[e]||0}),s})),index:"category",categories:(p=new Map,f.results.forEach(e=>{let t=e.user_agent||"Unknown";p.set(t,(p.get(t)||0)+1)}),Array.from(p.entries()).sort(([,e],[,t])=>t-e).slice(0,8).map(([e])=>e)),colors:["blue","green","orange","red","purple","yellow","pink","indigo"],valueFormatter:e=>`${e} users`,yAxisWidth:80,showLegend:!0,stack:!0})]})]})]})]})},eA=({accessToken:e,userRole:s,dateValue:l,onDateChange:h})=>{let[p,j]=(0,g.useState)({results:[]}),[y,b]=(0,g.useState)({results:[]}),[k,v]=(0,g.useState)({results:[]}),[N,T]=(0,g.useState)({results:[]}),[C,w]=(0,g.useState)(""),[q,S]=(0,g.useState)([]),[L,D]=(0,g.useState)([]),[A,E]=(0,g.useState)(!1),[O,F]=(0,g.useState)(!1),[M,$]=(0,g.useState)(!1),[U,V]=(0,g.useState)(!1),[R,z]=(0,g.useState)(!1),B=new Date,I=async()=>{if(e){E(!0);try{let t=await (0,_.tagDistinctCall)(e);S(t.results.map(e=>e.tag))}catch(e){console.error("Failed to fetch available tags:",e)}finally{E(!1)}}},P=async()=>{if(e){F(!0);try{let t=await (0,_.tagDauCall)(e,B,C||void 0,L.length>0?L:void 0);j(t)}catch(e){console.error("Failed to fetch DAU data:",e)}finally{F(!1)}}},W=async()=>{if(e){$(!0);try{let t=await (0,_.tagWauCall)(e,B,C||void 0,L.length>0?L:void 0);b(t)}catch(e){console.error("Failed to fetch WAU data:",e)}finally{$(!1)}}},Y=async()=>{if(e){V(!0);try{let t=await (0,_.tagMauCall)(e,B,C||void 0,L.length>0?L:void 0);v(t)}catch(e){console.error("Failed to fetch MAU data:",e)}finally{V(!1)}}},H=async()=>{if(e&&l.from&&l.to){z(!0);try{let t=await (0,_.userAgentSummaryCall)(e,l.from,l.to,L.length>0?L:void 0);T(t)}catch(e){console.error("Failed to fetch user agent summary data:",e)}finally{z(!1)}}};(0,g.useEffect)(()=>{I()},[e]),(0,g.useEffect)(()=>{if(!e)return;let t=setTimeout(()=>{P(),W(),Y()},50);return()=>clearTimeout(t)},[e,C,L]),(0,g.useEffect)(()=>{if(!l.from||!l.to)return;let e=setTimeout(()=>{H()},50);return()=>clearTimeout(e)},[e,l,L]);let G=e=>e.startsWith("User-Agent: ")?e.replace("User-Agent: ",""):e,Z=e=>Object.entries(e.reduce((e,t)=>(e[t.tag]=(e[t.tag]||0)+t.active_users,e),{})).sort(([,e],[,t])=>t-e).map(([e])=>e),J=Z(p.results).slice(0,10),X=Z(y.results).slice(0,10),Q=Z(k.results).slice(0,10),ee=(()=>{let e=[],t=new Date;for(let s=6;s>=0;s--){let a=new Date(t);a.setDate(a.getDate()-s);let r={date:a.toISOString().split("T")[0]};J.forEach(e=>{r[G(e)]=0}),e.push(r)}return p.results.forEach(t=>{let s=G(t.tag),a=e.find(e=>e.date===t.date);a&&(a[s]=t.active_users)}),e})(),et=(()=>{let e=[];for(let t=1;t<=7;t++){let s={week:`Week ${t}`};X.forEach(e=>{s[G(e)]=0}),e.push(s)}return y.results.forEach(t=>{let s=G(t.tag),a=t.date.match(/Week (\d+)/);if(a){let r=`Week ${a[1]}`,l=e.find(e=>e.week===r);l&&(l[s]=t.active_users)}}),e})(),es=(()=>{let e=[];for(let t=1;t<=7;t++){let s={month:`Month ${t}`};Q.forEach(e=>{s[G(e)]=0}),e.push(s)}return k.results.forEach(t=>{let s=G(t.tag),a=t.date.match(/Month (\d+)/);if(a){let r=`Month ${a[1]}`,l=e.find(e=>e.month===r);l&&(l[s]=t.active_users)}}),e})(),ea=(e,t=0)=>{if(e>=1e8||e>=1e7)return(e/1e6).toFixed(t)+"M";if(e>=1e6)return(e/1e6).toFixed(t)+"M";if(e>=1e4)return(e/1e3).toFixed(t)+"K";if(e>=1e3)return(e/1e3).toFixed(t)+"K";else return e.toFixed(t)};return(0,t.jsxs)("div",{className:"space-y-6 mt-6",children:[(0,t.jsx)(r.Card,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(x.Title,{children:"Summary by User Agent"}),(0,t.jsx)(eN.Subtitle,{children:"Performance metrics for different user agents"})]}),(0,t.jsxs)("div",{className:"w-96",children:[(0,t.jsx)(u.Text,{className:"text-sm font-medium block mb-2",children:"Filter by User Agents"}),(0,t.jsx)(K.Select,{mode:"multiple",placeholder:"All User Agents",value:L,onChange:D,style:{width:"100%"},showSearch:!0,allowClear:!0,loading:A,optionFilterProp:"label",className:"rounded-md",maxTagCount:"responsive",children:q.map(e=>{let s=G(e),a=s.length>50?`${s.substring(0,50)}...`:s;return(0,t.jsx)(K.Select.Option,{value:e,label:a,title:s,children:a},e)})})]})]}),R?(0,t.jsx)(e_,{isDateChanging:!1}):(0,t.jsxs)(i.Grid,{numItems:4,className:"gap-4",children:[(N.results||[]).slice(0,4).map((e,s)=>{let a=G(e.tag),l=a.length>15?a.substring(0,15)+"...":a;return(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(f.Tooltip,{title:a,placement:"top",children:(0,t.jsx)(x.Title,{className:"truncate",children:l})}),(0,t.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Text,{className:"text-sm text-gray-600",children:"Success Requests"}),(0,t.jsx)(ev,{className:"text-lg",children:ea(e.successful_requests)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Text,{className:"text-sm text-gray-600",children:"Total Tokens"}),(0,t.jsx)(ev,{className:"text-lg",children:ea(e.total_tokens)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Text,{className:"text-sm text-gray-600",children:"Total Cost"}),(0,t.jsxs)(ev,{className:"text-lg",children:["$",ea(e.total_spend,4)]})]})]})]},s)}),Array.from({length:Math.max(0,4-(N.results||[]).length)}).map((e,s)=>(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"No Data"}),(0,t.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Text,{className:"text-sm text-gray-600",children:"Success Requests"}),(0,t.jsx)(ev,{className:"text-lg",children:"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Text,{className:"text-sm text-gray-600",children:"Total Tokens"}),(0,t.jsx)(ev,{className:"text-lg",children:"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Text,{className:"text-sm text-gray-600",children:"Total Cost"}),(0,t.jsx)(ev,{className:"text-lg",children:"-"})]})]})]},`empty-${s}`))]})]})}),(0,t.jsx)(r.Card,{children:(0,t.jsxs)(o.TabGroup,{children:[(0,t.jsxs)(c.TabList,{className:"mb-6",children:[(0,t.jsx)(n.Tab,{children:"DAU/WAU/MAU"}),(0,t.jsx)(n.Tab,{children:"Per User Usage (Last 30 Days)"})]}),(0,t.jsxs)(m.TabPanels,{children:[(0,t.jsxs)(d.TabPanel,{children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)(x.Title,{children:"DAU, WAU & MAU per Agent"}),(0,t.jsx)(eN.Subtitle,{children:"Active users across different time periods"})]}),(0,t.jsxs)(o.TabGroup,{children:[(0,t.jsxs)(c.TabList,{className:"mb-6",children:[(0,t.jsx)(n.Tab,{children:"DAU"}),(0,t.jsx)(n.Tab,{children:"WAU"}),(0,t.jsx)(n.Tab,{children:"MAU"})]}),(0,t.jsxs)(m.TabPanels,{children:[(0,t.jsxs)(d.TabPanel,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(x.Title,{className:"text-lg",children:"Daily Active Users - Last 7 Days"})}),O?(0,t.jsx)(e_,{isDateChanging:!1}):(0,t.jsx)(a.BarChart,{data:ee,index:"date",categories:J.map(G),valueFormatter:e=>ea(e),yAxisWidth:60,showLegend:!0,stack:!0})]}),(0,t.jsxs)(d.TabPanel,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(x.Title,{className:"text-lg",children:"Weekly Active Users - Last 7 Weeks"})}),M?(0,t.jsx)(e_,{isDateChanging:!1}):(0,t.jsx)(a.BarChart,{data:et,index:"week",categories:X.map(G),valueFormatter:e=>ea(e),yAxisWidth:60,showLegend:!0,stack:!0})]}),(0,t.jsxs)(d.TabPanel,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(x.Title,{className:"text-lg",children:"Monthly Active Users - Last 7 Months"})}),U?(0,t.jsx)(e_,{isDateChanging:!1}):(0,t.jsx)(a.BarChart,{data:es,index:"month",categories:Q.map(G),valueFormatter:e=>ea(e),yAxisWidth:60,showLegend:!0,stack:!0})]})]})]})]}),(0,t.jsx)(d.TabPanel,{children:(0,t.jsx)(eD,{accessToken:e,selectedTags:L,formatAbbreviatedNumber:ea})})]})]})})]})};var eE=e.i(617802);let eO=({endpointData:e})=>{let s=e||{},l=g.default.useMemo(()=>Object.entries(s).map(([e,t])=>({endpoint:e,"metrics.successful_requests":t.metrics.successful_requests,"metrics.failed_requests":t.metrics.failed_requests,metrics:{successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests}})),[s]);return(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(x.Title,{children:"Success vs Failed Requests by Endpoint"}),(0,t.jsx)(O,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"]})]}),(0,t.jsx)(a.BarChart,{className:"mt-4",data:l,index:"endpoint",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"],valueFormatter:e=>e.toLocaleString(),customTooltip:E,showLegend:!1,stack:!0,yAxisWidth:60})]})};var eF=e.i(731195),eM=e.i(883966),e$=e.i(555706),eU=e.i(785183),eV=e.i(93230),eR=e.i(844171),ez=(0,eM.generateCategoricalChart)({chartName:"LineChart",GraphicalChild:e$.Line,axisComponents:[{axisType:"xAxis",AxisComp:eU.XAxis},{axisType:"yAxis",AxisComp:eV.YAxis}],formatAxisMap:eR.formatAxisMap}),eB=e.i(872526),eI=e.i(800494),eP=e.i(234239),eW=e.i(559559),eY=e.i(238279),eH=e.i(114887),eK=e.i(933303),eG=e.i(628781),eZ=e.i(472007),eJ=e.i(480731);let eX=g.default.forwardRef((e,t)=>{let{data:s=[],categories:a=[],index:r,colors:l=ey.themeColorRange,valueFormatter:i=ek.defaultValueFormatter,startEndOnly:n=!1,showXAxis:o=!0,showYAxis:c=!0,yAxisWidth:d=56,intervalType:m="equidistantPreserveStart",animationDuration:u=900,showAnimation:x=!1,showTooltip:h=!0,showLegend:p=!0,showGridLines:f=!0,autoMinValue:_=!1,curveType:j="linear",minValue:y,maxValue:b,connectNulls:k=!1,allowDecimals:v=!0,noDataText:N,className:T,onValueChange:C,enableLegendSlider:w=!1,customTooltip:q,rotateLabelX:S,padding:L=o||c?{left:20,right:20}:{left:0,right:0},tickGap:D=5,xAxisLabel:A,yAxisLabel:E}=e,O=(0,ej.__rest)(e,["data","categories","index","colors","valueFormatter","startEndOnly","showXAxis","showYAxis","yAxisWidth","intervalType","animationDuration","showAnimation","showTooltip","showLegend","showGridLines","autoMinValue","curveType","minValue","maxValue","connectNulls","allowDecimals","noDataText","className","onValueChange","enableLegendSlider","customTooltip","rotateLabelX","padding","tickGap","xAxisLabel","yAxisLabel"]),[F,M]=(0,g.useState)(60),[$,U]=(0,g.useState)(void 0),[V,R]=(0,g.useState)(void 0),z=(0,eZ.constructCategoryColors)(a,l),B=(0,eZ.getYAxisDomain)(_,y,b),I=!!C;function P(e){I&&(e===V&&!$||(0,eZ.hasOnlyOneValueForThisKey)(s,e)&&$&&$.dataKey===e?(R(void 0),null==C||C(null)):(R(e),null==C||C({eventType:"category",categoryClicked:e})),U(void 0))}return g.default.createElement("div",Object.assign({ref:t,className:(0,eb.tremorTwMerge)("w-full h-80",T)},O),g.default.createElement(eF.ResponsiveContainer,{className:"h-full w-full"},(null==s?void 0:s.length)?g.default.createElement(ez,{data:s,onClick:I&&(V||$)?()=>{U(void 0),R(void 0),null==C||C(null)}:void 0,margin:{bottom:A?30:void 0,left:E?20:void 0,right:E?5:void 0,top:5}},f?g.default.createElement(eB.CartesianGrid,{className:(0,eb.tremorTwMerge)("stroke-1","stroke-tremor-border","dark:stroke-dark-tremor-border"),horizontal:!0,vertical:!1}):null,g.default.createElement(eU.XAxis,{padding:L,hide:!o,dataKey:r,interval:n?"preserveStartEnd":m,tick:{transform:"translate(0, 6)"},ticks:n?[s[0][r],s[s.length-1][r]]:void 0,fill:"",stroke:"",className:(0,eb.tremorTwMerge)("text-tremor-label","fill-tremor-content","dark:fill-dark-tremor-content"),tickLine:!1,axisLine:!1,minTickGap:D,angle:null==S?void 0:S.angle,dy:null==S?void 0:S.verticalShift,height:null==S?void 0:S.xAxisHeight},A&&g.default.createElement(eI.Label,{position:"insideBottom",offset:-20,className:"fill-tremor-content-emphasis text-tremor-default font-medium dark:fill-dark-tremor-content-emphasis"},A)),g.default.createElement(eV.YAxis,{width:d,hide:!c,axisLine:!1,tickLine:!1,type:"number",domain:B,tick:{transform:"translate(-3, 0)"},fill:"",stroke:"",className:(0,eb.tremorTwMerge)("text-tremor-label","fill-tremor-content","dark:fill-dark-tremor-content"),tickFormatter:i,allowDecimals:v},E&&g.default.createElement(eI.Label,{position:"insideLeft",style:{textAnchor:"middle"},angle:-90,offset:-15,className:"fill-tremor-content-emphasis text-tremor-default font-medium dark:fill-dark-tremor-content-emphasis"},E)),g.default.createElement(eP.Tooltip,{wrapperStyle:{outline:"none"},isAnimationActive:!1,cursor:{stroke:"#d1d5db",strokeWidth:1},content:h?({active:e,payload:t,label:s})=>q?g.default.createElement(q,{payload:null==t?void 0:t.map(e=>{var t;return Object.assign(Object.assign({},e),{color:null!=(t=z.get(e.dataKey))?t:eJ.BaseColors.Gray})}),active:e,label:s}):g.default.createElement(eK.default,{active:e,payload:t,label:s,valueFormatter:i,categoryColors:z}):g.default.createElement(g.default.Fragment,null),position:{y:0}}),p?g.default.createElement(eW.Legend,{verticalAlign:"top",height:F,content:({payload:e})=>(0,eH.default)({payload:e},z,M,V,I?e=>P(e):void 0,w)}):null,a.map(e=>{var t;return g.default.createElement(e$.Line,{className:(0,eb.tremorTwMerge)((0,ek.getColorClassNames)(null!=(t=z.get(e))?t:eJ.BaseColors.Gray,ey.colorPalette.text).strokeColor),strokeOpacity:$||V&&V!==e?.3:1,activeDot:e=>{var t;let{cx:a,cy:r,stroke:l,strokeLinecap:i,strokeLinejoin:n,strokeWidth:o,dataKey:c}=e;return g.default.createElement(eY.Dot,{className:(0,eb.tremorTwMerge)("stroke-tremor-background dark:stroke-dark-tremor-background",C?"cursor-pointer":"",(0,ek.getColorClassNames)(null!=(t=z.get(c))?t:eJ.BaseColors.Gray,ey.colorPalette.text).fillColor),cx:a,cy:r,r:5,fill:"",stroke:l,strokeLinecap:i,strokeLinejoin:n,strokeWidth:o,onClick:(t,a)=>{a.stopPropagation(),I&&(e.index===(null==$?void 0:$.index)&&e.dataKey===(null==$?void 0:$.dataKey)||(0,eZ.hasOnlyOneValueForThisKey)(s,e.dataKey)&&V&&V===e.dataKey?(R(void 0),U(void 0),null==C||C(null)):(R(e.dataKey),U({index:e.index,dataKey:e.dataKey}),null==C||C(Object.assign({eventType:"dot",categoryClicked:e.dataKey},e.payload))))}})},dot:t=>{var a;let{stroke:r,strokeLinecap:l,strokeLinejoin:i,strokeWidth:n,cx:o,cy:c,dataKey:d,index:m}=t;return(0,eZ.hasOnlyOneValueForThisKey)(s,e)&&!($||V&&V!==e)||(null==$?void 0:$.index)===m&&(null==$?void 0:$.dataKey)===e?g.default.createElement(eY.Dot,{key:m,cx:o,cy:c,r:5,stroke:r,fill:"",strokeLinecap:l,strokeLinejoin:i,strokeWidth:n,className:(0,eb.tremorTwMerge)("stroke-tremor-background dark:stroke-dark-tremor-background",C?"cursor-pointer":"",(0,ek.getColorClassNames)(null!=(a=z.get(d))?a:eJ.BaseColors.Gray,ey.colorPalette.text).fillColor)}):g.default.createElement(g.Fragment,{key:m})},key:e,name:e,type:j,dataKey:e,stroke:"",strokeWidth:2,strokeLinejoin:"round",strokeLinecap:"round",isAnimationActive:x,animationDuration:u,connectNulls:k})}),C?a.map(e=>g.default.createElement(e$.Line,{className:(0,eb.tremorTwMerge)("cursor-pointer"),strokeOpacity:0,key:e,name:e,type:j,dataKey:e,stroke:"transparent",fill:"transparent",legendType:"none",tooltipType:"none",strokeWidth:12,connectNulls:k,onClick:(e,t)=>{t.stopPropagation();let{name:s}=e;P(s)}})):null):g.default.createElement(eG.default,{noDataText:N})))});eX.displayName="LineChart";let eQ=function({dailyData:e,endpointData:s}){let a=(0,g.useMemo)(()=>{var t;let s,a;return e?.results&&0!==e.results.length?(t=e.results,s=[],a=new Set,t.forEach(e=>{e.breakdown.endpoints&&Object.keys(e.breakdown.endpoints).forEach(e=>a.add(e))}),t.forEach(e=>{let t={date:new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})};a.forEach(s=>{let a=e.breakdown.endpoints?.[s];t[s]=a?.metrics.api_requests||0}),s.push(t)}),s.reverse()):[]},[e]),l=(0,g.useMemo)(()=>0===a.length?[]:Object.keys(a[0]).filter(e=>"date"!==e),[a]);return(0,t.jsxs)(r.Card,{className:"mb-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsx)(x.Title,{children:"Endpoint Usage Trends"})}),(0,t.jsx)(eX,{className:"h-80",data:a,index:"date",categories:l,colors:["blue","cyan","indigo","violet","purple","fuchsia","pink","rose","red","orange"].slice(0,l.length),valueFormatter:e=>e.toLocaleString(),showLegend:!0,showGridLines:!0,yAxisWidth:60,connectNulls:!0,curveType:"natural"})]})};var e0=e.i(309821);e.s(["Progress",()=>e0.default],497650);var e0=e0;let e1=({endpointData:e})=>{let s=Object.entries(e).map(([e,t])=>{var s,a;return{key:e,endpoint:e,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,api_requests:t.metrics.api_requests,total_tokens:t.metrics.total_tokens,spend:t.metrics.spend,successRate:(s=t.metrics.successful_requests,0===(a=t.metrics.api_requests)?0:s/a*100)}}),a=[{title:"Endpoint",dataIndex:"endpoint",key:"endpoint",render:e=>(0,t.jsx)("span",{className:"font-medium",children:e})},{title:"Successful / Failed",key:"requests",render:(e,s)=>{let a=s.api_requests>0?s.successful_requests/s.api_requests*100:0,r=s.api_requests>0?s.failed_requests/s.api_requests*100:0,l={"0%":"#22c55e"};return a>0&&a<100&&(l[`${a}%`]="#22c55e",l[`${a+.01}%`]="#ef4444"),l["100%"]=r>0?"#ef4444":"#22c55e",(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"flex-1 relative",children:(0,t.jsx)(e0.default,{percent:a+r,size:"small",strokeColor:l,showInfo:!1})}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm min-w-[100px]",children:[(0,t.jsx)("span",{className:"text-green-600 font-medium",children:s.successful_requests.toLocaleString()}),(0,t.jsx)("span",{className:"text-gray-400",children:"/"}),(0,t.jsx)("span",{className:"text-red-600 font-medium",children:s.failed_requests.toLocaleString()})]})]})}},{title:"Total Request",dataIndex:"api_requests",key:"api_requests",render:e=>e.toLocaleString()},{title:"Success Rate",dataIndex:"successRate",key:"successRate",render:e=>{let s=e.toFixed(2);return(0,t.jsxs)("span",{className:e>=95?"text-green-600 font-medium":e>=80?"text-yellow-600 font-medium":"text-red-600 font-medium",children:[s,"%"]})}},{title:"Total Tokens",dataIndex:"total_tokens",key:"total_tokens",render:e=>e.toLocaleString()},{title:"Spend",dataIndex:"spend",key:"spend",render:e=>`$${(0,w.formatNumberWithCommas)(e,2)}`}];return(0,t.jsx)(F.Table,{columns:a,dataSource:s,pagination:!1})},e2=({userSpendData:e})=>{let s=(0,g.useMemo)(()=>{let t={};return e?.results&&e.results.forEach(e=>{Object.entries(e.breakdown.endpoints||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:s.metadata||{},api_key_breakdown:{}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests||0,t[e].metrics.failed_requests+=s.metrics.failed_requests||0,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),t},[e]);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(e1,{endpointData:s}),(0,t.jsx)(eO,{endpointData:s}),(0,t.jsx)(eQ,{dailyData:e,endpointData:s})]})};var e4=e.i(214541),e3=e.i(413990),e6=e.i(916925),e5=e.i(1023),e7=e.i(149121);function e9({topModels:e,topModelsLimit:s,setTopModelsLimit:r}){let[l,i]=(0,g.useState)("table"),n=[{header:"Model",accessorKey:"key",cell:e=>e.getValue()||"-"},{header:"Spend (USD)",accessorKey:"spend",cell:e=>{let t=e.getValue();return`$${(0,w.formatNumberWithCommas)(t,2)}`}},{header:"Successful",accessorKey:"successful_requests",cell:e=>(0,t.jsx)("span",{className:"text-green-600",children:e.getValue()?.toLocaleString()||0})},{header:"Failed",accessorKey:"failed_requests",cell:e=>(0,t.jsx)("span",{className:"text-red-600",children:e.getValue()?.toLocaleString()||0})},{header:"Tokens",accessorKey:"tokens",cell:e=>e.getValue()?.toLocaleString()||0}],o=e.slice(0,s);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,t.jsx)(p.Segmented,{options:[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25},{label:"50",value:50}],value:s,onChange:e=>r(e)}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>i("table"),className:`px-3 py-1 text-sm rounded-md ${"table"===l?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Table View"}),(0,t.jsx)("button",{onClick:()=>i("chart"),className:`px-3 py-1 text-sm rounded-md ${"chart"===l?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Chart View"})]})]}),"chart"===l?(0,t.jsx)("div",{className:"relative max-h-[600px] overflow-y-auto",children:(0,t.jsx)(a.BarChart,{className:"mt-4 cursor-pointer hover:opacity-90",style:{height:52*Math.min(o.length,s)},data:o,index:"key",categories:["spend"],colors:["cyan"],valueFormatter:e=>`$${(0,w.formatNumberWithCommas)(e,2)}`,layout:"vertical",yAxisWidth:200,tickGap:5,showLegend:!1})}):(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden max-h-[600px] overflow-y-auto",children:(0,t.jsx)(e7.DataTable,{columns:n,data:o,renderSubComponent:()=>(0,t.jsx)(t.Fragment,{}),getRowCanExpand:()=>!1,isLoading:!1})})]})}let e8=({accessToken:e,entityType:s,entityId:h,entityList:p,dateValue:f})=>{let j,y,[b,k]=(0,g.useState)({results:[],metadata:{total_spend:0,total_api_requests:0,total_successful_requests:0,total_failed_requests:0,total_tokens:0}}),{teams:v}=(0,e4.default)(),N=B(b,"models",v||[]),T=B(b,"api_keys",v||[]),[C,q]=(0,g.useState)([]),[S,L]=(0,g.useState)(5),[D,A]=(0,g.useState)(5),E=async()=>{if(!e||!f.from||!f.to)return;let t=new Date(f.from),a=new Date(f.to);if("tag"===s)k(await (0,_.tagDailyActivityCall)(e,t,a,1,C.length>0?C:null));else if("team"===s)k(await (0,_.teamDailyActivityCall)(e,t,a,1,C.length>0?C:null));else if("organization"===s)k(await (0,_.organizationDailyActivityCall)(e,t,a,1,C.length>0?C:null));else if("customer"===s)k(await (0,_.customerDailyActivityCall)(e,t,a,1,C.length>0?C:null));else if("agent"===s)k(await (0,_.agentDailyActivityCall)(e,t,a,1,C.length>0?C:null));else throw Error("Invalid entity type")};(0,g.useEffect)(()=>{E()},[e,f,h,C]);let O=()=>{let e={};return b.results.forEach(t=>{Object.entries(t.breakdown.providers||{}).forEach(([t,s])=>{e[t]||(e[t]={provider:t,spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0});try{e[t].spend+=s.metrics.spend,e[t].requests+=s.metrics.api_requests,e[t].successful_requests+=s.metrics.successful_requests,e[t].failed_requests+=s.metrics.failed_requests,e[t].tokens+=s.metrics.total_tokens}catch(e){console.error(`Error processing provider ${t}: ${e}`)}})}),Object.values(e).filter(e=>e.spend>0).sort((e,t)=>t.spend-e.spend)},F=(e,t)=>{if(p){let t=p.find(t=>t.value===e);if(t)return t.label}return t?.team_alias?t.team_alias:e},M=()=>{var e;let t={};return b.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{alias:F(e,s.metadata),id:e}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests,t[e].metrics.failed_requests+=s.metrics.failed_requests,t[e].metrics.total_tokens+=s.metrics.total_tokens})}),e=Object.values(t).sort((e,t)=>t.metrics.spend-e.metrics.spend),0===C.length?e:e.filter(e=>C.includes(e.metadata.id))},$=s.charAt(0).toUpperCase()+s.slice(1);return(0,t.jsxs)("div",{style:{width:"100%"},className:"relative",children:[(0,t.jsx)(eo,{dateValue:f,entityType:s,spendData:b,showFilters:null!==p&&p.length>0,filterLabel:`Filter by ${s}`,filterPlaceholder:`Select ${s} to filter...`,selectedFilters:C,onFiltersChange:q,filterOptions:(()=>{if(p)return p})()||void 0,teams:v||[]}),(0,t.jsxs)(o.TabGroup,{children:[(0,t.jsxs)(c.TabList,{variant:"solid",className:"mt-1",children:[(0,t.jsx)(n.Tab,{children:"Cost"}),(0,t.jsx)(n.Tab,{children:"agent"===s?"Request / Token Consumption":"Model Activity"}),(0,t.jsx)(n.Tab,{children:"Key Activity"}),(0,t.jsx)(n.Tab,{children:"Endpoint Activity"})]}),(0,t.jsxs)(m.TabPanels,{children:[(0,t.jsx)(d.TabPanel,{children:(0,t.jsxs)(i.Grid,{numItems:2,className:"gap-2 w-full",children:[(0,t.jsx)(l.Col,{numColSpan:2,children:(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)(x.Title,{children:[$," Spend Overview"]}),(0,t.jsxs)(i.Grid,{numItems:5,className:"gap-4 mt-4",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Total Spend"}),(0,t.jsxs)(u.Text,{className:"text-2xl font-bold mt-2",children:["$",(0,w.formatNumberWithCommas)(b.metadata.total_spend,2)]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Total Requests"}),(0,t.jsx)(u.Text,{className:"text-2xl font-bold mt-2",children:b.metadata.total_api_requests.toLocaleString()})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Successful Requests"}),(0,t.jsx)(u.Text,{className:"text-2xl font-bold mt-2 text-green-600",children:b.metadata.total_successful_requests.toLocaleString()})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Failed Requests"}),(0,t.jsx)(u.Text,{className:"text-2xl font-bold mt-2 text-red-600",children:b.metadata.total_failed_requests.toLocaleString()})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Total Tokens"}),(0,t.jsx)(u.Text,{className:"text-2xl font-bold mt-2",children:b.metadata.total_tokens.toLocaleString()})]})]})]})}),(0,t.jsx)(l.Col,{numColSpan:2,children:(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Daily Spend"}),(0,t.jsx)(a.BarChart,{data:[...b.results].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),index:"date",categories:["metrics.spend"],colors:["cyan"],valueFormatter:V,yAxisWidth:100,showLegend:!1,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload,r=Object.keys(a.breakdown.entities||{}).length;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.date}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Total Spend: $",(0,w.formatNumberWithCommas)(a.metrics.spend,2)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total Requests: ",a.metrics.api_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Successful: ",a.metrics.successful_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Failed: ",a.metrics.failed_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total Tokens: ",a.metrics.total_tokens]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total ",$,"s: ",r]}),(0,t.jsxs)("div",{className:"mt-2 border-t pt-2",children:[(0,t.jsxs)("p",{className:"font-semibold",children:["Spend by ",$,":"]}),Object.entries(a.breakdown.entities||{}).sort(([,e],[,t])=>{let s=e.metrics.spend;return t.metrics.spend-s}).slice(0,5).map(([e,s])=>(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[F(e,s.metadata),": $",(0,w.formatNumberWithCommas)(s.metrics.spend,2)]},e)),r>5&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 italic",children:["...and ",r-5," more"]})]})]})}})]})}),(0,t.jsx)(l.Col,{numColSpan:2,children:(0,t.jsx)(r.Card,{children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,t.jsxs)(x.Title,{children:["Spend Per ",$]}),(0,t.jsx)(eN.Subtitle,{className:"text-xs",children:"Showing Top 5 by Spend"}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,t.jsxs)("span",{children:["Get Started by Tracking cost per ",$," "]}),(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/enterprise#spend-tracking",className:"text-blue-500 hover:text-blue-700 ml-1",children:"here"})]})]}),(0,t.jsxs)(i.Grid,{numItems:2,className:"gap-6",children:[(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsx)(a.BarChart,{className:"mt-4 h-52",data:M().slice(0,5).map(e=>({...e,metadata:{...e.metadata,alias_display:e.metadata.alias&&e.metadata.alias.length>15?`${e.metadata.alias.slice(0,15)}...`:e.metadata.alias}})),index:"metadata.alias_display",categories:["metrics.spend"],colors:["cyan"],valueFormatter:V,layout:"vertical",showLegend:!1,yAxisWidth:150,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.metadata.alias}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,w.formatNumberWithCommas)(a.metrics.spend,4)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Requests: ",a.metrics.api_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-green-600",children:["Successful: ",a.metrics.successful_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-red-600",children:["Failed: ",a.metrics.failed_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",a.metrics.total_tokens.toLocaleString()]})]})}})}),(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsx)("div",{className:"h-52 overflow-y-auto",children:(0,t.jsxs)(eT.Table,{children:[(0,t.jsx)(eC.TableHead,{children:(0,t.jsxs)(ew.TableRow,{children:[(0,t.jsx)(eq.TableHeaderCell,{children:$}),(0,t.jsx)(eq.TableHeaderCell,{children:"Spend"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-green-600",children:"Successful"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-red-600",children:"Failed"}),(0,t.jsx)(eq.TableHeaderCell,{children:"Tokens"})]})}),(0,t.jsx)(eS.TableBody,{children:M().filter(e=>e.metrics.spend>0).map(e=>(0,t.jsxs)(ew.TableRow,{children:[(0,t.jsx)(eL.TableCell,{children:e.metadata.alias}),(0,t.jsxs)(eL.TableCell,{children:["$",(0,w.formatNumberWithCommas)(e.metrics.spend,4)]}),(0,t.jsx)(eL.TableCell,{className:"text-green-600",children:e.metrics.successful_requests.toLocaleString()}),(0,t.jsx)(eL.TableCell,{className:"text-red-600",children:e.metrics.failed_requests.toLocaleString()}),(0,t.jsx)(eL.TableCell,{children:e.metrics.total_tokens.toLocaleString()})]},e.metadata.id))})]})})})]})]})})}),(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Top Virtual Keys"}),(0,t.jsx)(e5.default,{topKeys:(console.log("debugTags",{spendData:b}),j={},b.results.forEach(e=>{let{breakdown:t}=e,{entities:s}=t;console.log("debugTags",{entities:s});let a=Object.keys(s).reduce((e,t)=>{let{api_key_breakdown:a}=s[t];return Object.keys(a).forEach(s=>{let r={tag:t,usage:a[s].metrics.spend};e[s]?e[s].push(r):e[s]=[r]}),e},{});console.log("debugTags",{tagDictionary:a}),Object.entries(e.breakdown.api_keys||{}).forEach(([e,t])=>{j[e]||(j[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{key_alias:t.metadata.key_alias,team_id:t.metadata.team_id||null,tags:a[e]||[]}},console.log("debugTags",{keySpend:j})),j[e].metrics.spend+=t.metrics.spend,j[e].metrics.prompt_tokens+=t.metrics.prompt_tokens,j[e].metrics.completion_tokens+=t.metrics.completion_tokens,j[e].metrics.total_tokens+=t.metrics.total_tokens,j[e].metrics.api_requests+=t.metrics.api_requests,j[e].metrics.successful_requests+=t.metrics.successful_requests,j[e].metrics.failed_requests+=t.metrics.failed_requests,j[e].metrics.cache_read_input_tokens+=t.metrics.cache_read_input_tokens||0,j[e].metrics.cache_creation_input_tokens+=t.metrics.cache_creation_input_tokens||0})}),Object.entries(j).map(([e,t])=>({api_key:e,key_alias:t.metadata.key_alias||"-",tags:t.metadata.tags||"-",spend:t.metrics.spend})).sort((e,t)=>t.spend-e.spend).slice(0,S)),teams:null,showTags:"tag"===s,topKeysLimit:S,setTopKeysLimit:L})]})}),(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"agent"===s?"Top Agents":"Top Models"}),(0,t.jsx)(e9,{topModels:(y={},b.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(([e,t])=>{y[e]||(y[e]={spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0});try{y[e].spend+=t.metrics.spend}catch(s){console.error(`Error adding spend for ${e}: ${s}, got metrics: ${JSON.stringify(t)}`)}y[e].requests+=t.metrics.api_requests,y[e].successful_requests+=t.metrics.successful_requests,y[e].failed_requests+=t.metrics.failed_requests,y[e].tokens+=t.metrics.total_tokens})}),Object.entries(y).map(([e,t])=>({key:e,...t})).sort((e,t)=>t.spend-e.spend).slice(0,D)),topModelsLimit:D,setTopModelsLimit:A})]})}),(0,t.jsx)(l.Col,{numColSpan:2,children:(0,t.jsx)(r.Card,{children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsx)(x.Title,{children:"Provider Usage"}),(0,t.jsxs)(i.Grid,{numItems:2,children:[(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsx)(e3.DonutChart,{className:"mt-4 h-40",data:O(),index:"provider",category:"spend",valueFormatter:e=>`$${(0,w.formatNumberWithCommas)(e,2)}`,colors:["cyan","blue","indigo","violet","purple"]})}),(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsxs)(eT.Table,{children:[(0,t.jsx)(eC.TableHead,{children:(0,t.jsxs)(ew.TableRow,{children:[(0,t.jsx)(eq.TableHeaderCell,{children:"Provider"}),(0,t.jsx)(eq.TableHeaderCell,{children:"Spend"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-green-600",children:"Successful"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-red-600",children:"Failed"}),(0,t.jsx)(eq.TableHeaderCell,{children:"Tokens"})]})}),(0,t.jsx)(eS.TableBody,{children:O().map(e=>(0,t.jsxs)(ew.TableRow,{children:[(0,t.jsx)(eL.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[e.provider&&(0,t.jsx)("img",{src:(0,e6.getProviderLogoAndName)(e.provider).logo,alt:`${e.provider} logo`,className:"w-4 h-4",onError:t=>{let s=t.target,a=s.parentElement;if(a){let t=document.createElement("div");t.className="w-4 h-4 rounded-full bg-gray-200 flex items-center justify-center text-xs",t.textContent=e.provider?.charAt(0)||"-",a.replaceChild(t,s)}}}),(0,t.jsx)("span",{children:e.provider})]})}),(0,t.jsxs)(eL.TableCell,{children:["$",(0,w.formatNumberWithCommas)(e.spend,2)]}),(0,t.jsx)(eL.TableCell,{className:"text-green-600",children:e.successful_requests.toLocaleString()}),(0,t.jsx)(eL.TableCell,{className:"text-red-600",children:e.failed_requests.toLocaleString()}),(0,t.jsx)(eL.TableCell,{children:e.tokens.toLocaleString()})]},e.provider))})]})})]})]})})})]})}),(0,t.jsx)(d.TabPanel,{children:(0,t.jsx)(z,{modelMetrics:N,hidePromptCachingMetrics:"agent"===s})}),(0,t.jsx)(d.TabPanel,{children:(0,t.jsx)(z,{modelMetrics:T,hidePromptCachingMetrics:"agent"===s})}),(0,t.jsx)(d.TabPanel,{children:(0,t.jsx)(e2,{userSpendData:b})})]})]})]})};var te=e.i(793130),tt=e.i(418371);let ts=({loading:e,isDateChanging:a,providerSpend:n})=>{let[o,c]=(0,g.useState)(!1),[d,m]=(0,g.useState)(!1),u=n.filter(e=>e.provider?.toLowerCase()==="unknown"?d:!!o||e.spend>0);return(0,t.jsxs)(r.Card,{className:"h-full",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(x.Title,{children:"Spend by Provider"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm text-gray-700",children:"Show Zero Spend"}),(0,t.jsx)(te.Switch,{checked:o,onChange:c})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("label",{className:"text-sm text-gray-700",children:"Show Unknown"}),(0,t.jsx)(f.Tooltip,{title:"Requests that failed to route to a provider",children:(0,t.jsx)(s.InfoCircleOutlined,{className:"text-gray-400 hover:text-gray-600"})})]}),(0,t.jsx)(te.Switch,{checked:d,onChange:m})]})]})]}),e?(0,t.jsx)(e_,{isDateChanging:a}):(0,t.jsxs)(i.Grid,{numItems:2,children:[(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsx)(e3.DonutChart,{className:"mt-4 h-40",data:u,index:"provider",category:"spend",valueFormatter:e=>`$${(0,w.formatNumberWithCommas)(e,2)}`,colors:["cyan"]})}),(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsxs)(eT.Table,{children:[(0,t.jsx)(eC.TableHead,{children:(0,t.jsxs)(ew.TableRow,{children:[(0,t.jsx)(eq.TableHeaderCell,{children:"Provider"}),(0,t.jsx)(eq.TableHeaderCell,{children:"Spend"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-green-600",children:"Successful"}),(0,t.jsx)(eq.TableHeaderCell,{className:"text-red-600",children:"Failed"}),(0,t.jsx)(eq.TableHeaderCell,{children:"Tokens"})]})}),(0,t.jsx)(eS.TableBody,{children:u.map(e=>(0,t.jsxs)(ew.TableRow,{children:[(0,t.jsx)(eL.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[e.provider&&(0,t.jsx)(tt.ProviderLogo,{provider:e.provider,className:"w-4 h-4"}),(0,t.jsx)("span",{children:e.provider})]})}),(0,t.jsxs)(eL.TableCell,{children:["$",(0,w.formatNumberWithCommas)(e.spend,2)]}),(0,t.jsx)(eL.TableCell,{className:"text-green-600",children:e.successful_requests.toLocaleString()}),(0,t.jsx)(eL.TableCell,{className:"text-red-600",children:e.failed_requests.toLocaleString()}),(0,t.jsx)(eL.TableCell,{children:e.tokens.toLocaleString()})]},e.provider))})]})})]})]})};var ta=e.i(299251),tr=e.i(153702);let tl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.4 800.9c.2-.3.5-.6.7-.9C920.6 722.1 960 621.7 960 512s-39.4-210.1-104.8-288c-.2-.3-.5-.5-.7-.8-1.1-1.3-2.1-2.5-3.2-3.7-.4-.5-.8-.9-1.2-1.4l-4.1-4.7-.1-.1c-1.5-1.7-3.1-3.4-4.6-5.1l-.1-.1c-3.2-3.4-6.4-6.8-9.7-10.1l-.1-.1-4.8-4.8-.3-.3c-1.5-1.5-3-2.9-4.5-4.3-.5-.5-1-1-1.6-1.5-1-1-2-1.9-3-2.8-.3-.3-.7-.6-1-1C736.4 109.2 629.5 64 512 64s-224.4 45.2-304.3 119.2c-.3.3-.7.6-1 1-1 .9-2 1.9-3 2.9-.5.5-1 1-1.6 1.5-1.5 1.4-3 2.9-4.5 4.3l-.3.3-4.8 4.8-.1.1c-3.3 3.3-6.5 6.7-9.7 10.1l-.1.1c-1.6 1.7-3.1 3.4-4.6 5.1l-.1.1c-1.4 1.5-2.8 3.1-4.1 4.7-.4.5-.8.9-1.2 1.4-1.1 1.2-2.1 2.5-3.2 3.7-.2.3-.5.5-.7.8C103.4 301.9 64 402.3 64 512s39.4 210.1 104.8 288c.2.3.5.6.7.9l3.1 3.7c.4.5.8.9 1.2 1.4l4.1 4.7c0 .1.1.1.1.2 1.5 1.7 3 3.4 4.6 5l.1.1c3.2 3.4 6.4 6.8 9.6 10.1l.1.1c1.6 1.6 3.1 3.2 4.7 4.7l.3.3c3.3 3.3 6.7 6.5 10.1 9.6 80.1 74 187 119.2 304.5 119.2s224.4-45.2 304.3-119.2a300 300 0 0010-9.6l.3-.3c1.6-1.6 3.2-3.1 4.7-4.7l.1-.1c3.3-3.3 6.5-6.7 9.6-10.1l.1-.1c1.5-1.7 3.1-3.3 4.6-5 0-.1.1-.1.1-.2 1.4-1.5 2.8-3.1 4.1-4.7.4-.5.8-.9 1.2-1.4a99 99 0 003.3-3.7zm4.1-142.6c-13.8 32.6-32 62.8-54.2 90.2a444.07 444.07 0 00-81.5-55.9c11.6-46.9 18.8-98.4 20.7-152.6H887c-3 40.9-12.6 80.6-28.5 118.3zM887 484H743.5c-1.9-54.2-9.1-105.7-20.7-152.6 29.3-15.6 56.6-34.4 81.5-55.9A373.86 373.86 0 01887 484zM658.3 165.5c39.7 16.8 75.8 40 107.6 69.2a394.72 394.72 0 01-59.4 41.8c-15.7-45-35.8-84.1-59.2-115.4 3.7 1.4 7.4 2.9 11 4.4zm-90.6 700.6c-9.2 7.2-18.4 12.7-27.7 16.4V697a389.1 389.1 0 01115.7 26.2c-8.3 24.6-17.9 47.3-29 67.8-17.4 32.4-37.8 58.3-59 75.1zm59-633.1c11 20.6 20.7 43.3 29 67.8A389.1 389.1 0 01540 327V141.6c9.2 3.7 18.5 9.1 27.7 16.4 21.2 16.7 41.6 42.6 59 75zM540 640.9V540h147.5c-1.6 44.2-7.1 87.1-16.3 127.8l-.3 1.2A445.02 445.02 0 00540 640.9zm0-156.9V383.1c45.8-2.8 89.8-12.5 130.9-28.1l.3 1.2c9.2 40.7 14.7 83.5 16.3 127.8H540zm-56 56v100.9c-45.8 2.8-89.8 12.5-130.9 28.1l-.3-1.2c-9.2-40.7-14.7-83.5-16.3-127.8H484zm-147.5-56c1.6-44.2 7.1-87.1 16.3-127.8l.3-1.2c41.1 15.6 85 25.3 130.9 28.1V484H336.5zM484 697v185.4c-9.2-3.7-18.5-9.1-27.7-16.4-21.2-16.7-41.7-42.7-59.1-75.1-11-20.6-20.7-43.3-29-67.8 37.2-14.6 75.9-23.3 115.8-26.1zm0-370a389.1 389.1 0 01-115.7-26.2c8.3-24.6 17.9-47.3 29-67.8 17.4-32.4 37.8-58.4 59.1-75.1 9.2-7.2 18.4-12.7 27.7-16.4V327zM365.7 165.5c3.7-1.5 7.3-3 11-4.4-23.4 31.3-43.5 70.4-59.2 115.4-21-12-40.9-26-59.4-41.8 31.8-29.2 67.9-52.4 107.6-69.2zM165.5 365.7c13.8-32.6 32-62.8 54.2-90.2 24.9 21.5 52.2 40.3 81.5 55.9-11.6 46.9-18.8 98.4-20.7 152.6H137c3-40.9 12.6-80.6 28.5-118.3zM137 540h143.5c1.9 54.2 9.1 105.7 20.7 152.6a444.07 444.07 0 00-81.5 55.9A373.86 373.86 0 01137 540zm228.7 318.5c-39.7-16.8-75.8-40-107.6-69.2 18.5-15.8 38.4-29.7 59.4-41.8 15.7 45 35.8 84.1 59.2 115.4-3.7-1.4-7.4-2.9-11-4.4zm292.6 0c-3.7 1.5-7.3 3-11 4.4 23.4-31.3 43.5-70.4 59.2-115.4 21 12 40.9 26 59.4 41.8a373.81 373.81 0 01-107.6 69.2z"}}]},name:"global",theme:"outlined"};var ti=g.forwardRef(function(e,t){return g.createElement(em.default,(0,ec.default)({},e,{ref:t,icon:tl}))}),tn=e.i(777579),to=e.i(983561);let tc={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"}}]},name:"shopping-cart",theme:"outlined"};var td=g.forwardRef(function(e,t){return g.createElement(em.default,(0,ec.default)({},e,{ref:t,icon:tc}))}),tm=e.i(232164),tu=e.i(645526),tx=e.i(906579);let th=[{value:"global",label:"Global Usage",showForAdmin:"Global Usage",showForNonAdmin:"Your Usage",description:"View usage across all resources",descriptionForAdmin:"View usage across all resources",descriptionForNonAdmin:"View your usage",icon:(0,t.jsx)(ti,{style:{fontSize:"16px"}})},{value:"organization",label:"Organization Usage",showForAdmin:"Organization Usage",showForNonAdmin:"Your Organization Usage",description:"View organization-level usage",descriptionForAdmin:"View usage across all organizations",descriptionForNonAdmin:"View your organization's usage",icon:(0,t.jsx)(ta.BankOutlined,{style:{fontSize:"16px"}})},{value:"team",label:"Team Usage",description:"View usage by team",icon:(0,t.jsx)(tu.TeamOutlined,{style:{fontSize:"16px"}})},{value:"customer",label:"Customer Usage",description:"View usage by customer accounts",icon:(0,t.jsx)(td,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"tag",label:"Tag Usage",description:"View usage grouped by tags",icon:(0,t.jsx)(tm.TagsOutlined,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"agent",label:"Agent Usage (A2A)",description:"View usage by AI agents",icon:(0,t.jsx)(to.RobotOutlined,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"user-agent-activity",label:"User Agent Activity",description:"View detailed user agent activity logs",icon:(0,t.jsx)(tn.LineChartOutlined,{style:{fontSize:"16px"}}),adminOnly:!0}],tp=({value:e,onChange:s,isAdmin:a,title:r="Usage View",description:l="Select the usage data you want to view","data-id":i})=>{let n=th.filter(e=>!e.adminOnly||!!a).map(e=>{let t=e.label,s=e.description;return e.showForAdmin&&e.showForNonAdmin&&(t=a?e.showForAdmin:e.showForNonAdmin),e.descriptionForAdmin&&e.descriptionForNonAdmin&&(s=a?e.descriptionForAdmin:e.descriptionForNonAdmin),{value:e.value,label:t,description:s,icon:e.icon,badgeText:e.badgeText}});return(0,t.jsx)("div",{className:"w-full","data-id":i,children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-start gap-4",children:[(0,t.jsxs)("div",{className:"flex items-stretch gap-2 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,t.jsx)(tr.BarChartOutlined,{style:{fontSize:"32px"}})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-0.5 leading-tight",children:r}),(0,t.jsx)("p",{className:"text-xs text-gray-600 leading-tight",children:l})]})]}),(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(K.Select,{value:e,onChange:s,className:"w-54 sm:w-64 md:w-72",size:"large",options:n.map(e=>({value:e.value,label:e.label})),optionRender:e=>{let s=n.find(t=>t.value===e.value);return s?(0,t.jsxs)("div",{className:"flex items-center gap-2 py-1",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:s.icon}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:s.label}),(0,t.jsx)("div",{className:"text-xs text-gray-600 mt-0.5",children:s.description})]}),s.badgeText&&(0,t.jsx)("div",{className:"items-center",children:(0,t.jsx)(tx.Badge,{color:"blue",count:s.badgeText})})]}):e.label},labelRender:e=>{let s=n.find(t=>t.value===e.value);return s?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{children:s.icon}),(0,t.jsx)("span",{className:"text-sm",children:s.label})]}):e.label}})})]})})};e.s(["default",0,({teams:e,organizations:y})=>{let v,S,{accessToken:L,userRole:D,userId:A,premiumUser:E}=(0,k.default)(),[O,F]=(0,g.useState)({results:[],metadata:{}}),[M,$]=(0,g.useState)(!1),[U,R]=(0,g.useState)(!1),I=(0,g.useMemo)(()=>new Date(Date.now()-6048e5),[]),P=(0,g.useMemo)(()=>new Date,[]),[W,Y]=(0,g.useState)({from:I,to:P}),[H,K]=(0,g.useState)([]),{data:G=[]}=(()=>{let{accessToken:e,userRole:t}=(0,k.default)();return(0,j.useQuery)({queryKey:T.list({}),queryFn:async()=>await (0,_.allEndUsersCall)(e),enabled:!!e&&b.all_admin_roles.includes(t)})})(),{data:J}=N(),{data:X}=(0,C.useCurrentUser)();console.log(`currentUser: ${JSON.stringify(X)}`),console.log(`currentUser max budget: ${X?.max_budget}`);let[Q,ee]=(0,g.useState)("groups"),[et,es]=(0,g.useState)(!1),[ea,er]=(0,g.useState)(!1),[el,ei]=(0,g.useState)(!0),[eo,ec]=(0,g.useState)(!0),[ed,em]=(0,g.useState)("global"),[eu,ex]=(0,g.useState)(!0),[eh,ep]=(0,g.useState)(5),[eg,ej]=(0,g.useState)(5),ey=async()=>{L&&K(Object.values(await (0,_.tagListCall)(L)).map(e=>({label:e.name,value:e.name})))};(0,g.useEffect)(()=>{ey()},[L]);let eb=O.metadata?.total_spend||0,ek=(0,g.useCallback)(async()=>{if(!L||!W.from||!W.to)return;$(!0);let e=new Date(W.from),t=new Date(W.to);try{try{let s=await (0,_.userDailyActivityAggregatedCall)(L,e,t);F(s);return}catch(e){}let s=await (0,_.userDailyActivityCall)(L,e,t);if(s.metadata.total_pages<=1)return void F(s);let a=[...s.results],r={...s.metadata};for(let l=2;l<=s.metadata.total_pages;l++){let s=await (0,_.userDailyActivityCall)(L,e,t,l);a.push(...s.results),s.metadata&&(r.total_spend+=s.metadata.total_spend||0,r.total_api_requests+=s.metadata.total_api_requests||0,r.total_successful_requests+=s.metadata.total_successful_requests||0,r.total_failed_requests+=s.metadata.total_failed_requests||0,r.total_tokens+=s.metadata.total_tokens||0)}F({results:a,metadata:r})}catch(e){console.error("Error fetching user spend data:",e)}finally{$(!1),R(!1)}},[L,W.from,W.to]),ev=(0,g.useCallback)(e=>{R(!0),$(!0),Y(e)},[]);(0,g.useEffect)(()=>{if(!W.from||!W.to)return;let e=setTimeout(()=>{ek()},50);return()=>clearTimeout(e)},[ek]);let eN=B(O,"models",e),eT=B(O,"api_keys",e),eC=B(O,"mcp_servers",e);return(0,t.jsxs)("div",{style:{width:"100%"},className:"p-8 relative",children:[(0,t.jsx)("div",{className:"flex items-end justify-between gap-6 mb-6",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-end justify-between gap-6 mb-4 w-full",children:[(0,t.jsx)(tp,{value:ed,onChange:e=>em(e),isAdmin:b.all_admin_roles.includes(D||"")}),(0,t.jsx)(ef,{value:W,onValueChange:ev})]}),"global"===ed&&(0,t.jsxs)(o.TabGroup,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(c.TabList,{variant:"solid",className:"mt-1",children:[(0,t.jsx)(n.Tab,{children:"Cost"}),(0,t.jsx)(n.Tab,{children:"Model Activity"}),(0,t.jsx)(n.Tab,{children:"Key Activity"}),(0,t.jsx)(n.Tab,{children:"MCP Server Activity"}),(0,t.jsx)(n.Tab,{children:"Endpoint Activity"})]}),(0,t.jsx)(q.Button,{onClick:()=>er(!0),icon:()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),children:"Export Data"})]}),(0,t.jsxs)(m.TabPanels,{children:[(0,t.jsx)(d.TabPanel,{children:(0,t.jsxs)(i.Grid,{numItems:2,className:"gap-2 w-full",children:[(0,t.jsxs)(l.Col,{numColSpan:2,children:[(0,t.jsxs)(u.Text,{className:"text-tremor-default text-tremor-content dark:text-dark-tremor-content mb-2 mt-2 text-lg",children:["Project Spend"," ",W.from&&W.to&&(0,t.jsxs)(t.Fragment,{children:[W.from.toLocaleDateString("en-US",{month:"short",day:"numeric",year:W.from.getFullYear()!==W.to.getFullYear()?"numeric":void 0})," - ",W.to.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),(0,t.jsx)(eE.default,{userSpend:eb,selectedTeam:null,userMaxBudget:X?.max_budget||null})]}),(0,t.jsx)(l.Col,{numColSpan:2,children:(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Usage Metrics"}),(0,t.jsxs)(i.Grid,{numItems:5,className:"gap-4 mt-4",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Total Requests"}),(0,t.jsx)(u.Text,{className:"text-2xl font-bold mt-2",children:O.metadata?.total_api_requests?.toLocaleString()||0})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Successful Requests"}),(0,t.jsx)(u.Text,{className:"text-2xl font-bold mt-2 text-green-600",children:O.metadata?.total_successful_requests?.toLocaleString()||0})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Title,{children:"Failed Requests"}),(0,t.jsx)(f.Tooltip,{title:"Includes requests that failed to route to a provider, tool usage failures, and other request errors where the provider cannot be determined.",children:(0,t.jsx)(s.InfoCircleOutlined,{className:"text-gray-400 hover:text-gray-600"})})]}),(0,t.jsx)(u.Text,{className:"text-2xl font-bold mt-2 text-red-600",children:O.metadata?.total_failed_requests?.toLocaleString()||0})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Total Tokens"}),(0,t.jsx)(u.Text,{className:"text-2xl font-bold mt-2",children:O.metadata?.total_tokens?.toLocaleString()||0})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Average Cost per Request"}),(0,t.jsxs)(u.Text,{className:"text-2xl font-bold mt-2",children:["$",(0,w.formatNumberWithCommas)((eb||0)/(O.metadata?.total_api_requests||1),4)]})]})]})]})}),(0,t.jsx)(l.Col,{numColSpan:2,children:(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(x.Title,{children:"Daily Spend"}),M?(0,t.jsx)(e_,{isDateChanging:U}):(0,t.jsx)(a.BarChart,{data:[...O.results].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),index:"date",categories:["metrics.spend"],colors:["cyan"],valueFormatter:V,yAxisWidth:100,showLegend:!1,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.date}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,w.formatNumberWithCommas)(a.metrics.spend,2)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Requests: ",a.metrics.api_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Successful: ",a.metrics.successful_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Failed: ",a.metrics.failed_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",a.metrics.total_tokens]})]})}})]})}),(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsxs)(r.Card,{className:"h-full",children:[(0,t.jsx)(x.Title,{children:"Top Virtual Keys"}),(0,t.jsx)(e5.default,{topKeys:((e=5)=>{let t={};return O.results.forEach(e=>{Object.entries(e.breakdown.api_keys||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{key_alias:s.metadata.key_alias,team_id:null,tags:s.metadata.tags||[]}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests,t[e].metrics.failed_requests+=s.metrics.failed_requests,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),console.log("debugTags",{keySpend:t,userSpendData:O}),Object.entries(t).map(([e,t])=>({api_key:e,key_alias:t.metadata.key_alias||"-",tags:t.metadata.tags||[],spend:t.metrics.spend})).sort((e,t)=>t.spend-e.spend).slice(0,e)})(eh),teams:null,topKeysLimit:eh,setTopKeysLimit:ep})]})}),(0,t.jsx)(l.Col,{numColSpan:1,children:(0,t.jsxs)(r.Card,{className:"h-full",children:[(0,t.jsx)(x.Title,{children:"groups"===Q?"Top Public Model Names":"Top Litellm Models"}),(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(p.Segmented,{options:[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25},{label:"50",value:50}],value:eg,onChange:e=>ej(e)}),(0,t.jsxs)("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[(0,t.jsx)("button",{className:`px-3 py-1 text-sm rounded-md transition-colors ${"groups"===Q?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,onClick:()=>ee("groups"),children:"Public Model Name"}),(0,t.jsx)("button",{className:`px-3 py-1 text-sm rounded-md transition-colors ${"individual"===Q?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,onClick:()=>ee("individual"),children:"Litellm Model Name"})]})]}),M?(0,t.jsx)(e_,{isDateChanging:U}):(0,t.jsx)("div",{className:"relative max-h-[600px] overflow-y-auto",children:(v="groups"===Q?((e=5)=>{let t={};return O.results.forEach(e=>{Object.entries(e.breakdown.model_groups||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests||0,t[e].metrics.failed_requests+=s.metrics.failed_requests||0,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),Object.entries(t).map(([e,t])=>({key:e,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens})).sort((e,t)=>t.spend-e.spend).slice(0,e)})(eg):((e=5)=>{let t={};return O.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests||0,t[e].metrics.failed_requests+=s.metrics.failed_requests||0,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),Object.entries(t).map(([e,t])=>({key:e,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens})).sort((e,t)=>t.spend-e.spend).slice(0,e)})(eg),(0,t.jsx)(a.BarChart,{className:"mt-4",style:{height:52*Math.min(v.length,eg)},data:v,index:"key",categories:["spend"],colors:["cyan"],valueFormatter:V,layout:"vertical",yAxisWidth:200,showLegend:!1,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.key}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,w.formatNumberWithCommas)(a.spend,2)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total Requests: ",a.requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-green-600",children:["Successful: ",a.successful_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-red-600",children:["Failed: ",a.failed_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",a.tokens.toLocaleString()]})]})}}))})]})}),(0,t.jsx)(l.Col,{numColSpan:2,children:(0,t.jsx)(ts,{loading:M,isDateChanging:U,providerSpend:(S={},O.results.forEach(e=>{Object.entries(e.breakdown.providers||{}).forEach(([e,t])=>{S[e]||(S[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),S[e].metrics.spend+=t.metrics.spend,S[e].metrics.prompt_tokens+=t.metrics.prompt_tokens,S[e].metrics.completion_tokens+=t.metrics.completion_tokens,S[e].metrics.total_tokens+=t.metrics.total_tokens,S[e].metrics.api_requests+=t.metrics.api_requests,S[e].metrics.successful_requests+=t.metrics.successful_requests||0,S[e].metrics.failed_requests+=t.metrics.failed_requests||0,S[e].metrics.cache_read_input_tokens+=t.metrics.cache_read_input_tokens||0,S[e].metrics.cache_creation_input_tokens+=t.metrics.cache_creation_input_tokens||0})}),Object.entries(S).map(([e,t])=>({provider:e,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens})))})})]})}),(0,t.jsx)(d.TabPanel,{children:(0,t.jsx)(z,{modelMetrics:eN})}),(0,t.jsx)(d.TabPanel,{children:(0,t.jsx)(z,{modelMetrics:eT})}),(0,t.jsx)(d.TabPanel,{children:(0,t.jsx)(z,{modelMetrics:eC})}),(0,t.jsx)(d.TabPanel,{children:(0,t.jsx)(e2,{userSpendData:O})})]})]}),"organization"===ed&&(0,t.jsxs)(t.Fragment,{children:[el&&(0,t.jsx)(h.Alert,{banner:!0,type:"info",message:"Organization usage is a new feature.",description:"Spend is tracked from feature launch and previous data isn't backfilled, so only future usage appears here.",closable:!0,onClose:()=>ei(!1),className:"mb-5"}),(0,t.jsx)(e8,{accessToken:L,entityType:"organization",userID:A,userRole:D,dateValue:W,entityList:y?.map(e=>({label:e.organization_alias,value:e.organization_id}))||null,premiumUser:E})]}),"team"===ed&&(0,t.jsx)(e8,{accessToken:L,entityType:"team",userID:A,userRole:D,entityList:e?.map(e=>({label:e.team_alias,value:e.team_id}))||null,premiumUser:E,dateValue:W}),"customer"===ed&&(0,t.jsxs)(t.Fragment,{children:[eo&&(0,t.jsx)(h.Alert,{banner:!0,type:"info",message:"Customer usage is a new feature.",description:"Spend is tracked from feature launch and previous data isn't backfilled, so only future usage appears here.",closable:!0,onClose:()=>ec(!1),className:"mb-5"}),(0,t.jsx)(e8,{accessToken:L,entityType:"customer",userID:A,userRole:D,entityList:G?.map(e=>({label:e.alias||e.user_id,value:e.user_id}))||null,premiumUser:E,dateValue:W})]}),"tag"===ed&&(0,t.jsx)(e8,{accessToken:L,entityType:"tag",userID:A,userRole:D,entityList:H,premiumUser:E,dateValue:W}),"agent"===ed&&(0,t.jsxs)(t.Fragment,{children:[eu&&(0,t.jsx)(h.Alert,{banner:!0,type:"info",message:"Agent usage (A2A) is a new feature.",description:"Spend is tracked from feature launch and previous data isn't backfilled, so only future usage appears here.",closable:!0,onClose:()=>ex(!1),className:"mb-5"}),(0,t.jsx)(e8,{accessToken:L,entityType:"agent",userID:A,userRole:D,entityList:J?.agents?.map(e=>({label:e.agent_name,value:e.agent_id}))||null,premiumUser:E,dateValue:W})," "]}),"user-agent-activity"===ed&&(0,t.jsx)(eA,{accessToken:L,userRole:D,dateValue:W})]})}),(0,t.jsx)(Z,{isOpen:et,onClose:()=>es(!1),accessToken:L}),(0,t.jsx)(en,{isOpen:ea,onClose:()=>er(!1),entityType:"team",spendData:{results:O.results,metadata:O.metadata},dateRange:W,selectedFilters:[],customTitle:"Export Usage Data"})]})}],797305)}]);