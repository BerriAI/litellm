"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6399],{12579:function(e,t,s){s.d(t,{RM:function(){return a.Z},SC:function(){return c.Z},iA:function(){return r.Z},pj:function(){return l.Z},ss:function(){return o.Z},xs:function(){return i.Z},zx:function(){return n.Z}});var n=s(78489),r=s(21626),a=s(97214),l=s(28241),o=s(58834),i=s(69552),c=s(71876)},56399:function(e,t,s){s.d(t,{Z:function(){return eG}});var n=s(57437),r=s(2265),a=s(16312),l=s(22116),o=s(19250),i=s(12579),c=s(74998),d=s(44633),m=s(86462),p=s(49084),x=s(99981),u=s(23639),h=s(71594),g=s(24525),v=s(42673);let f=e=>{let t=new Set,s=/\{\{(\w+)\}\}/g;if(e.messages.forEach(e=>{let n;for(;null!==(n=s.exec(e.content));)t.add(n[1])}),e.developerMessage){let n;for(;null!==(n=s.exec(e.developerMessage));)t.add(n[1])}return Array.from(t)},j=e=>{let t=f(e),s="---\nmodel: ".concat(e.model,"\n");return void 0!==e.config.temperature&&(s+="temperature: ".concat(e.config.temperature,"\n")),void 0!==e.config.max_tokens&&(s+="max_tokens: ".concat(e.config.max_tokens,"\n")),void 0!==e.config.top_p&&(s+="top_p: ".concat(e.config.top_p,"\n")),s+="input:\n  schema:\n",t.forEach(e=>{s+="    ".concat(e,": string\n")}),s+="output:\n  format: text\n",e.tools&&e.tools.length>0&&(s+="tools:\n",e.tools.forEach(e=>{let t=JSON.parse(e.json);s+="  - ".concat(JSON.stringify(t),"\n")})),s+="---\n\n",e.developerMessage&&""!==e.developerMessage.trim()&&(s+="Developer: ".concat(e.developerMessage.trim(),"\n\n")),e.messages.forEach(e=>{let t=e.role.charAt(0).toUpperCase()+e.role.slice(1);s+="".concat(t,": ").concat(e.content,"\n\n")}),s.trim()},b=e=>{var t,s,n;let r=(null==e?void 0:null===(s=e.prompt_spec)||void 0===s?void 0:null===(t=s.litellm_params)||void 0===t?void 0:t.dotprompt_content)||"";if(!r)throw Error("No dotprompt_content found in API response");let a=r.split("---");if(a.length<3)throw Error("Invalid dotprompt format");let l=a[1],o=a.slice(2).join("---").trim(),i={};l.split("\n").forEach(e=>{let t=e.trim();if(t&&!t.startsWith("input:")&&!t.startsWith("output:")&&!t.startsWith("schema:")&&!t.startsWith("format:")){let e=t.indexOf(":");if(e>0){let s=t.substring(0,e).trim(),n=t.substring(e+1).trim();"temperature"===s||"max_tokens"===s||"top_p"===s?i[s]=parseFloat(n):"model"===s&&(i[s]=n)}}});let c="",d=[],m=o.split("\n"),p=null,x="";for(let e of m)e.startsWith("Developer:")?c=e.substring(10).trim():e.startsWith("User:")?(p&&x&&d.push({role:p,content:x.trim()}),p="user",x=e.substring(5).trim()):e.startsWith("Assistant:")?(p&&x&&d.push({role:p,content:x.trim()}),p="assistant",x=e.substring(10).trim()):e.trim()&&p&&(x+="\n"+e.trim());p&&x&&d.push({role:p,content:x.trim()});let u=(null==e?void 0:null===(n=e.prompt_spec)||void 0===n?void 0:n.prompt_id)||"Unnamed Prompt";return{name:N(u)||u,model:i.model||"gpt-4o",config:{temperature:i.temperature,max_tokens:i.max_tokens,top_p:i.top_p},tools:[],developerMessage:c,messages:d.length>0?d:[{role:"user",content:"Enter task specifics. Use {{template_variables}} for dynamic inputs"}]}},y=e=>{if(!e)return"1";let t=e.match(/[._-]v(\d+)$/);return t?t[1]:"1"},N=e=>e?e.replace(/[._-]v\d+$/,""):"",w=e=>{let t;if(!e)return{};let s={},n=/\{\{(\w+)\}\}/g;for(;null!==(t=n.exec(e));){let e=t[1];s[e]||(s[e]="example_".concat(e))}return s},_=e=>(null==e?void 0:e.prompt_id)||"",C=e=>{var t;let s=_(e);return(null==e?void 0:null===(t=e.litellm_params)||void 0===t?void 0:t.prompt_id)||s},k=e=>(null==e?void 0:e.version)?String(e.version):y(C(e)),S=e=>{try{var t;let s=e.litellm_params;if(null==s?void 0:s.dotprompt_content){let e=s.dotprompt_content.match(/model:\s*([^\n]+)/);if(e)return e[1].trim()}if(null==s?void 0:null===(t=s.prompt_data)||void 0===t?void 0:t.model)return s.prompt_data.model;if(null==s?void 0:s.model)return s.model;return null}catch(e){return console.error("Error extracting model:",e),null}},Z=(e,t)=>{if(!e)return null;let s=t.get(e);return s&&s.providers&&s.providers.length>0?s.providers[0]:null};var P=e=>{let{promptsList:t,isLoading:s,onPromptClick:a,onDeleteClick:l,accessToken:f,isAdmin:j}=e,[b,y]=(0,r.useState)([{id:"created_at",desc:!0}]),[N,w]=(0,r.useState)(new Map);(0,r.useEffect)(()=>{(async()=>{if(f)try{let e=await (0,o.modelHubCall)(f);if(null==e?void 0:e.data){let t=new Map;e.data.forEach(e=>{t.set(e.model_group,e)}),w(t)}}catch(e){console.error("Error fetching model hub data:",e)}})()},[f]);let _=e=>e?new Date(e).toLocaleString():"-",C=e=>{navigator.clipboard.writeText(e)},k=[{header:"Prompt ID",accessorKey:"prompt_id",cell:e=>{let t=String(e.getValue()||""),s=t.length>25?"".concat(t.slice(0,25),"..."):t;return(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(x.Z,{title:t,children:(0,n.jsx)(i.zx,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate min-w-[220px] justify-start",onClick:()=>e.getValue()&&(null==a?void 0:a(e.getValue())),children:s})}),(0,n.jsx)(x.Z,{title:"Copy prompt ID",children:(0,n.jsx)(u.Z,{onClick:e=>{e.stopPropagation(),C(t)},className:"cursor-pointer text-gray-500 hover:text-blue-500 text-xs"})})]})}},{header:"Model",accessorKey:"model",cell:e=>{let{row:t}=e,s=S(t.original);if(!s)return(0,n.jsx)("span",{className:"text-xs text-gray-400",children:"-"});let r=Z(s,N),{logo:a}=(0,v.dr)(r||"");return(0,n.jsx)(x.Z,{title:s,children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:r&&a?(0,n.jsx)("img",{src:a,alt:"".concat(r," logo"),className:"w-4 h-4",onError:e=>{let t=e.currentTarget,s=t.parentElement;if(s&&s.contains(t))try{let e=document.createElement("div");e.className="w-4 h-4 rounded-full bg-gray-200 flex items-center justify-center text-xs",e.textContent=(null==r?void 0:r.charAt(0))||"-",s.replaceChild(e,t)}catch(e){console.error("Failed to replace provider logo fallback:",e)}}}):(0,n.jsx)("div",{className:"w-4 h-4 rounded-full bg-gray-200 flex items-center justify-center text-xs",children:"-"})}),(0,n.jsx)("span",{className:"max-w-[15ch] truncate block",children:s})]})})}},{header:"Created At",accessorKey:"created_at",cell:e=>{let{row:t}=e,s=t.original;return(0,n.jsx)(x.Z,{title:s.created_at,children:(0,n.jsx)("span",{className:"text-xs",children:_(s.created_at)})})}},{header:"Updated At",accessorKey:"updated_at",cell:e=>{let{row:t}=e,s=t.original;return(0,n.jsx)(x.Z,{title:s.updated_at,children:(0,n.jsx)("span",{className:"text-xs",children:_(s.updated_at)})})}},{header:"Type",accessorKey:"prompt_info.prompt_type",cell:e=>{let{row:t}=e,s=t.original;return(0,n.jsx)(x.Z,{title:s.prompt_info.prompt_type,children:(0,n.jsx)("span",{className:"text-xs",children:s.prompt_info.prompt_type})})}},...j?[{header:"Actions",id:"actions",enableSorting:!1,cell:e=>{let{row:t}=e,s=t.original,r=s.prompt_id||"Unknown Prompt";return(0,n.jsx)("div",{className:"flex items-center gap-1",children:(0,n.jsx)(x.Z,{title:"Delete prompt",children:(0,n.jsx)(i.zx,{size:"xs",variant:"light",color:"red",onClick:e=>{e.stopPropagation(),null==l||l(s.prompt_id,r)},icon:c.Z,className:"text-red-500 hover:text-red-700 hover:bg-red-50"})})})}}]:[]],P=(0,h.b7)({data:t,columns:k,state:{sorting:b},onSortingChange:y,getCoreRowModel:(0,g.sC)(),getSortedRowModel:(0,g.tj)(),enableSorting:!0});return(0,n.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)(i.iA,{className:"[&_td]:py-0.5 [&_th]:py-1",children:[(0,n.jsx)(i.ss,{children:P.getHeaderGroups().map(e=>(0,n.jsx)(i.SC,{children:e.headers.map(e=>(0,n.jsx)(i.xs,{className:"py-1 h-8",onClick:e.column.getToggleSortingHandler(),children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,n.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,h.ie)(e.column.columnDef.header,e.getContext())}),(0,n.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,n.jsx)(d.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,n.jsx)(m.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,n.jsx)(p.Z,{className:"h-4 w-4 text-gray-400"})})]})},e.id))},e.id))}),(0,n.jsx)(i.RM,{children:s?(0,n.jsx)(i.SC,{children:(0,n.jsx)(i.pj,{colSpan:k.length,className:"h-8 text-center",children:(0,n.jsx)("div",{className:"text-center text-gray-500",children:(0,n.jsx)("p",{children:"Loading..."})})})}):t.length>0?P.getRowModel().rows.map(e=>(0,n.jsx)(i.SC,{className:"h-8",children:e.getVisibleCells().map(e=>(0,n.jsx)(i.pj,{className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap",children:(0,h.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,n.jsx)(i.SC,{children:(0,n.jsx)(i.pj,{colSpan:k.length,className:"h-8 text-center",children:(0,n.jsx)("div",{className:"text-center text-gray-500",children:(0,n.jsx)("p",{children:"No prompts found"})})})})})]})})})},T=s(84717),D=s(5545),E=s(10900),z=s(93416),O=s(59872),A=s(30401),I=s(78867),L=s(9114),M=s(37592),F=s(65869),B=s(11894),R=s(19431),J=s(17906),U=s(94263),V=e=>{let{promptId:t,model:s,promptVariables:a={},accessToken:o,version:i="1",proxySettings:c}=e,[d,m]=(0,r.useState)(!1),[p,x]=(0,r.useState)("curl"),[u,h]=(0,r.useState)("basic"),[g,v]=(0,r.useState)(""),f=window.location.origin,j=null==c?void 0:c.LITELLM_UI_API_DOC_BASE_URL;j&&j.trim()?f=j:(null==c?void 0:c.PROXY_BASE_URL)&&(f=c.PROXY_BASE_URL);let b=o||"sk-1234",y=()=>{let e=Object.keys(a).length>0;if("curl"===p)return"basic"===u?"curl -X POST '".concat(f,"/chat/completions' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Authorization: Bearer ").concat(b,'\' \\\n  -d \'{\n    "model": "').concat(s,'",\n    "prompt_id": "').concat(t,'"').concat(e?',\n    "prompt_variables": '.concat(JSON.stringify(a,null,6).replace(/\n/g,"\n    ")):"","\n  }' | jq"):"messages"===u?"curl -X POST '".concat(f,"/chat/completions' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Authorization: Bearer ").concat(b,'\' \\\n  -d \'{\n    "model": "').concat(s,'",\n    "prompt_id": "').concat(t,'"').concat(e?',\n    "prompt_variables": '.concat(JSON.stringify(a,null,6).replace(/\n/g,"\n    ")):"",',\n    "messages": [\n      {\n        "role": "user",\n        "content": "hi"\n      }\n    ]\n  }\' | jq'):"curl -X POST '".concat(f,"/chat/completions' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Authorization: Bearer ").concat(b,'\' \\\n  -d \'{\n    "model": "').concat(s,'",\n    "prompt_id": "').concat(t,'",\n    "prompt_version": ').concat(i,',\n    "messages": [\n      {\n        "role": "user",\n        "content": "Who are u"\n      }\n    ]\n  }\' | jq');if("python"===p){let n='import openai\n\nclient = openai.OpenAI(\n    api_key="'.concat(b,'",\n    base_url="').concat(f,'"\n)\n');return"basic"===u?"".concat(n,'\nresponse = client.chat.completions.create(\n    model="').concat(s,'",\n    extra_body={\n        "prompt_id": "').concat(t,'"').concat(e?',\n        "prompt_variables": '.concat(JSON.stringify(a,null,8).replace(/\n/g,"\n        ")):"","\n    }\n)\n\nprint(response)"):"messages"===u?"".concat(n,'\nresponse = client.chat.completions.create(\n    model="').concat(s,'",\n    messages=[\n        {"role": "user", "content": "hi"}\n    ],\n    extra_body={\n        "prompt_id": "').concat(t,'"').concat(e?',\n        "prompt_variables": '.concat(JSON.stringify(a,null,8).replace(/\n/g,"\n        ")):"","\n    }\n)\n\nprint(response)"):"".concat(n,'\nresponse = client.chat.completions.create(\n    model="').concat(s,'",\n    messages=[\n        {"role": "user", "content": "Who are u"}\n    ],\n    extra_body={\n        "prompt_id": "').concat(t,'",\n        "prompt_version": ').concat(i,"\n    }\n)\n\nprint(response)")}{let n="import OpenAI from 'openai';\n\nconst client = new OpenAI({\n    apiKey: \"".concat(b,'",\n    baseURL: "').concat(f,'"\n});\n');return"basic"===u?"".concat(n,'\nasync function main() {\n    const response = await client.chat.completions.create({\n        model: "').concat(s,'",\n        ').concat(e?'prompt_id: "'.concat(t,'",\n        prompt_variables: ').concat(JSON.stringify(a,null,8).replace(/\n/g,"\n        ")):'prompt_id: "'.concat(t,'"'),"\n    });\n    \n    console.log(response);\n}\n\nmain();"):"messages"===u?"".concat(n,'\nasync function main() {\n    const response = await client.chat.completions.create({\n        model: "').concat(s,'",\n        messages: [\n            { role: "user", content: "hi" }\n        ],\n        ').concat(e?'prompt_id: "'.concat(t,'",\n        prompt_variables: ').concat(JSON.stringify(a,null,8).replace(/\n/g,"\n        ")):'prompt_id: "'.concat(t,'"'),"\n    });\n    \n    console.log(response);\n}\n\nmain();"):"".concat(n,'\nasync function main() {\n    const response = await client.chat.completions.create({\n        model: "').concat(s,'",\n        messages: [\n            { role: "user", content: "Who are u" }\n        ],\n        prompt_id: "').concat(t,'",\n        prompt_version: ').concat(i,"\n    });\n    \n    console.log(response);\n}\n\nmain();")}};return r.useEffect(()=>{d&&v(y())},[d,p,u,t,s,a]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(R.z,{variant:"secondary",icon:B.Z,onClick:()=>{m(!0)},children:"Get Code"}),(0,n.jsxs)(l.Z,{title:"Generated Code",open:d,onCancel:()=>{m(!1)},footer:null,width:800,children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(R.x,{className:"font-medium block mb-1 text-gray-700",children:"Language"}),(0,n.jsx)(M.default,{value:p,onChange:e=>x(e),style:{width:180},options:[{value:"curl",label:"cURL"},{value:"python",label:"Python (OpenAI SDK)"},{value:"javascript",label:"JavaScript (OpenAI SDK)"}]})]}),(0,n.jsx)(D.ZP,{onClick:()=>{navigator.clipboard.writeText(g),L.Z.success("Copied to clipboard!")},children:"Copy to Clipboard"})]}),(0,n.jsx)(F.default,{activeKey:u,onChange:h,items:[{label:"Basic",key:"basic"},{label:"With Messages",key:"messages"},{label:"With Version",key:"version"}]}),(0,n.jsx)(J.Z,{language:"curl"===p?"bash":"python"===p?"python":"javascript",style:U.Z,wrapLines:!0,wrapLongLines:!0,className:"rounded-md mt-0",customStyle:{maxHeight:"60vh",overflowY:"auto",marginTop:0,borderTopLeftRadius:0,borderTopRightRadius:0},children:g})]})]})},W=e=>{var t,s,a;let{promptId:i,onClose:d,accessToken:m,isAdmin:p,onDelete:x,onEdit:u}=e,[h,g]=(0,r.useState)(null),[v,f]=(0,r.useState)(null),[j,b]=(0,r.useState)(null),[y,N]=(0,r.useState)(!0),[C,Z]=(0,r.useState)({}),[P,M]=(0,r.useState)(!1),[F,B]=(0,r.useState)(!1),R=async()=>{try{if(N(!0),!m)return;let e=await (0,o.getPromptInfo)(m,i);g(e.prompt_spec),f(e.raw_prompt_template),b(e)}catch(e){L.Z.fromBackend("Failed to load prompt information"),console.error("Error fetching prompt info:",e)}finally{N(!1)}};if((0,r.useEffect)(()=>{R()},[i,m]),y)return(0,n.jsx)("div",{className:"p-4",children:"Loading..."});if(!h)return(0,n.jsx)("div",{className:"p-4",children:"Prompt not found"});let J=e=>e?new Date(e).toLocaleString():"-",U=async(e,t)=>{await (0,O.vQ)(e)&&(Z(e=>({...e,[t]:!0})),setTimeout(()=>{Z(e=>({...e,[t]:!1}))},2e3))},W=async()=>{if(m&&h){B(!0);try{await (0,o.deletePromptCall)(m,H),L.Z.success('Prompt "'.concat(H,'" deleted successfully')),null==x||x(),d()}catch(e){console.error("Error deleting prompt:",e),L.Z.fromBackend("Failed to delete prompt")}finally{B(!1),M(!1)}}},K=h&&S(h)||"gpt-4o",H=_(h),q=k(h);return(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(T.zx,{icon:E.Z,variant:"light",onClick:d,className:"mb-4",children:"Back to Prompts"}),(0,n.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(T.Dx,{children:"Prompt Details"}),(0,n.jsxs)("div",{className:"flex items-center cursor-pointer",children:[(0,n.jsx)(T.xv,{className:"text-gray-500 font-mono",children:H}),(0,n.jsx)(D.ZP,{type:"text",size:"small",icon:C["prompt-id"]?(0,n.jsx)(A.Z,{size:12}):(0,n.jsx)(I.Z,{size:12}),onClick:()=>U(H,"prompt-id"),className:"left-2 z-10 transition-all duration-200 ".concat(C["prompt-id"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100")})]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(V,{promptId:H,model:K,promptVariables:w(null==v?void 0:v.content),accessToken:m,version:q}),(0,n.jsx)(T.zx,{icon:z.Z,variant:"primary",onClick:()=>null==u?void 0:u(j),className:"flex items-center",children:"Prompt Studio"}),p&&(0,n.jsx)(T.zx,{icon:c.Z,variant:"secondary",onClick:()=>{M(!0)},className:"flex items-center",children:"Delete Prompt"})]})]})]}),(0,n.jsxs)(T.v0,{children:[(0,n.jsxs)(T.td,{className:"mb-4",children:[(0,n.jsx)(T.OK,{children:"Overview"},"overview"),v?(0,n.jsx)(T.OK,{children:"Prompt Template"},"prompt-template"):(0,n.jsx)(n.Fragment,{}),p?(0,n.jsx)(T.OK,{children:"Details"},"details"):(0,n.jsx)(n.Fragment,{}),(0,n.jsx)(T.OK,{children:"Raw JSON"},"raw-json")]}),(0,n.jsxs)(T.nP,{children:[(0,n.jsxs)(T.x4,{children:[(0,n.jsxs)(T.rj,{numItems:1,numItemsSm:2,numItemsLg:3,className:"gap-6",children:[(0,n.jsxs)(T.Zb,{children:[(0,n.jsx)(T.xv,{children:"Prompt ID"}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(T.Dx,{className:"font-mono text-sm",children:H})})]}),(0,n.jsxs)(T.Zb,{children:[(0,n.jsx)(T.xv,{children:"Version"}),(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)(T.Dx,{children:q}),(0,n.jsxs)(T.Ct,{color:"blue",className:"mt-1",children:["v",q]})]})]}),(0,n.jsxs)(T.Zb,{children:[(0,n.jsx)(T.xv,{children:"Prompt Type"}),(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)(T.Dx,{children:(null===(t=h.prompt_info)||void 0===t?void 0:t.prompt_type)||"-"}),(0,n.jsx)(T.Ct,{color:"blue",className:"mt-1",children:(null===(s=h.prompt_info)||void 0===s?void 0:s.prompt_type)||"Unknown"})]})]}),(0,n.jsxs)(T.Zb,{children:[(0,n.jsx)(T.xv,{children:"Created At"}),(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)(T.Dx,{children:J(h.created_at)}),(0,n.jsxs)(T.xv,{children:["Last Updated: ",J(h.updated_at)]})]})]})]}),h.litellm_params&&Object.keys(h.litellm_params).length>0&&(0,n.jsxs)(T.Zb,{className:"mt-6",children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"LiteLLM Parameters"}),(0,n.jsx)("div",{className:"mt-2 p-3 bg-gray-50 rounded-md",children:(0,n.jsx)("pre",{className:"text-xs text-gray-800 whitespace-pre-wrap",children:JSON.stringify(h.litellm_params,null,2)})})]})]}),v&&(0,n.jsx)(T.x4,{children:(0,n.jsxs)(T.Zb,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(T.Dx,{children:"Prompt Template"}),(0,n.jsx)(D.ZP,{type:"text",size:"small",icon:C["prompt-content"]?(0,n.jsx)(A.Z,{size:16}):(0,n.jsx)(I.Z,{size:16}),onClick:()=>U(v.content,"prompt-content"),className:"transition-all duration-200 ".concat(C["prompt-content"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:C["prompt-content"]?"Copied!":"Copy Content"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"Template ID"}),(0,n.jsx)("div",{className:"font-mono text-sm bg-gray-50 p-2 rounded",children:v.litellm_prompt_id})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"Content"}),(0,n.jsx)("div",{className:"mt-2 p-4 bg-gray-50 rounded-md border overflow-auto max-h-96",children:(0,n.jsx)("pre",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:v.content})})]}),v.metadata&&Object.keys(v.metadata).length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"Template Metadata"}),(0,n.jsx)("div",{className:"mt-2 p-3 bg-gray-50 rounded-md border",children:(0,n.jsx)("pre",{className:"text-xs text-gray-800 whitespace-pre-wrap overflow-auto max-h-64",children:JSON.stringify(v.metadata,null,2)})})]})]})]})}),p&&(0,n.jsx)(T.x4,{children:(0,n.jsxs)(T.Zb,{children:[(0,n.jsx)(T.Dx,{className:"mb-4",children:"Prompt Details"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"Prompt ID"}),(0,n.jsx)("div",{className:"font-mono text-sm bg-gray-50 p-2 rounded",children:H})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"Prompt Type"}),(0,n.jsx)("div",{children:(null===(a=h.prompt_info)||void 0===a?void 0:a.prompt_type)||"-"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"Created At"}),(0,n.jsx)("div",{children:J(h.created_at)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"Last Updated"}),(0,n.jsx)("div",{children:J(h.updated_at)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"LiteLLM Parameters"}),(0,n.jsx)("div",{className:"mt-2 p-3 bg-gray-50 rounded-md border",children:(0,n.jsx)("pre",{className:"text-xs text-gray-800 whitespace-pre-wrap overflow-auto max-h-96",children:JSON.stringify(h.litellm_params,null,2)})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)(T.xv,{className:"font-medium",children:"Prompt Info"}),(0,n.jsx)("div",{className:"mt-2 p-3 bg-gray-50 rounded-md border",children:(0,n.jsx)("pre",{className:"text-xs text-gray-800 whitespace-pre-wrap",children:JSON.stringify(h.prompt_info,null,2)})})]})]})]})}),(0,n.jsx)(T.x4,{children:(0,n.jsxs)(T.Zb,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(T.Dx,{children:"Raw API Response"}),(0,n.jsx)(D.ZP,{type:"text",size:"small",icon:C["raw-json"]?(0,n.jsx)(A.Z,{size:16}):(0,n.jsx)(I.Z,{size:16}),onClick:()=>U(JSON.stringify(j,null,2),"raw-json"),className:"transition-all duration-200 ".concat(C["raw-json"]?"text-green-600 bg-green-50 border-green-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:C["raw-json"]?"Copied!":"Copy JSON"})]}),(0,n.jsx)("div",{className:"p-4 bg-gray-50 rounded-md border overflow-auto",children:(0,n.jsx)("pre",{className:"text-xs text-gray-800 whitespace-pre-wrap",children:JSON.stringify(j,null,2)})})]})})]})]}),(0,n.jsxs)(l.Z,{title:"Delete Prompt",open:P,onOk:W,onCancel:()=>{M(!1)},confirmLoading:F,okText:"Delete",okButtonProps:{danger:!0},children:[(0,n.jsxs)("p",{children:["Are you sure you want to delete prompt: ",(0,n.jsx)("strong",{children:H}),"?"]}),(0,n.jsx)("p",{children:"This action cannot be undone."})]})]})},K=s(10032),H=s(23496),q=s(65319),G=s(31283),X=s(3632);let{Option:Y}=M.default;var $=e=>{let{visible:t,onClose:s,accessToken:a,onSuccess:i}=e,[c]=K.Z.useForm(),[d,m]=(0,r.useState)(!1),[p,x]=(0,r.useState)([]),[u,h]=(0,r.useState)("dotprompt"),g=()=>{c.resetFields(),x([]),h("dotprompt"),s()},v=async()=>{try{let e=await c.validateFields();if(console.log("values: ",e),!a){L.Z.fromBackend("Access token is required");return}if("dotprompt"===u&&0===p.length){L.Z.fromBackend("Please upload a .prompt file");return}m(!0);let t={};if("dotprompt"===u&&p.length>0){let s=p[0].originFileObj;try{let n=await (0,o.convertPromptFileToJson)(a,s);console.log("Conversion result:",n),t={prompt_id:e.prompt_id,litellm_params:{prompt_integration:"dotprompt",prompt_id:n.prompt_id,prompt_data:n.json_data},prompt_info:{prompt_type:"db"}}}catch(e){console.error("Error converting prompt file:",e),L.Z.fromBackend("Failed to convert prompt file to JSON"),m(!1);return}}try{await (0,o.createPromptCall)(a,t),L.Z.success("Prompt created successfully!"),g(),i()}catch(e){console.error("Error creating prompt:",e),L.Z.fromBackend("Failed to create prompt")}}catch(e){console.error("Form validation error:",e)}finally{m(!1)}};return(0,n.jsx)(l.Z,{title:"Add New Prompt",open:t,onCancel:g,footer:[(0,n.jsx)(D.ZP,{onClick:g,children:"Cancel"},"cancel"),(0,n.jsx)(D.ZP,{loading:d,onClick:v,children:"Create Prompt"},"submit")],width:600,children:(0,n.jsxs)(K.Z,{form:c,layout:"vertical",requiredMark:!1,children:[(0,n.jsx)(K.Z.Item,{label:"Prompt ID",name:"prompt_id",rules:[{required:!0,message:"Please enter a prompt ID"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"Prompt ID can only contain letters, numbers, underscores, and hyphens"}],children:(0,n.jsx)(G.o,{placeholder:"Enter unique prompt ID (e.g., my_prompt_id)"})}),(0,n.jsx)(K.Z.Item,{label:"Prompt Integration",name:"prompt_integration",initialValue:"dotprompt",children:(0,n.jsx)(M.default,{value:u,onChange:h,children:(0,n.jsx)(Y,{value:"dotprompt",children:"dotprompt"})})}),"dotprompt"===u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(H.Z,{}),(0,n.jsxs)(K.Z.Item,{label:"Prompt File",extra:"Upload a .prompt file that follows the Dotprompt specification",children:[(0,n.jsx)(q.default,{beforeUpload:e=>(e.name.endsWith(".prompt")||L.Z.fromBackend("Please upload a .prompt file"),!1),fileList:p,onChange:e=>{let{fileList:t}=e;x(t.slice(-1))},onRemove:()=>{x([])},children:(0,n.jsx)(D.ZP,{icon:(0,n.jsx)(X.Z,{}),children:"Select .prompt File"})}),p.length>0&&(0,n.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",p[0].name]})]})]})]})})},Q=e=>{let{visible:t,initialJson:s,onSave:a,onClose:o}=e,[i,c]=(0,r.useState)(s||'{\n  "type": "function",\n  "function": {\n    "name": "get_current_weather",\n    "description": "Get the current weather in a given location",\n    "parameters": {\n      "type": "object",\n      "properties": {\n        "location": {\n          "type": "string",\n          "description": "The city and state, e.g. San Francisco, CA"\n        },\n        "unit": {\n          "type": "string",\n          "enum": ["celsius", "fahrenheit"]\n        }\n      },\n      "required": ["location"]\n    }\n  }\n}'),[d,m]=(0,r.useState)(null),p=()=>{m(null),o()};return(0,n.jsx)(l.Z,{title:(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("span",{className:"text-lg font-medium",children:"Add Tool"})}),open:t,onCancel:p,width:800,footer:[(0,n.jsx)(D.ZP,{onClick:p,children:"Cancel"},"cancel"),(0,n.jsx)(D.ZP,{type:"primary",onClick:()=>{try{JSON.parse(i),m(null),a(i)}catch(e){m("Invalid JSON format. Please check your syntax.")}},children:"Add"},"save")],children:(0,n.jsxs)("div",{className:"space-y-3",children:[d&&(0,n.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded text-red-600 text-sm",children:d}),(0,n.jsx)("textarea",{value:i,onChange:e=>c(e.target.value),className:"w-full min-h-[400px] px-4 py-3 border border-gray-300 rounded-lg text-sm font-mono focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",placeholder:"Paste your tool JSON here..."})]})})},ee=s(4260),et=s(32660),es=s(91723),en=s(83229),er=e=>{let{promptName:t,onNameChange:s,onBack:r,onSave:l,isSaving:o,editMode:i=!1,onShowHistory:c,version:d,promptModel:m="gpt-4o",promptVariables:p={},accessToken:x,proxySettings:u}=e;return(0,n.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-3 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)(a.z,{icon:et.Z,variant:"light",onClick:r,size:"xs",children:"Back"}),(0,n.jsx)(ee.default,{value:t,onChange:e=>s(e.target.value),className:"text-base font-medium border-none shadow-none",style:{width:"200px"}}),d&&(0,n.jsx)("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded font-medium",children:d}),(0,n.jsx)("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:"Draft"}),(0,n.jsx)("span",{className:"text-xs text-gray-400",children:"Unsaved changes"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(V,{promptId:t,model:m,promptVariables:p,accessToken:x,version:(null==d?void 0:d.replace("v",""))||"1",proxySettings:u}),i&&c&&(0,n.jsx)(a.z,{icon:es.Z,variant:"secondary",onClick:c,children:"History"}),(0,n.jsx)(a.z,{icon:en.Z,onClick:l,loading:o,disabled:o,children:i?"Update":"Save"})]})]})},ea=s(92280),el=s(98728),eo=s(76593),ei=e=>{let{model:t,temperature:s=1,maxTokens:a=1e3,accessToken:l,onModelChange:o,onTemperatureChange:i,onMaxTokensChange:c}=e,[d,m]=(0,r.useState)(!1);return(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-[300px]",children:(0,n.jsx)(eo.Z,{accessToken:l||"",value:t,onChange:o,showLabel:!1})}),(0,n.jsxs)("button",{onClick:()=>m(!d),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[(0,n.jsx)(el.Z,{size:16}),(0,n.jsx)("span",{children:"Parameters"})]}),d&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-96",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Model Parameters"}),(0,n.jsx)("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)(ea.x,{className:"text-sm text-gray-700",children:"Temperature"}),(0,n.jsx)(ee.default,{type:"number",size:"small",min:0,max:2,step:.1,value:s,onChange:e=>i(parseFloat(e.target.value)||0),className:"w-20"})]})}),(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)(ea.x,{className:"text-sm text-gray-700",children:"Max Tokens"}),(0,n.jsx)(ee.default,{type:"number",size:"small",min:1,max:32768,value:a,onChange:e=>c(parseInt(e.target.value)||1e3),className:"w-24"})]})})]})]})})]})},ec=s(78801),ed=s(99397),em=s(27413),ep=e=>{let{tools:t,onAddTool:s,onEditTool:r,onRemoveTool:a}=e;return(0,n.jsxs)(ec.Z,{className:"p-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)(ec.x,{className:"text-sm font-medium",children:"Tools"}),(0,n.jsxs)("button",{onClick:s,className:"text-xs text-blue-600 hover:text-blue-700 flex items-center",children:[(0,n.jsx)(ed.Z,{size:14,className:"mr-1"}),"Add"]})]}),0===t.length?(0,n.jsx)(ec.x,{className:"text-gray-500 text-xs",children:"No tools added"}):(0,n.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 border border-gray-200 rounded",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"font-medium text-xs truncate",children:e.name}),(0,n.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.description})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-1 ml-2",children:[(0,n.jsx)("button",{onClick:()=>r(t),className:"text-xs text-blue-600 hover:text-blue-700",children:"Edit"}),(0,n.jsx)("button",{onClick:()=>a(t),className:"text-gray-400 hover:text-red-500",children:(0,n.jsx)(em.Z,{size:14})})]})]},t))})]})},ex=s(79326),eu=s(3810),eh=s(13377);let{TextArea:eg}=ee.default;var ev=e=>{let{value:t,onChange:s,placeholder:a,rows:l=4,className:o}=e,[i,c]=(0,r.useState)(null),[d,m]=(0,r.useState)(""),p=()=>{d.trim()&&i&&(s(t.substring(0,i.start)+"{{".concat(d,"}}")+t.substring(i.end)),c(null),m(""))},x=(()=>{let e;let s=/\{\{(\w+)\}\}/g,n=[];for(;null!==(e=s.exec(t));)n.push({name:e[1],start:e.index,end:e.index+e[0].length});return n})();return(0,n.jsxs)("div",{className:"variable-textarea-container ".concat(o),children:[(0,n.jsx)("style",{children:"\n          .variable-highlight-text {\n            color: #f97316;\n            background-color: #fff7ed;\n            border-radius: 4px;\n            padding: 0 2px;\n            border: 1px solid #fed7aa;\n            font-family: monospace;\n          }\n        "}),(0,n.jsx)(eg,{value:t,onChange:e=>s(e.target.value),placeholder:a,rows:l,className:"font-sans"}),x.length>0&&(0,n.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2 items-center",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500 mr-1",children:"Detected variables:"}),x.map((e,t)=>(0,n.jsx)(ex.Z,{content:(0,n.jsxs)("div",{className:"p-2",style:{minWidth:"200px"},children:[(0,n.jsx)("div",{className:"text-xs text-gray-500 mb-2",children:"Edit variable name"}),(0,n.jsx)(ee.default,{size:"small",value:d,onChange:e=>m(e.target.value),onPressEnter:p,placeholder:"Variable name",autoFocus:!0}),(0,n.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,n.jsx)("button",{onClick:p,className:"text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Save"}),(0,n.jsx)("button",{onClick:()=>{c(null),m("")},className:"text-xs px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Cancel"})]})]}),open:(null==i?void 0:i.start)===e.start,onOpenChange:e=>{e||(c(null),m(""))},trigger:"click",children:(0,n.jsx)(eu.Z,{color:"orange",className:"cursor-pointer hover:opacity-80 transition-all m-0",icon:(0,n.jsx)(eh.Z,{}),onClick:()=>{c({oldName:e.name,start:e.start,end:e.end}),m(e.name)},children:e.name})},"".concat(e.start,"-").concat(t)))]})]})},ef=e=>{let{value:t,onChange:s}=e;return(0,n.jsxs)(ec.Z,{className:"p-3",children:[(0,n.jsx)(ec.x,{className:"block mb-2 text-sm font-medium",children:"Developer message"}),(0,n.jsx)(ec.x,{className:"text-gray-500 text-xs mb-2",children:"Optional system instructions for the model"}),(0,n.jsx)(ev,{value:t,onChange:s,rows:3,placeholder:"e.g., You are a helpful assistant..."})]})},ej=s(41905);let{Option:eb}=M.default;var ey=e=>{let{messages:t,onAddMessage:s,onUpdateMessage:a,onRemoveMessage:l,onMoveMessage:o}=e,[i,c]=(0,r.useState)(null),[d,m]=(0,r.useState)(null),p=e=>{c(e)},x=(e,t)=>{e.preventDefault(),m(t)},u=(e,t)=>{e.preventDefault(),null!==i&&i!==t&&o(i,t),c(null),m(null)},h=()=>{c(null),m(null)};return(0,n.jsxs)(ec.Z,{className:"p-3",children:[(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)(ec.x,{className:"text-sm font-medium",children:"Prompt messages"}),(0,n.jsxs)(ec.x,{className:"text-gray-500 text-xs mt-1",children:["Use ",(0,n.jsx)("code",{className:"bg-gray-100 px-1 rounded text-xs",children:"{{variable}}"})," syntax for template variables"]})]}),(0,n.jsx)("div",{className:"space-y-2",children:t.map((e,s)=>(0,n.jsxs)("div",{draggable:!0,onDragStart:()=>p(s),onDragOver:e=>x(e,s),onDrop:e=>u(e,s),onDragEnd:h,className:"border border-gray-300 rounded overflow-hidden bg-white transition-all ".concat(i===s?"opacity-50":""," ").concat(d===s&&i!==s?"border-blue-500 border-2":""),children:[(0,n.jsxs)("div",{className:"bg-gray-50 px-2 py-1.5 border-b border-gray-300 flex items-center justify-between",children:[(0,n.jsxs)(M.default,{value:e.role,onChange:e=>a(s,"role",e),style:{width:100},size:"small",bordered:!1,children:[(0,n.jsx)(eb,{value:"user",children:"User"}),(0,n.jsx)(eb,{value:"assistant",children:"Assistant"}),(0,n.jsx)(eb,{value:"system",children:"System"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[t.length>1&&(0,n.jsx)("button",{onClick:()=>l(s),className:"text-gray-400 hover:text-red-500",children:(0,n.jsx)(em.Z,{size:14})}),(0,n.jsx)("div",{className:"cursor-grab active:cursor-grabbing text-gray-400 hover:text-gray-600",children:(0,n.jsx)(ej.Z,{size:16})})]})]}),(0,n.jsx)("div",{className:"p-2",children:(0,n.jsx)(ev,{value:e.content,onChange:e=>a(s,"content",e),rows:3,placeholder:"Enter prompt content..."})})]},s))}),(0,n.jsxs)("button",{onClick:s,className:"mt-2 text-xs text-blue-600 hover:text-blue-700 flex items-center",children:[(0,n.jsx)(ed.Z,{size:14,className:"mr-1"}),"Add message"]})]})},eN=s(26430);let ew=(e,t)=>{let[s,n]=(0,r.useState)(!1),[a,l]=(0,r.useState)([]),[i,c]=(0,r.useState)(""),[d,m]=(0,r.useState)({}),[p,x]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null),g=(0,r.useRef)(null),v=f(e),b=v.every(e=>d[e]&&""!==d[e].trim()),y=()=>{g.current&&setTimeout(()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})},100)};(0,r.useEffect)(()=>{y()},[a]);let N=async()=>{let s;if(!t){L.Z.fromBackend("Access token is required");return}if(v.length>0&&!b){L.Z.fromBackend("Please fill in all template variables");return}if(!i.trim())return;!p&&v.length>0&&x(!0);let r={role:"user",content:i};l(e=>[...e,r]),c("");let m=new AbortController;h(m),n(!0);let u=Date.now();try{let n,r;let c=j(e),p=(0,o.getProxyBaseUrl)(),x={dotprompt_content:c};0===a.length?x.prompt_variables=d:x.conversation_history=[...a.map(e=>({role:e.role,content:e.content})),{role:"user",content:i}];let h=await fetch("".concat(p,"/prompts/test"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(x),signal:m.signal});if(!h.ok){let e=await h.text();throw Error("HTTP error! status: ".concat(h.status,", ").concat(e))}if(!h.body)throw Error("No response body");let v=h.body.getReader(),b=new TextDecoder,N="";for(l(e=>[...e,{role:"assistant",content:""}]);;){let{done:e,value:t}=await v.read();if(e)break;for(let e of b.decode(t).split("\n"))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{var g,f,y;let e=JSON.parse(t);!n&&e.model&&(n=e.model),e.usage&&(r=e.usage);let a=null===(y=e.choices)||void 0===y?void 0:null===(f=y[0])||void 0===f?void 0:null===(g=f.delta)||void 0===g?void 0:g.content;a&&(s||(s=Date.now()-u),N+=a,l(e=>{let t=[...e];return t[t.length-1]={role:"assistant",content:N,model:n,timeToFirstToken:s},t}))}catch(e){console.error("Error parsing chunk:",e)}}}let w=Date.now()-u;l(e=>{let t=[...e];return t[t.length-1]={...t[t.length-1],totalLatency:w,usage:r},t})}catch(e){"AbortError"===e.name?console.log("Request was cancelled"):(console.error("Error testing prompt:",e),l(t=>{let s=t[t.length-1];return s&&"assistant"===s.role&&""===s.content?[...t.slice(0,-1),{role:"assistant",content:"Error: ".concat(e.message)}]:[...t,{role:"assistant",content:"Error: ".concat(e.message)}]}))}finally{n(!1),h(null)}};return{isLoading:s,messages:a,inputMessage:i,variables:d,variablesFilled:p,extractedVariables:v,allVariablesFilled:b,messagesEndRef:g,setInputMessage:c,handleSendMessage:N,handleCancelRequest:()=>{u&&(u.abort(),h(null),n(!1),L.Z.info("Request cancelled"))},handleClearConversation:()=>{l([]),x(!1),L.Z.success("Chat history cleared.")},handleKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N())},handleVariableChange:(e,t)=>{m({...d,[e]:t})}}};var e_=e=>{let{extractedVariables:t,variables:s,onVariableChange:r}=e;return 0===t.length?null:(0,n.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-blue-50",children:[(0,n.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Fill in template variables to start testing"}),(0,n.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-xs text-gray-600 mb-1 font-medium",children:["{{",e,"}}"]}),(0,n.jsx)(ee.default,{value:s[e]||"",onChange:t=>r(e,t.target.value),placeholder:"Enter value for ".concat(e),size:"small"})]},e))})]})},eC=s(61935),ek=s(10353),eS=s(69993),eZ=e=>{let{hasVariables:t}=e;return(0,n.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-gray-400",children:[(0,n.jsx)(eS.Z,{style:{fontSize:"48px",marginBottom:"16px"}}),(0,n.jsx)("span",{className:"text-base",children:t?"Fill in the variables above, then type a message to start testing":"Type a message below to start testing your prompt"})]})},eP=s(15883),eT=s(62831),eD=s(38398),eE=e=>{let{message:t}=e;return(0,n.jsx)("div",{className:"mb-4 flex ".concat("user"===t.role?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-[85%] rounded-lg shadow-sm p-3.5 px-4",style:{backgroundColor:"user"===t.role?"#f0f8ff":"#ffffff",border:"user"===t.role?"1px solid #e6f0fa":"1px solid #f0f0f0"},children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1.5",children:[(0,n.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full mr-1",style:{backgroundColor:"user"===t.role?"#e6f0fa":"#f5f5f5"},children:"user"===t.role?(0,n.jsx)(eP.Z,{style:{fontSize:"12px",color:"#2563eb"}}):(0,n.jsx)(eS.Z,{style:{fontSize:"12px",color:"#4b5563"}})}),(0,n.jsx)("strong",{className:"text-sm capitalize",children:t.role}),"assistant"===t.role&&t.model&&(0,n.jsx)("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600 font-normal",children:t.model})]}),(0,n.jsxs)("div",{className:"whitespace-pre-wrap break-words max-w-full message-content",style:{wordWrap:"break-word",overflowWrap:"break-word",wordBreak:"break-word",hyphens:"auto"},children:["assistant"===t.role?(0,n.jsx)(eT.UG,{components:{code(e){let{node:t,inline:s,className:r,children:a,...l}=e,o=/language-(\w+)/.exec(r||"");return!s&&o?(0,n.jsx)(J.Z,{style:U.Z,language:o[1],PreTag:"div",className:"rounded-md my-2",wrapLines:!0,wrapLongLines:!0,...l,children:String(a).replace(/\n$/,"")}):(0,n.jsx)("code",{className:"".concat(r," px-1.5 py-0.5 rounded bg-gray-100 text-sm font-mono"),style:{wordBreak:"break-word"},...l,children:a})},pre:e=>{let{node:t,...s}=e;return(0,n.jsx)("pre",{style:{overflowX:"auto",maxWidth:"100%"},...s})}},children:t.content}):(0,n.jsx)("div",{className:"whitespace-pre-wrap",children:t.content}),"assistant"===t.role&&(t.timeToFirstToken||t.totalLatency||t.usage)&&(0,n.jsx)(eD.Z,{timeToFirstToken:t.timeToFirstToken,totalLatency:t.totalLatency,usage:t.usage})]})]})})},ez=e=>{let{messages:t,isLoading:s,hasVariables:r,messagesEndRef:a}=e,l=(0,n.jsx)(eC.Z,{style:{fontSize:24},spin:!0});return(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 pb-0",children:[0===t.length&&(0,n.jsx)(eZ,{hasVariables:r}),t.map((e,t)=>(0,n.jsx)(eE,{message:e},t)),s&&(0,n.jsx)("div",{className:"flex justify-center items-center my-4",children:(0,n.jsx)(ek.Z,{indicator:l})}),(0,n.jsx)("div",{ref:a,style:{height:"1px"}})]})},eO=e=>{let{extractedVariables:t,variables:s}=e,r=t.filter(e=>!s[e]||""===s[e].trim());return 0===r.length?null:(0,n.jsx)("div",{className:"mb-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)("span",{className:"text-yellow-600 text-sm",children:"⚠️"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-sm text-yellow-800 font-medium mb-1",children:"Please fill in all template variables above"}),(0,n.jsxs)("p",{className:"text-xs text-yellow-700",children:["Missing: ",r.map(e=>"{{".concat(e,"}}")).join(", ")]})]})]})})},eA=s(79276);let{TextArea:eI}=ee.default;var eL=e=>{let{inputMessage:t,isLoading:s,isDisabled:r,onInputChange:l,onSend:o,onKeyDown:i,onCancel:c}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center flex-1 bg-white border border-gray-300 rounded-xl px-3 py-1 min-h-[44px]",children:[(0,n.jsx)(eI,{value:t,onChange:e=>l(e.target.value),onKeyDown:i,placeholder:"Type your message... (Shift+Enter for new line)",disabled:s,className:"flex-1",autoSize:{minRows:1,maxRows:4},style:{resize:"none",border:"none",boxShadow:"none",background:"transparent",padding:"4px 0",fontSize:"14px",lineHeight:"20px"}}),(0,n.jsx)(a.z,{onClick:o,disabled:r,className:"flex-shrink-0 ml-2 !w-8 !h-8 !min-w-8 !p-0 !rounded-full !bg-blue-600 hover:!bg-blue-700 disabled:!bg-gray-300 !border-none !text-white disabled:!text-gray-500 !flex !items-center !justify-center",children:(0,n.jsx)(eA.Z,{style:{fontSize:"14px"}})})]}),s&&(0,n.jsx)(a.z,{onClick:c,className:"bg-red-50 hover:bg-red-100 text-red-600 border-red-200",children:"Cancel"})]})},eM=e=>{let{prompt:t,accessToken:s}=e,{isLoading:r,messages:l,inputMessage:o,variables:i,variablesFilled:c,extractedVariables:d,allVariablesFilled:m,messagesEndRef:p,setInputMessage:x,handleSendMessage:u,handleCancelRequest:h,handleClearConversation:g,handleKeyDown:v,handleVariableChange:f}=ew(t,s);return(0,n.jsxs)("div",{className:"flex flex-col h-full bg-white",children:[!c&&(0,n.jsx)(e_,{extractedVariables:d,variables:i,onVariableChange:f}),l.length>0&&(0,n.jsx)("div",{className:"p-3 border-b border-gray-200 bg-white flex justify-end",children:(0,n.jsx)(a.z,{onClick:g,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 border-gray-300",icon:eN.Z,children:"Clear Chat"})}),(0,n.jsx)(ez,{messages:l,isLoading:r,hasVariables:d.length>0,messagesEndRef:p}),(0,n.jsxs)("div",{className:"p-4 border-t border-gray-200 bg-white",children:[(0,n.jsx)(eO,{extractedVariables:d,variables:i}),(0,n.jsx)(eL,{inputMessage:o,isLoading:r,isDisabled:r||!o.trim()||d.length>0&&!m,onInputChange:x,onSend:u,onKeyDown:v,onCancel:h})]})]})},eF=e=>{let{visible:t,promptName:s,isSaving:r,onNameChange:a,onPublish:o,onCancel:i}=e;return(0,n.jsx)(l.Z,{title:"Publish Prompt",open:t,onCancel:i,footer:[(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(R.z,{variant:"secondary",onClick:i,children:"Cancel"}),(0,n.jsx)(R.z,{onClick:o,loading:r,children:"Publish"})]},"footer")],children:(0,n.jsxs)("div",{className:"py-4",children:[(0,n.jsx)(R.x,{className:"mb-2",children:"Name"}),(0,n.jsx)(ee.default,{value:s,onChange:e=>a(e.target.value),placeholder:"Enter prompt name",onPressEnter:o,autoFocus:!0}),(0,n.jsx)(R.x,{className:"text-gray-500 text-xs mt-2",children:"Published prompts can be used in API calls and are versioned for easy tracking."})]})})},eB=e=>{let{prompt:t}=e,s=j(t);return(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Generated .prompt file"}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"This is the dotprompt format that will be saved to the database"})]}),(0,n.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 overflow-auto",children:(0,n.jsx)("pre",{className:"text-sm text-gray-900 font-mono whitespace-pre-wrap",children:s})})]})},eR=s(57840),eJ=s(63134),eU=s(50337),eV=s(35631);let{Text:eW}=eR.default;var eK=e=>{let{isOpen:t,onClose:s,accessToken:a,promptId:l,activeVersionId:i,onSelectVersion:c}=e,[d,m]=(0,r.useState)([]),[p,x]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&a&&l&&u()},[t,a,l]);let u=async()=>{x(!0);try{let e=l.includes(".v")?l.split(".v")[0]:l,t=await (0,o.getPromptVersions)(a,e);m(t.prompts)}catch(e){console.error("Error fetching prompt versions:",e)}finally{x(!1)}},h=e=>{var t;if(e.version)return"v".concat(e.version);let s=(null===(t=e.litellm_params)||void 0===t?void 0:t.prompt_id)||e.prompt_id;return s.includes(".v")?"v".concat(s.split(".v")[1]):s.includes("_v")?"v".concat(s.split("_v")[1]):"v1"},g=e=>e?new Date(e).toLocaleString():"-";return(0,n.jsx)(eJ.Z,{title:"Version History",placement:"right",onClose:s,open:t,width:400,mask:!1,maskClosable:!1,children:p?(0,n.jsx)(eU.Z,{active:!0,paragraph:{rows:4}}):0===d.length?(0,n.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No version history available."}):(0,n.jsx)(eV.Z,{dataSource:d,renderItem:(e,t)=>{var s;let r=e.version||parseInt(h(e).replace("v","")),a=null;i&&(i.includes(".v")?a=parseInt(i.split(".v")[1]):i.includes("_v")&&(a=parseInt(i.split("_v")[1])));let l=a?r===a:0===t;return(0,n.jsxs)("div",{className:"mb-4 p-4 rounded-lg border cursor-pointer transition-all hover:shadow-md ".concat(l?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-blue-300"),onClick:()=>null==c?void 0:c(e),children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(eu.Z,{className:"m-0",children:h(e)}),0===t&&(0,n.jsx)(eu.Z,{color:"blue",className:"m-0",children:"Latest"})]}),l&&(0,n.jsx)(eu.Z,{color:"green",className:"m-0",children:"Active"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)(eW,{className:"text-sm text-gray-600 font-medium",children:g(e.created_at)}),(0,n.jsx)(eW,{type:"secondary",className:"text-xs",children:(null===(s=e.prompt_info)||void 0===s?void 0:s.prompt_type)==="db"?"Saved to Database":"Config Prompt"})]})]},"".concat(e.prompt_id,"-v").concat(e.version||r))}})})},eH=e=>{var t;let{onClose:s,onSuccess:a,accessToken:l,initialPromptData:i}=e,[c,d]=(0,r.useState)((()=>{if(i)try{return b(i)}catch(e){console.error("Error parsing existing prompt:",e),L.Z.fromBackend("Failed to parse prompt data")}return{name:"New prompt",model:"gpt-4o",config:{temperature:1,max_tokens:1e3},tools:[],developerMessage:"",messages:[{role:"user",content:"Enter task specifics. Use {{template_variables}} for dynamic inputs"}]}})()),[m,p]=(0,r.useState)(!!i),[x,u]=(0,r.useState)(!1),[h,g]=(0,r.useState)((()=>{var e;if(!(null==i?void 0:i.prompt_spec))return;let t=i.prompt_spec.prompt_id,s=i.prompt_spec.version||(null===(e=i.prompt_spec.litellm_params)||void 0===e?void 0:e.prompt_id);return"number"==typeof s?"".concat(t,".v").concat(s):"string"==typeof s&&(s.includes(".v")||s.includes("_v"))?s:t})()),[v,f]=(0,r.useState)(!1),[y,N]=(0,r.useState)(!1),[w,_]=(0,r.useState)(null),[C,k]=(0,r.useState)(!1),[S,Z]=(0,r.useState)("pretty"),P=e=>{void 0!==e?_(e):_(null),f(!0)},T=async()=>{if(!l){L.Z.fromBackend("Access token is required");return}if(!c.name||""===c.name.trim()){L.Z.fromBackend("Please enter a valid prompt name");return}k(!0);try{var e;let t=c.name.replace(/[^a-zA-Z0-9_-]/g,"_").toLowerCase(),n=j(c),r={prompt_id:t,litellm_params:{prompt_integration:"dotprompt",prompt_id:t,dotprompt_content:n},prompt_info:{prompt_type:"db"}};m&&(null==i?void 0:null===(e=i.prompt_spec)||void 0===e?void 0:e.prompt_id)?(await (0,o.updatePromptCall)(l,i.prompt_spec.prompt_id,r),L.Z.success("Prompt updated successfully!")):(await (0,o.createPromptCall)(l,r),L.Z.success("Prompt created successfully!")),a(),s()}catch(e){console.error("Error saving prompt:",e),L.Z.fromBackend(m?"Failed to update prompt":"Failed to save prompt")}finally{k(!1),N(!1)}},D=h&&h.includes(".v")?"v".concat(h.split(".v")[1]):null;return(0,n.jsxs)("div",{className:"flex h-full bg-white",children:[(0,n.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,n.jsx)(er,{promptName:c.name,onNameChange:e=>d({...c,name:e}),onBack:s,onSave:()=>{c.name&&""!==c.name.trim()&&"New prompt"!==c.name?T():N(!0)},isSaving:C,editMode:m,onShowHistory:()=>u(!0),version:D,promptModel:c.model,promptVariables:(()=>{let e;let t={},s=[c.developerMessage,...c.messages.map(e=>e.content)].join(" "),n=/\{\{(\w+)\}\}/g;for(;null!==(e=n.exec(s));){let s=e[1];t[s]||(t[s]="example_".concat(s))}return t})(),accessToken:l}),(0,n.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,n.jsxs)("div",{className:"w-1/2 overflow-y-auto bg-white border-r border-gray-200 flex-shrink-0",children:[(0,n.jsxs)("div",{className:"border-b border-gray-200 bg-white px-6 py-4 flex items-center gap-3",children:[(0,n.jsx)(ei,{model:c.model,temperature:c.config.temperature,maxTokens:c.config.max_tokens,accessToken:l,onModelChange:e=>d({...c,model:e}),onTemperatureChange:e=>d({...c,config:{...c.config,temperature:e}}),onMaxTokensChange:e=>d({...c,config:{...c.config,max_tokens:e}})}),(0,n.jsxs)("div",{className:"ml-auto inline-flex items-center bg-gray-200 rounded-full p-0.5",children:[(0,n.jsx)("button",{className:"px-3 py-1 text-xs font-medium rounded-full transition-colors ".concat("pretty"===S?"bg-white text-gray-900 shadow-sm":"text-gray-600"),onClick:()=>Z("pretty"),children:"PRETTY"}),(0,n.jsx)("button",{className:"px-3 py-1 text-xs font-medium rounded-full transition-colors ".concat("dotprompt"===S?"bg-white text-gray-900 shadow-sm":"text-gray-600"),onClick:()=>Z("dotprompt"),children:"DOTPROMPT"})]})]}),"pretty"===S?(0,n.jsxs)("div",{className:"p-6 space-y-4 pb-20",children:[(0,n.jsx)(ep,{tools:c.tools,onAddTool:()=>P(),onEditTool:P,onRemoveTool:e=>{d({...c,tools:c.tools.filter((t,s)=>s!==e)})}}),(0,n.jsx)(ef,{value:c.developerMessage,onChange:e=>d({...c,developerMessage:e})}),(0,n.jsx)(ey,{messages:c.messages,onAddMessage:()=>{d({...c,messages:[...c.messages,{role:"user",content:""}]})},onUpdateMessage:(e,t,s)=>{let n=[...c.messages];n[e][t]=s,d({...c,messages:n})},onRemoveMessage:e=>{c.messages.length>1&&d({...c,messages:c.messages.filter((t,s)=>s!==e)})},onMoveMessage:(e,t)=>{let s=[...c.messages],[n]=s.splice(e,1);s.splice(t,0,n),d({...c,messages:s})}})]}):(0,n.jsx)(eB,{prompt:c})]}),(0,n.jsx)("div",{className:"w-1/2 flex-shrink-0",children:(0,n.jsx)(eM,{prompt:c,accessToken:l})})]})]}),(0,n.jsx)(eF,{visible:y,promptName:c.name,isSaving:C,onNameChange:e=>d({...c,name:e}),onPublish:T,onCancel:()=>N(!1)}),v&&(0,n.jsx)(Q,{visible:v,initialJson:null!==w?c.tools[w].json:"",onSave:e=>{try{var t,s;let n=JSON.parse(e),r={name:(null===(t=n.function)||void 0===t?void 0:t.name)||"Unnamed Tool",description:(null===(s=n.function)||void 0===s?void 0:s.description)||"",json:e};if(null!==w){let e=[...c.tools];e[w]=r,d({...c,tools:e})}else d({...c,tools:[...c.tools,r]});f(!1),_(null)}catch(e){L.Z.fromBackend("Invalid JSON format")}},onClose:()=>{f(!1),_(null)}}),(0,n.jsx)(eK,{isOpen:x,onClose:()=>u(!1),accessToken:l,promptId:(null==i?void 0:null===(t=i.prompt_spec)||void 0===t?void 0:t.prompt_id)||c.name,activeVersionId:h,onSelectVersion:e=>{try{let t=b({prompt_spec:e});d(t);let s=e.version||1;g("".concat(e.prompt_id,".v").concat(s))}catch(e){console.error("Error loading version:",e),L.Z.fromBackend("Failed to load prompt version")}}})]})},eq=s(20347),eG=e=>{let{accessToken:t,userRole:s}=e,[i,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(!1),[p,x]=(0,r.useState)(null),[u,h]=(0,r.useState)(!1),[g,v]=(0,r.useState)(!1),[f,j]=(0,r.useState)(null),[b,y]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),_=!!s&&(0,eq.tY)(s),C=async()=>{if(t){m(!0);try{let e=await (0,o.getPromptsList)(t);console.log("prompts: ".concat(JSON.stringify(e))),c(e.prompts)}catch(e){console.error("Error fetching prompts:",e)}finally{m(!1)}}};(0,r.useEffect)(()=>{C()},[t]);let k=()=>{C(),v(!1),j(null),x(null)},S=async()=>{if(N&&t){y(!0);try{await (0,o.deletePromptCall)(t,N.id),L.Z.success('Prompt "'.concat(N.name,'" deleted successfully')),C()}catch(e){console.error("Error deleting prompt:",e),L.Z.fromBackend("Failed to delete prompt")}finally{y(!1),w(null)}}};return(0,n.jsxs)("div",{className:"w-full mx-auto flex-auto overflow-y-auto m-8 p-2",children:[g?(0,n.jsx)(eH,{onClose:()=>{v(!1),j(null)},onSuccess:k,accessToken:t,initialPromptData:f}):p?(0,n.jsx)(W,{promptId:p,onClose:()=>x(null),accessToken:t,isAdmin:_,onDelete:C,onEdit:e=>{j(e),v(!0)}}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(a.z,{onClick:()=>{p&&x(null),j(null),v(!0)},disabled:!t,children:"+ Add New Prompt"}),(0,n.jsx)(a.z,{onClick:()=>{p&&x(null),h(!0)},disabled:!t,variant:"secondary",children:"Upload .prompt File"})]})}),(0,n.jsx)(P,{promptsList:i,isLoading:d,onPromptClick:e=>{x(e)},onDeleteClick:(e,t)=>{w({id:e,name:t})},accessToken:t,isAdmin:_})]}),(0,n.jsx)($,{visible:u,onClose:()=>{h(!1)},accessToken:t,onSuccess:k}),N&&(0,n.jsxs)(l.Z,{title:"Delete Prompt",open:null!==N,onOk:S,onCancel:()=>{w(null)},confirmLoading:b,okText:"Delete",okButtonProps:{danger:!0},children:[(0,n.jsxs)("p",{children:["Are you sure you want to delete prompt: ",N.name," ?"]}),(0,n.jsx)("p",{children:"This action cannot be undone."})]})]})}}}]);