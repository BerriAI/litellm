"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5975],{9513:function(e,t,l){l.d(t,{Ct:function(){return n.Z},JO:function(){return a.Z},RM:function(){return i.Z},SC:function(){return u.Z},iA:function(){return r.Z},pj:function(){return o.Z},ss:function(){return c.Z},xs:function(){return d.Z},xv:function(){return g.Z},zx:function(){return s.Z}});var n=l(41649),s=l(78489),a=l(47323),r=l(21626),i=l(97214),o=l(28241),c=l(58834),d=l(69552),u=l(71876),g=l(84264)},12011:function(e,t,l){l.r(t),l.d(t,{default:function(){return S}});var n=l(57437),s=l(2265),a=l(99376),r=l(78489),i=l(94789),o=l(12514),c=l(49804),d=l(67101),u=l(84264),g=l(49566),m=l(96761),h=l(84566),x=l(19250),f=l(14474),y=l(10032),p=l(5545),w=l(3914);function S(){let[e]=y.Z.useForm(),t=(0,a.useSearchParams)();(0,w.e)("token");let l=t.get("invitation_id"),S=t.get("action"),[j,v]=(0,s.useState)(null),[_,b]=(0,s.useState)(""),[k,z]=(0,s.useState)(""),[N,C]=(0,s.useState)(null),[D,I]=(0,s.useState)(""),[Z,O]=(0,s.useState)(""),[A,E]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(0,x.getUiConfig)().then(e=>{console.log("ui config in onboarding.tsx:",e),E(!1)})},[]),(0,s.useEffect)(()=>{l&&!A&&(0,x.getOnboardingCredentials)(l).then(e=>{let t=e.login_url;console.log("login_url:",t),I(t);let l=e.token,n=(0,f.o)(l);O(l),console.log("decoded:",n),v(n.key),console.log("decoded user email:",n.user_email),z(n.user_email),C(n.user_id)})},[l,A]),(0,n.jsx)("div",{className:"mx-auto w-full max-w-md mt-10",children:(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(m.Z,{className:"text-sm mb-5 text-center",children:"\uD83D\uDE85 LiteLLM"}),(0,n.jsx)(m.Z,{className:"text-xl",children:"reset_password"===S?"Reset Password":"Sign up"}),(0,n.jsx)(u.Z,{children:"reset_password"===S?"Reset your password to access Admin UI.":"Claim your user account to login to Admin UI."}),"reset_password"!==S&&(0,n.jsx)(i.Z,{className:"mt-4",title:"SSO",icon:h.GH$,color:"sky",children:(0,n.jsxs)(d.Z,{numItems:2,className:"flex justify-between items-center",children:[(0,n.jsx)(c.Z,{children:"SSO is under the Enterprise Tier."}),(0,n.jsx)(c.Z,{children:(0,n.jsx)(r.Z,{variant:"primary",className:"mb-2",children:(0,n.jsx)("a",{href:"https://forms.gle/W3U4PZpJGFHWtHyA9",target:"_blank",children:"Get Free Trial"})})})]})}),(0,n.jsxs)(y.Z,{className:"mt-10 mb-5 mx-auto",layout:"vertical",onFinish:e=>{console.log("in handle submit. accessToken:",j,"token:",Z,"formValues:",e),j&&Z&&(e.user_email=k,N&&l&&(0,x.claimOnboardingToken)(j,l,N,e.password).then(e=>{document.cookie="token="+Z;let t=(0,x.getProxyBaseUrl)();console.log("proxyBaseUrl:",t);let l=t?"".concat(t,"/ui/?login=success"):"/ui/?login=success";console.log("redirecting to:",l),window.location.href=l}))},children:[(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y.Z.Item,{label:"Email Address",name:"user_email",children:(0,n.jsx)(g.Z,{type:"email",disabled:!0,value:k,defaultValue:k,className:"max-w-md"})}),(0,n.jsx)(y.Z.Item,{label:"Password",name:"password",rules:[{required:!0,message:"password required to sign up"}],help:"reset_password"===S?"Enter your new password":"Create a password for your account",children:(0,n.jsx)(g.Z,{placeholder:"",type:"password",className:"max-w-md"})})]}),(0,n.jsx)("div",{className:"mt-10",children:(0,n.jsx)(p.ZP,{htmlType:"submit",children:"reset_password"===S?"Reset Password":"Sign Up"})})]})]})})}},39210:function(e,t,l){l.d(t,{Z:function(){return s}});var n=l(19250);let s=async(e,t,l,s,a)=>{let r;r="Admin"!=l&&"Admin Viewer"!=l?await (0,n.teamListCall)(e,(null==s?void 0:s.organization_id)||null,t):await (0,n.teamListCall)(e,(null==s?void 0:s.organization_id)||null),console.log("givenTeams: ".concat(r)),a(r)}},85975:function(e,t,l){l.d(t,{Z:function(){return K}});var n=l(57437),s=l(3914),a=l(49804),r=l(67101),i=l(57840),o=l(14474),c=l(99376),d=l(2265),u=l(12011),g=l(39210),m=l(19250),h=l(71098),x=l(30280),f=l(59872),y=l(86462),p=l(47686),w=l(44633),S=l(49084),j=l(71594),v=l(24525),_=l(9513),b=l(99981),k=l(50337),z=l(46468),N=l(11713),C=l(30841),D=l(7310),I=l.n(D),Z=l(12363),O=l(39760),A=l(23048),E=l(50665);function U(e){let{teams:t,organizations:l,onSortChange:s,currentSort:a}=e,[r,i]=(0,d.useState)(null),[o,c]=d.useState(()=>a?[{id:a.sortBy,desc:"desc"===a.sortOrder}]:[{id:"created_at",desc:!0}]),[u,g]=d.useState({pageIndex:0,pageSize:50}),h=o.length>0?o[0].id:null,D=o.length>0?o[0].desc?"desc":"asc":null,{data:U,isPending:K,isFetching:P,refetch:R}=(0,x.EX)(u.pageIndex+1,u.pageSize,{sortBy:h||void 0,sortOrder:D||void 0}),L=(null==U?void 0:U.total_count)||0,[T,V]=(0,d.useState)({}),{filters:M,filteredKeys:B,allKeyAliases:F,allTeams:J,allOrganizations:W,handleFilterChange:H,handleFilterReset:q}=function(e){let{keys:t,teams:l,organizations:n}=e,s={"Team ID":"","Organization ID":"","Key Alias":"","User ID":"","Sort By":"created_at","Sort Order":"desc"},{accessToken:a}=(0,O.Z)(),[r,i]=(0,d.useState)(s),[o,c]=(0,d.useState)(l||[]),[u,g]=(0,d.useState)(n||[]),[h,x]=(0,d.useState)(t),f=(0,d.useRef)(0),y=(0,d.useCallback)(I()(async e=>{if(!a)return;let t=Date.now();f.current=t;try{let l=await (0,m.keyListCall)(a,e["Organization ID"]||null,e["Team ID"]||null,e["Key Alias"]||null,e["User ID"]||null,e["Key Hash"]||null,1,Z.d,e["Sort By"]||null,e["Sort Order"]||null);t===f.current&&l&&(x(l.keys),console.log("called from debouncedSearch filters:",JSON.stringify(e)),console.log("called from debouncedSearch data:",JSON.stringify(l)))}catch(e){console.error("Error searching users:",e)}},300),[a]);(0,d.useEffect)(()=>{if(!t){x([]);return}let e=[...t];r["Team ID"]&&(e=e.filter(e=>e.team_id===r["Team ID"])),r["Organization ID"]&&(e=e.filter(e=>e.organization_id===r["Organization ID"])),x(e)},[t,r]),(0,d.useEffect)(()=>{let e=async()=>{let e=await (0,C.IE)(a);e.length>0&&c(e);let t=await (0,C.cT)(a);t.length>0&&g(t)};a&&e()},[a]);let p=(0,N.a)({queryKey:["allKeys"],queryFn:async()=>{if(!a)throw Error("Access token required");return await (0,C.LO)(a)},enabled:!!a}).data||[];return(0,d.useEffect)(()=>{l&&l.length>0&&c(e=>e.length<l.length?l:e)},[l]),(0,d.useEffect)(()=>{n&&n.length>0&&g(e=>e.length<n.length?n:e)},[n]),{filters:r,filteredKeys:h,allKeyAliases:p,allTeams:o,allOrganizations:u,handleFilterChange:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i({"Team ID":e["Team ID"]||"","Organization ID":e["Organization ID"]||"","Key Alias":e["Key Alias"]||"","User ID":e["User ID"]||"","Sort By":e["Sort By"]||"created_at","Sort Order":e["Sort Order"]||"desc"}),t||y({...r,...e})},handleFilterReset:()=>{i(s),y(s)}}}({keys:(null==U?void 0:U.keys)||[],teams:t,organizations:l});(0,d.useEffect)(()=>{if(R){let e=()=>{R()};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}},[R]);let G=[{id:"expander",header:()=>null,size:40,enableSorting:!1,cell:e=>{let{row:t}=e;return t.getCanExpand()?(0,n.jsx)("button",{onClick:t.getToggleExpandedHandler(),style:{cursor:"pointer"},children:t.getIsExpanded()?"▼":"▶"}):null}},{id:"token",accessorKey:"token",header:"Key ID",size:100,enableSorting:!0,cell:e=>{let t=e.getValue(),l=e.cell.column.getSize();return(0,n.jsx)(b.Z,{title:t,children:(0,n.jsx)(_.zx,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate block",style:{maxWidth:l,overflow:"hidden"},onClick:()=>i(e.row.original),children:null!=t?t:"-"})})}},{id:"key_alias",accessorKey:"key_alias",header:"Key Alias",size:150,enableSorting:!0,cell:e=>{let t=e.getValue(),l=e.cell.column.getSize();return(0,n.jsx)(b.Z,{title:t,children:(0,n.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:l,overflow:"hidden"},children:null!=t?t:"-"})})}},{id:"key_name",accessorKey:"key_name",header:"Secret Key",size:120,enableSorting:!1,cell:e=>(0,n.jsx)("span",{className:"font-mono text-xs",children:e.getValue()})},{id:"team_alias",accessorKey:"team_id",header:"Team Alias",size:120,enableSorting:!1,cell:e=>{let{row:l,getValue:n}=e,s=n(),a=null==t?void 0:t.find(e=>e.team_id===s);return(null==a?void 0:a.team_alias)||"Unknown"}},{id:"team_id",accessorKey:"team_id",header:"Team ID",size:80,enableSorting:!1,cell:e=>{let t=e.getValue(),l=e.cell.column.getSize();return(0,n.jsx)(b.Z,{title:t,children:(0,n.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:l,overflow:"hidden"},children:null!=t?t:"-"})})}},{id:"organization_id",accessorKey:"organization_id",header:"Organization ID",size:140,enableSorting:!1,cell:e=>e.getValue()?e.renderValue():"-"},{id:"user_email",accessorKey:"user",header:"User Email",size:160,enableSorting:!1,cell:e=>{let t=e.getValue(),l=null==t?void 0:t.user_email,s=e.cell.column.getSize();return(0,n.jsx)(b.Z,{title:l,children:(0,n.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:s,overflow:"hidden"},children:null!=l?l:"-"})})}},{id:"user_id",accessorKey:"user_id",header:"User ID",size:70,enableSorting:!1,cell:e=>{let t=e.getValue(),l="default_user_id"===t?"Default Proxy Admin":t,s=e.cell.column.getSize();return(0,n.jsx)(b.Z,{title:l,children:(0,n.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:s,overflow:"hidden"},children:null!=l?l:"-"})})}},{id:"created_at",accessorKey:"created_at",header:"Created At",size:120,enableSorting:!0,cell:e=>{let t=e.getValue();return t?new Date(t).toLocaleDateString():"-"}},{id:"created_by",accessorKey:"created_by",header:"Created By",size:70,enableSorting:!1,cell:e=>{let t=e.getValue(),l="default_user_id"===t?"Default Proxy Admin":t,s=e.cell.column.getSize();return(0,n.jsx)(b.Z,{title:l,children:(0,n.jsx)("span",{className:"font-mono text-xs truncate block",style:{maxWidth:s,overflow:"hidden"},children:null!=l?l:"-"})})}},{id:"updated_at",accessorKey:"updated_at",header:"Updated At",size:120,enableSorting:!0,cell:e=>{let t=e.getValue();return t?new Date(t).toLocaleDateString():"Never"}},{id:"expires",accessorKey:"expires",header:"Expires",size:120,enableSorting:!1,cell:e=>{let t=e.getValue();return t?new Date(t).toLocaleDateString():"Never"}},{id:"spend",accessorKey:"spend",header:"Spend (USD)",size:100,enableSorting:!0,cell:e=>(0,f.pw)(e.getValue(),4)},{id:"max_budget",accessorKey:"max_budget",header:"Budget (USD)",size:110,enableSorting:!0,cell:e=>{let t=e.getValue();return null===t?"Unlimited":"$".concat((0,f.pw)(t))}},{id:"budget_reset_at",accessorKey:"budget_reset_at",header:"Budget Reset",size:130,enableSorting:!1,cell:e=>{let t=e.getValue();return t?new Date(t).toLocaleString():"Never"}},{id:"models",accessorKey:"models",header:"Models",size:200,enableSorting:!1,cell:e=>{let t=e.getValue();return(0,n.jsx)("div",{className:"flex flex-col py-2",children:Array.isArray(t)?(0,n.jsx)("div",{className:"flex flex-col",children:0===t.length?(0,n.jsx)(_.Ct,{size:"xs",className:"mb-1",color:"red",children:(0,n.jsx)(_.xv,{children:"All Proxy Models"})}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex items-start",children:[t.length>3&&(0,n.jsx)("div",{children:(0,n.jsx)(_.JO,{icon:T[e.row.id]?y.Z:p.Z,className:"cursor-pointer",size:"xs",onClick:()=>{V(t=>({...t,[e.row.id]:!t[e.row.id]}))}})}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-1",children:[t.slice(0,3).map((e,t)=>"all-proxy-models"===e?(0,n.jsx)(_.Ct,{size:"xs",color:"red",children:(0,n.jsx)(_.xv,{children:"All Proxy Models"})},t):(0,n.jsx)(_.Ct,{size:"xs",color:"blue",children:(0,n.jsx)(_.xv,{children:e.length>30?"".concat((0,z.W0)(e).slice(0,30),"..."):(0,z.W0)(e)})},t)),t.length>3&&!T[e.row.id]&&(0,n.jsx)(_.Ct,{size:"xs",color:"gray",className:"cursor-pointer",children:(0,n.jsxs)(_.xv,{children:["+",t.length-3," ",t.length-3==1?"more model":"more models"]})}),T[e.row.id]&&(0,n.jsx)("div",{className:"flex flex-wrap gap-1",children:t.slice(3).map((e,t)=>"all-proxy-models"===e?(0,n.jsx)(_.Ct,{size:"xs",color:"red",children:(0,n.jsx)(_.xv,{children:"All Proxy Models"})},t+3):(0,n.jsx)(_.Ct,{size:"xs",color:"blue",children:(0,n.jsx)(_.xv,{children:e.length>30?"".concat((0,z.W0)(e).slice(0,30),"..."):(0,z.W0)(e)})},t+3))})]})]})})}):null})}},{id:"rate_limits",header:"Rate Limits",size:140,enableSorting:!1,cell:e=>{let{row:t}=e,l=t.original;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{children:["TPM: ",null!==l.tpm_limit?l.tpm_limit:"Unlimited"]}),(0,n.jsxs)("div",{children:["RPM: ",null!==l.rpm_limit?l.rpm_limit:"Unlimited"]})]})}}];console.log("keys: ".concat(JSON.stringify(U)));let $=(0,j.b7)({data:B,columns:G.filter(e=>"expander"!==e.id),columnResizeMode:"onChange",columnResizeDirection:"ltr",state:{sorting:o,pagination:u},onSortingChange:e=>{let t="function"==typeof e?e(o):e;if(console.log("newSorting: ".concat(JSON.stringify(t))),c(t),t&&t.length>0){let e=t[0],l=e.id,n=e.desc?"desc":"asc";console.log("sortBy: ".concat(l,", sortOrder: ").concat(n)),H({...M,"Sort By":l,"Sort Order":n},!0),null==s||s(l,n)}},onPaginationChange:g,getCoreRowModel:(0,v.sC)(),getSortedRowModel:(0,v.tj)(),getPaginationRowModel:(0,v.G_)(),enableSorting:!0,manualSorting:!1,manualPagination:!0,pageCount:Math.ceil(L/u.pageSize)});d.useEffect(()=>{a&&c([{id:a.sortBy,desc:"desc"===a.sortOrder}])},[a]);let{pageIndex:X,pageSize:Q}=$.getState().pagination,Y="".concat(X*Q+1," - ").concat(Math.min((X+1)*Q,L));return(0,n.jsx)("div",{className:"w-full h-full overflow-hidden",children:r?(0,n.jsx)(E.Z,{keyId:r.token,onClose:()=>i(null),keyData:r,teams:J,onDelete:R}):(0,n.jsxs)("div",{className:"border-b py-4 flex-1 overflow-hidden",children:[(0,n.jsx)("div",{className:"w-full mb-6",children:(0,n.jsx)(A.Z,{options:[{name:"Team ID",label:"Team ID",isSearchable:!0,searchFn:async e=>J&&0!==J.length?J.filter(t=>t.team_id.toLowerCase().includes(e.toLowerCase())||t.team_alias&&t.team_alias.toLowerCase().includes(e.toLowerCase())).map(e=>({label:"".concat(e.team_alias||e.team_id," (").concat(e.team_id,")"),value:e.team_id})):[]},{name:"Organization ID",label:"Organization ID",isSearchable:!0,searchFn:async e=>W&&0!==W.length?W.filter(t=>{var l,n;return null!==(n=null===(l=t.organization_id)||void 0===l?void 0:l.toLowerCase().includes(e.toLowerCase()))&&void 0!==n&&n}).filter(e=>null!==e.organization_id&&void 0!==e.organization_id).map(e=>({label:"".concat(e.organization_id||"Unknown"," (").concat(e.organization_id,")"),value:e.organization_id})):[]},{name:"Key Alias",label:"Key Alias",isSearchable:!0,searchFn:async e=>F.filter(t=>t.toLowerCase().includes(e.toLowerCase())).map(e=>({label:e,value:e}))},{name:"User ID",label:"User ID",isSearchable:!1},{name:"Key Hash",label:"Key Hash",isSearchable:!1}],onApplyFilters:H,initialValues:M,onResetFilters:q})}),(0,n.jsxs)("div",{className:"flex items-center justify-between w-full mb-4",children:[K||P?(0,n.jsx)(k.Z.Node,{active:!0,style:{width:200,height:20}}):(0,n.jsxs)("span",{className:"inline-flex text-sm text-gray-700",children:["Showing ",Y," of ",L," results"]}),(0,n.jsxs)("div",{className:"inline-flex items-center gap-2",children:[K||P?(0,n.jsx)(k.Z.Node,{active:!0,style:{width:74,height:20}}):(0,n.jsxs)("span",{className:"text-sm text-gray-700",children:["Page ",X+1," of ",$.getPageCount()]}),K||P?(0,n.jsx)(k.Z.Button,{active:!0,size:"small",style:{width:84,height:30}}):(0,n.jsx)("button",{onClick:()=>$.previousPage(),disabled:K||P||!$.getCanPreviousPage(),className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),K||P?(0,n.jsx)(k.Z.Button,{active:!0,size:"small",style:{width:58,height:30}}):(0,n.jsx)("button",{onClick:()=>$.nextPage(),disabled:K||P||!$.getCanNextPage(),className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]}),(0,n.jsx)("div",{className:"h-[75vh] overflow-auto",children:(0,n.jsx)("div",{className:"rounded-lg custom-border relative",children:(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)(_.iA,{className:"[&_td]:py-0.5 [&_th]:py-1",style:{width:$.getCenterTotalSize()},children:[(0,n.jsx)(_.ss,{children:$.getHeaderGroups().map(e=>(0,n.jsx)(_.SC,{children:e.headers.map(e=>(0,n.jsx)(_.xs,{"data-header-id":e.id,className:"py-1 h-8 relative hover:bg-gray-50 ".concat("actions"===e.id?"sticky right-0 bg-white shadow-[-4px_0_8px_-6px_rgba(0,0,0,0.1)]":""),style:{width:e.getSize(),position:"relative",cursor:e.column.getCanSort()?"pointer":"default"},onMouseEnter:()=>{let t=document.querySelector('[data-header-id="'.concat(e.id,'"] .resizer'));t&&(t.style.opacity="0.5")},onMouseLeave:()=>{let t=document.querySelector('[data-header-id="'.concat(e.id,'"] .resizer'));t&&!e.column.getIsResizing()&&(t.style.opacity="0")},onClick:e.column.getCanSort()?e.column.getToggleSortingHandler():void 0,children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,n.jsx)("div",{className:"flex items-center",children:e.isPlaceholder?null:(0,j.ie)(e.column.columnDef.header,e.getContext())}),"actions"!==e.id&&e.column.getCanSort()&&(0,n.jsx)("div",{className:"w-4",children:e.column.getIsSorted()?({asc:(0,n.jsx)(w.Z,{className:"h-4 w-4 text-blue-500"}),desc:(0,n.jsx)(y.Z,{className:"h-4 w-4 text-blue-500"})})[e.column.getIsSorted()]:(0,n.jsx)(S.Z,{className:"h-4 w-4 text-gray-400"})}),(0,n.jsx)("div",{onDoubleClick:()=>e.column.resetSize(),onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler(),className:"resizer ".concat($.options.columnResizeDirection," ").concat(e.column.getIsResizing()?"isResizing":""),style:{position:"absolute",right:0,top:0,height:"100%",width:"5px",background:e.column.getIsResizing()?"#3b82f6":"transparent",cursor:"col-resize",userSelect:"none",touchAction:"none",opacity:e.column.getIsResizing()?1:0}})]})},e.id))},e.id))}),(0,n.jsx)(_.RM,{children:K||P?(0,n.jsx)(_.SC,{children:(0,n.jsx)(_.pj,{colSpan:G.length,className:"h-8 text-center",children:(0,n.jsx)("div",{className:"text-center text-gray-500",children:(0,n.jsx)("p",{children:"\uD83D\uDE85 Loading keys..."})})})}):B.length>0?$.getRowModel().rows.map(e=>(0,n.jsx)(_.SC,{className:"h-8",children:e.getVisibleCells().map(e=>(0,n.jsx)(_.pj,{style:{width:e.column.getSize(),maxWidth:"8-x",whiteSpace:"pre-wrap",overflow:"hidden"},className:"py-0.5 max-h-8 overflow-hidden text-ellipsis whitespace-nowrap ".concat("models"===e.column.id&&e.getValue().length>3?"px-0":""),children:(0,j.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,n.jsx)(_.SC,{children:(0,n.jsx)(_.pj,{colSpan:G.length,className:"h-8 text-center",children:(0,n.jsx)("div",{className:"text-center text-gray-500",children:(0,n.jsx)("p",{children:"No keys found"})})})})})]})})})})]})})}var K=e=>{let{userID:t,userRole:l,teams:x,keys:f,setUserRole:y,userEmail:p,setUserEmail:w,setTeams:S,setKeys:j,premiumUser:v,organizations:_,addKey:b,createClicked:k}=e,[z,N]=(0,d.useState)(null),[C,D]=(0,d.useState)(null),I=(0,c.useSearchParams)(),Z=function(e){console.log("COOKIES",document.cookie);let t=document.cookie.split("; ").find(t=>t.startsWith(e+"="));return t?t.split("=")[1]:null}("token"),O=I.get("invitation_id"),[A,E]=(0,d.useState)(null),[K,P]=(0,d.useState)(null),[R,L]=(0,d.useState)([]),[T,V]=(0,d.useState)(null),[M,B]=(0,d.useState)(null);if(window.addEventListener("beforeunload",function(){sessionStorage.clear()}),(0,d.useEffect)(()=>{if(Z){let e=(0,o.o)(Z);if(e){if(console.log("Decoded token:",e),console.log("Decoded key:",e.key),E(e.key),e.user_role){let t=function(e){if(!e)return"Undefined Role";switch(console.log("Received user role: ".concat(e)),e.toLowerCase()){case"app_owner":case"demo_app_owner":return"App Owner";case"app_admin":case"proxy_admin":return"Admin";case"proxy_admin_viewer":return"Admin Viewer";case"app_user":return"App User";case"internal_user":return"Internal User";case"internal_user_viewer":return"Internal Viewer";default:return"Unknown Role"}}(e.user_role);console.log("Decoded user_role:",t),y(t)}else console.log("User role not defined");e.user_email?w(e.user_email):console.log("User Email is not set ".concat(e))}}if(t&&A&&l&&!f&&!z){let e=sessionStorage.getItem("userModels"+t);e?L(JSON.parse(e)):(console.log("currentOrg: ".concat(JSON.stringify(C))),(async()=>{try{let e=await (0,m.getProxyUISettings)(A);V(e);let n=await (0,m.userInfoCall)(A,t,l,!1,null,null);N(n.user_info),console.log("userSpendData: ".concat(JSON.stringify(z))),(null==n?void 0:n.teams[0].keys)?j(n.keys.concat(n.teams.filter(e=>"Admin"===l||e.user_id===t).flatMap(e=>e.keys))):j(n.keys),sessionStorage.setItem("userData"+t,JSON.stringify(n.keys)),sessionStorage.setItem("userSpendData"+t,JSON.stringify(n.user_info));let s=(await (0,m.modelAvailableCall)(A,t,l)).data.map(e=>e.id);console.log("available_model_names:",s),L(s),console.log("userModels:",R),sessionStorage.setItem("userModels"+t,JSON.stringify(s))}catch(e){console.error("There was an error fetching the data",e),e.message.includes("Invalid proxy server token passed")&&F()}})(),(0,g.Z)(A,t,l,C,S))}},[t,Z,A,f,l]),(0,d.useEffect)(()=>{A&&(async()=>{try{let e=await (0,m.keyInfoCall)(A,[A]);console.log("keyInfo: ",e)}catch(e){e.message.includes("Invalid proxy server token passed")&&F()}})()},[A]),(0,d.useEffect)(()=>{console.log("currentOrg: ".concat(JSON.stringify(C),", accessToken: ").concat(A,", userID: ").concat(t,", userRole: ").concat(l)),A&&(console.log("fetching teams"),(0,g.Z)(A,t,l,C,S))},[C]),(0,d.useEffect)(()=>{if(null!==f&&null!=M&&null!==M.team_id){let e=0;for(let t of(console.log("keys: ".concat(JSON.stringify(f))),f))M.hasOwnProperty("team_id")&&null!==t.team_id&&t.team_id===M.team_id&&(e+=t.spend);console.log("sum: ".concat(e)),P(e)}else if(null!==f){let e=0;for(let t of f)e+=t.spend;P(e)}},[M]),null!=O)return(0,n.jsx)(u.default,{});function F(){(0,s.b)();let e=(0,m.getProxyBaseUrl)();console.log("proxyBaseUrl:",e);let t=e?"".concat(e,"/sso/key/generate"):"/sso/key/generate";return console.log("Full URL:",t),window.location.href=t,null}if(null==Z)return console.log("All cookies before redirect:",document.cookie),F(),null;try{let e=(0,o.o)(Z);console.log("Decoded token:",e);let t=e.exp,l=Math.floor(Date.now()/1e3);if(t&&l>=t)return console.log("Token expired, redirecting to login"),F(),null}catch(e){return console.error("Error decoding token:",e),(0,s.b)(),F(),null}if(null==A)return null;if(null==t)return(0,n.jsx)("h1",{children:"User ID is not set"});if(null==l&&y("App Owner"),l&&"Admin Viewer"==l){let{Title:e,Paragraph:t}=i.default;return(0,n.jsxs)("div",{children:[(0,n.jsx)(e,{level:1,children:"Access Denied"}),(0,n.jsx)(t,{children:"Ask your proxy admin for access to create keys"})]})}return console.log("inside user dashboard, selected team",M),console.log("All cookies after redirect:",document.cookie),(0,n.jsx)("div",{className:"w-full mx-4 h-[75vh]",children:(0,n.jsx)(r.Z,{numItems:1,className:"gap-2 p-8 w-full mt-2",children:(0,n.jsxs)(a.Z,{numColSpan:1,className:"flex flex-col gap-2",children:[(0,n.jsx)(h.ZP,{team:M,teams:x,data:f,addKey:b},M?M.team_id:null),(0,n.jsx)(U,{teams:x,organizations:_})]})})})}}}]);