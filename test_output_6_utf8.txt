============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-7.4.4, pluggy-1.6.0 -- /home/lucky_2004/.cache/pypoetry/virtualenvs/litellm-gd7OQ2ia-py3.12/bin/python
cachedir: .pytest_cache
rootdir: /home/lucky_2004/repos/litellm
configfile: pyproject.toml
plugins: asyncio-0.21.2, respx-0.22.0, retry-1.7.0, anyio-4.11.0, xdist-3.8.0, requests-mock-1.12.1, mock-3.15.1
asyncio: mode=Mode.AUTO
collecting ... collected 1 item

wsl : [92m17:53:16 - LiteLLM 
Proxy:ERROR[0m: key_management
_endpoints.py:2704 - litellm.pr
oxy.proxy_server.generate_key_h
elper_fn(): Exception occured 
- 400: {'error': 'Key already 
exists. Use /key/update to 
modify an existing key.'}
At line:1 char:1
+ wsl -d Ubuntu-24.04 -u 
lucky_2004 --cd 
/home/lucky_2004/repos/litellm 
...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~
    + CategoryInfo             
 : NotSpecified: (    
[92m17:53:16 -...exis    ting 
key.'}:String) [    ], 
RemoteException
    + FullyQualifiedError    
Id : NativeCommandErr    or
 
[92m17:53:16 - LiteLLM 
Proxy:ERROR[0m: key_management
_endpoints.py:1146 - litellm.pr
oxy.proxy_server.generate_key_f
n(): Exception occured - 400: 
{'error': 'Key already exists. 
Use /key/update to modify an 
existing key.'}
Traceback (most recent call 
last):
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 2673, in 
generate_key_helper_fn
    create_key_response = 
await 
prisma_client.insert_data(
                          ^^^^^
^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/uni
ttest/mock.py", line 2262, in 
_execute_mock_call
    raise effect
Exception: Unique constraint 
failed on the fields: (`token`)

During handling of the above 
exception, another exception 
occurred:

Traceback (most recent call 
last):
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 1138, in 
generate_key_fn
    return await 
_common_key_generation_helper(
           ^^^^^^^^^^^^^^^^^^^^
^^^^^^^^^^^^^^^^
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 659, in 
_common_key_generation_helper
    response = await 
generate_key_helper_fn(
               
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 2711, in 
generate_key_helper_fn
    raise e
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 2678, in 
generate_key_helper_fn
    raise HTTPException(
fastapi.exceptions.HTTPExceptio
n: 400: {'error': 'Key already 
exists. Use /key/update to 
modify an existing key.'}
[92m17:53:16 - LiteLLM 
Proxy:ERROR[0m: utils.py:4194 
- Exception: 400: {'error': 
'Key already exists. Use 
/key/update to modify an 
existing key.'}
Traceback (most recent call 
last):
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 2673, in 
generate_key_helper_fn
    create_key_response = 
await 
prisma_client.insert_data(
                          ^^^^^
^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/uni
ttest/mock.py", line 2262, in 
_execute_mock_call
    raise effect
Exception: Unique constraint 
failed on the fields: (`token`)

During handling of the above 
exception, another exception 
occurred:

Traceback (most recent call 
last):
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 1138, in 
generate_key_fn
    return await 
_common_key_generation_helper(
           ^^^^^^^^^^^^^^^^^^^^
^^^^^^^^^^^^^^^^
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 659, in 
_common_key_generation_helper
    response = await 
generate_key_helper_fn(
               
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 2711, in 
generate_key_helper_fn
    raise e
  File "/home/lucky_2004/repos/
litellm/litellm/proxy/managemen
t_endpoints/key_management_endp
oints.py", line 2678, in 
generate_key_helper_fn
    raise HTTPException(
fastapi.exceptions.HTTPExceptio
n: 400: {'error': 'Key already 
exists. Use /key/update to 
modify an existing key.'}
tests/test_litellm/proxy/management_endpoints/test_key_gen_duplicate.py::test_generate_key_with_duplicate_raises_error <module 'litellm' from '/home/lucky_2004/repos/litellm/litellm/__init__.py'>
PASSED

============================== 1 passed in 3.44s ===============================
