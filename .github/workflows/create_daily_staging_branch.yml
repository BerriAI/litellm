name: Create Daily Staging Branch

on:
  schedule:
    - cron: '0 0 * * *'  # Runs daily at midnight UTC
  workflow_dispatch:  # Allow manual trigger

jobs:
  create-staging-branch:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Create daily staging branch
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Configure Git user
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # Generate branch name with MM_DD_YYYY format
          BRANCH_NAME="litellm_staging_$(date +'%m_%d_%Y')"
          echo "Creating branch: $BRANCH_NAME"

          # Fetch all branches
          git fetch --all

          # Check if the branch already exists
          if git show-ref --verify --quiet refs/remotes/origin/$BRANCH_NAME; then
            echo "Branch $BRANCH_NAME already exists. Skipping creation."
          else
            echo "Creating new branch: $BRANCH_NAME"
            # Create the new branch from main
            git checkout -b $BRANCH_NAME origin/main
            # Push the new branch
            git push origin $BRANCH_NAME
            echo "Successfully created and pushed branch: $BRANCH_NAME"
          fi
