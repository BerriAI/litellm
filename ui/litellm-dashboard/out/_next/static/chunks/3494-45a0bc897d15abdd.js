"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3494],{40933:function(e,s,t){t.d(s,{Dx:function(){return l.Z},Zb:function(){return r.Z},vz:function(){return a.Z}});var a=t(40278),r=t(12514),l=t(96761)},27722:function(e,s,t){t.d(s,{P:function(){return o}});var a=t(19250),r=t(71632),l=t(90246),n=t(20347),i=t(39760);let c=(0,l.n)("agents"),o=()=>{let{accessToken:e,userRole:s}=(0,i.Z)();return(0,r.a)({queryKey:c.list({}),queryFn:async()=>await (0,a.getAgentsList)(e),enabled:!!e&&n.ZL.includes(s||"")})}},57589:function(e,s,t){t.d(s,{Z:function(){return j}});var a=t(57437),r=t(39760),l=t(44633),n=t(86462),i=t(40278),c=t(78489),o=t(99981),d=t(10968),u=t(2265),m=t(59872);let x=e=>{let{key:s,info:t}=e;return{token:s,...t}};var h=t(19250),p=t(70694),g=t(12322),j=e=>{let{topKeys:s,teams:t,showTags:j=!1,topKeysLimit:f,setTopKeysLimit:_}=e,{accessToken:y,userRole:v,userId:b,premiumUser:k}=(0,r.Z)(),[N,Z]=(0,u.useState)(!1),[w,q]=(0,u.useState)(null),[S,C]=(0,u.useState)(void 0),[L,D]=(0,u.useState)("table"),[T,E]=(0,u.useState)(new Set),A=e=>{E(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},F=async e=>{if(y)try{let s=await (0,h.keyInfoV1Call)(y,e.api_key),t=x(s);C(t),q(e.api_key),Z(!0)}catch(e){console.error("Error fetching key info:",e)}},M=()=>{Z(!1),q(null),C(void 0)};u.useEffect(()=>{let e=e=>{"Escape"===e.key&&N&&M()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[N]);let O=[{header:"Key ID",accessorKey:"api_key",cell:e=>(0,a.jsx)("div",{className:"overflow-hidden",children:(0,a.jsx)(o.Z,{title:e.getValue(),children:(0,a.jsx)(c.Z,{size:"xs",variant:"light",className:"font-mono text-blue-500 bg-blue-50 hover:bg-blue-100 text-xs font-normal px-2 py-0.5 text-left overflow-hidden truncate max-w-[200px]",onClick:()=>F(e.row.original),children:e.getValue()?"".concat(e.getValue().slice(0,7),"..."):"-"})})})},{header:"Key Alias",accessorKey:"key_alias",cell:e=>e.getValue()||"-"}],U={header:"Spend (USD)",accessorKey:"spend",cell:e=>{let s=e.getValue();return s>0&&s<.01?"<$0.01":"$".concat((0,m.pw)(s,2))}},V=j?[...O,{header:"Tags",accessorKey:"tags",cell:e=>{let s=e.getValue(),t=e.row.original.api_key,r=T.has(t);if(!s||0===s.length)return"-";let i=s.sort((e,s)=>s.usage-e.usage),c=r?i:i.slice(0,2),d=s.length>2;return(0,a.jsx)("div",{className:"overflow-hidden",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-1",children:[c.map((e,s)=>(0,a.jsx)(o.Z,{title:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-300",children:"Tag Name:"})," ",e.tag]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-300",children:"Spend:"})," ",e.usage>0&&e.usage<.01?"<$0.01":"$".concat((0,m.pw)(e.usage,2))]})]}),children:(0,a.jsxs)("span",{className:"px-2 py-1 bg-gray-100 rounded-full text-xs",children:[e.tag.slice(0,7),"..."]})},s)),d&&(0,a.jsx)("button",{onClick:()=>A(t),className:"ml-1 p-1 hover:bg-gray-200 rounded-full transition-colors",title:r?"Show fewer tags":"Show all tags",children:r?(0,a.jsx)(l.Z,{className:"h-3 w-3 text-gray-500"}):(0,a.jsx)(n.Z,{className:"h-3 w-3 text-gray-500"})})]})})}},U]:[...O,U],z=s.map(e=>({...e,display_key_alias:e.key_alias&&e.key_alias.length>10?"".concat(e.key_alias.slice(0,10),"..."):e.key_alias||"-"}));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,a.jsx)(d.Z,{options:[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25},{label:"50",value:50}],value:f,onChange:e=>_(e)}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>D("table"),className:"px-3 py-1 text-sm rounded-md ".concat("table"===L?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:"Table View"}),(0,a.jsx)("button",{onClick:()=>D("chart"),className:"px-3 py-1 text-sm rounded-md ".concat("chart"===L?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:"Chart View"})]})]}),"chart"===L?(0,a.jsx)("div",{className:"relative max-h-[600px] overflow-y-auto",children:(0,a.jsx)(i.Z,{className:"mt-4 cursor-pointer hover:opacity-90",style:{height:52*Math.min(z.length,f)},data:z,index:"display_key_alias",categories:["spend"],colors:["cyan"],yAxisWidth:120,tickGap:5,layout:"vertical",showLegend:!1,valueFormatter:e=>"$".concat((0,m.pw)(e,2)),onValueChange:e=>F(e),showTooltip:!0,customTooltip:e=>{var s,t;let r=null===(t=e.payload)||void 0===t?void 0:null===(s=t[0])||void 0===s?void 0:s.payload;return(0,a.jsx)("div",{className:"relative z-50 p-3 bg-black/90 shadow-lg rounded-lg text-white max-w-xs",children:(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-gray-300",children:"Key Alias: "}),(0,a.jsx)("span",{className:"font-mono text-gray-100 break-all",children:null==r?void 0:r.key_alias})]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-gray-300",children:"Key ID: "}),(0,a.jsx)("span",{className:"font-mono text-gray-100 break-all",children:null==r?void 0:r.api_key})]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-gray-300",children:"Spend: "}),(0,a.jsxs)("span",{className:"text-white font-medium",children:["$",(0,m.pw)(null==r?void 0:r.spend,2)]})]})]})})}})}):(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden max-h-[600px] overflow-y-auto",children:(0,a.jsx)(g.w,{columns:V,data:s,renderSubComponent:()=>(0,a.jsx)(a.Fragment,{}),getRowCanExpand:()=>!1,isLoading:!1})}),N&&w&&S&&(console.log("Rendering modal with:",{isModalOpen:N,selectedKey:w,keyData:S}),(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e=>{e.target===e.currentTarget&&M()},children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl relative w-11/12 max-w-6xl max-h-[90vh] overflow-y-auto min-h-[750px]",children:[(0,a.jsx)("button",{onClick:M,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 focus:outline-none","aria-label":"Close",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),(0,a.jsx)("div",{className:"p-6 h-full",children:(0,a.jsx)(p.Z,{keyId:w,onClose:M,keyData:S,teams:t})})]})}))]})}},63494:function(e,s,t){t.d(s,{Z:function(){return sx}});var a=t(57437),r=t(15883),l=t(61935),n=t(15424),i=t(40278),c=t(12514),o=t(49804),d=t(67101),u=t(12485),m=t(18135),x=t(35242),h=t(29706),p=t(77991),g=t(84264),j=t(96761),f=t(37592),_=t(99981),y=t(10968),v=t(51653),b=t(57840),k=t(19616),N=t(2265),Z=t(27722),w=t(19250),q=t(71632),S=t(90246),C=t(20347),L=t(39760);let D=(0,S.n)("customers"),T=()=>{let{accessToken:e,userRole:s}=(0,L.Z)();return(0,q.a)({queryKey:D.list({}),queryFn:async()=>await (0,w.allEndUsersCall)(e),enabled:!!e&&C.ZL.includes(s)})};var E=t(76134),A=t(58962);let F=(0,S.n)("infiniteUsers"),M=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,s=arguments.length>1?arguments[1]:void 0,{accessToken:t,userRole:a}=(0,L.Z)();return(0,A.N)({queryKey:F.list({filters:{pageSize:e,...s&&{searchEmail:s}}}),queryFn:async a=>{let{pageParam:r}=a;return await (0,w.userListCall)(t,null,r,e,s||null)},initialPageParam:1,getNextPageParam:e=>{if(e.page<e.total_pages)return e.page+1},enabled:!!t&&C.ZL.includes(a)})};var O=t(59872),U=t(16312),V=t(29299),z=t(75105),I=t(44851);let R={blue:"#3b82f6",cyan:"#06b6d4",indigo:"#6366f1",green:"#22c55e",red:"#ef4444",purple:"#8b5cf6",emerald:"#37bc7d"},P=e=>{let{active:s,payload:t,label:r}=e;if(s&&t&&t.length){let e=e=>e.replace("metrics.","").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),s=(e,s)=>{let t=s.substring(s.indexOf(".")+1);if(e.metrics&&t in e.metrics)return e.metrics[t]};return(0,a.jsxs)("div",{className:"w-56 rounded-tremor-default border border-tremor-border bg-tremor-background p-2 text-tremor-default shadow-tremor-dropdown",children:[(0,a.jsx)("p",{className:"text-tremor-content-strong",children:r}),t.map(t=>{var r;let l=null===(r=t.dataKey)||void 0===r?void 0:r.toString();if(!l||!t.payload)return null;let n=s(t.payload,l),i=l.includes("spend"),c=void 0!==n?i?"$".concat(n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})):n.toLocaleString():"N/A",o=R[t.color]||t.color;return(0,a.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"h-2 w-2 shrink-0 rounded-full ring-2 ring-white drop-shadow-md",style:{backgroundColor:o}}),(0,a.jsx)("p",{className:"font-medium text-tremor-content dark:text-dark-tremor-content",children:e(l)})]}),(0,a.jsx)("p",{className:"font-medium text-tremor-content-emphasis dark:text-dark-tremor-content-emphasis",children:c})]},l)})]})}return null},Y=e=>{let{categories:s,colors:t}=e,r=e=>e.replace("metrics.","").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");return(0,a.jsx)("div",{className:"flex items-center justify-end space-x-4",children:s.map((e,s)=>{let l=R[t[s]]||t[s];return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"h-2 w-2 shrink-0 rounded-full ring-4 ring-white",style:{backgroundColor:l}}),(0,a.jsx)("p",{className:"text-sm text-tremor-content dark:text-dark-tremor-content",children:r(e)})]},e)})})};var K=t(40933),$=t(56609);let W=[{title:"Model",dataIndex:"model",key:"model",render:e=>e||"-"},{title:"Spend (USD)",dataIndex:"spend",key:"spend",render:e=>"$".concat((0,O.pw)(e,2))},{title:"Successful",dataIndex:"successful_requests",key:"successful_requests",render:e=>(0,a.jsx)("span",{className:"text-green-600",children:(null==e?void 0:e.toLocaleString())||0})},{title:"Failed",dataIndex:"failed_requests",key:"failed_requests",render:e=>(0,a.jsx)("span",{className:"text-red-600",children:(null==e?void 0:e.toLocaleString())||0})},{title:"Tokens",dataIndex:"tokens",key:"tokens",render:e=>(null==e?void 0:e.toLocaleString())||0}];var B=e=>{let{topModels:s}=e,[t,r]=(0,N.useState)("table");return 0===s.length?null:(0,a.jsxs)(K.Zb,{className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,a.jsx)(K.Dx,{children:"Model Usage"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>r("table"),className:"px-3 py-1 text-sm rounded-md ".concat("table"===t?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:"Table"}),(0,a.jsx)("button",{onClick:()=>r("chart"),className:"px-3 py-1 text-sm rounded-md ".concat("chart"===t?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:"Chart"})]})]}),"chart"===t?(0,a.jsx)("div",{className:"max-h-[234px] overflow-y-auto",children:(0,a.jsx)(K.vz,{style:{height:40*s.length},data:s.map(e=>({key:e.model,spend:e.spend})),index:"key",categories:["spend"],colors:["cyan"],valueFormatter:e=>"$".concat((0,O.pw)(e,2)),layout:"vertical",yAxisWidth:180,tickGap:5,showLegend:!1})}):(0,a.jsx)($.Z,{columns:W,dataSource:s,rowKey:"model",size:"small",pagination:!1,scroll:s.length>5?{y:195}:void 0})]})};function H(e){return e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?e/1e3+"k":e.toString()}function G(e){return 0===e?"$0":e>=1e6?"$"+e/1e6+"M":e>=1e3?"$"+e/1e3+"k":"$"+e}let J=e=>{var s,t;let{modelName:r,metrics:l,hidePromptCachingMetrics:n=!1}=e;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d.Z,{numItems:4,className:"gap-4",children:[(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(g.Z,{children:"Total Requests"}),(0,a.jsx)(j.Z,{children:l.total_requests.toLocaleString()})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(g.Z,{children:"Total Successful Requests"}),(0,a.jsx)(j.Z,{children:l.total_successful_requests.toLocaleString()})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(g.Z,{children:"Total Tokens"}),(0,a.jsx)(j.Z,{children:l.total_tokens.toLocaleString()}),(0,a.jsxs)(g.Z,{children:[Math.round(l.total_tokens/l.total_successful_requests)," avg per successful request"]})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(g.Z,{children:"Total Spend"}),(0,a.jsxs)(j.Z,{children:["$",(0,O.pw)(l.total_spend,2)]}),(0,a.jsxs)(g.Z,{children:["$",(0,O.pw)(l.total_spend/l.total_successful_requests,3)," per successful request"]})]})]}),l.top_api_keys&&l.top_api_keys.length>0&&(0,a.jsxs)(c.Z,{className:"mt-4",children:[(0,a.jsx)(j.Z,{children:"Top Virtual Keys by Spend"}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("div",{className:"grid grid-cols-1 gap-2",children:l.top_api_keys.map((e,s)=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Z,{className:"font-medium",children:e.key_alias||"".concat(e.api_key.substring(0,10),"...")}),e.team_id&&(0,a.jsxs)(g.Z,{className:"text-xs text-gray-500",children:["Team: ",e.team_id]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)(g.Z,{className:"font-medium",children:["$",(0,O.pw)(e.spend,2)]}),(0,a.jsxs)(g.Z,{className:"text-xs text-gray-500",children:[e.requests.toLocaleString()," requests | ",e.tokens.toLocaleString()," tokens"]})]})]},e.api_key))})})]}),l.top_models&&l.top_models.length>0&&(0,a.jsx)(B,{topModels:l.top_models}),(0,a.jsxs)(c.Z,{className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(j.Z,{children:"Spend per day"}),(0,a.jsx)(Y,{categories:["metrics.spend"],colors:["green"]})]}),(0,a.jsx)(i.Z,{className:"mt-4",data:l.daily_data,index:"date",categories:["metrics.spend"],colors:["green"],valueFormatter:e=>"$".concat((0,O.pw)(e,2,!0)),yAxisWidth:72})]}),(0,a.jsxs)(d.Z,{numItems:2,className:"gap-4 mt-4",children:[(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(j.Z,{children:"Total Tokens"}),(0,a.jsx)(Y,{categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"]})]}),(0,a.jsx)(z.Z,{className:"mt-4",data:l.daily_data,index:"date",categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"],valueFormatter:H,customTooltip:P,showLegend:!1})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(j.Z,{children:"Requests per day"}),(0,a.jsx)(Y,{categories:["metrics.api_requests"],colors:["blue"]})]}),(0,a.jsx)(i.Z,{className:"mt-4",data:l.daily_data,index:"date",categories:["metrics.api_requests"],colors:["blue"],valueFormatter:H,customTooltip:P,showLegend:!1})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(j.Z,{children:"Success vs Failed Requests"}),(0,a.jsx)(Y,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"]})]}),(0,a.jsx)(z.Z,{className:"mt-4",data:l.daily_data,index:"date",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"],valueFormatter:H,customTooltip:P,showLegend:!1})]}),!n&&(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(j.Z,{children:"Prompt Caching Metrics"}),(0,a.jsx)(Y,{categories:["metrics.cache_read_input_tokens","metrics.cache_creation_input_tokens"],colors:["cyan","purple"]})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsxs)(g.Z,{children:["Cache Read: ",(null===(s=l.total_cache_read_input_tokens)||void 0===s?void 0:s.toLocaleString())||0," tokens"]}),(0,a.jsxs)(g.Z,{children:["Cache Creation: ",(null===(t=l.total_cache_creation_input_tokens)||void 0===t?void 0:t.toLocaleString())||0," tokens"]})]}),(0,a.jsx)(z.Z,{className:"mt-4",data:l.daily_data,index:"date",categories:["metrics.cache_read_input_tokens","metrics.cache_creation_input_tokens"],colors:["cyan","purple"],valueFormatter:H,customTooltip:P,showLegend:!1})]})]})]})},Q=e=>{let{modelMetrics:s,hidePromptCachingMetrics:t=!1}=e,r=Object.keys(s).sort((e,t)=>""===e?1:""===t?-1:s[t].total_spend-s[e].total_spend),l={total_requests:0,total_successful_requests:0,total_tokens:0,total_spend:0,total_cache_read_input_tokens:0,total_cache_creation_input_tokens:0,daily_data:{}};Object.values(s).forEach(e=>{l.total_requests+=e.total_requests,l.total_successful_requests+=e.total_successful_requests,l.total_tokens+=e.total_tokens,l.total_spend+=e.total_spend,l.total_cache_read_input_tokens+=e.total_cache_read_input_tokens||0,l.total_cache_creation_input_tokens+=e.total_cache_creation_input_tokens||0,e.daily_data.forEach(e=>{l.daily_data[e.date]||(l.daily_data[e.date]={prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,spend:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0}),l.daily_data[e.date].prompt_tokens+=e.metrics.prompt_tokens,l.daily_data[e.date].completion_tokens+=e.metrics.completion_tokens,l.daily_data[e.date].total_tokens+=e.metrics.total_tokens,l.daily_data[e.date].api_requests+=e.metrics.api_requests,l.daily_data[e.date].spend+=e.metrics.spend,l.daily_data[e.date].successful_requests+=e.metrics.successful_requests,l.daily_data[e.date].failed_requests+=e.metrics.failed_requests,l.daily_data[e.date].cache_read_input_tokens+=e.metrics.cache_read_input_tokens||0,l.daily_data[e.date].cache_creation_input_tokens+=e.metrics.cache_creation_input_tokens||0})});let n=Object.entries(l.daily_data).map(e=>{let[s,t]=e;return{date:s,metrics:t}}).sort((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime());return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsx)(j.Z,{children:"Overall Usage"}),(0,a.jsxs)(d.Z,{numItems:4,className:"gap-4 mb-4",children:[(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(g.Z,{children:"Total Requests"}),(0,a.jsx)(j.Z,{children:l.total_requests.toLocaleString()})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(g.Z,{children:"Total Successful Requests"}),(0,a.jsx)(j.Z,{children:l.total_successful_requests.toLocaleString()})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(g.Z,{children:"Total Tokens"}),(0,a.jsx)(j.Z,{children:l.total_tokens.toLocaleString()})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(g.Z,{children:"Total Spend"}),(0,a.jsxs)(j.Z,{children:["$",(0,O.pw)(l.total_spend,2)]})]})]}),(0,a.jsxs)(d.Z,{numItems:2,className:"gap-4",children:[(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(j.Z,{children:"Total Tokens Over Time"}),(0,a.jsx)(Y,{categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"]})]}),(0,a.jsx)(z.Z,{className:"mt-4",data:n,index:"date",categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"],valueFormatter:H,customTooltip:P,showLegend:!1})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(j.Z,{children:"Total Requests Over Time"}),(0,a.jsx)(Y,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["emerald","red"]})]}),(0,a.jsx)(z.Z,{className:"mt-4",data:n,index:"date",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["emerald","red"],valueFormatter:e=>e.toLocaleString(),customTooltip:P,showLegend:!1})]})]})]}),(0,a.jsx)(I.default,{defaultActiveKey:r[0],children:r.map(e=>(0,a.jsx)(I.default.Panel,{header:(0,a.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,a.jsx)(j.Z,{children:s[e].label||"Unknown Item"}),(0,a.jsxs)("div",{className:"flex space-x-4 text-sm text-gray-500",children:[(0,a.jsxs)("span",{children:["$",(0,O.pw)(s[e].total_spend,2)]}),(0,a.jsxs)("span",{children:[s[e].total_requests.toLocaleString()," requests"]})]})]}),children:(0,a.jsx)(J,{modelName:e||"Unknown Model",metrics:s[e],hidePromptCachingMetrics:t})},e))})]})},X=(e,s,t)=>{let a=e.metadata.key_alias||"key-hash-".concat(s),r=e.metadata.team_id;if(r){let e=(0,V.o)(r,t);return e?"".concat(a," (team: ").concat(e,")"):"".concat(a," (team_id: ").concat(r,")")}return a},ee=function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a={};return e.results.forEach(e=>{Object.entries(e.breakdown[s]||{}).forEach(r=>{let[l,n]=r;a[l]||(a[l]={label:"api_keys"===s?X(n,l,t):l,total_requests:0,total_successful_requests:0,total_failed_requests:0,total_tokens:0,prompt_tokens:0,completion_tokens:0,total_spend:0,total_cache_read_input_tokens:0,total_cache_creation_input_tokens:0,top_api_keys:[],top_models:[],daily_data:[]}),a[l].total_requests+=n.metrics.api_requests,a[l].prompt_tokens+=n.metrics.prompt_tokens,a[l].completion_tokens+=n.metrics.completion_tokens,a[l].total_tokens+=n.metrics.total_tokens,a[l].total_spend+=n.metrics.spend,a[l].total_successful_requests+=n.metrics.successful_requests,a[l].total_failed_requests+=n.metrics.failed_requests,a[l].total_cache_read_input_tokens+=n.metrics.cache_read_input_tokens||0,a[l].total_cache_creation_input_tokens+=n.metrics.cache_creation_input_tokens||0,a[l].daily_data.push({date:e.date,metrics:{prompt_tokens:n.metrics.prompt_tokens,completion_tokens:n.metrics.completion_tokens,total_tokens:n.metrics.total_tokens,api_requests:n.metrics.api_requests,spend:n.metrics.spend,successful_requests:n.metrics.successful_requests,failed_requests:n.metrics.failed_requests,cache_read_input_tokens:n.metrics.cache_read_input_tokens||0,cache_creation_input_tokens:n.metrics.cache_creation_input_tokens||0}})})}),"api_keys"!==s&&Object.entries(a).forEach(t=>{let[r,l]=t,n={};e.results.forEach(e=>{var t;let a=null===(t=e.breakdown[s])||void 0===t?void 0:t[r];a&&"api_key_breakdown"in a&&Object.entries(a.api_key_breakdown||{}).forEach(e=>{let[s,t]=e;n[s]||(n[s]={api_key:s,key_alias:t.metadata.key_alias,team_id:t.metadata.team_id,spend:0,requests:0,tokens:0}),n[s].spend+=t.metrics.spend,n[s].requests+=t.metrics.api_requests,n[s].tokens+=t.metrics.total_tokens})}),a[r].top_api_keys=Object.values(n).sort((e,s)=>s.spend-e.spend).slice(0,5)}),"api_keys"===s&&Object.entries(a).forEach(s=>{let[t,r]=s,l={};e.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(e=>{let[s,a]=e;if(a&&"api_key_breakdown"in a){var r;let e=null===(r=a.api_key_breakdown)||void 0===r?void 0:r[t];e&&(l[s]||(l[s]={model:s,spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0}),l[s].spend+=e.metrics.spend,l[s].requests+=e.metrics.api_requests,l[s].successful_requests+=e.metrics.successful_requests||0,l[s].failed_requests+=e.metrics.failed_requests||0,l[s].tokens+=e.metrics.total_tokens)}})}),a[t].top_models=Object.values(l).sort((e,s)=>s.spend-e.spend)}),Object.values(a).forEach(e=>{e.daily_data.sort((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime())}),a};var es=t(78489),et=t(94789),ea=t(49566),er=t(10032),el=t(22116),en=t(10353),ei=t(9114),ec=e=>{let{isOpen:s,onClose:t,accessToken:r}=e,[l]=er.Z.useForm(),[n,i]=(0,N.useState)(!1),[c,o]=(0,N.useState)(null),[d,u]=(0,N.useState)(!1),[m,x]=(0,N.useState)("cloudzero"),[h,p]=(0,N.useState)(!1);(0,N.useEffect)(()=>{s&&r&&j()},[s,r]);let j=async()=>{u(!0);try{let e=await fetch("/cloudzero/settings",{method:"GET",headers:{[(0,w.getGlobalLitellmHeaderName)()]:"Bearer ".concat(r),"Content-Type":"application/json"}});if(e.ok){let s=await e.json();o(s),l.setFieldsValue({connection_id:s.connection_id})}else if(404!==e.status){let s=await e.json();ei.ZP.fromBackend("Failed to load existing settings: ".concat(s.error||"Unknown error"))}}catch(e){console.error("Error loading CloudZero settings:",e),ei.ZP.fromBackend("Failed to load existing settings")}finally{u(!1)}},_=async e=>{if(!r){ei.ZP.fromBackend("No access token available");return}i(!0);try{let s={...e,timezone:"UTC"},t=await fetch(c?"/cloudzero/settings":"/cloudzero/init",{method:c?"PUT":"POST",headers:{[(0,w.getGlobalLitellmHeaderName)()]:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify(s)}),a=await t.json();if(t.ok)return ei.ZP.success(a.message||"CloudZero settings saved successfully"),o({api_key_masked:e.api_key.substring(0,4)+"****"+e.api_key.slice(-4),connection_id:e.connection_id,status:"configured"}),!0;return ei.ZP.fromBackend(a.error||"Failed to save CloudZero settings"),!1}catch(e){return console.error("Error saving CloudZero settings:",e),ei.ZP.fromBackend("Failed to save CloudZero settings"),!1}finally{i(!1)}},y=async()=>{if(!r){ei.ZP.fromBackend("No access token available");return}p(!0);try{let e=await fetch("/cloudzero/export",{method:"POST",headers:{[(0,w.getGlobalLitellmHeaderName)()]:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({limit:1e5,operation:"replace_hourly"})}),s=await e.json();e.ok?(ei.ZP.success(s.message||"Export to CloudZero completed successfully"),t()):ei.ZP.fromBackend(s.error||"Failed to export to CloudZero")}catch(e){console.error("Error exporting to CloudZero:",e),ei.ZP.fromBackend("Failed to export to CloudZero")}finally{p(!1)}},v=async()=>{p(!0);try{ei.ZP.info("CSV export functionality coming soon!"),t()}catch(e){console.error("Error exporting CSV:",e),ei.ZP.fromBackend("Failed to export CSV")}finally{p(!1)}},b=async()=>{if("cloudzero"===m){if(!c){let e=await l.validateFields();if(!await _(e))return}await y()}else await v()},k=()=>{l.resetFields(),x("cloudzero"),o(null),t()},Z=[{value:"cloudzero",label:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("img",{src:"/cloudzero.png",alt:"CloudZero",className:"w-5 h-5",onError:e=>{e.target.style.display="none"}}),(0,a.jsx)("span",{children:"Export to CloudZero"})]})},{value:"csv",label:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("span",{children:"Export to CSV"})]})}];return(0,a.jsx)(el.Z,{title:"Export Data",open:s,onCancel:k,footer:null,width:600,destroyOnHidden:!0,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Z,{className:"font-medium mb-2 block",children:"Export Destination"}),(0,a.jsx)(f.default,{value:m,onChange:x,options:Z,className:"w-full",size:"large"})]}),"cloudzero"===m&&(0,a.jsx)("div",{children:d?(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)(en.Z,{size:"large"})}):(0,a.jsxs)(a.Fragment,{children:[c&&(0,a.jsx)(et.Z,{title:"Existing CloudZero Configuration",icon:()=>(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"green",className:"mb-4",children:(0,a.jsxs)(g.Z,{children:["API Key: ",c.api_key_masked,(0,a.jsx)("br",{}),"Connection ID: ",c.connection_id]})}),!c&&(0,a.jsxs)(er.Z,{form:l,layout:"vertical",children:[(0,a.jsx)(er.Z.Item,{label:"CloudZero API Key",name:"api_key",rules:[{required:!0,message:"Please enter your CloudZero API key"}],children:(0,a.jsx)(ea.Z,{type:"password",placeholder:"Enter your CloudZero API key"})}),(0,a.jsx)(er.Z.Item,{label:"Connection ID",name:"connection_id",rules:[{required:!0,message:"Please enter the CloudZero connection ID"}],children:(0,a.jsx)(ea.Z,{placeholder:"Enter CloudZero connection ID"})})]})]})}),"csv"===m&&(0,a.jsx)(et.Z,{title:"CSV Export",icon:()=>(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),color:"blue",children:(0,a.jsx)(g.Z,{children:"Export your usage data as a CSV file for analysis in spreadsheet applications."})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,a.jsx)(es.Z,{variant:"secondary",onClick:k,children:"Cancel"}),(0,a.jsx)(es.Z,{onClick:b,loading:n||h,disabled:n||h,children:"cloudzero"===m?"Export to CloudZero":"Export CSV"})]})]})})},eo=t(47359),ed=t(50337),eu=t(5545),em=e=>{let{value:s,onChange:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Format"}),(0,a.jsx)(f.default,{value:s,onChange:t,className:"w-full",options:[{value:"csv",label:"CSV (Excel, Google Sheets)"},{value:"json",label:"JSON (includes metadata)"}]})]})},ex=e=>{var s,t;let{dateRange:r,selectedFilters:l}=e;return(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[null===(s=r.from)||void 0===s?void 0:s.toLocaleDateString()," - ",null===(t=r.to)||void 0===t?void 0:t.toLocaleDateString(),l.length>0&&" \xb7 ".concat(l.length," filter").concat(l.length>1?"s":"")]})},eh=t(29967),ep=e=>{let{value:s,onChange:t,entityType:r}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Export type"}),(0,a.jsx)(eh.ZP.Group,{value:s,onChange:e=>t(e.target.value),className:"w-full",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,a.jsx)(eh.ZP,{value:"daily",className:"mt-0.5"}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day breakdown by ",r]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Daily metrics for each ",r]})]})]}),(0,a.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,a.jsx)(eh.ZP,{value:"daily_with_keys",className:"mt-0.5"}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day breakdown by ",r," and key"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Daily metrics for each ",r,", split by API key"]})]})]}),(0,a.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,a.jsx)(eh.ZP,{value:"daily_with_models",className:"mt-0.5"}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day by ",r," and model"]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:"Daily metrics split by model"})]})]})]})})]})},eg=t(15452),ej=t.n(eg);let ef=e=>{if(!e)return null;for(let t of Object.values(e)){var s;let e=null==t?void 0:null===(s=t.metadata)||void 0===s?void 0:s.team_id;if(e)return e}return null},e_=function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[];return e.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(r=>{let[l,n]=r,i=ef(n.api_key_breakdown),c=i&&t[i]||null;a.push({Date:e.date,[s]:c||"-",["".concat(s," ID")]:i||"-","Spend ($)":(0,O.pw)(n.metrics.spend,4),Requests:n.metrics.api_requests,"Successful Requests":n.metrics.successful_requests,"Failed Requests":n.metrics.failed_requests,"Total Tokens":n.metrics.total_tokens,"Prompt Tokens":n.metrics.prompt_tokens||0,"Completion Tokens":n.metrics.completion_tokens||0})})}),a.sort((e,s)=>new Date(e.Date).getTime()-new Date(s.Date).getTime())},ey=function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={};return e.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(s=>{let[r,l]=s;Object.entries(l.api_key_breakdown||{}).forEach(s=>{var l,n,i,c,o,d,u,m,x,h,p,g,j,f,_,y;let[v,b]=s,k=(null==b?void 0:null===(l=b.metadata)||void 0===l?void 0:l.key_alias)||null,N=(null==b?void 0:null===(n=b.metadata)||void 0===n?void 0:n.team_id)||r,Z=N&&t[N]||null,w="".concat(e.date,"_").concat(N,"_").concat(v);a[w]?(a[w].metrics.spend+=(null===(h=b.metrics)||void 0===h?void 0:h.spend)||0,a[w].metrics.api_requests+=(null===(p=b.metrics)||void 0===p?void 0:p.api_requests)||0,a[w].metrics.successful_requests+=(null===(g=b.metrics)||void 0===g?void 0:g.successful_requests)||0,a[w].metrics.failed_requests+=(null===(j=b.metrics)||void 0===j?void 0:j.failed_requests)||0,a[w].metrics.total_tokens+=(null===(f=b.metrics)||void 0===f?void 0:f.total_tokens)||0,a[w].metrics.prompt_tokens+=(null===(_=b.metrics)||void 0===_?void 0:_.prompt_tokens)||0,a[w].metrics.completion_tokens+=(null===(y=b.metrics)||void 0===y?void 0:y.completion_tokens)||0):a[w]={Date:e.date,teamId:N,teamAlias:Z,keyId:v,keyAlias:k,metrics:{spend:(null===(i=b.metrics)||void 0===i?void 0:i.spend)||0,api_requests:(null===(c=b.metrics)||void 0===c?void 0:c.api_requests)||0,successful_requests:(null===(o=b.metrics)||void 0===o?void 0:o.successful_requests)||0,failed_requests:(null===(d=b.metrics)||void 0===d?void 0:d.failed_requests)||0,total_tokens:(null===(u=b.metrics)||void 0===u?void 0:u.total_tokens)||0,prompt_tokens:(null===(m=b.metrics)||void 0===m?void 0:m.prompt_tokens)||0,completion_tokens:(null===(x=b.metrics)||void 0===x?void 0:x.completion_tokens)||0}}})})}),Object.values(a).map(e=>({Date:e.Date,[s]:e.teamAlias||"-",["".concat(s," ID")]:e.teamId||"-","Key Alias":e.keyAlias||"-","Key ID":e.keyId,"Spend ($)":(0,O.pw)(e.metrics.spend,4),Requests:e.metrics.api_requests,"Successful Requests":e.metrics.successful_requests,"Failed Requests":e.metrics.failed_requests,"Total Tokens":e.metrics.total_tokens,"Prompt Tokens":e.metrics.prompt_tokens,"Completion Tokens":e.metrics.completion_tokens})).sort((e,s)=>new Date(e.Date).getTime()-new Date(s.Date).getTime())},ev=function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[];return e.results.forEach(e=>{let r={};Object.entries(e.breakdown.entities||{}).forEach(s=>{let[t,a]=s;r[t]||(r[t]={}),Object.entries(e.breakdown.models||{}).forEach(e=>{let[s,l]=e;Object.entries(a.api_key_breakdown||{}).forEach(e=>{let[a,l]=e;r[t][s]||(r[t][s]={spend:0,requests:0,successful:0,failed:0,tokens:0}),r[t][s].spend+=l.metrics.spend||0,r[t][s].requests+=l.metrics.api_requests||0,r[t][s].successful+=l.metrics.successful_requests||0,r[t][s].failed+=l.metrics.failed_requests||0,r[t][s].tokens+=l.metrics.total_tokens||0})})}),Object.entries(r).forEach(r=>{var l;let[n,i]=r,c=null===(l=e.breakdown.entities)||void 0===l?void 0:l[n],o=ef(null==c?void 0:c.api_key_breakdown),d=o&&t[o]||null;Object.entries(i).forEach(t=>{let[r,l]=t;a.push({Date:e.date,[s]:d||"-",["".concat(s," ID")]:o||"-",Model:r,"Spend ($)":(0,O.pw)(l.spend,4),Requests:l.requests,Successful:l.successful,Failed:l.failed,"Total Tokens":l.tokens})})})}),a.sort((e,s)=>new Date(e.Date).getTime()-new Date(s.Date).getTime())},eb=function(e,s,t){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};switch(s){case"daily":default:return e_(e,t,a);case"daily_with_keys":return ey(e,t,a);case"daily_with_models":return ev(e,t,a)}},ek=(e,s,t,a,r)=>{var l,n;return{export_date:new Date().toISOString(),entity_type:e,date_range:{from:null===(l=s.from)||void 0===l?void 0:l.toISOString(),to:null===(n=s.to)||void 0===n?void 0:n.toISOString()},filters_applied:t.length>0?t:"None",export_scope:a,summary:{total_spend:r.metadata.total_spend,total_requests:r.metadata.total_api_requests,successful_requests:r.metadata.total_successful_requests,failed_requests:r.metadata.total_failed_requests,total_tokens:r.metadata.total_tokens}}},eN=function(e,s,t,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},l=eb(e,s,t,r),n=new Blob([ej().unparse(l)],{type:"text/csv;charset=utf-8;"}),i=window.URL.createObjectURL(n),c=document.createElement("a");c.href=i;let o="".concat(a,"_usage_").concat(s,"_").concat(new Date().toISOString().split("T")[0],".csv");c.download=o,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(i)},eZ=function(e,s,t,a,r,l){let n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},i=eb(e,s,t,n),c=new Blob([JSON.stringify({metadata:ek(a,r,l,s,e),data:i},null,2)],{type:"application/json"}),o=window.URL.createObjectURL(c),d=document.createElement("a");d.href=o;let u="".concat(a,"_usage_").concat(s,"_").concat(new Date().toISOString().split("T")[0],".json");d.download=u,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(o)};var ew=e=>{let{isOpen:s,onClose:t,entityType:r,spendData:l,dateRange:n,selectedFilters:i,customTitle:c}=e,[o,d]=(0,N.useState)("csv"),[u,m]=(0,N.useState)("daily"),[x,h]=(0,N.useState)(!1),{data:p,isLoading:g}=(0,eo.y2)(),j=r.charAt(0).toUpperCase()+r.slice(1),f=c||"Export ".concat(j," Usage"),_=(0,N.useMemo)(()=>(0,V.O)(p),[p]),y=async e=>{let s=e||o;h(!0);try{"csv"===s?(eN(l,u,j,r,_),ei.ZP.success("".concat(j," usage data exported successfully as CSV"))):(eZ(l,u,j,r,n,i,_),ei.ZP.success("".concat(j," usage data exported successfully as JSON"))),t()}catch(e){console.error("Error exporting data:",e),ei.ZP.fromBackend("Failed to export data")}finally{h(!1)}};return(0,a.jsx)(el.Z,{title:(0,a.jsx)("span",{className:"text-base font-semibold",children:f}),open:s,onCancel:t,footer:null,width:480,children:(0,a.jsxs)("div",{className:"space-y-5 py-2",children:[g?(0,a.jsx)(ed.Z,{active:!0}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ex,{dateRange:n,selectedFilters:i}),(0,a.jsx)(ep,{value:u,onChange:m,entityType:r}),(0,a.jsx)(em,{value:o,onChange:d})]}),g?(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-4 border-t",children:[(0,a.jsx)(ed.Z.Button,{active:!0}),(0,a.jsx)(ed.Z.Button,{active:!0})]}):(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-4 border-t",children:[(0,a.jsx)(eu.ZP,{variant:"outlined",onClick:t,disabled:x,children:"Cancel"}),(0,a.jsx)(eu.ZP,{onClick:()=>y(),loading:x||g,disabled:x||g,type:"primary",children:x?"Exporting...":"Export ".concat(o.toUpperCase())})]})]})})},eq=t(19431),eS=e=>{let{dateValue:s,entityType:t,spendData:r,showFilters:l=!1,filterLabel:n,filterPlaceholder:i,selectedFilters:c=[],onFiltersChange:o,filterOptions:d=[],customTitle:u,compactLayout:m=!1,teams:x=[]}=e,[h,p]=(0,N.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"grid ".concat(l&&d.length>0?"grid-cols-[1fr_auto]":"grid-cols-[auto]"," items-end gap-4"),children:[l&&d.length>0&&(0,a.jsxs)("div",{children:[n&&(0,a.jsx)(eq.x,{className:"mb-2",children:n}),(0,a.jsx)(f.default,{mode:"multiple",style:{width:"100%"},placeholder:i,value:c,onChange:o,options:d,allowClear:!0})]}),(0,a.jsx)("div",{className:"justify-self-end",children:(0,a.jsx)(eq.z,{onClick:()=>p(!0),icon:()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),children:"Export Data"})})]})}),(0,a.jsx)(ew,{isOpen:h,onClose:()=>p(!1),entityType:t,spendData:r,dateRange:s,selectedFilters:c,customTitle:u,teams:x})]})},eC=t(2431),eL=t(91323);let eD=e=>{let{isDateChanging:s=!1}=e;return(0,a.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,a.jsx)(eL.S,{className:"size-5"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-gray-600 text-sm font-medium",children:s?"Processing date selection...":"Loading chart data..."}),(0,a.jsx)("span",{className:"text-gray-400 text-xs mt-1",children:s?"This will only take a moment":"Fetching your data"})]})]})})};var eT=t(35829),eE=t(97765),eA=t(21626),eF=t(97214),eM=t(28241),eO=t(58834),eU=t(69552),eV=t(71876),ez=e=>{let{accessToken:s,selectedTags:t,formatAbbreviatedNumber:r}=e,[l,n]=(0,N.useState)({results:[],total_count:0,page:1,page_size:50,total_pages:0}),[c,o]=(0,N.useState)(!1),[d,f]=(0,N.useState)(1),_=async()=>{if(s){o(!0);try{let e=await (0,w.perUserAnalyticsCall)(s,d,50,t.length>0?t:void 0);n(e)}catch(e){console.error("Failed to fetch per-user data:",e)}finally{o(!1)}}};return(0,N.useEffect)(()=>{_()},[s,t,d]),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)(j.Z,{children:"Per User Usage"}),(0,a.jsx)(eE.Z,{children:"Individual developer usage metrics"}),(0,a.jsxs)(m.Z,{children:[(0,a.jsxs)(x.Z,{className:"mb-6",children:[(0,a.jsx)(u.Z,{children:"User Details"}),(0,a.jsx)(u.Z,{children:"Usage Distribution"})]}),(0,a.jsxs)(p.Z,{children:[(0,a.jsxs)(h.Z,{children:[(0,a.jsxs)(eA.Z,{children:[(0,a.jsx)(eO.Z,{children:(0,a.jsxs)(eV.Z,{children:[(0,a.jsx)(eU.Z,{children:"User ID"}),(0,a.jsx)(eU.Z,{children:"User Email"}),(0,a.jsx)(eU.Z,{children:"User Agent"}),(0,a.jsx)(eU.Z,{className:"text-right",children:"Success Generations"}),(0,a.jsx)(eU.Z,{className:"text-right",children:"Total Tokens"}),(0,a.jsx)(eU.Z,{className:"text-right",children:"Failed Requests"}),(0,a.jsx)(eU.Z,{className:"text-right",children:"Total Cost"})]})}),(0,a.jsx)(eF.Z,{children:l.results.slice(0,10).map((e,s)=>(0,a.jsxs)(eV.Z,{children:[(0,a.jsx)(eM.Z,{children:(0,a.jsx)(g.Z,{className:"font-medium",children:e.user_id})}),(0,a.jsx)(eM.Z,{children:(0,a.jsx)(g.Z,{children:e.user_email||"N/A"})}),(0,a.jsx)(eM.Z,{children:(0,a.jsx)(g.Z,{children:e.user_agent||"Unknown"})}),(0,a.jsx)(eM.Z,{className:"text-right",children:(0,a.jsx)(g.Z,{children:r(e.successful_requests)})}),(0,a.jsx)(eM.Z,{className:"text-right",children:(0,a.jsx)(g.Z,{children:r(e.total_tokens)})}),(0,a.jsx)(eM.Z,{className:"text-right",children:(0,a.jsx)(g.Z,{children:r(e.failed_requests)})}),(0,a.jsx)(eM.Z,{className:"text-right",children:(0,a.jsxs)(g.Z,{children:["$",r(e.spend,4)]})})]},s))})]}),l.results.length>10&&(0,a.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,a.jsxs)(g.Z,{className:"text-sm text-gray-500",children:["Showing 10 of ",l.total_count," results"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(es.Z,{size:"sm",variant:"secondary",onClick:()=>{d>1&&f(d-1)},disabled:1===d,children:"Previous"}),(0,a.jsx)(es.Z,{size:"sm",variant:"secondary",onClick:()=>{d<l.total_pages&&f(d+1)},disabled:d>=l.total_pages,children:"Next"})]})]})]}),(0,a.jsxs)(h.Z,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)(j.Z,{className:"text-lg",children:"User Usage Distribution"}),(0,a.jsx)(eE.Z,{children:"Number of users by successful request frequency"})]}),(0,a.jsx)(i.Z,{data:(()=>{let e=new Map;l.results.forEach(s=>{let t=s.user_agent||"Unknown";e.set(t,(e.get(t)||0)+1)});let s=Array.from(e.entries()).sort((e,s)=>{let[,t]=e,[,a]=s;return a-t}).slice(0,8).map(e=>{let[s]=e;return s}),t={"1-9 requests":{range:[1,9],agents:{}},"10-99 requests":{range:[10,99],agents:{}},"100-999 requests":{range:[100,999],agents:{}},"1K-9.9K requests":{range:[1e3,9999],agents:{}},"10K-99.9K requests":{range:[1e4,99999],agents:{}},"100K+ requests":{range:[1e5,1/0],agents:{}}};return l.results.forEach(e=>{let a=e.successful_requests,r=e.user_agent||"Unknown";s.includes(r)&&Object.entries(t).forEach(e=>{let[s,t]=e;a>=t.range[0]&&a<=t.range[1]&&(t.agents[r]||(t.agents[r]=0),t.agents[r]++)})}),Object.entries(t).map(e=>{let[t,a]=e,r={category:t};return s.forEach(e=>{r[e]=a.agents[e]||0}),r})})(),index:"category",categories:(()=>{let e=new Map;return l.results.forEach(s=>{let t=s.user_agent||"Unknown";e.set(t,(e.get(t)||0)+1)}),Array.from(e.entries()).sort((e,s)=>{let[,t]=e,[,a]=s;return a-t}).slice(0,8).map(e=>{let[s]=e;return s})})(),colors:["blue","green","orange","red","purple","yellow","pink","indigo"],valueFormatter:e=>"".concat(e," users"),yAxisWidth:80,showLegend:!0,stack:!0})]})]})]})]})},eI=e=>{let{accessToken:s,userRole:t,dateValue:r,onDateChange:l}=e,[n,o]=(0,N.useState)({results:[]}),[y,v]=(0,N.useState)({results:[]}),[b,k]=(0,N.useState)({results:[]}),[Z,q]=(0,N.useState)({results:[]}),[S,C]=(0,N.useState)(""),[L,D]=(0,N.useState)([]),[T,E]=(0,N.useState)([]),[A,F]=(0,N.useState)(!1),[M,O]=(0,N.useState)(!1),[U,V]=(0,N.useState)(!1),[z,I]=(0,N.useState)(!1),[R,P]=(0,N.useState)(!1),Y=new Date,K=async()=>{if(s){F(!0);try{let e=await (0,w.tagDistinctCall)(s);D(e.results.map(e=>e.tag))}catch(e){console.error("Failed to fetch available tags:",e)}finally{F(!1)}}},$=async()=>{if(s){O(!0);try{let e=await (0,w.tagDauCall)(s,Y,S||void 0,T.length>0?T:void 0);o(e)}catch(e){console.error("Failed to fetch DAU data:",e)}finally{O(!1)}}},W=async()=>{if(s){V(!0);try{let e=await (0,w.tagWauCall)(s,Y,S||void 0,T.length>0?T:void 0);v(e)}catch(e){console.error("Failed to fetch WAU data:",e)}finally{V(!1)}}},B=async()=>{if(s){I(!0);try{let e=await (0,w.tagMauCall)(s,Y,S||void 0,T.length>0?T:void 0);k(e)}catch(e){console.error("Failed to fetch MAU data:",e)}finally{I(!1)}}},H=async()=>{if(s&&r.from&&r.to){P(!0);try{let e=await (0,w.userAgentSummaryCall)(s,r.from,r.to,T.length>0?T:void 0);q(e)}catch(e){console.error("Failed to fetch user agent summary data:",e)}finally{P(!1)}}};(0,N.useEffect)(()=>{K()},[s]),(0,N.useEffect)(()=>{if(!s)return;let e=setTimeout(()=>{$(),W(),B()},50);return()=>clearTimeout(e)},[s,S,T]),(0,N.useEffect)(()=>{if(!r.from||!r.to)return;let e=setTimeout(()=>{H()},50);return()=>clearTimeout(e)},[s,r,T]);let G=e=>e.startsWith("User-Agent: ")?e.replace("User-Agent: ",""):e,J=e=>e.length>15?e.substring(0,15)+"...":e,Q=e=>Object.entries(e.reduce((e,s)=>(e[s.tag]=(e[s.tag]||0)+s.active_users,e),{})).sort((e,s)=>{let[,t]=e,[,a]=s;return a-t}).map(e=>{let[s]=e;return s}),X=Q(n.results).slice(0,10),ee=Q(y.results).slice(0,10),es=Q(b.results).slice(0,10),et=(()=>{let e=[],s=new Date;for(let t=6;t>=0;t--){let a=new Date(s);a.setDate(a.getDate()-t);let r={date:a.toISOString().split("T")[0]};X.forEach(e=>{r[G(e)]=0}),e.push(r)}return n.results.forEach(s=>{let t=G(s.tag),a=e.find(e=>e.date===s.date);a&&(a[t]=s.active_users)}),e})(),ea=(()=>{let e=[];for(let s=1;s<=7;s++){let t={week:"Week ".concat(s)};ee.forEach(e=>{t[G(e)]=0}),e.push(t)}return y.results.forEach(s=>{let t=G(s.tag),a=s.date.match(/Week (\d+)/);if(a){let r="Week ".concat(a[1]),l=e.find(e=>e.week===r);l&&(l[t]=s.active_users)}}),e})(),er=(()=>{let e=[];for(let s=1;s<=7;s++){let t={month:"Month ".concat(s)};es.forEach(e=>{t[G(e)]=0}),e.push(t)}return b.results.forEach(s=>{let t=G(s.tag),a=s.date.match(/Month (\d+)/);if(a){let r="Month ".concat(a[1]),l=e.find(e=>e.month===r);l&&(l[t]=s.active_users)}}),e})(),el=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e>=1e8||e>=1e7||e>=1e6?(e/1e6).toFixed(s)+"M":e>=1e4?(e/1e3).toFixed(s)+"K":e>=1e3?(e/1e3).toFixed(s)+"K":e.toFixed(s)};return(0,a.jsxs)("div",{className:"space-y-6 mt-6",children:[(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(j.Z,{children:"Summary by User Agent"}),(0,a.jsx)(eE.Z,{children:"Performance metrics for different user agents"})]}),(0,a.jsxs)("div",{className:"w-96",children:[(0,a.jsx)(g.Z,{className:"text-sm font-medium block mb-2",children:"Filter by User Agents"}),(0,a.jsx)(f.default,{mode:"multiple",placeholder:"All User Agents",value:T,onChange:E,style:{width:"100%"},showSearch:!0,allowClear:!0,loading:A,optionFilterProp:"label",className:"rounded-md",maxTagCount:"responsive",children:L.map(e=>{let s=G(e),t=s.length>50?"".concat(s.substring(0,50),"..."):s;return(0,a.jsx)(f.default.Option,{value:e,label:t,title:s,children:t},e)})})]})]}),R?(0,a.jsx)(eD,{isDateChanging:!1}):(0,a.jsxs)(d.Z,{numItems:4,className:"gap-4",children:[(Z.results||[]).slice(0,4).map((e,s)=>{let t=G(e.tag),r=J(t);return(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(_.Z,{title:t,placement:"top",children:(0,a.jsx)(j.Z,{className:"truncate",children:r})}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Z,{className:"text-sm text-gray-600",children:"Success Requests"}),(0,a.jsx)(eT.Z,{className:"text-lg",children:el(e.successful_requests)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Z,{className:"text-sm text-gray-600",children:"Total Tokens"}),(0,a.jsx)(eT.Z,{className:"text-lg",children:el(e.total_tokens)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Z,{className:"text-sm text-gray-600",children:"Total Cost"}),(0,a.jsxs)(eT.Z,{className:"text-lg",children:["$",el(e.total_spend,4)]})]})]})]},s)}),Array.from({length:Math.max(0,4-(Z.results||[]).length)}).map((e,s)=>(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"No Data"}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Z,{className:"text-sm text-gray-600",children:"Success Requests"}),(0,a.jsx)(eT.Z,{className:"text-lg",children:"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Z,{className:"text-sm text-gray-600",children:"Total Tokens"}),(0,a.jsx)(eT.Z,{className:"text-lg",children:"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.Z,{className:"text-sm text-gray-600",children:"Total Cost"}),(0,a.jsx)(eT.Z,{className:"text-lg",children:"-"})]})]})]},"empty-".concat(s)))]})]})}),(0,a.jsx)(c.Z,{children:(0,a.jsxs)(m.Z,{children:[(0,a.jsxs)(x.Z,{className:"mb-6",children:[(0,a.jsx)(u.Z,{children:"DAU/WAU/MAU"}),(0,a.jsx)(u.Z,{children:"Per User Usage (Last 30 Days)"})]}),(0,a.jsxs)(p.Z,{children:[(0,a.jsxs)(h.Z,{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)(j.Z,{children:"DAU, WAU & MAU per Agent"}),(0,a.jsx)(eE.Z,{children:"Active users across different time periods"})]}),(0,a.jsxs)(m.Z,{children:[(0,a.jsxs)(x.Z,{className:"mb-6",children:[(0,a.jsx)(u.Z,{children:"DAU"}),(0,a.jsx)(u.Z,{children:"WAU"}),(0,a.jsx)(u.Z,{children:"MAU"})]}),(0,a.jsxs)(p.Z,{children:[(0,a.jsxs)(h.Z,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(j.Z,{className:"text-lg",children:"Daily Active Users - Last 7 Days"})}),M?(0,a.jsx)(eD,{isDateChanging:!1}):(0,a.jsx)(i.Z,{data:et,index:"date",categories:X.map(G),valueFormatter:e=>el(e),yAxisWidth:60,showLegend:!0,stack:!0})]}),(0,a.jsxs)(h.Z,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(j.Z,{className:"text-lg",children:"Weekly Active Users - Last 7 Weeks"})}),U?(0,a.jsx)(eD,{isDateChanging:!1}):(0,a.jsx)(i.Z,{data:ea,index:"week",categories:ee.map(G),valueFormatter:e=>el(e),yAxisWidth:60,showLegend:!0,stack:!0})]}),(0,a.jsxs)(h.Z,{children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(j.Z,{className:"text-lg",children:"Monthly Active Users - Last 7 Months"})}),z?(0,a.jsx)(eD,{isDateChanging:!1}):(0,a.jsx)(i.Z,{data:er,index:"month",categories:es.map(G),valueFormatter:e=>el(e),yAxisWidth:60,showLegend:!0,stack:!0})]})]})]})]}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(ez,{accessToken:s,selectedTags:T,formatAbbreviatedNumber:el})})]})]})})]})},eR=t(47375),eP=e=>{let{endpointData:s}=e,t=s||{},r=N.useMemo(()=>Object.entries(t).map(e=>{let[s,t]=e;return{endpoint:s,"metrics.successful_requests":t.metrics.successful_requests,"metrics.failed_requests":t.metrics.failed_requests,metrics:{successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests}}}),[t]);return(0,a.jsxs)(K.Zb,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(K.Dx,{children:"Success vs Failed Requests by Endpoint"}),(0,a.jsx)(Y,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"]})]}),(0,a.jsx)(K.vz,{className:"mt-4",data:r,index:"endpoint",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"],valueFormatter:e=>e.toLocaleString(),customTooltip:P,showLegend:!1,stack:!0,yAxisWidth:60})]})},eY=t(59664),eK=function(e){let{dailyData:s,endpointData:t}=e,r=(0,N.useMemo)(()=>(null==s?void 0:s.results)&&0!==s.results.length?function(e){let s=[],t=new Set;return e.forEach(e=>{e.breakdown.endpoints&&Object.keys(e.breakdown.endpoints).forEach(e=>t.add(e))}),e.forEach(e=>{let a={date:new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})};t.forEach(s=>{var t;let r=null===(t=e.breakdown.endpoints)||void 0===t?void 0:t[s];a[s]=(null==r?void 0:r.metrics.api_requests)||0}),s.push(a)}),s.reverse()}(s.results):[],[s]),l=(0,N.useMemo)(()=>0===r.length?[]:Object.keys(r[0]).filter(e=>"date"!==e),[r]);return(0,a.jsxs)(c.Z,{className:"mb-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)(j.Z,{children:"Endpoint Usage Trends"})}),(0,a.jsx)(eY.Z,{className:"h-80",data:r,index:"date",categories:l,colors:["blue","cyan","indigo","violet","purple","fuchsia","pink","rose","red","orange"].slice(0,l.length),valueFormatter:e=>e.toLocaleString(),showLegend:!0,showGridLines:!0,yAxisWidth:60,connectNulls:!0,curveType:"natural"})]})},e$=t(68565),eW=e=>{let{endpointData:s}=e,t=(e,s)=>0===s?0:e/s*100,r=Object.entries(s).map(e=>{let[s,a]=e;return{key:s,endpoint:s,successful_requests:a.metrics.successful_requests,failed_requests:a.metrics.failed_requests,api_requests:a.metrics.api_requests,total_tokens:a.metrics.total_tokens,spend:a.metrics.spend,successRate:t(a.metrics.successful_requests,a.metrics.api_requests)}}),l=[{title:"Endpoint",dataIndex:"endpoint",key:"endpoint",render:e=>(0,a.jsx)("span",{className:"font-medium",children:e})},{title:"Successful / Failed",key:"requests",render:(e,s)=>{let t=s.api_requests>0?s.successful_requests/s.api_requests*100:0,r=s.api_requests>0?s.failed_requests/s.api_requests*100:0,l={"0%":"#22c55e"};return t>0&&t<100&&(l["".concat(t,"%")]="#22c55e",l["".concat(t+.01,"%")]="#ef4444"),l["100%"]=r>0?"#ef4444":"#22c55e",(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)(e$.Z,{percent:t+r,size:"small",strokeColor:l,showInfo:!1})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm min-w-[100px]",children:[(0,a.jsx)("span",{className:"text-green-600 font-medium",children:s.successful_requests.toLocaleString()}),(0,a.jsx)("span",{className:"text-gray-400",children:"/"}),(0,a.jsx)("span",{className:"text-red-600 font-medium",children:s.failed_requests.toLocaleString()})]})]})}},{title:"Total Request",dataIndex:"api_requests",key:"api_requests",render:e=>e.toLocaleString()},{title:"Success Rate",dataIndex:"successRate",key:"successRate",render:e=>{let s=e.toFixed(2);return(0,a.jsxs)("span",{className:e>=95?"text-green-600 font-medium":e>=80?"text-yellow-600 font-medium":"text-red-600 font-medium",children:[s,"%"]})}},{title:"Total Tokens",dataIndex:"total_tokens",key:"total_tokens",render:e=>e.toLocaleString()},{title:"Spend",dataIndex:"spend",key:"spend",render:e=>"$".concat((0,O.pw)(e,2))}];return(0,a.jsx)($.Z,{columns:l,dataSource:r,pagination:!1})},eB=e=>{let{userSpendData:s}=e,t=(0,N.useMemo)(()=>{let e={};return(null==s?void 0:s.results)&&s.results.forEach(s=>{Object.entries(s.breakdown.endpoints||{}).forEach(s=>{let[t,a]=s;e[t]||(e[t]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:a.metadata||{},api_key_breakdown:{}}),e[t].metrics.spend+=a.metrics.spend,e[t].metrics.prompt_tokens+=a.metrics.prompt_tokens,e[t].metrics.completion_tokens+=a.metrics.completion_tokens,e[t].metrics.total_tokens+=a.metrics.total_tokens,e[t].metrics.api_requests+=a.metrics.api_requests,e[t].metrics.successful_requests+=a.metrics.successful_requests||0,e[t].metrics.failed_requests+=a.metrics.failed_requests||0,e[t].metrics.cache_read_input_tokens+=a.metrics.cache_read_input_tokens||0,e[t].metrics.cache_creation_input_tokens+=a.metrics.cache_creation_input_tokens||0})}),e},[s]);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(eW,{endpointData:t}),(0,a.jsx)(eP,{endpointData:t}),(0,a.jsx)(eK,{dailyData:s,endpointData:t})]})},eH=t(49282),eG=t(14042),eJ=t(42673),eQ=t(57589),eX=t(12322);function e0(e){let{topModels:s,topModelsLimit:t,setTopModelsLimit:r}=e,[l,n]=(0,N.useState)("table"),c=s.slice(0,t);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,a.jsx)(y.Z,{options:[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25},{label:"50",value:50}],value:t,onChange:e=>r(e)}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>n("table"),className:"px-3 py-1 text-sm rounded-md ".concat("table"===l?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:"Table View"}),(0,a.jsx)("button",{onClick:()=>n("chart"),className:"px-3 py-1 text-sm rounded-md ".concat("chart"===l?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:"Chart View"})]})]}),"chart"===l?(0,a.jsx)("div",{className:"relative max-h-[600px] overflow-y-auto",children:(0,a.jsx)(i.Z,{className:"mt-4 cursor-pointer hover:opacity-90",style:{height:52*Math.min(c.length,t)},data:c,index:"key",categories:["spend"],colors:["cyan"],valueFormatter:e=>"$".concat((0,O.pw)(e,2)),layout:"vertical",yAxisWidth:200,tickGap:5,showLegend:!1})}):(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden max-h-[600px] overflow-y-auto",children:(0,a.jsx)(eX.w,{columns:[{header:"Model",accessorKey:"key",cell:e=>e.getValue()||"-"},{header:"Spend (USD)",accessorKey:"spend",cell:e=>{let s=e.getValue();return"$".concat((0,O.pw)(s,2))}},{header:"Successful",accessorKey:"successful_requests",cell:e=>{var s;return(0,a.jsx)("span",{className:"text-green-600",children:(null===(s=e.getValue())||void 0===s?void 0:s.toLocaleString())||0})}},{header:"Failed",accessorKey:"failed_requests",cell:e=>{var s;return(0,a.jsx)("span",{className:"text-red-600",children:(null===(s=e.getValue())||void 0===s?void 0:s.toLocaleString())||0})}},{header:"Tokens",accessorKey:"tokens",cell:e=>{var s;return(null===(s=e.getValue())||void 0===s?void 0:s.toLocaleString())||0}}],data:c,renderSubComponent:()=>(0,a.jsx)(a.Fragment,{}),getRowCanExpand:()=>!1,isLoading:!1})})]})}var e1=e=>{let{accessToken:s,entityType:t,entityId:r,entityList:l,dateValue:n}=e,[f,_]=(0,N.useState)({results:[],metadata:{total_spend:0,total_api_requests:0,total_successful_requests:0,total_failed_requests:0,total_tokens:0}}),{teams:y}=(0,eH.Z)(),v=ee(f,"models",y||[]),b=ee(f,"api_keys",y||[]),[k,Z]=(0,N.useState)([]),[q,S]=(0,N.useState)(5),[C,L]=(0,N.useState)(5),D=async()=>{if(!s||!n.from||!n.to)return;let e=new Date(n.from),a=new Date(n.to);if("tag"===t)_(await (0,w.tagDailyActivityCall)(s,e,a,1,k.length>0?k:null));else if("team"===t)_(await (0,w.teamDailyActivityCall)(s,e,a,1,k.length>0?k:null));else if("organization"===t)_(await (0,w.organizationDailyActivityCall)(s,e,a,1,k.length>0?k:null));else if("customer"===t)_(await (0,w.customerDailyActivityCall)(s,e,a,1,k.length>0?k:null));else if("agent"===t)_(await (0,w.agentDailyActivityCall)(s,e,a,1,k.length>0?k:null));else throw Error("Invalid entity type")};(0,N.useEffect)(()=>{D()},[s,n,r,k]);let T=()=>{let e={};return f.results.forEach(s=>{Object.entries(s.breakdown.providers||{}).forEach(s=>{let[t,a]=s;e[t]||(e[t]={provider:t,spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0});try{e[t].spend+=a.metrics.spend,e[t].requests+=a.metrics.api_requests,e[t].successful_requests+=a.metrics.successful_requests,e[t].failed_requests+=a.metrics.failed_requests,e[t].tokens+=a.metrics.total_tokens}catch(e){console.error("Error processing provider ".concat(t,": ").concat(e))}})}),Object.values(e).filter(e=>e.spend>0).sort((e,s)=>s.spend-e.spend)},E=(e,s)=>{if(l){let s=l.find(s=>s.value===e);if(s)return s.label}return(null==s?void 0:s.team_alias)?s.team_alias:e},A=e=>0===k.length?e:e.filter(e=>k.includes(e.metadata.id)),F=()=>{let e={};return f.results.forEach(s=>{Object.entries(s.breakdown.entities||{}).forEach(s=>{let[t,a]=s;e[t]||(e[t]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{alias:E(t,a.metadata),id:t}}),e[t].metrics.spend+=a.metrics.spend,e[t].metrics.api_requests+=a.metrics.api_requests,e[t].metrics.successful_requests+=a.metrics.successful_requests,e[t].metrics.failed_requests+=a.metrics.failed_requests,e[t].metrics.total_tokens+=a.metrics.total_tokens})}),A(Object.values(e).sort((e,s)=>s.metrics.spend-e.metrics.spend))},M=t.charAt(0).toUpperCase()+t.slice(1);return(0,a.jsxs)("div",{style:{width:"100%"},className:"relative",children:[(0,a.jsx)(eS,{dateValue:n,entityType:t,spendData:f,showFilters:null!==l&&l.length>0,filterLabel:"Filter by ".concat(t),filterPlaceholder:"Select ".concat(t," to filter..."),selectedFilters:k,onFiltersChange:Z,filterOptions:(()=>{if(l)return l})()||void 0,teams:y||[]}),(0,a.jsxs)(m.Z,{children:[(0,a.jsxs)(x.Z,{variant:"solid",className:"mt-1",children:[(0,a.jsx)(u.Z,{children:"Cost"}),(0,a.jsx)(u.Z,{children:"agent"===t?"Request / Token Consumption":"Model Activity"}),(0,a.jsx)(u.Z,{children:"Key Activity"}),(0,a.jsx)(u.Z,{children:"Endpoint Activity"})]}),(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(h.Z,{children:(0,a.jsxs)(d.Z,{numItems:2,className:"gap-2 w-full",children:[(0,a.jsx)(o.Z,{numColSpan:2,children:(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)(j.Z,{children:[M," Spend Overview"]}),(0,a.jsxs)(d.Z,{numItems:5,className:"gap-4 mt-4",children:[(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Total Spend"}),(0,a.jsxs)(g.Z,{className:"text-2xl font-bold mt-2",children:["$",(0,O.pw)(f.metadata.total_spend,2)]})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Total Requests"}),(0,a.jsx)(g.Z,{className:"text-2xl font-bold mt-2",children:f.metadata.total_api_requests.toLocaleString()})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Successful Requests"}),(0,a.jsx)(g.Z,{className:"text-2xl font-bold mt-2 text-green-600",children:f.metadata.total_successful_requests.toLocaleString()})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Failed Requests"}),(0,a.jsx)(g.Z,{className:"text-2xl font-bold mt-2 text-red-600",children:f.metadata.total_failed_requests.toLocaleString()})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Total Tokens"}),(0,a.jsx)(g.Z,{className:"text-2xl font-bold mt-2",children:f.metadata.total_tokens.toLocaleString()})]})]})]})}),(0,a.jsx)(o.Z,{numColSpan:2,children:(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Daily Spend"}),(0,a.jsx)(i.Z,{data:[...f.results].sort((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime()),index:"date",categories:["metrics.spend"],colors:["cyan"],valueFormatter:G,yAxisWidth:100,showLegend:!1,customTooltip:e=>{let{payload:s,active:t}=e;if(!t||!(null==s?void 0:s[0]))return null;let r=s[0].payload,l=Object.keys(r.breakdown.entities||{}).length;return(0,a.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,a.jsx)("p",{className:"font-bold",children:r.date}),(0,a.jsxs)("p",{className:"text-cyan-500",children:["Total Spend: $",(0,O.pw)(r.metrics.spend,2)]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Total Requests: ",r.metrics.api_requests]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Successful: ",r.metrics.successful_requests]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Failed: ",r.metrics.failed_requests]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Total Tokens: ",r.metrics.total_tokens]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Total ",M,"s: ",l]}),(0,a.jsxs)("div",{className:"mt-2 border-t pt-2",children:[(0,a.jsxs)("p",{className:"font-semibold",children:["Spend by ",M,":"]}),Object.entries(r.breakdown.entities||{}).sort((e,s)=>{let[,t]=e,[,a]=s,r=t.metrics.spend;return a.metrics.spend-r}).slice(0,5).map(e=>{let[s,t]=e;return(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[E(s,t.metadata),": $",(0,O.pw)(t.metrics.spend,2)]},s)}),l>5&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 italic",children:["...and ",l-5," more"]})]})]})}})]})}),(0,a.jsx)(o.Z,{numColSpan:2,children:(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsxs)(j.Z,{children:["Spend Per ",M]}),(0,a.jsx)(eE.Z,{className:"text-xs",children:"Showing Top 5 by Spend"}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,a.jsxs)("span",{children:["Get Started by Tracking cost per ",M," "]}),(0,a.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/enterprise#spend-tracking",className:"text-blue-500 hover:text-blue-700 ml-1",children:"here"})]})]}),(0,a.jsxs)(d.Z,{numItems:2,className:"gap-6",children:[(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsx)(i.Z,{className:"mt-4 h-52",data:F().slice(0,5).map(e=>({...e,metadata:{...e.metadata,alias_display:e.metadata.alias&&e.metadata.alias.length>15?"".concat(e.metadata.alias.slice(0,15),"..."):e.metadata.alias}})),index:"metadata.alias_display",categories:["metrics.spend"],colors:["cyan"],valueFormatter:G,layout:"vertical",showLegend:!1,yAxisWidth:150,customTooltip:e=>{let{payload:s,active:t}=e;if(!t||!(null==s?void 0:s[0]))return null;let r=s[0].payload;return(0,a.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,a.jsx)("p",{className:"font-bold",children:r.metadata.alias}),(0,a.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,O.pw)(r.metrics.spend,4)]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Requests: ",r.metrics.api_requests.toLocaleString()]}),(0,a.jsxs)("p",{className:"text-green-600",children:["Successful: ",r.metrics.successful_requests.toLocaleString()]}),(0,a.jsxs)("p",{className:"text-red-600",children:["Failed: ",r.metrics.failed_requests.toLocaleString()]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",r.metrics.total_tokens.toLocaleString()]})]})}})}),(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsx)("div",{className:"h-52 overflow-y-auto",children:(0,a.jsxs)(eA.Z,{children:[(0,a.jsx)(eO.Z,{children:(0,a.jsxs)(eV.Z,{children:[(0,a.jsx)(eU.Z,{children:M}),(0,a.jsx)(eU.Z,{children:"Spend"}),(0,a.jsx)(eU.Z,{className:"text-green-600",children:"Successful"}),(0,a.jsx)(eU.Z,{className:"text-red-600",children:"Failed"}),(0,a.jsx)(eU.Z,{children:"Tokens"})]})}),(0,a.jsx)(eF.Z,{children:F().filter(e=>e.metrics.spend>0).map(e=>(0,a.jsxs)(eV.Z,{children:[(0,a.jsx)(eM.Z,{children:e.metadata.alias}),(0,a.jsxs)(eM.Z,{children:["$",(0,O.pw)(e.metrics.spend,4)]}),(0,a.jsx)(eM.Z,{className:"text-green-600",children:e.metrics.successful_requests.toLocaleString()}),(0,a.jsx)(eM.Z,{className:"text-red-600",children:e.metrics.failed_requests.toLocaleString()}),(0,a.jsx)(eM.Z,{children:e.metrics.total_tokens.toLocaleString()})]},e.metadata.id))})]})})})]})]})})}),(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Top Virtual Keys"}),(0,a.jsx)(eQ.Z,{topKeys:(()=>{console.log("debugTags",{spendData:f});let e={};return f.results.forEach(s=>{let{breakdown:t}=s,{entities:a}=t;console.log("debugTags",{entities:a});let r=Object.keys(a).reduce((e,s)=>{let{api_key_breakdown:t}=a[s];return Object.keys(t).forEach(a=>{let r={tag:s,usage:t[a].metrics.spend};e[a]?e[a].push(r):e[a]=[r]}),e},{});console.log("debugTags",{tagDictionary:r}),Object.entries(s.breakdown.api_keys||{}).forEach(s=>{let[t,a]=s;e[t]||(e[t]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{key_alias:a.metadata.key_alias,team_id:a.metadata.team_id||null,tags:r[t]||[]}},console.log("debugTags",{keySpend:e})),e[t].metrics.spend+=a.metrics.spend,e[t].metrics.prompt_tokens+=a.metrics.prompt_tokens,e[t].metrics.completion_tokens+=a.metrics.completion_tokens,e[t].metrics.total_tokens+=a.metrics.total_tokens,e[t].metrics.api_requests+=a.metrics.api_requests,e[t].metrics.successful_requests+=a.metrics.successful_requests,e[t].metrics.failed_requests+=a.metrics.failed_requests,e[t].metrics.cache_read_input_tokens+=a.metrics.cache_read_input_tokens||0,e[t].metrics.cache_creation_input_tokens+=a.metrics.cache_creation_input_tokens||0})}),Object.entries(e).map(e=>{let[s,t]=e;return{api_key:s,key_alias:t.metadata.key_alias||"-",tags:t.metadata.tags||"-",spend:t.metrics.spend}}).sort((e,s)=>s.spend-e.spend).slice(0,q)})(),teams:null,showTags:"tag"===t,topKeysLimit:q,setTopKeysLimit:S})]})}),(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"agent"===t?"Top Agents":"Top Models"}),(0,a.jsx)(e0,{topModels:(()=>{let e={};return f.results.forEach(s=>{Object.entries(s.breakdown.models||{}).forEach(s=>{let[t,a]=s;e[t]||(e[t]={spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0});try{e[t].spend+=a.metrics.spend}catch(e){console.error("Error adding spend for ".concat(t,": ").concat(e,", got metrics: ").concat(JSON.stringify(a)))}e[t].requests+=a.metrics.api_requests,e[t].successful_requests+=a.metrics.successful_requests,e[t].failed_requests+=a.metrics.failed_requests,e[t].tokens+=a.metrics.total_tokens})}),Object.entries(e).map(e=>{let[s,t]=e;return{key:s,...t}}).sort((e,s)=>s.spend-e.spend).slice(0,C)})(),topModelsLimit:C,setTopModelsLimit:L})]})}),(0,a.jsx)(o.Z,{numColSpan:2,children:(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,a.jsx)(j.Z,{children:"Provider Usage"}),(0,a.jsxs)(d.Z,{numItems:2,children:[(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsx)(eG.Z,{className:"mt-4 h-40",data:T(),index:"provider",category:"spend",valueFormatter:e=>"$".concat((0,O.pw)(e,2)),colors:["cyan","blue","indigo","violet","purple"]})}),(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsxs)(eA.Z,{children:[(0,a.jsx)(eO.Z,{children:(0,a.jsxs)(eV.Z,{children:[(0,a.jsx)(eU.Z,{children:"Provider"}),(0,a.jsx)(eU.Z,{children:"Spend"}),(0,a.jsx)(eU.Z,{className:"text-green-600",children:"Successful"}),(0,a.jsx)(eU.Z,{className:"text-red-600",children:"Failed"}),(0,a.jsx)(eU.Z,{children:"Tokens"})]})}),(0,a.jsx)(eF.Z,{children:T().map(e=>(0,a.jsxs)(eV.Z,{children:[(0,a.jsx)(eM.Z,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[e.provider&&(0,a.jsx)("img",{src:(0,eJ.dr)(e.provider).logo,alt:"".concat(e.provider," logo"),className:"w-4 h-4",onError:s=>{let t=s.target,a=t.parentElement;if(a){var r;let s=document.createElement("div");s.className="w-4 h-4 rounded-full bg-gray-200 flex items-center justify-center text-xs",s.textContent=(null===(r=e.provider)||void 0===r?void 0:r.charAt(0))||"-",a.replaceChild(s,t)}}}),(0,a.jsx)("span",{children:e.provider})]})}),(0,a.jsxs)(eM.Z,{children:["$",(0,O.pw)(e.spend,2)]}),(0,a.jsx)(eM.Z,{className:"text-green-600",children:e.successful_requests.toLocaleString()}),(0,a.jsx)(eM.Z,{className:"text-red-600",children:e.failed_requests.toLocaleString()}),(0,a.jsx)(eM.Z,{children:e.tokens.toLocaleString()})]},e.provider))})]})})]})]})})})]})}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(Q,{modelMetrics:v,hidePromptCachingMetrics:"agent"===t})}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(Q,{modelMetrics:b,hidePromptCachingMetrics:"agent"===t})}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(eB,{userSpendData:f})})]})]})]})},e2=t(59341),e5=t(45188),e4=e=>{let{loading:s,isDateChanging:t,providerSpend:r}=e,[l,i]=(0,N.useState)(!1),[u,m]=(0,N.useState)(!1),x=r.filter(e=>{var s;return(null===(s=e.provider)||void 0===s?void 0:s.toLowerCase())==="unknown"?u:!!l||e.spend>0});return(0,a.jsxs)(c.Z,{className:"h-full",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)(j.Z,{children:"Spend by Provider"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"text-sm text-gray-700",children:"Show Zero Spend"}),(0,a.jsx)(e2.Z,{checked:l,onChange:i})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("label",{className:"text-sm text-gray-700",children:"Show Unknown"}),(0,a.jsx)(_.Z,{title:"Requests that failed to route to a provider",children:(0,a.jsx)(n.Z,{className:"text-gray-400 hover:text-gray-600"})})]}),(0,a.jsx)(e2.Z,{checked:u,onChange:m})]})]})]}),s?(0,a.jsx)(eD,{isDateChanging:t}):(0,a.jsxs)(d.Z,{numItems:2,children:[(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsx)(eG.Z,{className:"mt-4 h-40",data:x,index:"provider",category:"spend",valueFormatter:e=>"$".concat((0,O.pw)(e,2)),colors:["cyan"]})}),(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsxs)(eA.Z,{children:[(0,a.jsx)(eO.Z,{children:(0,a.jsxs)(eV.Z,{children:[(0,a.jsx)(eU.Z,{children:"Provider"}),(0,a.jsx)(eU.Z,{children:"Spend"}),(0,a.jsx)(eU.Z,{className:"text-green-600",children:"Successful"}),(0,a.jsx)(eU.Z,{className:"text-red-600",children:"Failed"}),(0,a.jsx)(eU.Z,{children:"Tokens"})]})}),(0,a.jsx)(eF.Z,{children:x.map(e=>(0,a.jsxs)(eV.Z,{children:[(0,a.jsx)(eM.Z,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[e.provider&&(0,a.jsx)(e5.K,{provider:e.provider,className:"w-4 h-4"}),(0,a.jsx)("span",{children:e.provider})]})}),(0,a.jsxs)(eM.Z,{children:["$",(0,O.pw)(e.spend,2)]}),(0,a.jsx)(eM.Z,{className:"text-green-600",children:e.successful_requests.toLocaleString()}),(0,a.jsx)(eM.Z,{className:"text-red-600",children:e.failed_requests.toLocaleString()}),(0,a.jsx)(eM.Z,{children:e.tokens.toLocaleString()})]},e.provider))})]})})]})]})},e6=t(64739),e3=t(37527),e7=t(41361),e9=t(40312),e8=t(71891),se=t(69993),ss=t(48231),st=t(9775),sa=t(33866);let sr=[{value:"global",label:"Global Usage",showForAdmin:"Global Usage",showForNonAdmin:"Your Usage",description:"View usage across all resources",descriptionForAdmin:"View usage across all resources",descriptionForNonAdmin:"View your usage",icon:(0,a.jsx)(e6.Z,{style:{fontSize:"16px"}})},{value:"organization",label:"Organization Usage",showForAdmin:"Organization Usage",showForNonAdmin:"Your Organization Usage",description:"View organization-level usage",descriptionForAdmin:"View usage across all organizations",descriptionForNonAdmin:"View your organization's usage",icon:(0,a.jsx)(e3.Z,{style:{fontSize:"16px"}})},{value:"team",label:"Team Usage",description:"View usage by team",icon:(0,a.jsx)(e7.Z,{style:{fontSize:"16px"}})},{value:"customer",label:"Customer Usage",description:"View usage by customer accounts",icon:(0,a.jsx)(e9.Z,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"tag",label:"Tag Usage",description:"View usage grouped by tags",icon:(0,a.jsx)(e8.Z,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"agent",label:"Agent Usage (A2A)",description:"View usage by AI agents",icon:(0,a.jsx)(se.Z,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"user-agent-activity",label:"User Agent Activity",description:"View detailed user agent activity logs",icon:(0,a.jsx)(ss.Z,{style:{fontSize:"16px"}}),adminOnly:!0}],sl=e=>{let{value:s,onChange:t,isAdmin:r,title:l="Usage View",description:n="Select the usage data you want to view","data-id":i}=e,c=sr.filter(e=>!e.adminOnly||!!r).map(e=>{let s=e.label,t=e.description;return e.showForAdmin&&e.showForNonAdmin&&(s=r?e.showForAdmin:e.showForNonAdmin),e.descriptionForAdmin&&e.descriptionForNonAdmin&&(t=r?e.descriptionForAdmin:e.descriptionForNonAdmin),{value:e.value,label:s,description:t,icon:e.icon,badgeText:e.badgeText}});return(0,a.jsx)("div",{className:"w-full","data-id":i,children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-start gap-4",children:[(0,a.jsxs)("div",{className:"flex items-stretch gap-2 min-w-0",children:[(0,a.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,a.jsx)(st.Z,{style:{fontSize:"32px"}})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-0.5 leading-tight",children:l}),(0,a.jsx)("p",{className:"text-xs text-gray-600 leading-tight",children:n})]})]}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(f.default,{value:s,onChange:t,className:"w-54 sm:w-64 md:w-72",size:"large",options:c.map(e=>({value:e.value,label:e.label})),optionRender:e=>{let s=c.find(s=>s.value===e.value);return s?(0,a.jsxs)("div",{className:"flex items-center gap-2 py-1",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:s.icon}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:s.label}),(0,a.jsx)("div",{className:"text-xs text-gray-600 mt-0.5",children:s.description})]}),s.badgeText&&(0,a.jsx)("div",{className:"items-center",children:(0,a.jsx)(sa.Z,{color:"blue",count:s.badgeText})})]}):e.label},labelRender:e=>{let s=c.find(s=>s.value===e.value);return s?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{children:s.icon}),(0,a.jsx)("span",{className:"text-sm",children:s.label})]}):e.label}})})]})})};var sn=t(4260),si=t(62831);let{TextArea:sc}=sn.default,so={get_usage_data:"\uD83D\uDCCA",get_team_usage_data:"\uD83D\uDC65",get_tag_usage_data:"\uD83C\uDFF7"},sd=e=>{let{step:s}=e,t=so[s.tool_name]||"\uD83D\uDD27",r=s.arguments,l=r.start_date&&r.end_date?"".concat(r.start_date,"  ").concat(r.end_date):"",n=r.team_ids||r.tags||r.user_id||"";return(0,a.jsxs)("div",{className:"flex items-start gap-2 px-3 py-2 rounded-lg bg-gray-100 border border-gray-200 text-xs",children:[(0,a.jsx)("span",{className:"flex-shrink-0 mt-0.5",children:"running"===s.status?(0,a.jsx)(en.Z,{size:"small"}):"error"===s.status?(0,a.jsx)("span",{className:"text-red-500",children:""}):(0,a.jsx)("span",{className:"text-green-600",children:""})}),(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsxs)("div",{className:"font-medium text-gray-700",children:[t," ",s.tool_label]}),l&&(0,a.jsx)("div",{className:"text-gray-500 mt-0.5",children:l}),n&&(0,a.jsxs)("div",{className:"text-gray-500 mt-0.5",children:["Filter: ",n]}),"error"===s.status&&s.error&&(0,a.jsx)("div",{className:"text-red-600 mt-0.5",children:s.error})]})]})},su=e=>{let{content:s}=e;return(0,a.jsx)(si.UG,{components:{p:e=>{let{children:s}=e;return(0,a.jsx)("p",{className:"mb-2 last:mb-0",children:s})},strong:e=>{let{children:s}=e;return(0,a.jsx)("strong",{className:"font-semibold",children:s})},ul:e=>{let{children:s}=e;return(0,a.jsx)("ul",{className:"list-disc pl-4 mb-2 space-y-0.5",children:s})},ol:e=>{let{children:s}=e;return(0,a.jsx)("ol",{className:"list-decimal pl-4 mb-2 space-y-0.5",children:s})},li:e=>{let{children:s}=e;return(0,a.jsx)("li",{children:s})},h1:e=>{let{children:s}=e;return(0,a.jsx)("h4",{className:"font-semibold text-sm mt-2 mb-1",children:s})},h2:e=>{let{children:s}=e;return(0,a.jsx)("h4",{className:"font-semibold text-sm mt-2 mb-1",children:s})},h3:e=>{let{children:s}=e;return(0,a.jsx)("h4",{className:"font-semibold text-sm mt-2 mb-1",children:s})},code:e=>{let{children:s,className:t}=e;return(null==t?void 0:t.includes("language-"))?(0,a.jsx)("pre",{className:"bg-gray-100 rounded p-2 my-1 overflow-x-auto text-xs",children:(0,a.jsx)("code",{children:s})}):(0,a.jsx)("code",{className:"px-1 py-0.5 rounded bg-gray-100 text-xs font-mono",children:s})},table:e=>{let{children:s}=e;return(0,a.jsx)("div",{className:"overflow-x-auto my-2",children:(0,a.jsx)("table",{className:"text-xs border-collapse w-full",children:s})})},th:e=>{let{children:s}=e;return(0,a.jsx)("th",{className:"border border-gray-200 px-2 py-1 bg-gray-50 font-medium text-left",children:s})},td:e=>{let{children:s}=e;return(0,a.jsx)("td",{className:"border border-gray-200 px-2 py-1",children:s})}},children:s})};var sm=e=>{let{open:s,onClose:t,accessToken:r}=e,[l,n]=(0,N.useState)([]),[i,c]=(0,N.useState)(""),[o,d]=(0,N.useState)(!1),[u,m]=(0,N.useState)(void 0),[x,h]=(0,N.useState)([]),[p,g]=(0,N.useState)(!1),[j,_]=(0,N.useState)(""),[y,v]=(0,N.useState)(null),[b,k]=(0,N.useState)([]),Z=(0,N.useRef)(null),q=(0,N.useRef)(null);(0,N.useEffect)(()=>{s&&0===x.length&&S()},[s]),(0,N.useEffect)(()=>{var e;"function"==typeof(null===(e=Z.current)||void 0===e?void 0:e.scrollIntoView)&&Z.current.scrollIntoView({behavior:"smooth"})},[l,j,b,y]);let S=async()=>{if(r){g(!0);try{var e;let s=await (0,w.modelHubCall)(r);if((null==s?void 0:null===(e=s.data)||void 0===e?void 0:e.length)>0){let e=s.data.map(e=>e.model_group).sort();h(e)}}catch(e){console.error("Failed to load models:",e)}finally{g(!1)}}},C=async()=>{if(!r||!i.trim()||o)return;let e=[...l,{role:"user",content:i.trim()}];n(e),c(""),d(!0),_(""),v(null),k([]);let s=new AbortController;q.current=s;let t="",a=[];try{await (0,w.usageAiChatStream)(r,e.slice(-20).map(e=>({role:e.role,content:e.content})),u||"",e=>{v(null),t+=e,_(t)},()=>{v(null),k([]),n(e=>[...e,{role:"assistant",content:t,toolCalls:a.length>0?[...a]:void 0}]),_("")},e=>{v(null),k([]),n(s=>[...s,{role:"assistant",content:"Error: ".concat(e)}]),_("")},e=>{v(e)},e=>{let s=a.findIndex(s=>s.tool_name===e.tool_name);s>=0?a[s]={...e}:a.push({...e}),k([...a])},s.signal)}catch(t){if((null==t?void 0:t.name)==="AbortError"||s.signal.aborted)return;let e=(null==t?void 0:t.message)||"Failed to get response. Please try again.";n(s=>[...s,{role:"assistant",content:"Error: ".concat(e)}]),_("")}finally{d(!1),q.current=null}};return(0,a.jsxs)("div",{"data-testid":"usage-ai-chat-panel",className:"fixed top-0 right-0 h-full bg-white border-l border-gray-200 shadow-2xl z-50 flex flex-col transition-transform duration-300 ease-in-out ".concat(s?"translate-x-0":"translate-x-full"),style:{width:420},children:[(0,a.jsxs)("div",{className:"px-5 pt-5 pb-3 border-b border-gray-100 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",viewBox:"0 0 16 16",fill:"currentColor",children:(0,a.jsx)("path",{d:"M8 1l1.5 3.5L13 6l-3.5 1.5L8 11 6.5 7.5 3 6l3.5-1.5L8 1zm4 7l.75 1.75L14.5 10.5l-1.75.75L12 13l-.75-1.75L9.5 10.5l1.75-.75L12 8zM4 9l.75 1.75L6.5 11.5l-1.75.75L4 14l-.75-1.75L1.5 11.5l1.75-.75L4 9z"})}),(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"Ask AI"})]}),(0,a.jsx)("button",{onClick:()=>{q.current&&q.current.abort(),t()},className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-md hover:bg-gray-100",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Ask about your spend, models, keys, and trends"})]}),(0,a.jsx)("div",{className:"px-5 py-3 border-b border-gray-100 flex-shrink-0",children:(0,a.jsx)(f.default,{placeholder:"Select a model (optional, defaults to gpt-4o-mini)",value:u,onChange:e=>m(e),loading:p,showSearch:!0,allowClear:!0,size:"small",className:"w-full",options:x.map(e=>({label:e,value:e})),filterOption:(e,s)=>{var t;return(null!==(t=null==s?void 0:s.label)&&void 0!==t?t:"").toLowerCase().includes(e.toLowerCase())}})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50",children:[0===l.length&&!j&&!o&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[(0,a.jsx)("svg",{className:"w-8 h-8 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),(0,a.jsx)("p",{className:"text-sm font-medium",children:"Ask a question about your usage"}),(0,a.jsx)("p",{className:"text-xs mt-1",children:'e.g. "Which model costs me the most?"'})]}),l.map((e,s)=>(0,a.jsx)("div",{children:"user"===e.role?(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("div",{className:"max-w-[88%] rounded-xl px-3.5 py-2 text-sm leading-relaxed bg-blue-600 text-white",children:e.content})}):(0,a.jsxs)("div",{className:"space-y-2",children:[e.toolCalls&&e.toolCalls.length>0&&(0,a.jsx)("div",{className:"space-y-1.5",children:e.toolCalls.map((e,s)=>(0,a.jsx)(sd,{step:e},s))}),(0,a.jsx)("div",{className:"max-w-[95%] rounded-xl px-3.5 py-2.5 text-sm leading-relaxed bg-white border border-gray-200 text-gray-800",children:(0,a.jsx)(su,{content:e.content})})]})},s)),o&&b.length>0&&(0,a.jsx)("div",{className:"space-y-1.5",children:b.map((e,s)=>(0,a.jsx)(sd,{step:e},s))}),o&&!j&&(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 text-xs text-gray-500",children:[(0,a.jsx)(en.Z,{size:"small"}),(0,a.jsx)("span",{className:"italic",children:y||"Thinking..."})]}),j&&(0,a.jsx)("div",{className:"max-w-[95%] rounded-xl px-3.5 py-2.5 text-sm leading-relaxed bg-white border border-gray-200 text-gray-800",children:(0,a.jsx)(su,{content:j})}),(0,a.jsx)("div",{ref:Z})]}),(0,a.jsxs)("div",{className:"px-4 py-3 border-t border-gray-200 bg-white flex-shrink-0",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(sc,{value:i,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),C())},placeholder:"Ask about your usage...",autoSize:{minRows:1,maxRows:3},className:"flex-1",disabled:o}),(0,a.jsx)(eu.ZP,{type:"primary",onClick:C,disabled:!i.trim()||o,loading:o,children:"Send"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,a.jsx)("button",{onClick:()=>{n([]),_(""),k([]),v(null)},className:"text-xs text-gray-400 hover:text-gray-600 transition-colors",disabled:0===l.length,children:"Clear chat"}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Enter to send"})]})]})]})},sx=e=>{var s,t,q,S,D,A,F,V,z,I,R;let{teams:P,organizations:Y}=e,{accessToken:K,userRole:$,userId:W,premiumUser:B}=(0,L.Z)(),[H,J]=(0,N.useState)({results:[],metadata:{}}),[X,es]=(0,N.useState)(!1),[et,ea]=(0,N.useState)(!1),er=(0,N.useMemo)(()=>new Date(Date.now()-6048e5),[]),el=(0,N.useMemo)(()=>new Date,[]),[en,ei]=(0,N.useState)({from:er,to:el}),[eo,ed]=(0,N.useState)([]),{data:eu=[]}=T(),{data:em}=(0,Z.P)(),{data:ex}=(0,E.x)();console.log("currentUser: ".concat(JSON.stringify(ex))),console.log("currentUser max budget: ".concat(null==ex?void 0:ex.max_budget));let eh=C.ZL.includes($||""),[ep,eg]=(0,N.useState)(""),[ej,ef]=(0,k.G)("",{wait:300}),{data:e_,fetchNextPage:ey,hasNextPage:ev,isFetchingNextPage:eb,isLoading:ek}=M(50,ej||void 0),eN=(0,N.useMemo)(()=>{if(!(null==e_?void 0:e_.pages))return[];let e=new Set,s=[];for(let t of e_.pages)for(let a of t.users)e.has(a.user_id)||(e.add(a.user_id),s.push({value:a.user_id,label:a.user_alias?"".concat(a.user_alias," (").concat(a.user_id,")"):a.user_email?"".concat(a.user_email," (").concat(a.user_id,")"):a.user_id}));return s},[e_]),[eZ,eq]=(0,N.useState)(eh?null:W||null),[eS,eL]=(0,N.useState)("groups"),[eT,eE]=(0,N.useState)(!1),[eA,eF]=(0,N.useState)(!1),[eM,eO]=(0,N.useState)(!1),[eU,eV]=(0,N.useState)("global"),[ez,eP]=(0,N.useState)(!0),[eY,eK]=(0,N.useState)(5),[e$,eW]=(0,N.useState)(5),eH=async()=>{K&&ed(Object.values(await (0,w.tagListCall)(K)).map(e=>({label:e.name,value:e.name})))};(0,N.useEffect)(()=>{eH()},[K]),(0,N.useEffect)(()=>{!eh&&W&&eq(W)},[eh,W]);let eG=(null===(s=H.metadata)||void 0===s?void 0:s.total_spend)||0,eJ=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,s={};return H.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(e=>{let[t,a]=e;s[t]||(s[t]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),s[t].metrics.spend+=a.metrics.spend,s[t].metrics.prompt_tokens+=a.metrics.prompt_tokens,s[t].metrics.completion_tokens+=a.metrics.completion_tokens,s[t].metrics.total_tokens+=a.metrics.total_tokens,s[t].metrics.api_requests+=a.metrics.api_requests,s[t].metrics.successful_requests+=a.metrics.successful_requests||0,s[t].metrics.failed_requests+=a.metrics.failed_requests||0,s[t].metrics.cache_read_input_tokens+=a.metrics.cache_read_input_tokens||0,s[t].metrics.cache_creation_input_tokens+=a.metrics.cache_creation_input_tokens||0})}),Object.entries(s).map(e=>{let[s,t]=e;return{key:s,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens}}).sort((e,s)=>s.spend-e.spend).slice(0,e)},eX=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,s={};return H.results.forEach(e=>{Object.entries(e.breakdown.model_groups||{}).forEach(e=>{let[t,a]=e;s[t]||(s[t]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),s[t].metrics.spend+=a.metrics.spend,s[t].metrics.prompt_tokens+=a.metrics.prompt_tokens,s[t].metrics.completion_tokens+=a.metrics.completion_tokens,s[t].metrics.total_tokens+=a.metrics.total_tokens,s[t].metrics.api_requests+=a.metrics.api_requests,s[t].metrics.successful_requests+=a.metrics.successful_requests||0,s[t].metrics.failed_requests+=a.metrics.failed_requests||0,s[t].metrics.cache_read_input_tokens+=a.metrics.cache_read_input_tokens||0,s[t].metrics.cache_creation_input_tokens+=a.metrics.cache_creation_input_tokens||0})}),Object.entries(s).map(e=>{let[s,t]=e;return{key:s,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens}}).sort((e,s)=>s.spend-e.spend).slice(0,e)},e0=(0,N.useCallback)(async()=>{if(!K||!en.from||!en.to)return;let e=eh?eZ:W||null;es(!0);let s=new Date(en.from),t=new Date(en.to);try{try{let a=await (0,w.userDailyActivityAggregatedCall)(K,s,t,e);J(a);return}catch(e){}let a=await (0,w.userDailyActivityCall)(K,s,t,1,e);if(a.metadata.total_pages<=1){J(a);return}let r=[...a.results],l={...a.metadata};for(let n=2;n<=a.metadata.total_pages;n++){let a=await (0,w.userDailyActivityCall)(K,s,t,n,e);r.push(...a.results),a.metadata&&(l.total_spend+=a.metadata.total_spend||0,l.total_api_requests+=a.metadata.total_api_requests||0,l.total_successful_requests+=a.metadata.total_successful_requests||0,l.total_failed_requests+=a.metadata.total_failed_requests||0,l.total_tokens+=a.metadata.total_tokens||0)}J({results:r,metadata:l})}catch(e){console.error("Error fetching user spend data:",e)}finally{es(!1),ea(!1)}},[K,en.from,en.to,eZ,eh,W]),e2=(0,N.useCallback)(e=>{ea(!0),es(!0),ei(e)},[]);(0,N.useEffect)(()=>{if(!en.from||!en.to)return;let e=setTimeout(()=>{e0()},50);return()=>clearTimeout(e)},[e0]);let e5=ee(H,"models",P),e6=ee(H,"api_keys",P),e3=ee(H,"mcp_servers",P);return(0,a.jsxs)("div",{style:{width:"100%"},className:"p-8 relative",children:[(0,a.jsx)("div",{className:"flex items-end justify-between gap-6 mb-6",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-end justify-between gap-6 mb-4 w-full",children:[(0,a.jsx)(sl,{value:eU,onChange:e=>eV(e),isAdmin:eh}),(0,a.jsx)(eC.Z,{value:en,onValueChange:e2})]}),"global"===eU&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(m.Z,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)(x.Z,{variant:"solid",className:"mt-1",children:[(0,a.jsx)(u.Z,{children:"Cost"}),(0,a.jsx)(u.Z,{children:"Model Activity"}),(0,a.jsx)(u.Z,{children:"Key Activity"}),(0,a.jsx)(u.Z,{children:"MCP Server Activity"}),(0,a.jsx)(u.Z,{children:"Endpoint Activity"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(U.z,{onClick:()=>eO(!0),icon:()=>(0,a.jsx)("svg",{className:"w-4 h-4",viewBox:"0 0 16 16",fill:"currentColor",children:(0,a.jsx)("path",{d:"M8 1l1.5 3.5L13 6l-3.5 1.5L8 11 6.5 7.5 3 6l3.5-1.5L8 1zm4 7l.75 1.75L14.5 10.5l-1.75.75L12 13l-.75-1.75L9.5 10.5l1.75-.75L12 8zM4 9l.75 1.75L6.5 11.5l-1.75.75L4 14l-.75-1.75L1.5 11.5l1.75-.75L4 9z"})}),children:"Ask AI"}),(0,a.jsx)(U.z,{onClick:()=>eF(!0),icon:()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),children:"Export Data"})]})]}),(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(h.Z,{children:(0,a.jsxs)(d.Z,{numItems:2,className:"gap-2 w-full",children:[(0,a.jsxs)(o.Z,{numColSpan:2,children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-2 mb-2",children:[(0,a.jsxs)(g.Z,{className:"text-tremor-default text-tremor-content dark:text-dark-tremor-content text-lg",children:["Project Spend"," ",en.from&&en.to&&(0,a.jsxs)(a.Fragment,{children:[en.from.toLocaleDateString("en-US",{month:"short",day:"numeric",year:en.from.getFullYear()!==en.to.getFullYear()?"numeric":void 0})," - ",en.to.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),eh&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.Z,{style:{fontSize:"14px",color:"#6b7280"}}),(0,a.jsx)(f.default,{showSearch:!0,allowClear:!0,style:{width:300},placeholder:"All Users (Global View)",value:eZ,onChange:e=>eq(null!=e?e:null),filterOption:!1,onSearch:e=>{eg(e),ef(e)},searchValue:ep,onPopupScroll:e=>{let s=e.currentTarget;(s.scrollTop+s.clientHeight)/s.scrollHeight>=.8&&ev&&!eb&&ey()},loading:ek,notFoundContent:ek?(0,a.jsx)(l.Z,{spin:!0}):"No users found",options:eN,popupRender:e=>(0,a.jsxs)(a.Fragment,{children:[e,eb&&(0,a.jsx)("div",{style:{textAlign:"center",padding:8},children:(0,a.jsx)(l.Z,{spin:!0})})]})}),eZ&&(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Filtering by user"})]})]}),(0,a.jsx)(eR.Z,{userSpend:eG,selectedTeam:null,userMaxBudget:(null==ex?void 0:ex.max_budget)||null})]}),(0,a.jsx)(o.Z,{numColSpan:2,children:(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Usage Metrics"}),(0,a.jsxs)(d.Z,{numItems:5,className:"gap-4 mt-4",children:[(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Total Requests"}),(0,a.jsx)(g.Z,{className:"text-2xl font-bold mt-2",children:(null===(q=H.metadata)||void 0===q?void 0:null===(t=q.total_api_requests)||void 0===t?void 0:t.toLocaleString())||0})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Successful Requests"}),(0,a.jsx)(g.Z,{className:"text-2xl font-bold mt-2 text-green-600",children:(null===(D=H.metadata)||void 0===D?void 0:null===(S=D.total_successful_requests)||void 0===S?void 0:S.toLocaleString())||0})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.Z,{children:"Failed Requests"}),(0,a.jsx)(_.Z,{title:"Includes requests that failed to route to a provider, tool usage failures, and other request errors where the provider cannot be determined.",children:(0,a.jsx)(n.Z,{className:"text-gray-400 hover:text-gray-600"})})]}),(0,a.jsx)(g.Z,{className:"text-2xl font-bold mt-2 text-red-600",children:(null===(F=H.metadata)||void 0===F?void 0:null===(A=F.total_failed_requests)||void 0===A?void 0:A.toLocaleString())||0})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Total Tokens"}),(0,a.jsx)(g.Z,{className:"text-2xl font-bold mt-2",children:(null===(z=H.metadata)||void 0===z?void 0:null===(V=z.total_tokens)||void 0===V?void 0:V.toLocaleString())||0})]}),(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Average Cost per Request"}),(0,a.jsxs)(g.Z,{className:"text-2xl font-bold mt-2",children:["$",(0,O.pw)((eG||0)/((null===(I=H.metadata)||void 0===I?void 0:I.total_api_requests)||1),4)]})]})]})]})}),(0,a.jsx)(o.Z,{numColSpan:2,children:(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(j.Z,{children:"Daily Spend"}),X?(0,a.jsx)(eD,{isDateChanging:et}):(0,a.jsx)(i.Z,{data:[...H.results].sort((e,s)=>new Date(e.date).getTime()-new Date(s.date).getTime()),index:"date",categories:["metrics.spend"],colors:["cyan"],valueFormatter:G,yAxisWidth:100,showLegend:!1,customTooltip:e=>{let{payload:s,active:t}=e;if(!t||!(null==s?void 0:s[0]))return null;let r=s[0].payload;return(0,a.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,a.jsx)("p",{className:"font-bold",children:r.date}),(0,a.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,O.pw)(r.metrics.spend,2)]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Requests: ",r.metrics.api_requests]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Successful: ",r.metrics.successful_requests]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Failed: ",r.metrics.failed_requests]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",r.metrics.total_tokens]})]})}})]})}),(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsxs)(c.Z,{className:"h-full",children:[(0,a.jsx)(j.Z,{children:"Top Virtual Keys"}),(0,a.jsx)(eQ.Z,{topKeys:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,s={};return H.results.forEach(e=>{Object.entries(e.breakdown.api_keys||{}).forEach(e=>{let[t,a]=e;s[t]||(s[t]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{key_alias:a.metadata.key_alias,team_id:null,tags:a.metadata.tags||[]}}),s[t].metrics.spend+=a.metrics.spend,s[t].metrics.prompt_tokens+=a.metrics.prompt_tokens,s[t].metrics.completion_tokens+=a.metrics.completion_tokens,s[t].metrics.total_tokens+=a.metrics.total_tokens,s[t].metrics.api_requests+=a.metrics.api_requests,s[t].metrics.successful_requests+=a.metrics.successful_requests,s[t].metrics.failed_requests+=a.metrics.failed_requests,s[t].metrics.cache_read_input_tokens+=a.metrics.cache_read_input_tokens||0,s[t].metrics.cache_creation_input_tokens+=a.metrics.cache_creation_input_tokens||0})}),console.log("debugTags",{keySpend:s,userSpendData:H}),Object.entries(s).map(e=>{let[s,t]=e;return{api_key:s,key_alias:t.metadata.key_alias||"-",tags:t.metadata.tags||[],spend:t.metrics.spend}}).sort((e,s)=>s.spend-e.spend).slice(0,e)}(eY),teams:null,topKeysLimit:eY,setTopKeysLimit:eK})]})}),(0,a.jsx)(o.Z,{numColSpan:1,children:(0,a.jsxs)(c.Z,{className:"h-full",children:[(0,a.jsx)(j.Z,{children:"groups"===eS?"Top Public Model Names":"Top Litellm Models"}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)(y.Z,{options:[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25},{label:"50",value:50}],value:e$,onChange:e=>eW(e)}),(0,a.jsxs)("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[(0,a.jsx)("button",{className:"px-3 py-1 text-sm rounded-md transition-colors ".concat("groups"===eS?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"),onClick:()=>eL("groups"),children:"Public Model Name"}),(0,a.jsx)("button",{className:"px-3 py-1 text-sm rounded-md transition-colors ".concat("individual"===eS?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"),onClick:()=>eL("individual"),children:"Litellm Model Name"})]})]}),X?(0,a.jsx)(eD,{isDateChanging:et}):(0,a.jsx)("div",{className:"relative max-h-[600px] overflow-y-auto",children:(()=>{let e="groups"===eS?eX(e$):eJ(e$);return(0,a.jsx)(i.Z,{className:"mt-4",style:{height:52*Math.min(e.length,e$)},data:e,index:"key",categories:["spend"],colors:["cyan"],valueFormatter:G,layout:"vertical",yAxisWidth:200,showLegend:!1,customTooltip:e=>{let{payload:s,active:t}=e;if(!t||!(null==s?void 0:s[0]))return null;let r=s[0].payload;return(0,a.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,a.jsx)("p",{className:"font-bold",children:r.key}),(0,a.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,O.pw)(r.spend,2)]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Total Requests: ",r.requests.toLocaleString()]}),(0,a.jsxs)("p",{className:"text-green-600",children:["Successful: ",r.successful_requests.toLocaleString()]}),(0,a.jsxs)("p",{className:"text-red-600",children:["Failed: ",r.failed_requests.toLocaleString()]}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",r.tokens.toLocaleString()]})]})}})})()})]})}),(0,a.jsx)(o.Z,{numColSpan:2,children:(0,a.jsx)(e4,{loading:X,isDateChanging:et,providerSpend:(()=>{let e={};return H.results.forEach(s=>{Object.entries(s.breakdown.providers||{}).forEach(s=>{let[t,a]=s;e[t]||(e[t]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),e[t].metrics.spend+=a.metrics.spend,e[t].metrics.prompt_tokens+=a.metrics.prompt_tokens,e[t].metrics.completion_tokens+=a.metrics.completion_tokens,e[t].metrics.total_tokens+=a.metrics.total_tokens,e[t].metrics.api_requests+=a.metrics.api_requests,e[t].metrics.successful_requests+=a.metrics.successful_requests||0,e[t].metrics.failed_requests+=a.metrics.failed_requests||0,e[t].metrics.cache_read_input_tokens+=a.metrics.cache_read_input_tokens||0,e[t].metrics.cache_creation_input_tokens+=a.metrics.cache_creation_input_tokens||0})}),Object.entries(e).map(e=>{let[s,t]=e;return{provider:s,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens}})})()})})]})}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(Q,{modelMetrics:e5})}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(Q,{modelMetrics:e6})}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(Q,{modelMetrics:e3})}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(eB,{userSpendData:H})})]})]})}),"organization"===eU&&(0,a.jsx)(e1,{accessToken:K,entityType:"organization",userID:W,userRole:$,dateValue:en,entityList:(null==Y?void 0:Y.map(e=>({label:e.organization_alias,value:e.organization_id})))||null,premiumUser:B}),"team"===eU&&(0,a.jsx)(e1,{accessToken:K,entityType:"team",userID:W,userRole:$,entityList:(null==P?void 0:P.map(e=>({label:e.team_alias,value:e.team_id})))||null,premiumUser:B,dateValue:en}),"customer"===eU&&(0,a.jsx)(e1,{accessToken:K,entityType:"customer",userID:W,userRole:$,entityList:(null==eu?void 0:eu.map(e=>({label:e.alias||e.user_id,value:e.user_id})))||null,premiumUser:B,dateValue:en}),"tag"===eU&&(0,a.jsxs)(a.Fragment,{children:[ez&&(0,a.jsx)(v.Z,{banner:!0,type:"info",message:"Reusable credentials are automatically tracked as tags",description:(0,a.jsxs)(b.default.Text,{children:["When a reusable credential is used, it will appear as a tag prefixed with"," ",(0,a.jsx)(b.default.Text,{code:!0,children:"Credential: "}),"in this view."]}),closable:!0,onClose:()=>eP(!1),className:"mb-5"}),(0,a.jsx)(e1,{accessToken:K,entityType:"tag",userID:W,userRole:$,entityList:eo,premiumUser:B,dateValue:en})]}),"agent"===eU&&(0,a.jsx)(e1,{accessToken:K,entityType:"agent",userID:W,userRole:$,entityList:(null==em?void 0:null===(R=em.agents)||void 0===R?void 0:R.map(e=>({label:e.agent_name,value:e.agent_id})))||null,premiumUser:B,dateValue:en}),"user-agent-activity"===eU&&(0,a.jsx)(eI,{accessToken:K,userRole:$,dateValue:en})]})}),(0,a.jsx)(ec,{isOpen:eT,onClose:()=>eE(!1),accessToken:K}),(0,a.jsx)(ew,{isOpen:eA,onClose:()=>eF(!1),entityType:"team",spendData:{results:H.results,metadata:H.metadata},dateRange:en,selectedFilters:[],customTitle:"Export Usage Data"}),(0,a.jsx)(sm,{open:eM,onClose:()=>eO(!1),accessToken:K})]})}},2431:function(e,s,t){var a=t(57437),r=t(5540),l=t(49634),n=t(19431),i=t(77398),c=t.n(i),o=t(2265);let d=[{label:"Today",shortLabel:"today",getValue:()=>({from:c()().startOf("day").toDate(),to:c()().endOf("day").toDate()})},{label:"Last 7 days",shortLabel:"7d",getValue:()=>({from:c()().subtract(7,"days").startOf("day").toDate(),to:c()().endOf("day").toDate()})},{label:"Last 30 days",shortLabel:"30d",getValue:()=>({from:c()().subtract(30,"days").startOf("day").toDate(),to:c()().endOf("day").toDate()})},{label:"Month to date",shortLabel:"MTD",getValue:()=>({from:c()().startOf("month").toDate(),to:c()().endOf("day").toDate()})},{label:"Year to date",shortLabel:"YTD",getValue:()=>({from:c()().startOf("year").toDate(),to:c()().endOf("day").toDate()})}];s.Z=e=>{let{value:s,onValueChange:t,label:i="Select Time Range",showTimeRange:u=!0}=e,[m,x]=(0,o.useState)(!1),[h,p]=(0,o.useState)(s),[g,j]=(0,o.useState)(null),[f,_]=(0,o.useState)(""),[y,v]=(0,o.useState)(""),b=(0,o.useRef)(null),k=(0,o.useCallback)(e=>{if(!e.from||!e.to)return null;for(let s of d){let t=s.getValue(),a=c()(e.from).isSame(c()(t.from),"day"),r=c()(e.to).isSame(c()(t.to),"day");if(a&&r)return s.shortLabel}return null},[]);(0,o.useEffect)(()=>{j(k(s))},[s,k]);let N=(0,o.useCallback)(()=>{if(!f||!y)return{isValid:!0,error:""};let e=c()(f,"YYYY-MM-DD"),s=c()(y,"YYYY-MM-DD");return e.isValid()&&s.isValid()?s.isBefore(e)?{isValid:!1,error:"End date cannot be before start date"}:{isValid:!0,error:""}:{isValid:!1,error:"Invalid date format"}},[f,y])();(0,o.useEffect)(()=>{s.from&&_(c()(s.from).format("YYYY-MM-DD")),s.to&&v(c()(s.to).format("YYYY-MM-DD")),p(s)},[s]),(0,o.useEffect)(()=>{let e=e=>{b.current&&!b.current.contains(e.target)&&x(!1)};return m&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[m]);let Z=(0,o.useCallback)((e,s)=>{if(!e||!s)return"Select date range";let t=e=>c()(e).format("D MMM, HH:mm");return"".concat(t(e)," - ").concat(t(s))},[]),w=(0,o.useCallback)(e=>{let s;if(!e.from)return e;let t={...e},a=new Date(e.from);return s=new Date(e.to?e.to:e.from),a.toDateString(),s.toDateString(),a.setHours(0,0,0,0),s.setHours(23,59,59,999),t.from=a,t.to=s,t},[]),q=e=>{let{from:s,to:t}=e.getValue();p({from:s,to:t}),j(e.shortLabel),_(c()(s).format("YYYY-MM-DD")),v(c()(t).format("YYYY-MM-DD"))},S=(0,o.useCallback)(()=>{try{if(f&&y&&N.isValid){let e=c()(f,"YYYY-MM-DD").startOf("day"),s=c()(y,"YYYY-MM-DD").endOf("day");if(e.isValid()&&s.isValid()){let t={from:e.toDate(),to:s.toDate()};p(t);let a=k(t);j(a)}}}catch(e){console.warn("Invalid date format:",e)}},[f,y,N.isValid,k]);return(0,o.useEffect)(()=>{S()},[S]),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[i&&(0,a.jsx)(n.x,{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:i}),(0,a.jsxs)("div",{className:"relative",ref:b,children:[(0,a.jsx)("div",{className:"w-[300px] px-3 py-2 text-sm border border-gray-300 rounded-md bg-white cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",onClick:()=>x(!m),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.Z,{className:"text-gray-600"}),(0,a.jsx)("span",{className:"text-gray-900",children:Z(s.from,s.to)})]}),(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(m?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),m&&(0,a.jsx)("div",{className:"absolute top-full right-0 z-[9999] min-w-[600px] mt-1 bg-white border border-gray-200 rounded-lg shadow-xl",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsxs)("div",{className:"w-1/2 border-r border-gray-200",children:[(0,a.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Relative time"})}),(0,a.jsx)("div",{className:"h-[350px] overflow-y-auto",children:d.map(e=>{let s=g===e.shortLabel;return(0,a.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 cursor-pointer border-b border-gray-100 transition-colors ".concat(s?"bg-blue-50 hover:bg-blue-100 border-blue-200":"hover:bg-gray-50"),onClick:()=>q(e),children:[(0,a.jsx)("span",{className:"text-sm ".concat(s?"text-blue-700 font-medium":"text-gray-700"),children:e.label}),(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded capitalize ".concat(s?"text-blue-700 bg-blue-100":"text-gray-500 bg-gray-100"),children:e.shortLabel})]},e.label)})})]}),(0,a.jsxs)("div",{className:"w-1/2 relative",children:[(0,a.jsx)("div",{className:"p-3.5 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.Z,{className:"text-gray-600"}),(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Start and end dates"})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-6 pb-20",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm text-gray-700 mb-1 block",children:"Start date"}),(0,a.jsx)("input",{type:"date",value:f,onChange:e=>_(e.target.value),className:"w-65 px-3 py-2 text-sm border rounded-md cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 ".concat(N.isValid?"border-gray-300":"border-red-300 focus:border-red-500 focus:ring-red-200")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm text-gray-700 mb-1 block",children:"End date"}),(0,a.jsx)("input",{type:"date",value:y,onChange:e=>v(e.target.value),className:"w-65 px-3 py-2 text-sm border rounded-md cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 ".concat(N.isValid?"border-gray-300":"border-red-300 focus:border-red-500 focus:ring-red-200")})]}),!N.isValid&&N.error&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,a.jsx)("span",{className:"text-sm text-red-700 font-medium",children:N.error})]})}),h.from&&h.to&&N.isValid&&(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md space-y-1",children:[(0,a.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,a.jsx)("span",{className:"font-medium",children:"From:"})," ",c()(h.from).format("MMM D, YYYY [at] HH:mm:ss")]}),(0,a.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,a.jsx)("span",{className:"font-medium",children:"To:"})," ",c()(h.to).format("MMM D, YYYY [at] HH:mm:ss")]})]})]}),(0,a.jsx)("div",{className:"absolute bottom-4 right-4",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(n.z,{variant:"secondary",onClick:()=>{p(s),s.from&&_(c()(s.from).format("YYYY-MM-DD")),s.to&&v(c()(s.to).format("YYYY-MM-DD")),j(k(s)),x(!1)},children:"Cancel"}),(0,a.jsx)(n.z,{onClick:()=>{h.from&&h.to&&N.isValid&&(t(h),requestIdleCallback(()=>{t(w(h))},{timeout:100}),x(!1))},disabled:!h.from||!h.to||!N.isValid,children:"Apply"})]})})]})]})})]})]})}},91323:function(e,s,t){t.d(s,{S:function(){return n}});var a=t(57437),r=t(2265),l=t(10012);function n(e){var s,t;let{className:n="",...i}=e,c=(0,r.useId)();return s=()=>{let e=document.getAnimations().filter(e=>e instanceof CSSAnimation&&"spin"===e.animationName),s=e.find(e=>{var s;return(null===(s=e.effect.target)||void 0===s?void 0:s.getAttribute("data-spinner-id"))===c}),t=e.find(e=>{var s;return e.effect instanceof KeyframeEffect&&(null===(s=e.effect.target)||void 0===s?void 0:s.getAttribute("data-spinner-id"))!==c});s&&t&&(s.currentTime=t.currentTime)},t=[c],(0,r.useLayoutEffect)(s,t),(0,a.jsxs)("svg",{"data-spinner-id":c,className:(0,l.cx)("pointer-events-none size-12 animate-spin text-current",n),fill:"none",viewBox:"0 0 24 24",...i,children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}},47375:function(e,s,t){var a=t(57437),r=t(2265),l=t(19250),n=t(59872),i=t(39760);s.Z=e=>{let{userSpend:s,userMaxBudget:t,selectedTeam:c}=e,{accessToken:o,userRole:d,userId:u}=(0,i.Z)(),[m,x]=(0,r.useState)(null!==s?s:0),[h,p]=(0,r.useState)(c?Number((0,n.pw)(c.max_budget,4)):null);(0,r.useEffect)(()=>{if(c){if("Default Team"===c.team_alias)p(t);else{let e=!1;if(c.team_memberships)for(let s of c.team_memberships)s.user_id===u&&"max_budget"in s.litellm_budget_table&&null!==s.litellm_budget_table.max_budget&&(p(s.litellm_budget_table.max_budget),e=!0);e||p(c.max_budget)}}else p(t)},[c,t]);let[g,j]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=async()=>{if(!o||!u||!d)return};(async()=>{try{if(null===u||null===d)return;if(null!==o){let e=(await (0,l.modelAvailableCall)(o,u,d)).data.map(e=>e.id);console.log("available_model_names:",e),j(e)}}catch(e){console.error("Error fetching user models:",e)}})(),e()},[d,o,u]),(0,r.useEffect)(()=>{null!==s&&x(s)},[s]);let f=[];c&&c.models&&(f=c.models),f&&f.includes("all-proxy-models")?(console.log("user models:",g),f=g):f&&f.includes("all-team-models")?f=c.models:f&&0===f.length&&(f=g);let _=null!==h?"$".concat((0,n.pw)(Number(h),4)," limit"):"No limit",y=void 0!==m?(0,n.pw)(m,4):null;return console.log("spend in view user spend: ".concat(m)),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("div",{className:"flex justify-between gap-x-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-tremor-default text-tremor-content dark:text-dark-tremor-content",children:"Total Spend"}),(0,a.jsxs)("p",{className:"text-2xl text-tremor-content-strong dark:text-dark-tremor-content-strong font-semibold",children:["$",y]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-tremor-default text-tremor-content dark:text-dark-tremor-content",children:"Max Budget"}),(0,a.jsx)("p",{className:"text-2xl text-tremor-content-strong dark:text-dark-tremor-content-strong font-semibold",children:_})]})]})})}}}]);